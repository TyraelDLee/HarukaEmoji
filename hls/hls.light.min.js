(function t(e){(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"==typeof globalThis?e||self:globalThis,e.Hls=t())})(this,function(){"use strict";var a=Math.ceil,r=Math.exp,n=Number.POSITIVE_INFINITY,d=Number.isFinite,o=Math.round,s=Math.min,l=Math.abs,u=Number.MAX_SAFE_INTEGER,f=Math.floor,g=Math.pow,c=Math.max,m=String.fromCharCode;function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,r)}return a}function y(e){for(var t=1,a;t<arguments.length;t++)a=null==arguments[t]?{}:arguments[t],t%2?p(Object(a),!0).forEach(function(t){T(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))});return e}function h(e,t){for(var a=0,r;a<t.length;a++)r=t[a],r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,x(r.key),r)}function E(e,t,a){return t&&h(e.prototype,t),a&&h(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function T(e,t,a){return t=x(t),t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function L(){return L=Object.assign?Object.assign.bind():function(e){for(var t=1,a;t<arguments.length;t++)for(var r in a=arguments[t],a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r]);return e},L.apply(this,arguments)}function v(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,R(e,t)}function S(e){return S=Object.setPrototypeOf?Object.getPrototypeOf.bind():function t(e){return e.__proto__||Object.getPrototypeOf(e)},S(e)}function R(e,t){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function a(e,t){return e.__proto__=t,e},R(e,t)}function A(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function D(e,t,a){return D=A()?Reflect.construct.bind():function n(e,t,r){var d=[null];d.push.apply(d,t);var a=Function.bind.apply(e,d),i=new a;return r&&R(i,r.prototype),i},D.apply(null,arguments)}function _(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function b(e){var t="function"==typeof Map?new Map:void 0;return b=function a(e){function r(){return D(e,arguments,S(this).constructor)}if(null===e||!_(e))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!=typeof t){if(t.has(e))return t.get(e);t.set(e,r)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),R(r,e)},b(e)}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e,t){if("object"!=typeof e||null===e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var r=a.call(e,t||"default");if("object"!=typeof r)return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function x(e){var t=I(e,"string");return"symbol"==typeof t?t:t+""}function C(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}function P(e){var t=self.console[e];return t?t.bind(self.console,"["+e+"] >"):Sa}function F(e){for(var t=arguments.length,a=Array(1<t?t-1:0),r=1;r<t;r++)a[r-1]=arguments[r];a.forEach(function(t){Aa[t]=e[t]?e[t].bind(e):P(t)})}function O(e,t){if(self.console&&!0===e||"object"==typeof e){F(e,"debug","log","info","warn","error");try{Aa.log("Debug logs enabled for \""+t+"\" in hls.js version 1.4.12")}catch(t){Aa=Ra}}else Aa=Ra}function N(e){return"ID"!==e&&"CLASS"!==e&&"START-DATE"!==e&&"DURATION"!==e&&"END-DATE"!==e&&"END-ON-NEXT"!==e}function w(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e}function M(e,t,a){return Uint8Array.prototype.slice?e.slice(t,a):new Uint8Array(Array.prototype.slice.call(e,t,a))}function B(){return un||"undefined"==typeof self.TextDecoder||(un=new self.TextDecoder("utf-8")),un}function U(e){return m.apply(null,e)}function G(e,t){var a=e[t]<<8|e[t+1];return 0>a?65536+a:a}function K(e,t){var a=H(e,t);return 0>a?4294967296+a:a}function H(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function V(e,t,a){e[t]=a>>24,e[t+1]=255&a>>16,e[t+2]=255&a>>8,e[t+3]=255&a}function W(e,t){var a=[];if(!t.length)return a;for(var r=e.byteLength,n=0;n<r;){var d=K(e,n),o=U(e.subarray(n+4,n+8)),s=1<d?n+d:r;if(o===t[0])if(1===t.length)a.push(e.subarray(n+8,s));else{var l=W(e.subarray(n+8,s),t.slice(1));l.length&&er.apply(a,l)}n=s}return a}function Y(e){var t=[],a=e[0],r=8,n=K(e,r);r+=4;var d=0,o=0;r+=0===a?8:16,r+=2;var s=e.length+o,l=G(e,r);r+=2;for(var u=0;u<l;u++){var f=r,g=K(e,f);f+=4;var c=2147483647&g,m=(2147483648&g)>>>31;if(1===m)return Da.warn("SIDX has hierarchical references (not supported)"),null;var p=K(e,f);f+=4,t.push({referenceSize:c,subsegmentDuration:p,info:{duration:p/n,start:s,end:s+c-1}}),s+=c,f+=4,r=f}return{earliestPresentationTime:0,timescale:n,version:a,referencesCount:l,references:t}}function q(e){for(var t=[],a=W(e,["moov","trak"]),r=0;r<a.length;r++){var n=a[r],d=W(n,["tkhd"])[0];if(d){var o=d[0],s=0===o?12:20,l=K(d,s),u=W(n,["mdia","mdhd"])[0];if(u){o=u[0],s=0===o?12:20;var f=K(u,s),g=W(n,["mdia","hdlr"])[0];if(g){var c=U(g.subarray(8,12)),m={soun:Ca.AUDIO,vide:Ca.VIDEO}[c];if(m){var p=W(n,["mdia","minf","stbl","stsd"])[0],y=void 0;p&&(y=U(p.subarray(12,16))),t[l]={timescale:f,type:m},t[m]={timescale:f,id:l,codec:y}}}}}}var h=W(e,["moov","mvex","trex"]);return h.forEach(function(e){var a=K(e,4),r=t[a];r&&(r.default={duration:K(e,12),flags:K(e,20)})}),t}function z(e,t){if(!e||!t)return e;var a=t.keyId;if(a&&t.isCommonEncryption){var r=W(e,["moov","trak"]);r.forEach(function(e){var t=W(e,["mdia","minf","stbl","stsd"])[0],r=t.subarray(8),n=W(r,["enca"]),d=0<n.length;d||(n=W(r,["encv"])),n.forEach(function(e){var t=d?e.subarray(28):e.subarray(78),r=W(t,["sinf"]);r.forEach(function(e){var t=j(e);if(t){var r=t.subarray(8,24);r.some(function(e){return 0!==e})||(Da.log("[eme] Patching keyId in 'enc"+(d?"a":"v")+">sinf>>tenc' box: "+$a.hexDump(r)+" -> "+$a.hexDump(a)),t.set(a,8))}})})})}return e}function j(e){var t=W(e,["schm"])[0];if(t){var a=U(t.subarray(4,8));if("cbcs"===a||"cenc"===a)return W(e,["schi","tenc"])[0]}return Da.error("[eme] missing 'schm' box"),null}function X(e,t){return W(t,["moof","traf"]).reduce(function(t,a){var r=W(a,["tfdt"])[0],n=r[0],d=W(a,["tfhd"]).reduce(function(t,a){var d=K(a,4),i=e[d];if(i){var o=K(r,4);if(1===n){if(4294967295===o)return Da.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;o*=4294967296,o+=K(r,8)}var s=i.timescale||9e4,l=o/s;if(isFinite(l)&&(null===t||l<t))return l}return t},null);return null!==d&&isFinite(d)&&(null===t||d<t)?d:t},null)}function Q(e,t){for(var a=0,r=0,n=0,d=W(e,["moof","traf"]),o=0;o<d.length;o++){var s=d[o],l=W(s,["tfhd"])[0],u=K(l,4),f=t[u];if(f){var g=f.default,c=K(l,0)|(null==g?void 0:g.flags),m=null==g?void 0:g.duration;8&c&&(2&c?m=K(l,12):m=K(l,8));for(var p=f.timescale||9e4,y=W(s,["trun"]),h=0;h<y.length;h++){if(a=Z(y[h]),!a&&m){var E=K(y[h],4);a=m*E}f.type===Ca.VIDEO?r+=a/p:f.type===Ca.AUDIO&&(n+=a/p)}}}if(0===r&&0===n){for(var T=0,L=W(e,["sidx"]),v=0,S;v<L.length;v++)S=Y(L[v]),null!=S&&S.references&&(T+=S.references.reduce(function(e,t){return e+t.info.duration||0},0));return T}return r?r:n}function Z(e){var t=K(e,0),a=8;1&t&&(a+=4),4&t&&(a+=4);for(var r=0,n=K(e,4),d=0;d<n;d++){if(256&t){var o=K(e,a);r+=o,a+=4}512&t&&(a+=4),1024&t&&(a+=4),2048&t&&(a+=4)}return r}function $(e,t,a){W(t,["moof","traf"]).forEach(function(t){W(t,["tfhd"]).forEach(function(r){var n=K(r,4),d=e[n];if(d){var i=d.timescale||9e4;W(t,["tfdt"]).forEach(function(e){var t=e[0],r=K(e,4);if(0===t)r-=a*i,r=c(r,0),V(e,4,r);else{r*=g(2,32),r+=K(e,8),r-=a*i,r=c(r,0);var n=f(r/4294967296),d=f(r%4294967296);V(e,4,n),V(e,8,d)}})}})})}function J(e){var t={valid:null,remainder:null},a=W(e,["moof"]);if(!a)return t;if(2>a.length)return t.remainder=e,t;var r=a[a.length-1];return t.valid=M(e,0,r.byteOffset-8),t.remainder=M(e,r.byteOffset-8),t}function ee(e,t){var a=new Uint8Array(e.length+t.length);return a.set(e),a.set(t,e.length),a}function te(e,t){var a=[],r=t.samples,n=t.timescale,d=t.id,i=!1,o=W(r,["moof"]);return o.map(function(o){var s=o.byteOffset-8,l=W(o,["traf"]);l.map(function(o){var l=W(o,["tfdt"]).map(function(e){var t=e[0],a=K(e,4);return 1===t&&(a*=g(2,32),a+=K(e,8)),a/n})[0];return void 0!==l&&(e=l),W(o,["tfhd"]).map(function(l){var u=K(l,4),f=16777215&K(l,0),g=0!=(1&f),c=0!=(2&f),m=0!=(8&f),p=0,y=0!=(16&f),h=0,E=0!=(32&f),T=8;u===d&&(g&&(T+=8),c&&(T+=4),m&&(p=K(l,T),T+=4),y&&(h=K(l,T),T+=4),E&&(T+=4),"video"===t.type&&(i=ae(t.codec)),W(o,["trun"]).map(function(d){var o=d[0],l=16777215&K(d,0),u=0!=(1&l),f=0,g=0!=(4&l),c=0!=(256&l),m=0,y=0!=(512&l),E=0,T=0!=(1024&l),L=0!=(2048&l),v=0,S=K(d,4),R=8;u&&(f=K(d,R),R+=4),g&&(R+=4);for(var A=f+s,D=0;D<S;D++){if(c?(m=K(d,R),R+=4):m=p,y?(E=K(d,R),R+=4):E=h,T&&(R+=4),L&&(v=0===o?K(d,R):H(d,R),R+=4),t.type===Ca.VIDEO)for(var _=0,b;_<E;){if(b=K(r,A),A+=4,re(i,r[A])){var k=r.subarray(A,A+b);ne(k,i?2:1,e+v/n,a)}A+=b,_+=b+4}e+=m/n}}))})})}),a}function ae(e){if(!e)return!1;var t=e.indexOf("."),a=0>t?e:e.substring(0,t);return"hvc1"===a||"hev1"===a||"dvh1"===a||"dvhe"===a}function re(e,t){if(e){var a=63&t>>1;return 39==a||40===a}var r=31&t;return 6==r}function ne(e,t,a,r){var n=de(e),d=0;d+=t;for(var o=0,s=0,l=!1,u=0;d<n.length;){o=0;do{if(d>=n.length)break;u=n[d++],o+=u}while(255===u);s=0;do{if(d>=n.length)break;u=n[d++],s+=u}while(255===u);var f=n.length-d;if(!l&&4===o&&d<n.length){l=!0;var g=n[d++];if(181===g){var c=G(n,d);if(d+=2,49===c){var m=K(n,d);if(d+=4,1195456820===m){var p=n[d++];if(3===p){var y=n[d++],h=31&y,E=64&y,T=E?2+3*h:0,L=new Uint8Array(T);if(E){L[0]=y;for(var v=1;v<T;v++)L[v]=n[d++]}r.push({type:p,payloadType:o,pts:a,bytes:L})}}}}}else if(5===o&&s<f){if(l=!0,16<s){for(var S=[],R=0,A;16>R;R++)A=n[d++].toString(16),S.push(1==A.length?"0"+A:A),(3==R||5===R||7===R||9===R)&&S.push("-");for(var D=s-16,_=new Uint8Array(D),k=0;k<D;k++)_[k]=n[d++];r.push({payloadType:o,pts:a,uuid:S.join(""),userData:Za(_),userDataBytes:_})}}else if(s<f)d+=s;else if(s>f)break}}function de(e){for(var t=e.byteLength,a=[],r=1;r<t-2;)0===e[r]&&0===e[r+1]&&3===e[r+2]?(a.push(r+2),r+=2):r++;if(0===a.length)return e;var n=t-a.length,d=new Uint8Array(n),o=0;for(r=0;r<n;o++,r++)o===a[0]&&(o++,a.shift()),d[r]=e[o];return d}function ie(e){var t=Number.isSafeInteger,a=e[0],r="",n="",d=0,i=0,o=0,s=0,l=0,f=0;if(0===a){for(;"\0"!==U(e.subarray(f,f+1));)r+=U(e.subarray(f,f+1)),f+=1;for(r+=U(e.subarray(f,f+1)),f+=1;"\0"!==U(e.subarray(f,f+1));)n+=U(e.subarray(f,f+1)),f+=1;n+=U(e.subarray(f,f+1)),f+=1,d=K(e,12),i=K(e,16),s=K(e,20),l=K(e,24),f=28}else if(1===a){f+=4,d=K(e,f),f+=4;var c=K(e,f);f+=4;var m=K(e,f);for(f+=4,o=g(2,32)*c+m,t(o)||(o=u,Da.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),s=K(e,f),f+=4,l=K(e,f),f+=4;"\0"!==U(e.subarray(f,f+1));)r+=U(e.subarray(f,f+1)),f+=1;for(r+=U(e.subarray(f,f+1)),f+=1;"\0"!==U(e.subarray(f,f+1));)n+=U(e.subarray(f,f+1)),f+=1;n+=U(e.subarray(f,f+1)),f+=1}var p=e.subarray(f,e.byteLength);return{schemeIdUri:r,value:n,timeScale:d,presentationTime:o,presentationTimeDelta:i,eventDuration:s,id:l,payload:p}}function oe(e){for(var t=new Uint8Array(16),a=12;16>a;a++)t[a]=255&e>>8*(15-a);return t}function se(){return"undefined"==typeof self?void 0:self.MediaSource||self.WebKitMediaSource}function le(e,t){var a=rr[t];return!!a&&!0===a[e.slice(0,4)]}function ue(e,t){var a;return null!=(a=null==nr?void 0:nr.isTypeSupported((t||"video")+"/mp4;codecs=\""+e+"\""))&&a}function fe(e,t,a){var r=new ka(e),n=null==(l=r.METHOD)?"":l,d=r.URI,i=r.hexadecimalInteger("IV"),o=r.KEYFORMATVERSIONS,s=null==(u=r.KEYFORMAT)?"identity":u,l,u;d&&r.IV&&!i&&Da.error("Invalid IV: "+r.IV);var f=d?ur.resolve(d,t):"",g=(o?o:"1").split("/").map(Number).filter(Number.isFinite);return new ar(n,f,s,g,i)}function ge(e){var t=new ka(e),a=t.decimalFloatingPoint("TIME-OFFSET");return Ea(a)?a:null}function ce(e,t){["video","audio","text"].forEach(function(a){var r=e.filter(function(e){return le(e,a)});if(r.length){var n=r.filter(function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)});t[a+"Codec"]=0<n.length?n[0]:r[0],e=e.filter(function(e){return-1===r.indexOf(e)})}}),t.unknownCodecs=e}function me(e,t,a){var r=t[a];r&&(e[a]=r)}function pe(e,t){for(var a=e[t],r=t,n;r--;){if(n=e[r],!n)return;n.programDateTime=a.programDateTime-1e3*n.duration,a=n}}function ye(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),Ea(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function he(e,t,a,r){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=a,e.sn="initSegment",r&&(e.levelkeys=r),e.initSegment=null}function Ee(e,t,a){e.levelkeys=t;var r=a.encryptedFragments;(!r.length||r[r.length-1].levelkeys!==t)&&Object.keys(t).some(function(e){return t[e].isCommonEncryption})&&r.push(e)}function Te(e){var t=e.type;return t===fr.AUDIO_TRACK?gr.AUDIO:t===fr.SUBTITLE_TRACK?gr.SUBTITLE:gr.MAIN}function Le(e,t){var a=e.url;return(void 0===a||0===a.indexOf("data:"))&&(a=t.url),a}function ve(e,t){var a;try{a=new Event("addtrack")}catch(e){a=document.createEvent("Event"),a.initEvent("addtrack",!1,!1)}a.track=e,t.dispatchEvent(a)}function Se(e){var t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(var a=e.cues.length;a--;)e.removeCue(e.cues[a]);"disabled"===t&&(e.mode=t)}function Re(e,t,a,r){var n=e.mode;if("disabled"===n&&(e.mode="hidden"),e.cues&&0<e.cues.length)for(var d=De(e.cues,t,a),o=0;o<d.length;o++)(!r||r(d[o]))&&e.removeCue(d[o]);"disabled"===n&&(e.mode=n)}function Ae(e,t){if(t<e[0].startTime)return 0;var a=e.length-1;if(t>e[a].endTime)return-1;for(var r=0,n=a,d;r<=n;)if(d=f((n+r)/2),t<e[d].startTime)n=d-1;else if(t>e[d].startTime&&r<a)r=d+1;else return d;return e[r].startTime-t<t-e[n].startTime?r:n}function De(e,t,a){var r=[],n=Ae(e,t);if(-1<n)for(var d=n,o=e.length,s;d<o;d++)if(s=e[d],s.startTime>=t&&s.endTime<=a)r.push(s);else if(s.startTime>a)return r;return r}function _e(){return"undefined"==typeof self?void 0:self.WebKitDataCue||self.VTTCue||self.TextTrackCue}function be(e,t){return e.getTime()/1e3-t}function ke(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function Ie(e,t){var a=e.canSkipUntil,r=e.canSkipDateRanges,n=e.endSN,d=void 0===t?0:t-n;return a&&d<a?r?Tr.v2:Tr.Yes:Tr.No}function xe(e,t){var a=t.startPTS;if(Ea(a)){var r=0,n;t.sn>e.sn?(r=a-e.start,n=e):(r=e.start-a,n=t),n.duration!==r&&(n.duration=r)}else if(t.sn>e.sn){var d=e.cc===t.cc;t.start=d&&e.minEndPTS?e.start+(e.minEndPTS-e.start):e.start+e.duration}else t.start=c(e.start-t.duration,0)}function Ce(e,t,a,r,n,d){var o=r-a;0>=o&&(Da.warn("Fragment should have a positive duration",t),r=a+t.duration,d=n+t.duration);var u=a,f=r,g=t.startPTS,m=t.endPTS;if(Ea(g)){var p=l(g-a);t.deltaPTS=Ea(t.deltaPTS)?c(p,t.deltaPTS):p,u=c(a,g),a=s(a,g),n=s(n,t.startDTS),f=s(r,m),r=c(r,m),d=c(d,t.endDTS)}var y=a-t.start;0!==t.start&&(t.start=a),t.duration=r-t.start,t.startPTS=a,t.maxStartPTS=u,t.startDTS=n,t.endPTS=r,t.minEndPTS=f,t.endDTS=d;var h=t.sn;if(!e||h<e.startSN||h>e.endSN)return 0;var E=h-e.startSN,T=e.fragments,L;for(T[E]=t,L=E;0<L;L--)xe(T[L],T[L-1]);for(L=E;L<T.length-1;L++)xe(T[L],T[L+1]);return e.fragmentHint&&xe(T[T.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,y}function Pe(e,t){for(var a=null,r=e.fragments,n=r.length-1,d;0<=n;n--)if(d=r[n].initSegment,d){a=d;break}e.fragmentHint&&delete e.fragmentHint.endPTS;var o=0,s;if(Ne(e,t,function(e,r){e.relurl&&(o=e.cc-r.cc),Ea(e.startPTS)&&Ea(e.endPTS)&&(r.start=r.startPTS=e.startPTS,r.startDTS=e.startDTS,r.maxStartPTS=e.maxStartPTS,r.endPTS=e.endPTS,r.endDTS=e.endDTS,r.minEndPTS=e.minEndPTS,r.duration=e.endPTS-e.startPTS,r.duration&&(s=r),t.PTSKnown=t.alignedSliding=!0),r.elementaryStreams=e.elementaryStreams,r.loader=e.loader,r.stats=e.stats,r.urlId=e.urlId,e.initSegment&&(r.initSegment=e.initSegment,a=e.initSegment)}),a){var l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;l.forEach(function(e){var t;e.initSegment&&e.initSegment.relurl!==(null==(t=a)?void 0:t.relurl)||(e.initSegment=a)})}if(t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some(function(e){return!e}),t.deltaUpdateFailed){Da.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var u=t.skippedSegments;u--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=Fe(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));var f=t.fragments;if(o){Da.warn("discontinuity sliding from playlist, take drift into account");for(var g=0;g<f.length;g++)f[g].cc+=o}t.skippedSegments&&(t.startCC=t.fragments[0].cc),Oe(e.partList,t.partList,function(e,t){t.elementaryStreams=e.elementaryStreams,t.stats=e.stats}),s?Ce(t,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):we(e,t),f.length&&(t.totalduration=t.edge-f[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;var c=t.advancedDateTime;if(t.advanced&&c){var m=t.edge;t.driftStart||(t.driftStartTime=c,t.driftStart=m),t.driftEndTime=c,t.driftEnd=m}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function Fe(e,t,a){var r=L({},e);return a&&a.forEach(function(e){delete r[e]}),Object.keys(t).forEach(function(e){var a=new Ia(t[e].attr,r[e]);a.isValid?r[e]=a:Da.warn("Ignoring invalid Playlist Delta Update DATERANGE tag: \""+JSON.stringify(t[e].attr)+"\"")}),r}function Oe(e,t,a){if(e&&t)for(var r=0,n=0,d=e.length;n<=d;n++){var o=e[n],s=t[n+r];o&&s&&o.index===s.index&&o.fragment.sn===s.fragment.sn?a(o,s):r--}}function Ne(e,t,a){for(var r=t.skippedSegments,n=c(e.startSN,t.startSN)-t.startSN,d=(e.fragmentHint?1:0)+(r?t.endSN:s(e.endSN,t.endSN))-t.startSN,o=t.startSN-e.startSN,l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,f=n;f<=d;f++){var g=u[o+f],m=l[f];r&&!m&&f<r&&(m=t.fragments[f]=g),g&&m&&a(g,m)}}function we(e,t){var a=t.startSN+t.skippedSegments-e.startSN,r=e.fragments;0>a||a>=r.length||Me(t,r[a].start)}function Me(e,t){if(t){for(var a=e.fragments,r=e.skippedSegments;r<a.length;r++)a[r].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function Be(e,t){void 0===t&&(t=1/0);var a=1e3*e.targetduration;if(e.updated){var r=e.fragments,n=4;if(r.length&&a*n>t){var d=1e3*r[r.length-1].duration;d<a&&(a=d)}}else a/=2;return o(a)}function Ue(e,t,a){if(!(null!=e&&e.details))return null;var r=e.details,n=r.fragments[t-r.startSN];return n?n:(n=r.fragmentHint,n&&n.sn===t?n:t<r.startSN&&a&&a.sn===t?a:null)}function Ge(e,t,a){var r;return null!=e&&e.details?Ke(null==(r=e.details)?void 0:r.partList,t,a):null}function Ke(e,t,a){if(e)for(var r=e.length,n;r--;)if(n=e[r],n.index===a&&n.fragment.sn===t)return n;return null}function He(e){switch(e.details){case va.FRAG_LOAD_TIMEOUT:case va.KEY_LOAD_TIMEOUT:case va.LEVEL_LOAD_TIMEOUT:case va.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Ve(e,t){var a=He(t);return e.default[(a?"timeout":"error")+"Retry"]}function We(e,t){var a="linear"===e.backoff?1:g(2,t);return s(a*e.retryDelayMs,e.maxRetryDelayMs)}function Ye(e){return y(y({},e),{errorRetry:null,timeoutRetry:null})}function qe(e,t,a,r){return!!e&&t<e.maxNumRetry&&(ze(r)||!!a)}function ze(e){return 0===e&&!1===navigator.onLine||!!e&&(400>e||499<e)}function je(e,t,a){if(null===t||!Array.isArray(e)||!e.length||!Ea(t))return null;var r=e[0].programDateTime;if(t<(r||0))return null;var n=e[e.length-1].endProgramDateTime;if(t>=(n||0))return null;a=a||0;for(var d=0,i;d<e.length;++d)if(i=e[d],Ze(t,a,i))return i;return null}function Xe(e,t,a,r){void 0===a&&(a=0),void 0===r&&(r=0);var n=null;if(e?n=t[e.sn-t[0].sn+1]||null:0===a&&0===t[0].start&&(n=t[0]),n&&0===Qe(a,r,n))return n;var d=Sr.search(t,Qe.bind(null,a,r));return d&&(d!==e||!n)?d:n}function Qe(e,t,a){if(void 0===e&&(e=0),void 0===t&&(t=0),a.start<=e&&a.start+a.duration>e)return 0;var r=s(t,a.duration+(a.deltaPTS?a.deltaPTS:0));return a.start+a.duration-r<=e?1:a.start-r>e&&a.start?-1:0}function Ze(e,t,a){var r=1e3*s(t,a.duration+(a.deltaPTS?a.deltaPTS:0)),n=a.endProgramDateTime||0;return n-r>e}function $e(e,t){return Sr.search(e,function(e){return e.cc<t?1:e.cc>t?-1:0})}function Je(e,t,a){if(300000<performance.now()-e.lastErrorPerfMs)return!0;var r=e.details;if(t.details===va.FRAG_GAP&&r&&t.frag){var n=t.frag.start,d=Xe(null,r.fragments,n);if(d&&!d.gap)return!0}if(a&&e.errors.length<a.errors.length){var i=e.errors[e.errors.length-1];if(r&&i.frag&&t.frag&&l(i.frag.start-t.frag.start)>3*r.targetduration)return!0}return!1}function et(e,t,a){a&&("audio"===t?(!e.audioGroupIds&&(e.audioGroupIds=[]),e.audioGroupIds[e.url.length-1]=a):"text"==t&&(!e.textGroupIds&&(e.textGroupIds=[]),e.textGroupIds[e.url.length-1]=a))}function tt(e){var t={};e.forEach(function(e){var a=e.groupId||"";e.id=t[a]=t[a]||0,t[a]++})}function at(e){var t,a,r;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(a=e.range.audio)?void 0:a.partial)||(null==(r=e.range.audiovideo)?void 0:r.partial))}function rt(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn}function nt(e,t){void 0===t&&(t=null);var a=t||e,r={frag:e,part:t,responseType:"arraybuffer",url:a.url,headers:{},rangeStart:0,rangeEnd:0},n=a.byteRangeStartOffset,d=a.byteRangeEndOffset;if(Ea(n)&&Ea(d)){var i=n,o=d,s;if("initSegment"===e.sn&&"AES-128"===(null==(s=e.decryptdata)?void 0:s.method)){var l=d-n;l%16&&(o=d+(16-l%16)),0!==n&&(r.resetIV=!0,i=n-16)}r.rangeStart=i,r.rangeEnd=o}return r}function dt(e,t){var a=new Error("GAP "+(e.gap?"tag":"attribute")+" found"),r={type:La.MEDIA_ERROR,details:va.FRAG_GAP,fatal:!1,frag:e,error:a,networkDetails:null};return t&&(r.part=t),(t?t:e).stats.aborted=!0,new Pr(r)}function it(){return{start:0,executeStart:0,executeEnd:0,end:0}}function ot(e,t){for(var a=null,r=0,n=e.length,d;r<n;r++)if(d=e[r],d&&d.cc===t){a=d;break}return a}function st(e,t,a){return!!(t.details&&(a.endCC>a.startCC||e&&e.cc<a.startCC))}function lt(e,t,a){var r=e.fragments,n=t.fragments;if(!n.length||!r.length)return void Da.log("No fragments to align");var d=ot(r,n[0].cc);return d&&(!d||d.startPTS)?d:void Da.log("No frag in previous level to align on")}function ut(e,t){if(e){var a=e.start+t;e.start=e.startPTS=a,e.endPTS=a+e.duration}}function ft(e,t){for(var a=t.fragments,r=0,n=a.length;r<n;r++)ut(a[r],e);t.fragmentHint&&ut(t.fragmentHint,e),t.alignedSliding=!0}function gt(e,t,a){t&&(ct(e,a,t),!a.alignedSliding&&t.details&&mt(a,t.details),!a.alignedSliding&&t.details&&!a.skippedSegments&&we(t.details,a))}function ct(e,t,a){if(st(e,a,t)){var r=lt(a.details,t);r&&Ea(r.start)&&(Da.log("Adjusting PTS using last level due to CC increase within current level "+t.url),ft(r.start,t))}}function mt(e,t){if(t.fragments.length&&e.hasProgramDateTime&&t.hasProgramDateTime){var a=t.fragments[0].programDateTime,r=e.fragments[0].programDateTime,n=(r-a)/1e3+t.fragments[0].start;n&&Ea(n)&&(Da.log("Adjusting PTS using programDateTime delta "+(r-a)+"ms, sliding:"+n.toFixed(3)+" "+e.url+" "),ft(n,e))}}function pt(e){var t=e.byteLength,a=t&&new DataView(e.buffer).getUint8(t-1);return a?M(e,0,t-a):e}function yt(){return self.SourceBuffer||self.WebKitSourceBuffer}function ht(){var e=se();if(!e)return!1;var t=yt(),a=e&&"function"==typeof e.isTypeSupported&&e.isTypeSupported("video/mp4; codecs=\"avc1.42E01E,mp4a.40.2\""),r=!t||t.prototype&&"function"==typeof t.prototype.appendBuffer&&"function"==typeof t.prototype.remove;return!!a&&!!r}function Et(){var e=yt(),t;return"function"==typeof(null==e||null==(t=e.prototype)?void 0:t.changeType)}function Tt(e,t){return void 0===e&&(e=""),void 0===t&&(t=9e4),{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}function Lt(e,t,a,r){var n=navigator.userAgent.toLowerCase(),d=r,i=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],o,s,l,u;o=((192&t[a+2])>>>6)+1;var f=(60&t[a+2])>>>2;return f>i.length-1?void e.trigger(Ta.ERROR,{type:La.MEDIA_ERROR,details:va.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+f}):(l=(1&t[a+2])<<2,l|=(192&t[a+3])>>>6,Da.log("manifest codec:"+r+", ADTS type:"+o+", samplingIndex:"+f),/firefox/i.test(n)?6<=f?(o=5,u=[,,,,],s=f-3):(o=2,u=[,,],s=f):-1===n.indexOf("android")?(o=5,u=[,,,,],r&&(-1!==r.indexOf("mp4a.40.29")||-1!==r.indexOf("mp4a.40.5"))||!r&&6<=f?s=f-3:((r&&-1!==r.indexOf("mp4a.40.2")&&(6<=f&&1===l||/vivaldi/i.test(n))||!r&&1===l)&&(o=2,u=[,,]),s=f)):(o=2,u=[,,],s=f),u[0]=o<<3,u[0]|=(14&f)>>1,u[1]|=(1&f)<<7,u[1]|=l<<3,5===o&&(u[1]|=(14&s)>>1,u[2]=(1&s)<<7,u[2]|=8,u[3]=0),{config:u,samplerate:i[f],channelCount:l,codec:"mp4a.40."+o,manifestCodec:d})}function vt(e,t){return 255===e[t]&&240==(246&e[t+1])}function St(e,t){return 1&e[t+1]?7:9}function Rt(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function At(e,t){return t+5<e.length}function Dt(e,t){return t+1<e.length&&vt(e,t)}function _t(e,t){return At(e,t)&&vt(e,t)&&Rt(e,t)<=e.length-t}function bt(e,t){if(Dt(e,t)){var a=St(e,t);if(t+a>=e.length)return!1;var r=Rt(e,t);if(r<=a)return!1;var n=t+r;return n===e.length||Dt(e,n)}return!1}function kt(e,t,a,r,n){if(!e.samplerate){var d=Lt(t,a,r,n);if(!d)return;e.config=d.config,e.samplerate=d.samplerate,e.channelCount=d.channelCount,e.codec=d.codec,e.manifestCodec=d.manifestCodec,Da.log("parsed codec:"+e.codec+", rate:"+d.samplerate+", channels:"+d.channelCount)}}function It(e){return 92160000/e}function xt(e,t){var a=St(e,t);if(t+a<=e.length){var r=Rt(e,t)-a;if(0<r)return{headerLength:a,frameLength:r}}}function Ct(e,t,a,r,n){var d=It(e.samplerate),i=r+n*d,o=xt(t,a),s;if(o){var l=o.frameLength,u=o.headerLength,f=u+l,g=c(0,a+f-t.length);g?(s=new Uint8Array(f-u),s.set(t.subarray(a+u,t.length),0)):s=t.subarray(a+u,a+f);var m={unit:s,pts:i};return g||e.samples.push(m),{sample:m,length:f,missing:g}}var p=t.length-a;s=new Uint8Array(p),s.set(t.subarray(a,t.length),0);var y={unit:s,pts:i};return{sample:y,length:p,missing:-1}}function Pt(e,t,a,r,n){if(!(a+24>t.length)){var d=Ft(t,a);if(d&&a+d.frameLength<=t.length){var i=9e4*d.samplesPerFrame/d.sampleRate,o=r+n*i,s={unit:t.subarray(a,a+d.frameLength),pts:o,dts:o};return e.config=[],e.channelCount=d.channelCount,e.samplerate=d.sampleRate,e.samples.push(s),{sample:s,length:d.frameLength,missing:0}}}}function Ft(e,t){var a=3&e[t+1]>>3,r=3&e[t+1]>>1,n=15&e[t+2]>>4,d=3&e[t+2]>>2;if(1!=a&&0!==n&&15!==n&&3!==d){var i=1&e[t+2]>>1,o=e[t+3]>>6,s=3===a?3-r:3===r?3:4,l=1e3*Zr[14*s+n-1],u=3===a?0:2===a?1:2,g=$r[3*u+d],c=3===o?1:2,m=Jr[a][r],p=en[r],y=8*m*p,h=f(m*l/g+i)*p;if(null===Qr){var E=navigator.userAgent||"",T=E.match(/Chrome\/(\d+)/i);Qr=T?parseInt(T[1]):0}var L=!!Qr&&87>=Qr;return L&&2===r&&224e3<=l&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:g,channelCount:c,frameLength:h,samplesPerFrame:y}}}function Ot(e,t){return 255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1])}function Nt(e,t){return t+1<e.length&&Ot(e,t)}function wt(e,t){var a=4;return Ot(e,t)&&4<=e.length-t}function Mt(e,t){if(t+1<e.length&&Ot(e,t)){var a=4,r=Ft(e,t),n=4;null!=r&&r.frameLength&&(n=r.frameLength);var d=t+n;return d===e.length||Nt(e,d)}return!1}function Bt(e,t,a,r){return{key:e,frame:!1,pts:t,dts:a,units:[],debug:r,length:0}}function Ut(e,t){return((31&e[t+1])<<8)+e[t+2]}function Gt(e,t){return(31&e[t+10])<<8|e[t+11]}function Kt(e,t,a,r){var n={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},d=(15&e[t+1])<<8|e[t+2],i=t+3+d-4,o=(15&e[t+10])<<8|e[t+11];for(t+=12+o;t<i;){var s=Ut(e,t);switch(e[t]){case 207:if(!r){Da.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===n.audio&&(n.audio=s);break;case 21:-1===n.id3&&(n.id3=s);break;case 219:if(!r){Da.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===n.avc&&(n.avc=s);break;case 3:case 4:!0!==a.mpeg&&!0!==a.mp3?Da.log("MPEG audio found, not supported in this browser"):-1===n.audio&&(n.audio=s,n.segmentCodec="mp3");break;case 36:Da.warn("Unsupported HEVC stream type found")}t+=((15&e[t+3])<<8|e[t+4])+5}return n}function Ht(e){var t=0,a=e.data,r,n,d,s,l;if(!e||0===e.size)return null;for(;19>a[0].length&&1<a.length;){var u=new Uint8Array(a[0].length+a[1].length);u.set(a[0]),u.set(a[1],a[0].length),a[0]=u,a.splice(1,1)}r=a[0];var f=(r[0]<<16)+(r[1]<<8)+r[2];if(1===f){if(n=(r[4]<<8)+r[5],n&&n>e.size-6)return null;var g=r[7];192&g&&(s=536870912*(14&r[9])+4194304*(255&r[10])+16384*(254&r[11])+128*(255&r[12])+(254&r[13])/2,64&g?(l=536870912*(14&r[14])+4194304*(255&r[15])+16384*(254&r[16])+128*(255&r[17])+(254&r[18])/2,5400000<s-l&&(Da.warn(o((s-l)/9e4)+"s delta between PTS and DTS, align them"),s=l)):l=s),d=r[8];var c=d+9;if(e.size<=c)return null;e.size-=c;for(var m=new Uint8Array(e.size),p=0,y=a.length;p<y;p++){r=a[p];var h=r.byteLength;if(c)if(c>h){c-=h;continue}else r=r.subarray(c),h-=c,c=0;m.set(r,t),t+=h}return n&&(n-=d+3),{data:m,pts:s,dts:l,len:n}}return null}function Vt(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){var a=t.samples,r=a.length;if(r){var n=a[r-1];e.pts=n.pts,e.dts=n.dts}else return void t.dropped++}t.samples.push(e)}e.debug.length&&Da.log(e.pts+"/"+e.dts+":"+e.debug)}function Wt(e,t,a,r){void 0===a&&(a=1),void 0===r&&(r=!1);var n=e*t*a;return r?o(n):n}function Yt(e,t){return void 0===t&&(t=!1),Wt(e,1e3,1/90000,t)}function qt(e,t){var a;if(null===t)return e;for(a=t<e?-8589934592:8589934592;4294967296<l(e-t);)e+=a;return e}function zt(e){for(var t=0;t<e.length;t++)if(e[t].key)return t;return-1}function jt(e,t,a,r){var n=e.samples.length;if(n){for(var d=e.inputTimeScale,i=0,o;i<n;i++)o=e.samples[i],o.pts=qt(o.pts-a.baseTime*d/a.timescale,t*d)/d,o.dts=qt(o.dts-r.baseTime*d/r.timescale,t*d)/d;var s=e.samples;return e.samples=[],{samples:s}}}function Xt(e,t,a){var r=e.samples.length;if(r){for(var n=e.inputTimeScale,d=0,i;d<r;d++)i=e.samples[d],i.pts=qt(i.pts-a.baseTime*n/a.timescale,t*n)/n;e.samples.sort(function(e,t){return e.pts-t.pts});var o=e.samples;return e.samples=[],{samples:o}}}function Qt(e,t,a,r){if(null===e)return!0;var n=c(r,1),d=t-e.baseTime/e.timescale;return l(d-a)>n}function Zt(e,t){var a=null==e?void 0:e.codec;return a&&4<a.length?a:"hvc1"===a||"hev1"===a?"hvc1.1.6.L120.90":"av01"===a?"av01.0.04M.08":"avc1"===a||t===Ca.VIDEO?"avc1.42e01e":"mp4a.40.5"}function $t(e,t){var a=null;return 0<e.byteLength&&null!=t&&null!=t.key&&null!==t.iv&&null!=t.method&&(a=t),a}function Jt(e){return"then"in e&&e.then instanceof Function}function ea(e,t){if(ra(t.remuxResult))return!1;var a=[],r=t.remuxResult,n=r.audio,d=r.video;return n&&ta(a,n),d&&ta(a,d),e.postMessage({event:"transmuxComplete",data:t},a),!0}function ta(e,t){t.data1&&e.push(t.data1.buffer),t.data2&&e.push(t.data2.buffer)}function aa(e,t,a){var r=t.reduce(function(t,a){return ea(e,a)||t},!1);r||e.postMessage({event:"transmuxComplete",data:t[0]}),e.postMessage({event:"flush",data:a})}function ra(e){return!e.audio&&!e.video&&!e.text&&!e.id3&&!e.initSegment}function na(){return"function"==typeof t}function da(){var e=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+t.toString()+")(true);"],{type:"text/javascript"}),a=self.URL.createObjectURL(e),r=new self.Worker(a);return{worker:r,objectURL:a}}function ia(e){var t=new self.URL(e,self.location.href).href,a=new self.Worker(t);return{worker:a,scriptURL:t}}function oa(e,t){for(var a=new Uint8Array(t),r=0,n=0,d;n<e.length;n++)d=e[n],a.set(d,r),r+=d.length;return a}function sa(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(t){}return!1}function la(e,t){var a={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(L({},e.headers))};return e.rangeEnd&&a.headers.set("Range","bytes="+e.rangeStart+"-"+(e.rangeEnd-1+"")),a}function ua(e){var t=Yn.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}function fa(e){var t=e.get("Content-Range");if(t){var a=ua(t);if(Ea(a))return a}var r=e.get("Content-Length");if(r)return parseInt(r)}function ga(e,t){return new self.Request(e.url,t)}function ca(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error("Illegal hls.js config: \"liveMaxLatencyDurationCount\" must be greater than \"liveSyncDurationCount\"");if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error("Illegal hls.js config: \"liveMaxLatencyDuration\" must be greater than \"liveSyncDuration\"");var a=ma(e),r=["manifest","level","frag"],n=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(function(e){var r=("level"===e?"playlist":e)+"LoadPolicy",d=void 0===t[r],i=[];n.forEach(function(n){var o=e+"Loading"+n,s=t[o];if(void 0!==s&&d){i.push(o);var l=a[r].default;t[r]={default:l},"TimeOut"===n?(l.maxLoadTimeMs=s,l.maxTimeToFirstByteMs=s):"MaxRetry"===n?(l.errorRetry.maxNumRetry=s,l.timeoutRetry.maxNumRetry=s):"RetryDelay"===n?(l.errorRetry.retryDelayMs=s,l.timeoutRetry.retryDelayMs=s):"MaxRetryTimeout"===n?(l.errorRetry.maxRetryDelayMs=s,l.timeoutRetry.maxRetryDelayMs=s):void 0}}),i.length&&Da.warn("hls.js config: \""+i.join("\", \"")+"\" setting(s) are deprecated, use \""+r+"\": "+JSON.stringify(t[r]))}),y(y({},a),t)}function ma(e){return e&&"object"==typeof e?Array.isArray(e)?e.map(ma):Object.keys(e).reduce(function(t,a){return t[a]=ma(e[a]),t},{}):e}function pa(e){var t=e.loader;if(t!==qn&&t!==Vn)Da.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{var a=sa();a&&(e.loader=qn,e.progressive=!0,e.enableSoftwareAES=!0,Da.log("[config]: Progressive streaming enabled, using FetchLoader"))}}var ya={exports:{}};(function(e,t){(function(t){var a=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,n=/(?:\/|^)\.(?=\/)/g,d=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,i={buildAbsoluteURL:function(e,t,a){if(a=a||{},e=e.trim(),t=t.trim(),!t){if(!a.alwaysNormalize)return e;var n=i.parseURL(e);if(!n)throw new Error("Error trying to parse base URL.");return n.path=i.normalizePath(n.path),i.buildURLFromParts(n)}var d=i.parseURL(t);if(!d)throw new Error("Error trying to parse relative URL.");if(d.scheme)return a.alwaysNormalize?(d.path=i.normalizePath(d.path),i.buildURLFromParts(d)):t;var o=i.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var s=r.exec(o.path);o.netLoc=s[1],o.path=s[2]}o.netLoc&&!o.path&&(o.path="/");var l={scheme:o.scheme,netLoc:d.netLoc,path:null,params:d.params,query:d.query,fragment:d.fragment};if(!d.netLoc&&(l.netLoc=o.netLoc,"/"!==d.path[0]))if(!d.path)l.path=o.path,d.params||(l.params=o.params,!d.query&&(l.query=o.query));else{var u=o.path,f=u.substring(0,u.lastIndexOf("/")+1)+d.path;l.path=i.normalizePath(f)}return null===l.path&&(l.path=a.alwaysNormalize?i.normalizePath(d.path):d.path),i.buildURLFromParts(l)},parseURL:function(e){var t=a.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){for(e=e.split("").reverse().join("").replace(n,"");e.length!==(e=e.replace(d,"")).length;);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=i})()})(ya);var ha=ya.exports,Ea=d||function(e){return"number"==typeof e&&isFinite(e)},Ta=function(e){return e.MEDIA_ATTACHING="hlsMediaAttaching",e.MEDIA_ATTACHED="hlsMediaAttached",e.MEDIA_DETACHING="hlsMediaDetaching",e.MEDIA_DETACHED="hlsMediaDetached",e.BUFFER_RESET="hlsBufferReset",e.BUFFER_CODECS="hlsBufferCodecs",e.BUFFER_CREATED="hlsBufferCreated",e.BUFFER_APPENDING="hlsBufferAppending",e.BUFFER_APPENDED="hlsBufferAppended",e.BUFFER_EOS="hlsBufferEos",e.BUFFER_FLUSHING="hlsBufferFlushing",e.BUFFER_FLUSHED="hlsBufferFlushed",e.MANIFEST_LOADING="hlsManifestLoading",e.MANIFEST_LOADED="hlsManifestLoaded",e.MANIFEST_PARSED="hlsManifestParsed",e.LEVEL_SWITCHING="hlsLevelSwitching",e.LEVEL_SWITCHED="hlsLevelSwitched",e.LEVEL_LOADING="hlsLevelLoading",e.LEVEL_LOADED="hlsLevelLoaded",e.LEVEL_UPDATED="hlsLevelUpdated",e.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",e.LEVELS_UPDATED="hlsLevelsUpdated",e.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",e.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",e.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",e.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",e.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",e.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",e.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",e.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",e.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",e.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",e.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",e.CUES_PARSED="hlsCuesParsed",e.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",e.INIT_PTS_FOUND="hlsInitPtsFound",e.FRAG_LOADING="hlsFragLoading",e.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",e.FRAG_LOADED="hlsFragLoaded",e.FRAG_DECRYPTED="hlsFragDecrypted",e.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",e.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",e.FRAG_PARSING_METADATA="hlsFragParsingMetadata",e.FRAG_PARSED="hlsFragParsed",e.FRAG_BUFFERED="hlsFragBuffered",e.FRAG_CHANGED="hlsFragChanged",e.FPS_DROP="hlsFpsDrop",e.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",e.ERROR="hlsError",e.DESTROYING="hlsDestroying",e.KEY_LOADING="hlsKeyLoading",e.KEY_LOADED="hlsKeyLoaded",e.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",e.BACK_BUFFER_REACHED="hlsBackBufferReached",e}({}),La=function(e){return e.NETWORK_ERROR="networkError",e.MEDIA_ERROR="mediaError",e.KEY_SYSTEM_ERROR="keySystemError",e.MUX_ERROR="muxError",e.OTHER_ERROR="otherError",e}({}),va=function(e){return e.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",e.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",e.KEY_SYSTEM_NO_SESSION="keySystemNoSession",e.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",e.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",e.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",e.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",e.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",e.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",e.MANIFEST_LOAD_ERROR="manifestLoadError",e.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",e.MANIFEST_PARSING_ERROR="manifestParsingError",e.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",e.LEVEL_EMPTY_ERROR="levelEmptyError",e.LEVEL_LOAD_ERROR="levelLoadError",e.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",e.LEVEL_PARSING_ERROR="levelParsingError",e.LEVEL_SWITCH_ERROR="levelSwitchError",e.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",e.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",e.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",e.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",e.FRAG_LOAD_ERROR="fragLoadError",e.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",e.FRAG_DECRYPT_ERROR="fragDecryptError",e.FRAG_PARSING_ERROR="fragParsingError",e.FRAG_GAP="fragGap",e.REMUX_ALLOC_ERROR="remuxAllocError",e.KEY_LOAD_ERROR="keyLoadError",e.KEY_LOAD_TIMEOUT="keyLoadTimeOut",e.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",e.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",e.BUFFER_APPEND_ERROR="bufferAppendError",e.BUFFER_APPENDING_ERROR="bufferAppendingError",e.BUFFER_STALLED_ERROR="bufferStalledError",e.BUFFER_FULL_ERROR="bufferFullError",e.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",e.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",e.INTERNAL_EXCEPTION="internalException",e.INTERNAL_ABORTED="aborted",e.UNKNOWN="unknown",e}({}),Sa=function e(){},Ra={trace:Sa,debug:Sa,log:Sa,warn:Sa,info:Sa,error:Sa},Aa=Ra,Da=Aa,_a=/^(\d+)x(\d+)$/,ba=/(.+?)=(".*?"|.*?)(?:,|$)/g,ka=function(){function e(t){for(var a in"string"==typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(a)&&("X-"===a.substring(0,2)&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(a)),this[a]=t[a])}var t=e.prototype;return t.decimalInteger=function t(e){var a=parseInt(this[e],10);return a>u?1/0:a},t.hexadecimalInteger=function t(e){if(this[e]){var a=(this[e]||"0x").slice(2);a=(1&a.length?"0":"")+a;for(var r=new Uint8Array(a.length/2),n=0;n<a.length/2;n++)r[n]=parseInt(a.slice(2*n,2*n+2),16);return r}return null},t.hexadecimalIntegerAsNumber=function t(e){var a=parseInt(this[e],16);return a>u?1/0:a},t.decimalFloatingPoint=function t(e){return parseFloat(this[e])},t.optionalFloat=function a(e,t){var r=this[e];return r?parseFloat(r):t},t.enumeratedString=function t(e){return this[e]},t.bool=function t(e){return"YES"===this[e]},t.decimalResolution=function t(e){var a=_a.exec(this[e]);return null===a?void 0:{width:parseInt(a[1],10),height:parseInt(a[2],10)}},e.parseAttrList=function t(e){var a={},r="\"",n;for(ba.lastIndex=0;null!==(n=ba.exec(e));){var d=n[2];0===d.indexOf(r)&&d.lastIndexOf(r)===d.length-1&&(d=d.slice(1,-1));var i=n[1].trim();a[i]=d}return a},e}(),Ia=function(){function e(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){var a=t.attr;for(var r in a)if(Object.prototype.hasOwnProperty.call(e,r)&&e[r]!==a[r]){Da.warn("DATERANGE tag attribute: \""+r+"\" does not match for tags with ID: \""+e.ID+"\""),this._badValueForSameId=r;break}e=L(new ka({}),a,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){var n=new Date(this.attr["END-DATE"]);Ea(n.getTime())&&(this._endDate=n)}}return E(e,[{key:"id",get:function e(){return this.attr.ID}},{key:"class",get:function e(){return this.attr.CLASS}},{key:"startDate",get:function e(){return this._startDate}},{key:"endDate",get:function e(){if(this._endDate)return this._endDate;var t=this.duration;return null===t?null:new Date(this._startDate.getTime()+1e3*t)}},{key:"duration",get:function e(){if("DURATION"in this.attr){var t=this.attr.decimalFloatingPoint("DURATION");if(Ea(t))return t}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function e(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function e(){return this.attr.bool("END-ON-NEXT")}},{key:"isValid",get:function e(){return!!this.id&&!this._badValueForSameId&&Ea(this.startDate.getTime())&&(null===this.duration||0<=this.duration)&&(!this.endOnNext||!!this.class)}}]),e}(),xa=function e(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},Ca={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},Pa=function(){function e(e){var t;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(t={},t[Ca.AUDIO]=null,t[Ca.VIDEO]=null,t[Ca.AUDIOVIDEO]=null,t),this.baseurl=e}var t=e.prototype;return t.setByteRange=function a(e,t){var r=e.split("@",2),n=[];n[0]=1===r.length?t?t.byteRangeEndOffset:0:parseInt(r[1]),n[1]=parseInt(r[0])+n[0],this._byteRange=n},E(e,[{key:"byteRange",get:function e(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function e(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function e(){return this.byteRange[1]}},{key:"url",get:function e(){return!this._url&&this.baseurl&&this.relurl&&(this._url=ha.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function t(e){this._url=e}}]),e}(),Fa=function(e){function t(t,a){var r;return r=e.call(this,a)||this,r._decryptdata=null,r.rawProgramDateTime=null,r.programDateTime=null,r.tagList=[],r.duration=0,r.sn=0,r.levelkeys=void 0,r.type=void 0,r.loader=null,r.keyLoader=null,r.level=-1,r.cc=0,r.startPTS=void 0,r.endPTS=void 0,r.startDTS=void 0,r.endDTS=void 0,r.start=0,r.deltaPTS=void 0,r.maxStartPTS=void 0,r.minEndPTS=void 0,r.stats=new xa,r.urlId=0,r.data=void 0,r.bitrateTest=!1,r.title=null,r.initSegment=null,r.endList=void 0,r.gap=void 0,r.type=t,r}v(t,e);var a=t.prototype;return a.setKeyFormat=function t(e){if(this.levelkeys){var a=this.levelkeys[e];a&&!this._decryptdata&&(this._decryptdata=a.getDecryptData(this.sn))}},a.abortRequests=function e(){var t,a;null==(t=this.loader)?void 0:t.abort(),null==(a=this.keyLoader)?void 0:a.abort()},a.setElementaryStreamInfo=function i(e,t,a,r,n,d){void 0===d&&(d=!1);var o=this.elementaryStreams,l=o[e];return l?void(l.startPTS=s(l.startPTS,t),l.endPTS=c(l.endPTS,a),l.startDTS=s(l.startDTS,r),l.endDTS=c(l.endDTS,n)):void(o[e]={startPTS:t,endPTS:a,startDTS:r,endDTS:n,partial:d})},a.clearElementaryStreamInfo=function e(){var t=this.elementaryStreams;t[Ca.AUDIO]=null,t[Ca.VIDEO]=null,t[Ca.AUDIOVIDEO]=null},E(t,[{key:"decryptdata",get:function e(){var t=this.levelkeys;if(!t&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var a=this.levelkeys.identity;if(a)this._decryptdata=a.getDecryptData(this.sn);else{var r=Object.keys(this.levelkeys);if(1===r.length)return this._decryptdata=this.levelkeys[r[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function e(){return this.start+this.duration}},{key:"endProgramDateTime",get:function e(){if(null===this.programDateTime)return null;if(!Ea(this.programDateTime))return null;var t=Ea(this.duration)?this.duration:0;return this.programDateTime+1e3*t}},{key:"encrypted",get:function e(){var t;if(null!=(t=this._decryptdata)&&t.encrypted)return!0;if(this.levelkeys){var a=Object.keys(this.levelkeys),r=a.length;if(1<r||1===r&&this.levelkeys[a[0]].encrypted)return!0}return!1}}]),t}(Pa),Oa=function(e){function t(t,a,r,n,d){var i;i=e.call(this,r)||this,i.fragOffset=0,i.duration=0,i.gap=!1,i.independent=!1,i.relurl=void 0,i.fragment=void 0,i.index=void 0,i.stats=new xa,i.duration=t.decimalFloatingPoint("DURATION"),i.gap=t.bool("GAP"),i.independent=t.bool("INDEPENDENT"),i.relurl=t.enumeratedString("URI"),i.fragment=a,i.index=n;var o=t.enumeratedString("BYTERANGE");return o&&i.setByteRange(o,d),d&&(i.fragOffset=d.fragOffset+d.duration),i}return v(t,e),E(t,[{key:"start",get:function e(){return this.fragment.start+this.fragOffset}},{key:"end",get:function e(){return this.start+this.duration}},{key:"loaded",get:function e(){var t=this.elementaryStreams;return!!(t.audio||t.video||t.audiovideo)}}]),t}(Pa),Na=function(){function e(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}var t=e.prototype;return t.reloaded=function t(e){if(!e)return this.advanced=!0,void(this.updated=!0);var a=this.lastPartSn-e.lastPartSn,r=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!r||!!a||!this.live,this.advanced=this.endSN>e.endSN||0<a||0===a&&0<r,this.misses=this.updated||this.advanced?f(.6*e.misses):e.misses+1,this.availabilityDelay=e.availabilityDelay},E(e,[{key:"hasProgramDateTime",get:function e(){return!!this.fragments.length&&Ea(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function e(){return this.averagetargetduration||this.targetduration||10}},{key:"drift",get:function e(){var t=this.driftEndTime-this.driftStartTime;if(0<t){var a=this.driftEnd-this.driftStart;return 1e3*a/t}return 1}},{key:"edge",get:function e(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function e(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function e(){var t;return null!=(t=this.fragments)&&t.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function e(){return this.advancedDateTime?c(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function e(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function e(){var t;return null!=(t=this.partList)&&t.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),e}(),wa=C(void 0),Ma=function a(e,t){return!!(t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&255>e[t+3]&&255>e[t+4]&&128>e[t+6]&&128>e[t+7]&&128>e[t+8]&&128>e[t+9])},Ba=function a(e,t){return!!(t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&255>e[t+3]&&255>e[t+4]&&128>e[t+6]&&128>e[t+7]&&128>e[t+8]&&128>e[t+9])},Ua=function a(e,t){for(var r=t,n=0;Ma(e,t);){n+=10;var d=Ga(e,t+6);n+=d,Ba(e,t+10)&&(n+=10),t+=n}return 0<n?e.subarray(r,r+n):void 0},Ga=function a(e,t){var r=0;return r=(127&e[t])<<21,r|=(127&e[t+1])<<14,r|=(127&e[t+2])<<7,r|=127&e[t+3],r},Ka=function a(e,t){return Ma(e,t)&&Ga(e,t+6)+10<=e.length-t},Ha=function t(e){for(var a=Ya(e),r=0,n;r<a.length;r++)if(n=a[r],Va(n))return Qa(n)},Va=function t(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},Wa=function t(e){var a=m(e[0],e[1],e[2],e[3]),r=Ga(e,4),n=10;return{type:a,size:r,data:e.subarray(n,n+r)}},Ya=function t(e){for(var a=0,r=[],n;Ma(e,a);){n=Ga(e,a+6),a+=10;for(var d=a+n;a+8<d;){var i=Wa(e.subarray(a)),o=qa(i);o&&r.push(o),a+=i.size+10}Ba(e,a)&&(a+=10)}return r},qa=function t(e){return"PRIV"===e.type?za(e):"W"===e.type[0]?Xa(e):ja(e)},za=function t(e){if(!(2>e.size)){var a=Za(e.data,!0),r=new Uint8Array(e.data.subarray(a.length+1));return{key:e.type,info:a,data:r.buffer}}},ja=function t(e){if(!(2>e.size)){if("TXXX"===e.type){var a=1,r=Za(e.data.subarray(a),!0);a+=r.length+1;var n=Za(e.data.subarray(a));return{key:e.type,info:r,data:n}}var d=Za(e.data.subarray(1));return{key:e.type,data:d}}},Xa=function t(e){if("WXXX"===e.type){if(2>e.size)return;var a=1,r=Za(e.data.subarray(a),!0);a+=r.length+1;var n=Za(e.data.subarray(a));return{key:e.type,info:r,data:n}}var d=Za(e.data);return{key:e.type,data:d}},Qa=function t(e){if(8===e.data.byteLength){var a=new Uint8Array(e.data),r=1&a[3],n=(a[4]<<23)+(a[5]<<15)+(a[6]<<7)+a[7];return n/=45,r&&(n+=47721858.84),o(n)}},Za=function a(e,t){void 0===t&&(t=!1);var r=B();if(r){var n=r.decode(e);if(t){var d=n.indexOf("\0");return-1===d?n:n.substring(0,d)}return n.replace(/\0/g,"")}for(var o=e.length,s="",l=0,u,f,g;l<o;){if(u=e[l++],0===u&&t)return s;if(0!==u&&3!==u)switch(u>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:s+=m(u);break;case 12:case 13:f=e[l++],s+=m((31&u)<<6|63&f);break;case 14:f=e[l++],g=e[l++],s+=m((15&u)<<12|(63&f)<<6|(63&g)<<0)}}return s},$a={hexDump:function t(e){for(var a="",r=0,n;r<e.length;r++)n=e[r].toString(16),2>n.length&&(n="0"+n),a+=n;return a}},Ja=g(2,32)-1,er=[].push,tr={video:1,audio:2,id3:3,text:4},ar=function(){function e(e,t,a,r,n){void 0===r&&(r=[1]),void 0===n&&(n=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=a,this.keyFormatVersions=r,this.iv=n,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}e.clearKeyUriToKeyIdMap=function e(){};var t=e.prototype;return t.isSupported=function e(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method}return!1},t.getDecryptData=function a(t){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!=typeof t&&("AES-128"===this.method&&!this.iv&&Da.warn("missing IV for initialization segment with method=\""+this.method+"\" - compliance issue"),t=0);var r=oe(t),n=new e(this.method,this.uri,"identity",this.keyFormatVersions,r);return n}return this},e}(),rr={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},nr=se(),dr=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,ir=/#EXT-X-MEDIA:(.*)/g,or=/^#EXT(?:INF|-X-TARGETDURATION):/m,sr=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),lr=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),ur=function(){function e(){}return e.findGroup=function a(e,t){for(var r=0,n;r<e.length;r++)if(n=e[r],n.id===t)return n},e.convertAVC1ToAVCOTI=function t(e){var a=e.split(".");if(2<a.length){var r=a.shift()+".";return r+=parseInt(a.shift()).toString(16),r+=("000"+parseInt(a.shift()).toString(16)).slice(-4),r}return e},e.resolve=function a(e,t){return ha.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.isMediaPlaylist=function t(e){return or.test(e)},e.parseMasterPlaylist=function r(t,a){var n=!1,d={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:!1},i=[];dr.lastIndex=0;for(var o;null!=(o=dr.exec(t));)if(o[1]){var s=new ka(o[1]),l=o[2],u={attrs:s,bitrate:s.decimalInteger("AVERAGE-BANDWIDTH")||s.decimalInteger("BANDWIDTH"),name:s.NAME,url:e.resolve(l,a)},f=s.decimalResolution("RESOLUTION"),g;f&&(u.width=f.width,u.height=f.height),ce((s.CODECS||"").split(/[ ,]+/).filter(function(e){return e}),u),u.videoCodec&&-1!==u.videoCodec.indexOf("avc1")&&(u.videoCodec=e.convertAVC1ToAVCOTI(u.videoCodec)),null!=(g=u.unknownCodecs)&&g.length||i.push(u),d.levels.push(u)}else if(o[3]){var c=o[3],m=o[4];switch(c){case"SESSION-DATA":{var p=new ka(m),y=p["DATA-ID"];y&&(null===d.sessionData&&(d.sessionData={}),d.sessionData[y]=p);break}case"SESSION-KEY":{var h=fe(m,a);h.encrypted&&h.isSupported()?(null===d.sessionKeys&&(d.sessionKeys=[]),d.sessionKeys.push(h)):Da.warn("[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: \""+m+"\"");break}case"DEFINE":break;case"CONTENT-STEERING":{var E=new ka(m);d.contentSteering={uri:e.resolve(E["SERVER-URI"],a),pathwayId:E["PATHWAY-ID"]||"."};break}case"START":{d.startTimeOffset=ge(m);break}}}var T=0<i.length&&i.length<d.levels.length;return d.levels=T?i:d.levels,0===d.levels.length&&(d.playlistParsingError=new Error("no levels found in manifest")),d},e.parseMasterPlaylistMedia=function n(t,a,r){var d={},i=r.levels,o={AUDIO:i.map(function(e){return{id:e.attrs.AUDIO,audioCodec:e.audioCodec}}),SUBTITLES:i.map(function(e){return{id:e.attrs.SUBTITLES,textCodec:e.textCodec}}),"CLOSED-CAPTIONS":[]},s=0,l;for(ir.lastIndex=0;null!==(l=ir.exec(t));){var u=new ka(l[1]),f=u.TYPE;if(f){var g=o[f],c=d[f]||[];d[f]=c;var m={attrs:u,bitrate:0,id:s++,groupId:u["GROUP-ID"]||"",instreamId:u["INSTREAM-ID"],name:u.NAME||u.LANGUAGE||"",type:f,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:u.LANGUAGE,url:u.URI?e.resolve(u.URI,a):""};if(null!=g&&g.length){var p=e.findGroup(g,m.groupId)||g[0];me(m,p,"audioCodec"),me(m,p,"textCodec")}c.push(m)}}return d},e.parseLevelPlaylist=function o(e,t,a,r,n,d){var s=new Na(t),l=s.fragments,u=null,f=0,g=0,m=0,p=0,y=null,h=new Fa(r,t),E=-1,T=!1,v,S,R;for(sr.lastIndex=0,s.m3u8=e,s.hasVariableRefs=!1;null!==(v=sr.exec(e));){T&&(T=!1,h=new Fa(r,t),h.start=m,h.sn=f,h.cc=p,h.level=a,u&&(h.initSegment=u,h.rawProgramDateTime=u.rawProgramDateTime,u.rawProgramDateTime=null));var A=v[1];if(A){h.duration=parseFloat(A);var D=(" "+v[2]).slice(1);h.title=D||null,h.tagList.push(D?["INF",A,D]:["INF",A])}else if(v[3]){if(Ea(h.duration)){h.start=m,R&&Ee(h,R,s),h.sn=f,h.level=a,h.cc=p,h.urlId=n,l.push(h);var _=(" "+v[3]).slice(1);h.relurl=_,ye(h,y),y=h,m+=h.duration,f++,g=0,T=!0}}else if(v[4]){var b=(" "+v[4]).slice(1);y?h.setByteRange(b,y):h.setByteRange(b)}else if(v[5])h.rawProgramDateTime=(" "+v[5]).slice(1),h.tagList.push(["PROGRAM-DATE-TIME",h.rawProgramDateTime]),-1===E&&(E=l.length);else{if(v=v[0].match(lr),!v){Da.warn("No matches on slow regex match for level playlist!");continue}for(S=1;S<v.length&&"undefined"==typeof v[S];S++);var k=(" "+v[S]).slice(1),I=(" "+v[S+1]).slice(1),x=v[S+2]?(" "+v[S+2]).slice(1):"";switch(k){case"PLAYLIST-TYPE":s.type=I.toUpperCase();break;case"MEDIA-SEQUENCE":f=s.startSN=parseInt(I);break;case"SKIP":{var C=new ka(I),P=C.decimalInteger("SKIPPED-SEGMENTS");if(Ea(P)){s.skippedSegments=P;for(var F=P;F--;)l.unshift(null);f+=P}var O=C.enumeratedString("RECENTLY-REMOVED-DATERANGES");O&&(s.recentlyRemovedDateranges=O.split("\t"));break}case"TARGETDURATION":s.targetduration=c(parseInt(I),1);break;case"VERSION":s.version=parseInt(I);break;case"EXTM3U":break;case"ENDLIST":s.live=!1;break;case"#":(I||x)&&h.tagList.push(x?[I,x]:[I]);break;case"DISCONTINUITY":p++,h.tagList.push(["DIS"]);break;case"GAP":h.gap=!0,h.tagList.push([k]);break;case"BITRATE":h.tagList.push([k,I]);break;case"DATERANGE":{var N=new ka(I),w=new Ia(N,s.dateRanges[N.ID]);w.isValid||s.skippedSegments?s.dateRanges[w.id]=w:Da.warn("Ignoring invalid DATERANGE tag: \""+I+"\""),h.tagList.push(["EXT-X-DATERANGE",I]);break}case"DEFINE":break;case"DISCONTINUITY-SEQUENCE":p=parseInt(I);break;case"KEY":{var M=fe(I,t);if(M.isSupported()){if("NONE"===M.method){R=void 0;break}R||(R={}),R[M.keyFormat]&&(R=L({},R)),R[M.keyFormat]=M}else Da.warn("[Keys] Ignoring invalid EXT-X-KEY tag: \""+I+"\"");break}case"START":s.startTimeOffset=ge(I);break;case"MAP":{var B=new ka(I);if(h.duration){var U=new Fa(r,t);he(U,B,a,R),u=U,h.initSegment=u,u.rawProgramDateTime&&!h.rawProgramDateTime&&(h.rawProgramDateTime=u.rawProgramDateTime)}else he(h,B,a,R),u=h,T=!0;break}case"SERVER-CONTROL":{var G=new ka(I);s.canBlockReload=G.bool("CAN-BLOCK-RELOAD"),s.canSkipUntil=G.optionalFloat("CAN-SKIP-UNTIL",0),s.canSkipDateRanges=0<s.canSkipUntil&&G.bool("CAN-SKIP-DATERANGES"),s.partHoldBack=G.optionalFloat("PART-HOLD-BACK",0),s.holdBack=G.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{var K=new ka(I);s.partTarget=K.decimalFloatingPoint("PART-TARGET");break}case"PART":{var H=s.partList;H||(H=s.partList=[]);var V=0<g?H[H.length-1]:void 0,W=g++,Y=new ka(I),q=new Oa(Y,h,t,W,V);H.push(q),h.duration+=q.duration;break}case"PRELOAD-HINT":{var z=new ka(I);s.preloadHint=z;break}case"RENDITION-REPORT":{var j=new ka(I);s.renditionReports=s.renditionReports||[],s.renditionReports.push(j);break}default:Da.warn("line parsed but not handled: "+v)}}}y&&!y.relurl?(l.pop(),m-=y.duration,s.partList&&(s.fragmentHint=y)):s.partList&&(ye(h,y),h.cc=p,s.fragmentHint=h,R&&Ee(h,R,s));var X=l.length,Q=l[0],Z=l[X-1];if(m+=s.skippedSegments*s.targetduration,0<m&&X&&Z){s.averagetargetduration=m/X;var $=Z.sn;s.endSN="initSegment"===$?0:$,s.live||(Z.endList=!0),Q&&(s.startCC=Q.cc)}else s.endSN=0,s.startCC=0;return s.fragmentHint&&(m+=s.fragmentHint.duration),s.totalduration=m,s.endCC=p,0<E&&pe(l,E),s},e}(),fr={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},gr={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"},cr=function(){function e(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}var t=e.prototype;return t.startLoad=function t(e){},t.stopLoad=function e(){this.destroyInternalLoaders()},t.registerListeners=function e(){var t=this.hls;t.on(Ta.MANIFEST_LOADING,this.onManifestLoading,this),t.on(Ta.LEVEL_LOADING,this.onLevelLoading,this),t.on(Ta.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.on(Ta.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.unregisterListeners=function e(){var t=this.hls;t.off(Ta.MANIFEST_LOADING,this.onManifestLoading,this),t.off(Ta.LEVEL_LOADING,this.onLevelLoading,this),t.off(Ta.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),t.off(Ta.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.createInternalLoader=function t(e){var a=this.hls.config,r=a.pLoader,n=a.loader,d=r||n,i=new d(a);return this.loaders[e.type]=i,i},t.getInternalLoader=function t(e){return this.loaders[e.type]},t.resetInternalLoader=function t(e){this.loaders[e]&&delete this.loaders[e]},t.destroyInternalLoaders=function e(){for(var t in this.loaders){var a=this.loaders[t];a&&a.destroy(),this.resetInternalLoader(t)}},t.destroy=function e(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},t.onManifestLoading=function a(e,t){var r=t.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:fr.MANIFEST,url:r,deliveryDirectives:null})},t.onLevelLoading=function a(e,t){var r=t.id,n=t.level,d=t.url,i=t.deliveryDirectives;this.load({id:r,level:n,responseType:"text",type:fr.LEVEL,url:d,deliveryDirectives:i})},t.onAudioTrackLoading=function a(e,t){var r=t.id,n=t.groupId,d=t.url,i=t.deliveryDirectives;this.load({id:r,groupId:n,level:null,responseType:"text",type:fr.AUDIO_TRACK,url:d,deliveryDirectives:i})},t.onSubtitleTrackLoading=function a(e,t){var r=t.id,n=t.groupId,d=t.url,i=t.deliveryDirectives;this.load({id:r,groupId:n,level:null,responseType:"text",type:fr.SUBTITLE_TRACK,url:d,deliveryDirectives:i})},t.load=function t(e){var a=this,r=this.hls.config,n=this.getInternalLoader(e),d;if(n){var i=n.context;if(i&&i.url===e.url)return void Da.trace("[playlist-loader]: playlist request ongoing");Da.log("[playlist-loader]: aborting previous loader for type: "+e.type),n.abort()}var o;if(o=e.type===fr.MANIFEST?r.manifestLoadPolicy.default:L({},r.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),n=this.createInternalLoader(e),null!=(d=e.deliveryDirectives)&&d.part){var l;if(e.type===fr.LEVEL&&null!==e.level?l=this.hls.levels[e.level].details:e.type===fr.AUDIO_TRACK&&null!==e.id?l=this.hls.audioTracks[e.id].details:e.type===fr.SUBTITLE_TRACK&&null!==e.id&&(l=this.hls.subtitleTracks[e.id].details),l){var u=l.partTarget,f=l.targetduration;if(u&&f){var g=1e3*c(3*u,.8*f);o=L({},o,{maxTimeToFirstByteMs:s(g,o.maxTimeToFirstByteMs),maxLoadTimeMs:s(g,o.maxTimeToFirstByteMs)})}}}var m=o.errorRetry||o.timeoutRetry||{},p={loadPolicy:o,timeout:o.maxLoadTimeMs,maxRetry:m.maxNumRetry||0,retryDelay:m.retryDelayMs||0,maxRetryDelay:m.maxRetryDelayMs||0},y={onSuccess:function d(e,t,r,n){var i=a.getInternalLoader(r);a.resetInternalLoader(r.type);var o=e.data;return 0===o.indexOf("#EXTM3U")?void(t.parsing.start=performance.now(),ur.isMediaPlaylist(o)?a.handleTrackOrLevelPlaylist(e,t,r,n||null,i):a.handleMasterPlaylist(e,t,r,n)):void a.handleManifestParsingError(e,r,new Error("no EXTM3U delimiter"),n||null,t)},onError:function d(e,t,r,n){a.handleNetworkError(t,r,!1,e,n)},onTimeout:function n(e,t,r){a.handleNetworkError(t,r,!0,void 0,e)}};n.load(e,p,y)},t.handleMasterPlaylist=function n(e,t,a,r){var d=this.hls,i=e.data,o=Le(e,a),s=ur.parseMasterPlaylist(i,o);if(s.playlistParsingError)return void this.handleManifestParsingError(e,a,s.playlistParsingError,r,t);var l=s.contentSteering,u=s.levels,f=s.sessionData,g=s.sessionKeys,c=s.startTimeOffset,m=s.variableList;this.variableList=m;var p=ur.parseMasterPlaylistMedia(i,o,s),y=p.AUDIO,h=void 0===y?[]:y,E=p.SUBTITLES,T=p["CLOSED-CAPTIONS"];if(h.length){var L=h.some(function(e){return!e.url});L||!u[0].audioCodec||u[0].attrs.AUDIO||(Da.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),h.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new ka({}),bitrate:0,url:""}))}d.trigger(Ta.MANIFEST_LOADED,{levels:u,audioTracks:h,subtitles:E,captions:T,contentSteering:l,url:o,stats:t,networkDetails:r,sessionData:f,sessionKeys:g,startTimeOffset:c,variableList:m})},t.handleTrackOrLevelPlaylist=function d(e,t,a,r,n){var i=this.hls,o=a.id,s=a.level,l=a.type,u=Le(e,a),f=Ea(o)?o:0,g=Ea(s)?s:f,c=Te(a),m=ur.parseLevelPlaylist(e.data,u,g,c,f,this.variableList);if(l===fr.MANIFEST){var p={attrs:new ka({}),bitrate:0,details:m,name:"",url:u};i.trigger(Ta.MANIFEST_LOADED,{levels:[p],audioTracks:[],url:u,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),a.levelDetails=m,this.handlePlaylistLoaded(m,e,t,a,r,n)},t.handleManifestParsingError=function d(e,t,a,r,n){this.hls.trigger(Ta.ERROR,{type:La.NETWORK_ERROR,details:va.MANIFEST_PARSING_ERROR,fatal:t.type===fr.MANIFEST,url:e.url,err:a,error:a,reason:a.message,response:e,context:t,networkDetails:r,stats:n})},t.handleNetworkError=function d(e,t,a,r,n){void 0===a&&(a=!1);var i="A network "+(a?"timeout":"error"+(r?" (status "+r.code+")":""))+" occurred while loading "+e.type;e.type===fr.LEVEL?i+=": "+e.level+" id: "+e.id:(e.type===fr.AUDIO_TRACK||e.type===fr.SUBTITLE_TRACK)&&(i+=" id: "+e.id+" group-id: \""+e.groupId+"\"");var o=new Error(i);Da.warn("[playlist-loader]: "+i);var s=va.UNKNOWN,l=!1,u=this.getInternalLoader(e);switch(e.type){case fr.MANIFEST:s=a?va.MANIFEST_LOAD_TIMEOUT:va.MANIFEST_LOAD_ERROR,l=!0;break;case fr.LEVEL:s=a?va.LEVEL_LOAD_TIMEOUT:va.LEVEL_LOAD_ERROR,l=!1;break;case fr.AUDIO_TRACK:s=a?va.AUDIO_TRACK_LOAD_TIMEOUT:va.AUDIO_TRACK_LOAD_ERROR,l=!1;break;case fr.SUBTITLE_TRACK:s=a?va.SUBTITLE_TRACK_LOAD_TIMEOUT:va.SUBTITLE_LOAD_ERROR,l=!1}u&&this.resetInternalLoader(e.type);var f={type:La.NETWORK_ERROR,details:s,fatal:l,url:e.url,loader:u,context:e,error:o,networkDetails:t,stats:n};if(r){var g=(null==t?void 0:t.url)||e.url;f.response=y({url:g,data:void 0},r)}this.hls.trigger(Ta.ERROR,f)},t.handlePlaylistLoaded=function i(e,t,a,r,n,d){var o=this.hls,s=r.type,l=r.level,u=r.id,f=r.groupId,g=r.deliveryDirectives,c=Le(t,r),m=Te(r),p="number"==typeof r.level&&m===gr.MAIN?l:void 0;if(!e.fragments.length){var y=new Error("No Segments found in Playlist");return void o.trigger(Ta.ERROR,{type:La.NETWORK_ERROR,details:va.LEVEL_EMPTY_ERROR,fatal:!1,url:c,error:y,reason:y.message,response:t,context:r,level:p,parent:m,networkDetails:n,stats:a})}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));var h=e.playlistParsingError;return h?void o.trigger(Ta.ERROR,{type:La.NETWORK_ERROR,details:va.LEVEL_PARSING_ERROR,fatal:!1,url:c,error:h,reason:h.message,response:t,context:r,level:p,parent:m,networkDetails:n,stats:a}):void(e.live&&d&&(d.getCacheAge&&(e.ageHeader=d.getCacheAge()||0),(!d.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),s===fr.MANIFEST||s===fr.LEVEL?o.trigger(Ta.LEVEL_LOADED,{details:e,level:p||0,id:u||0,stats:a,networkDetails:n,deliveryDirectives:g}):s===fr.AUDIO_TRACK?o.trigger(Ta.AUDIO_TRACK_LOADED,{details:e,id:u||0,groupId:f||"",stats:a,networkDetails:n,deliveryDirectives:g}):s===fr.SUBTITLE_TRACK?o.trigger(Ta.SUBTITLE_TRACK_LOADED,{details:e,id:u||0,groupId:f||"",stats:a,networkDetails:n,deliveryDirectives:g}):void 0)},e}(),mr={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"},pr=function(){var t=Number.MAX_VALUE,a=_e();try{new a(0,n,"")}catch(a){return t}return n}(),yr=function(){function e(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}var t=e.prototype;return t.destroy=function e(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},t._registerListeners=function e(){var t=this.hls;t.on(Ta.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(Ta.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(Ta.MANIFEST_LOADING,this.onManifestLoading,this),t.on(Ta.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.on(Ta.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(Ta.LEVEL_UPDATED,this.onLevelUpdated,this)},t._unregisterListeners=function e(){var t=this.hls;t.off(Ta.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(Ta.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(Ta.MANIFEST_LOADING,this.onManifestLoading,this),t.off(Ta.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),t.off(Ta.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(Ta.LEVEL_UPDATED,this.onLevelUpdated,this)},t.onMediaAttached=function a(e,t){this.media=t.media},t.onMediaDetaching=function e(){this.id3Track&&(Se(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},t.onManifestLoading=function e(){this.dateRangeCuesAppended={}},t.createTrack=function t(e){var a=this.getID3Track(e.textTracks);return a.mode="hidden",a},t.getID3Track=function t(e){if(this.media){for(var a=0,r;a<e.length;a++)if(r=e[a],"metadata"===r.kind&&"id3"===r.label)return ve(r,this.media),r;return this.media.addTextTrack("metadata","id3")}},t.onFragParsingMetadata=function a(e,t){if(this.media){var r=this.hls.config,n=r.enableEmsgMetadataCues,d=r.enableID3MetadataCues;if(n||d){var o=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var s=_e(),l=0,u;l<o.length;l++)if(u=o[l].type,(u!==mr.emsg||n)&&d){var f=Ya(o[l].data);if(f){var g=o[l].pts,c=g+o[l].duration;c>pr&&(c=pr);var m=c-g;0>=m&&(c=g+.25);for(var p=0,y;p<f.length;p++)if(y=f[p],!Va(y)){this.updateId3CueEnds(g,u);var h=new s(g,c,"");h.value=y,u&&(h.type=u),this.id3Track.addCue(h)}}}}}},t.updateId3CueEnds=function a(e,t){var r=null==(n=this.id3Track)?void 0:n.cues,n;if(r)for(var d=r.length,o;d--;)o=r[d],o.type===t&&o.startTime<e&&o.endTime===pr&&(o.endTime=e)},t.onBufferFlushing=function a(e,t){var r=t.startOffset,n=t.endOffset,d=t.type,i=this.id3Track,o=this.hls;if(o){var s=o.config,l=s.enableEmsgMetadataCues,u=s.enableID3MetadataCues;if(i&&(l||u)){var f;f="audio"===d?function t(e){return e.type===mr.audioId3&&u}:"video"===d?function t(e){return e.type===mr.emsg&&l}:function t(e){return e.type===mr.audioId3&&u||e.type===mr.emsg&&l},Re(i,r,n,f)}}},t.onLevelUpdated=function a(e,t){var r=this,n=t.details;if(this.media&&n.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var d=this.dateRangeCuesAppended,o=this.id3Track,s=n.dateRanges,l=Object.keys(s);if(o)for(var u=Object.keys(d).filter(function(e){return!l.includes(e)}),f=function e(){var t=u[g];Object.keys(d[t].cues).forEach(function(e){o.removeCue(d[t].cues[e])}),delete d[t]},g=u.length;g--;)f();var c=n.fragments[n.fragments.length-1];if(0!==l.length&&Ea(null==c?void 0:c.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var m=c.programDateTime/1e3-c.start,p=_e(),y=function e(){var t=l[h],a=s[t],n=d[t],i=(null==n?void 0:n.cues)||{},o=(null==n?void 0:n.durationKnown)||!1,u=be(a.startDate,m),f=pr,g=a.endDate;if(g)f=be(g,m),o=!0;else if(a.endOnNext&&!o){var c=l.reduce(function(e,t){var r=s[t];return r.class===a.class&&r.id!==t&&r.startDate>a.startDate&&e.push(r),e},[]).sort(function(e,t){return e.startDate.getTime()-t.startDate.getTime()})[0];c&&(f=be(c.startDate,m),o=!0)}for(var y=Object.keys(a.attr),E=0,T;E<y.length;E++)if(T=y[E],!!N(T)){var L=i[T];if(L)o&&!n.durationKnown&&(L.endTime=f);else{var v=a.attr[T];L=new p(u,f,""),w(T)&&(v=ke(v)),L.value={key:T,data:v},L.type=mr.dateRange,L.id=t,r.id3Track.addCue(L),i[T]=L}}d[t]={cues:i,dateRange:a,durationKnown:o}},h=0;h<l.length;h++)y()}}},e}(),hr=function(){function e(e){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return t.timeupdate()},this.hls=e,this.config=e.config,this.registerListeners()}var t=e.prototype;return t.destroy=function e(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},t.registerListeners=function e(){this.hls.on(Ta.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(Ta.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(Ta.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(Ta.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(Ta.ERROR,this.onError,this)},t.unregisterListeners=function e(){this.hls.off(Ta.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(Ta.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(Ta.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(Ta.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(Ta.ERROR,this.onError,this)},t.onMediaAttached=function a(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},t.onMediaDetaching=function e(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},t.onManifestLoading=function e(){this.levelDetails=null,this._latency=null,this.stallCount=0},t.onLevelUpdated=function a(e,t){var r=t.details;this.levelDetails=r,r.advanced&&this.timeupdate(),!r.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},t.onError=function a(e,t){var r;t.details!==va.BUFFER_STALLED_ERROR||(this.stallCount++,null!=(r=this.levelDetails)&&r.live&&Da.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},t.timeupdate=function e(){var t=this.media,a=this.levelDetails;if(t&&a){this.currentTime=t.currentTime;var n=this.computeLatency();if(null!==n){this._latency=n;var d=this.config,i=d.lowLatencyMode,l=d.maxLiveSyncPlaybackRate;if(i&&1!==l){var u=this.targetLatency;if(null!==u){var f=n-u,g=s(this.maxLatency,u+a.targetduration),m=f<g;if(a.live&&m&&.05<f&&1<this.forwardBufferLength){var p=s(2,c(1,l)),y=o(20*(2/(1+r(-.75*f-this.edgeStalled))))/20;t.playbackRate=s(p,c(1,y))}else 1!==t.playbackRate&&0!==t.playbackRate&&(t.playbackRate=1)}}}}},t.estimateLiveEdge=function e(){var t=this.levelDetails;return null===t?null:t.edge+t.age},t.computeLatency=function e(){var t=this.estimateLiveEdge();return null===t?null:t-this.currentTime},E(e,[{key:"latency",get:function e(){return this._latency||0}},{key:"maxLatency",get:function e(){var t=this.config,a=this.levelDetails;return void 0===t.liveMaxLatencyDuration?a?t.liveMaxLatencyDurationCount*a.targetduration:0:t.liveMaxLatencyDuration}},{key:"targetLatency",get:function e(){var t=this.levelDetails;if(null===t)return null;var a=t.holdBack,r=t.partHoldBack,n=t.targetduration,d=this.config,i=d.liveSyncDuration,o=d.liveSyncDurationCount,l=d.lowLatencyMode,u=this.hls.userConfig,f=l?r||a:a;(u.liveSyncDuration||u.liveSyncDurationCount||0===f)&&(f=void 0===i?o*n:i);var g=n,c=1;return f+s(this.stallCount*c,g)}},{key:"liveSyncPosition",get:function e(){var t=this.estimateLiveEdge(),a=this.targetLatency,r=this.levelDetails;if(null===t||null===a||null===r)return null;var n=r.edge,d=t-a-this.edgeStalled,i=n-r.totalduration,o=n-(this.config.lowLatencyMode&&r.partTarget||r.targetduration);return s(c(i,d),o)}},{key:"drift",get:function e(){var t=this.levelDetails;return null===t?1:t.drift}},{key:"edgeStalled",get:function e(){var t=this.levelDetails;if(null===t)return 0;var a=3*(this.config.lowLatencyMode&&t.partTarget||t.targetduration);return c(t.age-a,0)}},{key:"forwardBufferLength",get:function e(){var t=this.media,a=this.levelDetails;if(!t||!a)return 0;var r=t.buffered.length;return(r?t.buffered.end(r-1):a.edge)-this.currentTime}}]),e}(),Er=["NONE","TYPE-0","TYPE-1",null],Tr={No:"",Yes:"YES",v2:"v2"},Lr=function(){function e(e,t,a){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=a}var t=e.prototype;return t.addDirectives=function t(e){var a=new self.URL(e);return void 0!==this.msn&&a.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&a.searchParams.set("_HLS_part",this.part.toString()),this.skip&&a.searchParams.set("_HLS_skip",this.skip),a.href},e}(),vr=function(){function e(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter(function(e){return e}).join(",").replace(/\.[^.,]+/g,"")}var t=e.prototype;return t.addFallback=function t(e){this.url.push(e.url),this._attrs.push(e.attrs)},E(e,[{key:"maxBitrate",get:function e(){return c(this.realBitrate,this.bitrate)}},{key:"attrs",get:function e(){return this._attrs[this._urlId]}},{key:"pathwayId",get:function e(){return this.attrs["PATHWAY-ID"]||"."}},{key:"uri",get:function e(){return this.url[this._urlId]||""}},{key:"urlId",get:function e(){return this._urlId},set:function t(e){var a=e%this.url.length;this._urlId!==a&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=a)}},{key:"audioGroupId",get:function e(){var t;return null==(t=this.audioGroupIds)?void 0:t[this.urlId]}},{key:"textGroupId",get:function e(){var t;return null==(t=this.textGroupIds)?void 0:t[this.urlId]}}]),e}(),Sr={search:function a(e,t){for(var r=0,n=e.length-1,d=null,i=null;r<=n;){d=0|(r+n)/2,i=e[d];var o=t(i);if(0<o)r=d+1;else if(0>o)n=d-1;else return i}return null}},Rr={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},Ar={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4},Dr=function(){function e(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=Da.log.bind(Da,"[info]:"),this.warn=Da.warn.bind(Da,"[warning]:"),this.error=Da.error.bind(Da,"[error]:"),this.registerListeners()}var t=e.prototype;return t.registerListeners=function e(){var t=this.hls;t.on(Ta.ERROR,this.onError,this),t.on(Ta.MANIFEST_LOADING,this.onManifestLoading,this),t.on(Ta.LEVEL_UPDATED,this.onLevelUpdated,this)},t.unregisterListeners=function e(){var t=this.hls;t&&(t.off(Ta.ERROR,this.onError,this),t.off(Ta.ERROR,this.onErrorOut,this),t.off(Ta.MANIFEST_LOADING,this.onManifestLoading,this),t.off(Ta.LEVEL_UPDATED,this.onLevelUpdated,this))},t.destroy=function e(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},t.startLoad=function t(e){this.playlistError=0},t.stopLoad=function e(){},t.getVariantLevelIndex=function t(e){return(null==e?void 0:e.type)===gr.MAIN?e.level:this.hls.loadLevel},t.onManifestLoading=function e(){this.playlistError=0,this.penalizedRenditions={}},t.onLevelUpdated=function e(){this.playlistError=0},t.onError=function a(e,t){var r,n;if(!t.fatal){var d=this.hls,i=t.context;switch(t.details){case va.FRAG_LOAD_ERROR:case va.FRAG_LOAD_TIMEOUT:case va.KEY_LOAD_ERROR:case va.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case va.FRAG_PARSING_ERROR:if(null!=(r=t.frag)&&r.gap)return void(t.errorAction={action:Rr.DoNothing,flags:Ar.None});case va.FRAG_GAP:case va.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=Rr.SendAlternateToPenaltyBox);case va.LEVEL_EMPTY_ERROR:case va.LEVEL_PARSING_ERROR:{var o=t.parent===gr.MAIN?t.level:d.loadLevel,s,l;t.details===va.LEVEL_EMPTY_ERROR&&null!=(s=t.context)&&null!=(l=s.levelDetails)&&l.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,o))}return;case va.LEVEL_LOAD_ERROR:case va.LEVEL_LOAD_TIMEOUT:return void("number"==typeof(null==i?void 0:i.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,i.level)));case va.AUDIO_TRACK_LOAD_ERROR:case va.AUDIO_TRACK_LOAD_TIMEOUT:case va.SUBTITLE_LOAD_ERROR:case va.SUBTITLE_TRACK_LOAD_TIMEOUT:if(i){var u=d.levels[d.loadLevel];if(u&&(i.type===fr.AUDIO_TRACK&&i.groupId===u.audioGroupId||i.type===fr.SUBTITLE_TRACK&&i.groupId===u.textGroupId))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,d.loadLevel),t.errorAction.action=Rr.SendAlternateToPenaltyBox,void(t.errorAction.flags=Ar.MoveAllAlternatesMatchingHost)}return;case va.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{var f=d.levels[d.loadLevel],g=null==f?void 0:f.attrs["HDCP-LEVEL"];g&&(t.errorAction={action:Rr.SendAlternateToPenaltyBox,flags:Ar.MoveAllAlternatesMatchingHDCP,hdcpLevel:g})}return;case va.BUFFER_ADD_CODEC_ERROR:case va.REMUX_ALLOC_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null==(n=t.level)?d.loadLevel:n));case va.INTERNAL_EXCEPTION:case va.BUFFER_APPENDING_ERROR:case va.BUFFER_APPEND_ERROR:case va.BUFFER_FULL_ERROR:case va.LEVEL_SWITCH_ERROR:case va.BUFFER_STALLED_ERROR:case va.BUFFER_SEEK_OVER_HOLE:case va.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:Rr.DoNothing,flags:Ar.None})}if(t.type===La.KEY_SYSTEM_ERROR){var c=this.getVariantLevelIndex(t.frag);return t.levelRetry=!1,void(t.errorAction=this.getLevelSwitchAction(t,c))}}},t.getPlaylistRetryOrSwitchAction=function a(e,t){var r=this.hls,n=Ve(r.config.playlistLoadPolicy,e),d=this.playlistError++,i=null==(s=e.response)?void 0:s.code,o=qe(n,d,He(e),i),s;if(o)return{action:Rr.RetryRequest,flags:Ar.None,retryConfig:n,retryCount:d};var l=this.getLevelSwitchAction(e,t);return n&&(l.retryConfig=n,l.retryCount=d),l},t.getFragRetryOrSwitchAction=function t(e){var a=this.hls,r=this.getVariantLevelIndex(e.frag),n=a.levels[r],d=a.config,i=d.fragLoadPolicy,o=d.keyLoadPolicy,s=Ve(e.details.startsWith("key")?o:i,e),l=a.levels.reduce(function(e,t){return e+t.fragmentError},0);if(n){var u;e.details!==va.FRAG_GAP&&n.fragmentError++;var f=null==(u=e.response)?void 0:u.code,g=qe(s,l,He(e),f);if(g)return{action:Rr.RetryRequest,flags:Ar.None,retryConfig:s,retryCount:l}}var c=this.getLevelSwitchAction(e,r);return s&&(c.retryConfig=s,c.retryCount=l),c},t.getLevelSwitchAction=function a(e,t){var r=this.hls;(null===t||void 0===t)&&(t=r.loadLevel);var n=this.hls.levels[t];if(n&&(n.loadError++,r.autoLevelEnabled)){for(var d=-1,o=r.levels,s=r.loadLevel,l=r.minAutoLevel,u=r.maxAutoLevel,f=null==(y=e.frag)?void 0:y.type,g=null==(h=e.context)?{}:h,c=g.type,m=g.groupId,p=o.length,y,h,E;p--;)if(E=(p+s)%o.length,E!==s&&E>=l&&E<=u&&0===o[E].loadError){var T=o[E];if(e.details===va.FRAG_GAP&&e.frag){var L=o[E].details;if(L){var v=Xe(e.frag,L.fragments,e.frag.start);if(null!=v&&v.gap)continue}}else if(c===fr.AUDIO_TRACK&&m===T.audioGroupId||c===fr.SUBTITLE_TRACK&&m===T.textGroupId)continue;else if(f===gr.AUDIO&&n.audioGroupId===T.audioGroupId||f===gr.SUBTITLE&&n.textGroupId===T.textGroupId)continue;d=E;break}if(-1<d&&r.loadLevel!==d)return e.levelRetry=!0,this.playlistError=0,{action:Rr.SendAlternateToPenaltyBox,flags:Ar.None,nextAutoLevel:d}}return{action:Rr.SendAlternateToPenaltyBox,flags:Ar.MoveAllAlternatesMatchingHost}},t.onErrorOut=function a(e,t){var r;switch(null==(r=t.errorAction)?void 0:r.action){case Rr.DoNothing:break;case Rr.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===va.FRAG_GAP||(t.fatal=!0)}if(t.fatal)return void this.hls.stopLoad()},t.sendAlternateToPenaltyBox=function t(e){var a=this.hls,r=e.errorAction;if(r){var n=r.flags,d=r.hdcpLevel,i=r.nextAutoLevel;n===Ar.None?this.switchLevel(e,i):n===Ar.MoveAllAlternatesMatchingHost?r.resolved||(r.resolved=this.redundantFailover(e)):n===Ar.MoveAllAlternatesMatchingHDCP?(d&&(a.maxHdcpLevel=Er[Er.indexOf(d)-1],r.resolved=!0),this.warn("Restricting playback to HDCP-LEVEL of \""+a.maxHdcpLevel+"\" or lower")):void 0,r.resolved||this.switchLevel(e,i)}},t.switchLevel=function a(e,t){void 0!==t&&e.errorAction&&(this.warn("switching to level "+t+" after "+e.details),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)},t.redundantFailover=function t(e){var a=this,r=this.hls,n=this.penalizedRenditions,d=e.parent===gr.MAIN?e.level:r.loadLevel,o=r.levels[d],s=o.url.length,l=e.frag?e.frag.urlId:o.urlId;o.urlId===l&&(!e.frag||o.details)&&this.penalizeRendition(o,e);for(var u=function t(){var i=(l+f)%s,u=n[i];if(!u||Je(u,e,n[l]))return a.warn("Switching to Redundant Stream "+(i+1)+"/"+s+": \""+o.url[i]+"\" after "+e.details),a.playlistError=0,r.levels.forEach(function(e){e.urlId=i}),r.nextLoadLevel=d,{v:!0}},f=1,g;f<s;f++)if(g=u(),"object"==typeof g)return g.v;return!1},t.penalizeRendition=function a(e,t){var r=this.penalizedRenditions,n=r[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};n.lastErrorPerfMs=performance.now(),n.errors.push(t),n.details=e.details,r[e.urlId]=n},e}(),_r=function(){function e(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=Da.log.bind(Da,t+":"),this.warn=Da.warn.bind(Da,t+":"),this.hls=e}var t=e.prototype;return t.destroy=function e(){this.clearTimer(),this.hls=this.log=this.warn=null},t.clearTimer=function e(){clearTimeout(this.timer),this.timer=-1},t.startLoad=function e(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()},t.stopLoad=function e(){this.canLoad=!1,this.clearTimer()},t.switchParams=function a(e,t){var r=null==t?void 0:t.renditionReports;if(r){for(var n=-1,d=0;d<r.length;d++){var o=r[d],l=void 0;try{l=new self.URL(o.URI,t.url).href}catch(e){Da.warn("Could not construct new URL for Rendition Report: "+e),l=o.URI||""}if(l===e){n=d;break}else l===e.substring(0,l.length)&&(n=d)}if(-1!==n){var u=r[n],f=parseInt(u["LAST-MSN"])||(null==t?void 0:t.lastPartSn),g=parseInt(u["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){var c=s(t.age-t.partTarget,t.targetduration);0<=g&&c>t.partTarget&&(g+=1)}return new Lr(f,0<=g?g:void 0,Tr.No)}}},t.loadPlaylist=function t(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())},t.shouldLoadPlaylist=function t(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)},t.shouldReloadPlaylist=function t(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)},t.playlistLoaded=function r(e,t,a){var n=this,d=t.details,i=t.stats,l=self.performance.now(),u=i.loading.first?c(0,l-i.loading.first):0;if(d.advancedDateTime=Date.now()-u,d.live||null!=a&&a.live){if(d.reloaded(a),a&&this.log("live playlist "+e+" "+(d.advanced?"REFRESHED "+d.lastPartSn+"-"+d.lastPartIndex:d.updated?"UPDATED":"MISSED")),a&&0<d.fragments.length&&Pe(a,d),!this.canLoad||!d.live)return;var g=void 0,m=void 0,p;if(d.canBlockReload&&d.endSN&&d.advanced){var y=this.hls.config.lowLatencyMode,h=d.lastPartSn,E=d.endSN,T=d.lastPartIndex,L=-1!==T,v=h===E,S=y?0:T;L?(g=v?E+1:h,m=v?S:T+1):g=E+1;var R=d.age,A=R+d.ageHeader,D=s(A-d.partTarget,1.5*d.targetduration);if(0<D){if(a&&D>a.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+a.tuneInGoal+" to: "+D+" with playlist age: "+d.age),D=0;else{var _=f(D/d.targetduration);if(g+=_,void 0!==m){var b=o(D%d.targetduration/d.partTarget);m+=b}this.log("CDN Tune-in age: "+d.ageHeader+"s last advanced "+R.toFixed(2)+"s goal: "+D+" skip sn "+_+" to part "+m)}d.tuneInGoal=D}if(p=this.getDeliveryDirectives(d,t.deliveryDirectives,g,m),y||!v)return void this.loadPlaylist(p)}else(d.canBlockReload||d.canSkipUntil)&&(p=this.getDeliveryDirectives(d,t.deliveryDirectives,g,m));var k=this.hls.mainForwardBufferInfo,I=k?k.end-k.len:0,x=1e3*(d.edge-I),C=Be(d,x);d.updated&&l>this.requestScheduled+C&&(this.requestScheduled=i.loading.start),void 0!==g&&d.canBlockReload?this.requestScheduled=i.loading.first+C-(1e3*d.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+C<l?this.requestScheduled=l:0>=this.requestScheduled-l&&(this.requestScheduled+=C);var P=this.requestScheduled-l;P=c(0,P),this.log("reload live playlist "+e+" in "+o(P)+" ms"),this.timer=self.setTimeout(function(){return n.loadPlaylist(p)},P)}else this.clearTimer()},t.getDeliveryDirectives=function n(e,t,a,r){var d=Ie(e,a);return null!=t&&t.skip&&e.deltaUpdateFailed&&(a=t.msn,r=t.part,d=Tr.No),new Lr(a,r,d)},t.checkRetry=function t(e){var a=this,r=e.details,n=He(e),d=e.errorAction,i=d||{},o=i.action,s=i.retryCount,l=void 0===s?0:s,u=i.retryConfig,f=!!d&&!!u&&(o===Rr.RetryRequest||!d.resolved&&o===Rr.SendAlternateToPenaltyBox);if(f){var g;if(this.requestScheduled=-1,l>=u.maxNumRetry)return!1;if(n&&null!=(g=e.context)&&g.deliveryDirectives)this.warn("Retrying playlist loading "+(l+1)+"/"+u.maxNumRetry+" after \""+r+"\" without delivery-directives"),this.loadPlaylist();else{var c=We(u,l);this.timer=self.setTimeout(function(){return a.loadPlaylist()},c),this.warn("Retrying playlist loading "+(l+1)+"/"+u.maxNumRetry+" after \""+r+"\" in "+c+"ms")}e.levelRetry=!0,d.resolved=!0}return f},e}(),br=function(e){function t(t,a){var r;return r=e.call(this,t,"[level-controller]")||this,r._levels=[],r._firstLevel=-1,r._startLevel=void 0,r.currentLevel=null,r.currentLevelIndex=-1,r.manualLevelIndex=-1,r.steering=void 0,r.onParsedComplete=void 0,r.steering=a,r._registerListeners(),r}v(t,e);var a=t.prototype;return a._registerListeners=function e(){var t=this.hls;t.on(Ta.MANIFEST_LOADING,this.onManifestLoading,this),t.on(Ta.MANIFEST_LOADED,this.onManifestLoaded,this),t.on(Ta.LEVEL_LOADED,this.onLevelLoaded,this),t.on(Ta.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(Ta.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(Ta.FRAG_LOADED,this.onFragLoaded,this),t.on(Ta.ERROR,this.onError,this)},a._unregisterListeners=function e(){var t=this.hls;t.off(Ta.MANIFEST_LOADING,this.onManifestLoading,this),t.off(Ta.MANIFEST_LOADED,this.onManifestLoaded,this),t.off(Ta.LEVEL_LOADED,this.onLevelLoaded,this),t.off(Ta.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(Ta.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(Ta.FRAG_LOADED,this.onFragLoaded,this),t.off(Ta.ERROR,this.onError,this)},a.destroy=function t(){this._unregisterListeners(),this.steering=null,this.resetLevels(),e.prototype.destroy.call(this)},a.startLoad=function t(){var a=this._levels;a.forEach(function(e){e.loadError=0,e.fragmentError=0}),e.prototype.startLoad.call(this)},a.resetLevels=function e(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]},a.onManifestLoading=function a(e,t){this.resetLevels()},a.onManifestLoaded=function a(e,t){var r=[],n={},d;t.levels.forEach(function(e){var t=e.attrs,a;-1!==(null==(a=e.audioCodec)?void 0:a.indexOf("mp4a.40.34"))&&(fn||(fn=/chrome|firefox/i.test(navigator.userAgent)),fn&&(e.audioCodec=void 0));var i=t.AUDIO,o=t.CODECS,s=t["FRAME-RATE"];t["PATHWAY-ID"];var l=t.RESOLUTION,u=t.SUBTITLES,f="",g=""+f+e.bitrate+"-"+l+"-"+s+"-"+o;d=n[g],d?d.addFallback(e):(d=new vr(e),n[g]=d,r.push(d)),et(d,"audio",i),et(d,"text",u)}),this.filterAndSortMediaOptions(r,t)},a.filterAndSortMediaOptions=function a(e,t){var r=this,n=[],d=[],o=!1,s=!1,l=!1,u=e.filter(function(e){var t=e.audioCodec,a=e.videoCodec,r=e.width,n=e.height,d=e.unknownCodecs;return o||(o=!!(r&&n)),s||(s=!!a),l||(l=!!t),!(null!=d&&d.length)&&(!t||ue(t,"audio"))&&(!a||ue(a,"video"))});if((o||s)&&l&&(u=u.filter(function(e){var t=e.videoCodec,a=e.width,r=e.height;return!!t||!!(a&&r)})),0===u.length)return void Promise.resolve().then(function(){if(r.hls){var e=new Error("no level with compatible codecs found in manifest");r.hls.trigger(Ta.ERROR,{type:La.MEDIA_ERROR,details:va.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:e,reason:e.message})}});t.audioTracks&&(n=t.audioTracks.filter(function(e){return!e.audioCodec||ue(e.audioCodec,"audio")}),tt(n)),t.subtitles&&(d=t.subtitles,tt(d));var f=u.slice(0);u.sort(function(e,t){return e.attrs["HDCP-LEVEL"]===t.attrs["HDCP-LEVEL"]?e.bitrate===t.bitrate?e.attrs["FRAME-RATE"]===t.attrs["FRAME-RATE"]?e.attrs.SCORE===t.attrs.SCORE?o&&e.height!==t.height?e.height-t.height:0:e.attrs.decimalFloatingPoint("SCORE")-t.attrs.decimalFloatingPoint("SCORE"):e.attrs.decimalFloatingPoint("FRAME-RATE")-t.attrs.decimalFloatingPoint("FRAME-RATE"):e.bitrate-t.bitrate:(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1});var g=f[0];if(this.steering&&(u=this.steering.filterParsedLevels(u),u.length!==f.length))for(var c=0;c<f.length;c++)if(f[c].pathwayId===u[0].pathwayId){g=f[c];break}this._levels=u;for(var m=0;m<u.length;m++)if(u[m]===g){this._firstLevel=m,this.log("manifest loaded, "+u.length+" level(s) found, first bitrate: "+g.bitrate);break}var p=l&&!s,y={levels:u,audioTracks:n,subtitleTracks:d,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:l,video:s,altAudio:!p&&n.some(function(e){return!!e.url})};this.hls.trigger(Ta.MANIFEST_PARSED,y),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)},a.onError=function a(e,t){t.fatal||!t.context||t.context.type===fr.LEVEL&&t.context.level===this.level&&this.checkRetry(t)},a.onFragLoaded=function a(e,t){var r=t.frag;if(void 0!==r&&r.type===gr.MAIN){var n=this._levels[r.level];void 0!==n&&(n.loadError=0)}},a.onLevelLoaded=function a(e,t){var r=t.level,n=t.details,d=this._levels[r],i;if(!d){var o;return this.warn("Invalid level index "+r),void(null!=(o=t.deliveryDirectives)&&o.skip&&(n.deltaUpdateFailed=!0))}r===this.currentLevelIndex?(0===d.fragmentError&&(d.loadError=0),this.playlistLoaded(r,t,d.details)):null!=(i=t.deliveryDirectives)&&i.skip&&(n.deltaUpdateFailed=!0)},a.onAudioTrackSwitched=function a(e,t){var r=this.currentLevel;if(r){var n=this.hls.audioTracks[t.id].groupId;if(r.audioGroupIds&&r.audioGroupId!==n){for(var d=-1,o=0;o<r.audioGroupIds.length;o++)if(r.audioGroupIds[o]===n){d=o;break}-1!==d&&d!==r.urlId&&(r.urlId=d,this.canLoad&&this.startLoad())}}},a.loadPlaylist=function a(t){e.prototype.loadPlaylist.call(this);var r=this.currentLevelIndex,n=this.currentLevel;if(n&&this.shouldLoadPlaylist(n)){var d=n.urlId,i=n.uri;if(t)try{i=t.addDirectives(i)}catch(e){this.warn("Could not construct new URL with HLS Delivery Directives: "+e)}var o=n.attrs["PATHWAY-ID"];this.log("Loading level index "+r+(void 0===(null==t?void 0:t.msn)?"":" at sn "+t.msn+" part "+t.part)+" with"+(o?" Pathway "+o:"")+" URI "+(d+1)+"/"+n.url.length+" "+i),this.clearTimer(),this.hls.trigger(Ta.LEVEL_LOADING,{url:i,level:r,id:d,deliveryDirectives:t||null})}},a.removeLevel=function a(e,t){var r=this,n=function r(e,a){return a!==t},d=this._levels.filter(function(a,d){return d!==e||(1<a.url.length&&void 0!==t?(a.url=a.url.filter(n),a.audioGroupIds&&(a.audioGroupIds=a.audioGroupIds.filter(n)),a.textGroupIds&&(a.textGroupIds=a.textGroupIds.filter(n)),a.urlId=0,!0):(r.steering&&r.steering.removeLevel(a),!1))});this.hls.trigger(Ta.LEVELS_UPDATED,{levels:d})},a.onLevelsUpdated=function a(e,t){var r=t.levels;r.forEach(function(e,t){var a=e.details;null!=a&&a.fragments&&a.fragments.forEach(function(e){e.level=t})}),this._levels=r},E(t,[{key:"levels",get:function e(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function e(){return this.currentLevelIndex},set:function t(e){var a=this._levels;if(0!==a.length){if(0>e||e>=a.length){var r=new Error("invalid level idx"),n=0>e;if(this.hls.trigger(Ta.ERROR,{type:La.OTHER_ERROR,details:va.LEVEL_SWITCH_ERROR,level:e,fatal:n,error:r,reason:r.message}),n)return;e=s(e,a.length-1)}var d=this.currentLevelIndex,i=this.currentLevel,o=i?i.attrs["PATHWAY-ID"]:void 0,l=a[e],u=l.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=l,!(d===e&&l.details&&i&&o===u)){this.log("Switching to level "+e+(u?" with Pathway "+u:"")+" from level "+d+(o?" with Pathway "+o:""));var f=L({},l,{level:e,maxBitrate:l.maxBitrate,attrs:l.attrs,uri:l.uri,urlId:l.urlId});delete f._attrs,delete f._urlId,this.hls.trigger(Ta.LEVEL_SWITCHING,f);var g=l.details;if(!g||g.live){var c=this.switchParams(l.uri,null==i?void 0:i.details);this.loadPlaylist(c)}}}}},{key:"manualLevel",get:function e(){return this.manualLevelIndex},set:function t(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function e(){return this._firstLevel},set:function t(e){this._firstLevel=e}},{key:"startLevel",get:function e(){if(void 0===this._startLevel){var t=this.hls.config.startLevel;return void 0===t?this._firstLevel:t}return this._startLevel},set:function t(e){this._startLevel=e}},{key:"nextLoadLevel",get:function e(){return-1===this.manualLevelIndex?this.hls.nextAutoLevel:this.manualLevelIndex},set:function t(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),t}(_r),kr={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},Ir=function(){function e(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}var t=e.prototype;return t._registerListeners=function e(){var t=this.hls;t.on(Ta.BUFFER_APPENDED,this.onBufferAppended,this),t.on(Ta.FRAG_BUFFERED,this.onFragBuffered,this),t.on(Ta.FRAG_LOADED,this.onFragLoaded,this)},t._unregisterListeners=function e(){var t=this.hls;t.off(Ta.BUFFER_APPENDED,this.onBufferAppended,this),t.off(Ta.FRAG_BUFFERED,this.onFragBuffered,this),t.off(Ta.FRAG_LOADED,this.onFragLoaded,this)},t.destroy=function e(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},t.getAppendedFrag=function a(e,t){var r=this.activePartLists[t];if(r)for(var n=r.length,d,o;n--&&(d=r[n],!!d);)if(o=d.end,d.start<=e&&null!==o&&e<=o)return d;return this.getBufferedFrag(e,t)},t.getBufferedFrag=function a(e,t){for(var r=this.fragments,n=Object.keys(r),d=n.length,o;d--;)if(o=r[n[d]],(null==o?void 0:o.body.type)===t&&o.buffered){var s=o.body;if(s.start<=e&&e<=s.end)return s}return null},t.detectEvictedFragments=function n(e,t,a,r){var d=this;this.timeRanges&&(this.timeRanges[e]=t);var i=(null==r?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(function(r){var n=d.fragments[r];if(n&&!(i>=n.body.sn)){if(!n.buffered&&!n.loaded)return void(n.body.type===a&&d.removeFragment(n.body));var o=n.range[e];o&&o.time.some(function(e){var a=!d.isTimeBuffered(e.startPTS,e.endPTS,t);return a&&d.removeFragment(n.body),a})}})},t.detectPartialFragments=function t(e){var a=this,r=this.timeRanges,n=e.frag,d=e.part;if(r&&"initSegment"!==n.sn){var i=rt(n),o=this.fragments[i];if(!(!o||o.buffered&&n.gap)){var s=!n.relurl;if(Object.keys(r).forEach(function(e){var t=n.elementaryStreams[e];if(t){var i=r[e],l=s||!0===t.partial;o.range[e]=a.getBufferedTimes(n,d,l,i)}}),o.loaded=null,Object.keys(o.range).length){o.buffered=!0;var l=o.body.endList=n.endList||o.body.endList;l&&(this.endListFragments[o.body.type]=o),at(o)||this.removeParts(n.sn-1,n.type)}else this.removeFragment(o.body)}}},t.removeParts=function a(e,t){var r=this.activePartLists[t];r&&(this.activePartLists[t]=r.filter(function(t){return t.fragment.sn>=e}))},t.fragBuffered=function a(e,t){var r=rt(e),n=this.fragments[r];!n&&t&&(n=this.fragments[r]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,n.buffered=!0)},t.getBufferedTimes=function n(e,t,a,r){for(var d={time:[],partial:a},o=e.start,l=e.end,u=e.minEndPTS||l,f=e.maxStartPTS||o,g=0;g<r.length;g++){var m=r.start(g)-this.bufferPadding,p=r.end(g)+this.bufferPadding;if(f>=m&&u<=p){d.time.push({startPTS:c(o,r.start(g)),endPTS:s(l,r.end(g))});break}else if(o<p&&l>m)d.partial=!0,d.time.push({startPTS:c(o,r.start(g)),endPTS:s(l,r.end(g))});else if(l<=m)break}return d},t.getPartialFragment=function t(e){var a=null,r=0,n=this.bufferPadding,d=this.fragments,i,o,l;return Object.keys(d).forEach(function(t){var u=d[t];!u||at(u)&&(o=u.body.start-n,l=u.body.end+n,e>=o&&e<=l&&(i=s(e-o,l-e),r<=i&&(a=u.body,r=i)))}),a},t.isEndListAppended=function t(e){var a=this.endListFragments[e];return void 0!==a&&(a.buffered||at(a))},t.getState=function t(e){var a=rt(e),r=this.fragments[a];return r?r.buffered?at(r)?kr.PARTIAL:kr.OK:kr.APPENDING:kr.NOT_LOADED},t.isTimeBuffered=function r(e,t,a){for(var n=0,d,o;n<a.length;n++){if(d=a.start(n)-this.bufferPadding,o=a.end(n)+this.bufferPadding,e>=d&&t<=o)return!0;if(t<=d)return!1}return!1},t.onFragLoaded=function a(e,t){var r=t.frag,n=t.part;if(!("initSegment"===r.sn||r.bitrateTest)){var d=n?null:t,i=rt(r);this.fragments[i]={body:r,appendedPTS:null,loaded:d,buffered:!1,range:Object.create(null)}}},t.onBufferAppended=function a(e,t){var r=this,n=t.frag,d=t.part,i=t.timeRanges;if("initSegment"!==n.sn){var o=n.type;if(d){var s=this.activePartLists[o];s||(this.activePartLists[o]=s=[]),s.push(d)}this.timeRanges=i,Object.keys(i).forEach(function(e){var t=i[e];r.detectEvictedFragments(e,t,o,d)})}},t.onFragBuffered=function a(e,t){this.detectPartialFragments(t)},t.hasFragment=function t(e){var a=rt(e);return!!this.fragments[a]},t.hasParts=function t(e){var a;return!!(null!=(a=this.activePartLists[e])&&a.length)},t.removeFragmentsInRange=function d(e,t,a,r,n){var i=this;r&&!this.hasGaps||Object.keys(this.fragments).forEach(function(d){var o=i.fragments[d];if(o){var s=o.body;s.type!==a||r&&!s.gap||s.start<t&&s.end>e&&(o.buffered||n)&&i.removeFragment(s)}})},t.removeFragment=function t(e){var a=rt(e);e.stats.loaded=0,e.clearElementaryStreamInfo();var r=this.activePartLists[e.type];if(r){var n=e.sn;this.activePartLists[e.type]=r.filter(function(e){return e.fragment.sn!==n})}delete this.fragments[a],e.endList&&delete this.endListFragments[e.type]},t.removeAllFragments=function e(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1},e}(),xr=g(2,17),Cr=function(){function e(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var t=e.prototype;return t.destroy=function e(){this.loader&&(this.loader.destroy(),this.loader=null)},t.abort=function e(){this.loader&&this.loader.abort()},t.load=function a(e,t){var r=this,n=e.url;if(!n)return Promise.reject(new Pr({type:La.NETWORK_ERROR,details:va.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(n?"part list":"url")),networkDetails:null}));this.abort();var d=this.config,i=d.fLoader,o=d.loader;return new Promise(function(a,s){if(r.loader&&r.loader.destroy(),e.gap){if(e.tagList.some(function(e){return"GAP"===e[0]}))return void s(dt(e));e.gap=!1}var l=r.loader=e.loader=i?new i(d):new o(d),u=nt(e),f=Ye(d.fragLoadPolicy.default),g={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:xr};e.stats=l.stats,l.load(u,g,{onSuccess:function o(t,n,d,i){r.resetLoader(e,l);var s=t.data;d.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(s.slice(0,16)),s=s.slice(16)),a({frag:e,part:null,payload:s,networkDetails:i})},onError:function o(t,a,d,i){r.resetLoader(e,l),s(new Pr({type:La.NETWORK_ERROR,details:va.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:y({url:n,data:void 0},t),error:new Error("HTTP Error "+t.code+" "+t.text),networkDetails:d,stats:i}))},onAbort:function d(t,a,n){r.resetLoader(e,l),s(new Pr({type:La.NETWORK_ERROR,details:va.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:n,stats:t}))},onTimeout:function d(t,a,n){r.resetLoader(e,l),s(new Pr({type:La.NETWORK_ERROR,details:va.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after "+g.timeout+"ms"),networkDetails:n,stats:t}))},onProgress:function i(a,r,n,d){t&&t({frag:e,part:null,payload:n,networkDetails:d})}})})},t.loadPart=function r(e,t,a){var n=this;this.abort();var d=this.config,i=d.fLoader,o=d.loader;return new Promise(function(r,s){if(n.loader&&n.loader.destroy(),e.gap||t.gap)return void s(dt(e,t));var l=n.loader=e.loader=i?new i(d):new o(d),u=nt(e,t),f=Ye(d.fragLoadPolicy.default),g={loadPolicy:f,timeout:f.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:xr};t.stats=l.stats,l.load(u,g,{onSuccess:function u(d,i,o,s){n.resetLoader(e,l),n.updateStatsFromPart(e,t);var f={frag:e,part:t,payload:d.data,networkDetails:s};a(f),r(f)},onError:function o(a,r,d,i){n.resetLoader(e,l),s(new Pr({type:La.NETWORK_ERROR,details:va.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:y({url:u.url,data:void 0},a),error:new Error("HTTP Error "+a.code+" "+a.text),networkDetails:d,stats:i}))},onAbort:function i(a,r,d){e.stats.aborted=t.stats.aborted,n.resetLoader(e,l),s(new Pr({type:La.NETWORK_ERROR,details:va.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:d,stats:a}))},onTimeout:function i(a,r,d){n.resetLoader(e,l),s(new Pr({type:La.NETWORK_ERROR,details:va.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error("Timeout after "+g.timeout+"ms"),networkDetails:d,stats:a}))}})})},t.updateStatsFromPart=function a(e,t){var r=e.stats,n=t.stats,d=n.total;if(r.loaded+=n.loaded,d){var i=o(e.duration/t.duration),l=s(o(r.loaded/d),i),u=i-l,f=u*o(r.loaded/l);r.total=r.loaded+f}else r.total=c(r.loaded,r.total);var g=r.loading,m=n.loading;g.start?g.first+=m.first-m.start:(g.start=m.start,g.first=m.first),g.end=m.end},t.resetLoader=function a(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},e}(),Pr=function(e){function t(t){var a;return a=e.call(this,t.error.message)||this,a.data=void 0,a.data=t,a}return v(t,e),t}(b(Error)),Fr=function(){function e(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}var t=e.prototype;return t.abort=function t(e){for(var a in this.keyUriToKeyInfo){var r=this.keyUriToKeyInfo[a].loader;if(r){if(e&&e!==r.context.frag.type)return;r.abort()}}},t.detach=function e(){for(var t in this.keyUriToKeyInfo){var a=this.keyUriToKeyInfo[t];(a.mediaKeySessionContext||a.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[t]}},t.destroy=function e(){for(var t in this.detach(),this.keyUriToKeyInfo){var a=this.keyUriToKeyInfo[t].loader;a&&a.destroy()}this.keyUriToKeyInfo={}},t.createKeyLoadError=function d(e,t,a,r,n){return void 0===t&&(t=va.KEY_LOAD_ERROR),new Pr({type:La.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:n,error:a,networkDetails:r})},t.loadClear=function a(e,t){var r=this;if(this.emeController&&this.config.emeEnabled)for(var n=e.sn,d=e.cc,o=function e(){var a=t[s];if(d<=a.cc&&("initSegment"===n||"initSegment"===a.sn||n<a.sn))return r.emeController.selectKeySystemFormat(a).then(function(e){a.setKeyFormat(e)}),"break"},s=0,l;s<t.length&&(l=o(),"break"!==l);s++);},t.load=function t(e){var a=this;return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then(function(t){return a.loadInternal(e,t)}):this.loadInternal(e)},t.loadInternal=function a(e,t){var r,n;t&&e.setKeyFormat(t);var d=e.decryptdata;if(!d){var i=new Error(t?"Expected frag.decryptdata to be defined after setting format "+t:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,va.KEY_LOAD_ERROR,i))}var o=d.uri;if(!o)return Promise.reject(this.createKeyLoadError(e,va.KEY_LOAD_ERROR,new Error("Invalid key URI: \""+o+"\"")));var s=this.keyUriToKeyInfo[o];if(null!=(r=s)&&r.decryptdata.key)return d.key=s.decryptdata.key,Promise.resolve({frag:e,keyInfo:s});if(null!=(n=s)&&n.keyLoadPromise){var l;switch(null==(l=s.mediaKeySessionContext)?void 0:l.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return s.keyLoadPromise.then(function(t){return d.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:s}})}}switch(s=this.keyUriToKeyInfo[o]={decryptdata:d,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},d.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===d.keyFormat?this.loadKeyHTTP(s,e):this.loadKeyEME(s,e);case"AES-128":return this.loadKeyHTTP(s,e);default:return Promise.reject(this.createKeyLoadError(e,va.KEY_LOAD_ERROR,new Error("Key supplied with unsupported METHOD: \""+d.method+"\"")))}},t.loadKeyEME=function a(e,t){var r={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var n=this.emeController.loadKey(r);if(n)return(e.keyLoadPromise=n.then(function(t){return e.mediaKeySessionContext=t,r})).catch(function(t){throw e.keyLoadPromise=null,t})}return Promise.resolve(r)},t.loadKeyHTTP=function a(e,t){var r=this,n=this.config,d=n.loader,i=new d(n);return t.keyLoader=e.loader=i,e.keyLoadPromise=new Promise(function(a,d){var o={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},s=n.keyLoadPolicy.default,l={loadPolicy:s,timeout:s.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},u={onSuccess:function o(e,t,n,i){var s=n.frag,l=n.keyInfo,u=n.url;return s.decryptdata&&l===r.keyUriToKeyInfo[u]?void(l.decryptdata.key=s.decryptdata.key=new Uint8Array(e.data),s.keyLoader=null,l.loader=null,a({frag:s,keyInfo:l})):d(r.createKeyLoadError(s,va.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),i))},onError:function s(e,a,n,i){r.resetLoader(a),d(r.createKeyLoadError(t,va.KEY_LOAD_ERROR,new Error("HTTP Error "+e.code+" loading key "+e.text),n,y({url:o.url,data:void 0},e)))},onTimeout:function i(e,a,n){r.resetLoader(a),d(r.createKeyLoadError(t,va.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),n))},onAbort:function i(e,a,n){r.resetLoader(a),d(r.createKeyLoadError(t,va.INTERNAL_ABORTED,new Error("key loading aborted"),n))}};i.load(o,l,u)})},t.resetLoader=function t(e){var a=e.frag,r=e.keyInfo,n=e.url,d=r.loader;a.keyLoader===d&&(a.keyLoader=null,r.loader=null),delete this.keyUriToKeyInfo[n],d&&d.destroy()},e}(),Or=function(){function e(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var t=e.prototype;return t.destroy=function e(){this.onHandlerDestroying(),this.onHandlerDestroyed()},t.onHandlerDestroying=function e(){this.clearNextTick(),this.clearInterval()},t.onHandlerDestroyed=function e(){},t.hasInterval=function e(){return!!this._tickInterval},t.hasNextTick=function e(){return!!this._tickTimer},t.setInterval=function t(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)},t.clearInterval=function e(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},t.clearNextTick=function e(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},t.tick=function e(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),1<this._tickCallCount&&this.tickImmediate(),this._tickCallCount=0)},t.tickImmediate=function e(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},t.doTick=function e(){},e}(),Nr={length:0,start:function e(){return 0},end:function e(){return 0}},wr=function(){function e(){}return e.isBuffered=function r(t,a){try{if(t)for(var n=e.getBuffered(t),d=0;d<n.length;d++)if(a>=n.start(d)&&a<=n.end(d))return!0}catch(e){}return!1},e.bufferInfo=function n(t,a,r){try{if(t){var d=e.getBuffered(t),o=[],s;for(s=0;s<d.length;s++)o.push({start:d.start(s),end:d.end(s)});return this.bufferedInfo(o,a,r)}}catch(e){}return{len:0,start:a,end:a,nextStart:void 0}},e.bufferedInfo=function r(e,t,a){t=c(0,t),e.sort(function(e,t){var a=e.start-t.start;return a?a:t.end-e.end});var n=[];if(a){for(var d=0,o;d<e.length;d++)if(o=n.length,o){var s=n[o-1].end;e[d].start-s<a?e[d].end>s&&(n[o-1].end=e[d].end):n.push(e[d])}else n.push(e[d]);}else n=e;for(var l=0,u=t,f=t,g=0,m;g<n.length;g++){var p=n[g].start,y=n[g].end;if(t+a>=p&&t<y)u=p,f=y,l=f-t;else if(t+a<p){m=p;break}}return{len:l,start:u||0,end:f||0,nextStart:m}},e.getBuffered=function t(e){try{return e.buffered}catch(t){return Da.log("failed to get media.buffered",t),Nr}},e}(),Mr=function i(e,t,a,r,n,d){void 0===r&&(r=0),void 0===n&&(n=-1),void 0===d&&(d=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=it(),this.buffering={audio:it(),video:it(),audiovideo:it()},this.level=e,this.sn=t,this.id=a,this.size=r,this.part=n,this.partial=d},Br=function(){function e(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}var t=e.prototype;return t.decrypt=function a(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}(),Ur=function(){function e(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}var t=e.prototype;return t.expandKey=function e(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}(),Gr=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function t(e){for(var a=new DataView(e),r=new Uint32Array(4),n=0;4>n;n++)r[n]=a.getUint32(4*n);return r},t.initTable=function e(){var a=this.sBox,r=this.invSBox,n=this.subMix,o=n[0],s=n[1],l=n[2],u=n[3],f=this.invSubMix,g=f[0],c=f[1],m=f[2],p=f[3],y=new Uint32Array(256),d=0,h=0,E=0;for(E=0;256>E;E++)y[E]=128>E?E<<1:283^E<<1;for(E=0;256>E;E++){var T=h^h<<1^h<<2^h<<3^h<<4;T=99^(T>>>8^255&T),a[d]=T,r[T]=d;var L=y[d],v=y[L],S=y[v],R=257*y[T]^16843008*T;o[d]=R<<24|R>>>8,s[d]=R<<16|R>>>16,l[d]=R<<8|R>>>24,u[d]=R,R=16843009*S^65537*v^257*L^16843008*d,g[T]=R<<24|R>>>8,c[T]=R<<16|R>>>16,m[T]=R<<8|R>>>24,p[T]=R,d?(d=L^y[y[y[S^L]]],h^=y[y[h]]):d=h=1}},t.expandKey=function a(e){for(var r=this.uint8ArrayToUint32Array_(e),n=!0,d=0;d<r.length&&n;)n=r[d]===this.key[d],d++;if(!n){this.key=r;var i=this.keySize=r.length;if(4!==i&&6!==i&&8!==i)throw new Error("Invalid aes key size="+i);var o=this.ksRows=4*(i+6+1),s=this.keySchedule=new Uint32Array(o),l=this.invKeySchedule=new Uint32Array(o),u=this.sBox,f=this.rcon,g=this.invSubMix,c=g[0],m=g[1],p=g[2],y=g[3],h,E,T,L;for(h=0;h<o;h++){if(h<i){T=s[h]=r[h];continue}L=T,0==h%i?(L=L<<8|L>>>24,L=u[L>>>24]<<24|u[255&L>>>16]<<16|u[255&L>>>8]<<8|u[255&L],L^=f[0|h/i]<<24):6<i&&4==h%i&&(L=u[L>>>24]<<24|u[255&L>>>16]<<16|u[255&L>>>8]<<8|u[255&L]),s[h]=T=(s[h-i]^L)>>>0}for(E=0;E<o;E++)h=o-E,L=3&E?s[h]:s[h-4],l[E]=4>E||4>=h?L:c[u[L>>>24]]^m[u[255&L>>>16]]^p[u[255&L>>>8]]^y[u[255&L]],l[E]>>>=0}},t.networkToHostOrderSwap=function t(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function r(e,t,a){for(var n=this.keySize+6,d=this.invKeySchedule,o=this.invSBox,s=this.invSubMix,l=s[0],u=s[1],f=s[2],g=s[3],c=this.uint8ArrayToUint32Array_(a),m=c[0],p=c[1],y=c[2],h=c[3],E=new Int32Array(e),T=new Int32Array(E.length),L=this.networkToHostOrderSwap,v,S,R,A,D,_,b,k,I,x,C,P,F,O;t<E.length;){for(I=L(E[t]),x=L(E[t+1]),C=L(E[t+2]),P=L(E[t+3]),D=I^d[0],_=P^d[1],b=C^d[2],k=x^d[3],F=4,O=1;O<n;O++)v=l[D>>>24]^u[255&_>>16]^f[255&b>>8]^g[255&k]^d[F],S=l[_>>>24]^u[255&b>>16]^f[255&k>>8]^g[255&D]^d[F+1],R=l[b>>>24]^u[255&k>>16]^f[255&D>>8]^g[255&_]^d[F+2],A=l[k>>>24]^u[255&D>>16]^f[255&_>>8]^g[255&b]^d[F+3],D=v,_=S,b=R,k=A,F+=4;v=o[D>>>24]<<24^o[255&_>>16]<<16^o[255&b>>8]<<8^o[255&k]^d[F],S=o[_>>>24]<<24^o[255&b>>16]<<16^o[255&k>>8]<<8^o[255&D]^d[F+1],R=o[b>>>24]<<24^o[255&k>>16]<<16^o[255&D>>8]<<8^o[255&_]^d[F+2],A=o[k>>>24]<<24^o[255&D>>16]<<16^o[255&_>>8]<<8^o[255&b]^d[F+3],T[t]=L(v^m),T[t+1]=L(A^p),T[t+2]=L(R^y),T[t+3]=L(S^h),m=I,p=x,y=C,h=P,t+=4}return T.buffer},e}(),Kr=function(){function e(e,t){var a=void 0===t?{}:t,r=a.removePKCS7Padding,n=void 0===r||r;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=n,n)try{var d=self.crypto;d&&(this.subtle=d.subtle||d.webkitSubtle)}catch(t){}null===this.subtle&&(this.useSoftware=!0)}var t=e.prototype;return t.destroy=function e(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},t.isSync=function e(){return this.useSoftware},t.flush=function e(){var t=this.currentResult,a=this.remainderData;if(!t||a)return this.reset(),null;var r=new Uint8Array(t);return this.reset(),this.removePKCS7Padding?pt(r):r},t.reset=function e(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},t.decrypt=function r(e,t,a){var n=this;return this.useSoftware?new Promise(function(r,d){n.softwareDecrypt(new Uint8Array(e),t,a);var i=n.flush();i?r(i.buffer):d(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,a)},t.softwareDecrypt=function r(e,t,a){var n=this.currentIV,d=this.currentResult,i=this.remainderData;this.logOnce("JS AES decrypt"),i&&(e=ee(i,e),this.remainderData=null);var o=this.getValidChunk(e);if(!o.length)return null;n&&(a=n);var s=this.softwareDecrypter;s||(s=this.softwareDecrypter=new Gr),s.expandKey(t);var l=d;return this.currentResult=s.decrypt(o.buffer,0,a),this.currentIV=M(o,-16).buffer,l?l:null},t.webCryptoDecrypt=function r(e,t,a){var n=this,d=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new Ur(d,t)),this.fastAesKey.expandKey().then(function(t){if(!d)return Promise.reject(new Error("web crypto not initialized"));n.logOnce("WebCrypto AES decrypt");var r=new Br(d,new Uint8Array(a));return r.decrypt(e.buffer,t)}).catch(function(r){return Da.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+r.name+": "+r.message),n.onWebCryptoError(e,t,a)})},t.onWebCryptoError=function r(e,t,a){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,a);var n=this.flush();if(n)return n.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},t.getValidChunk=function t(e){var a=e,r=e.length-e.length%16;return r!==e.length&&(a=M(e,0,r),this.remainderData=M(e,r)),a},t.logOnce=function t(e){this.logEnabled&&(Da.log("[decrypter]: "+e),this.logEnabled=!1)},e}(),Hr={toString:function t(e){for(var a="",r=e.length,n=0;n<r;n++)a+="["+e.start(n).toFixed(3)+"-"+e.end(n).toFixed(3)+"]";return a}},Vr={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},Wr=function(e){function t(t,a,r,n,d){var i;return i=e.call(this)||this,i.hls=void 0,i.fragPrevious=null,i.fragCurrent=null,i.fragmentTracker=void 0,i.transmuxer=null,i._state=Vr.STOPPED,i.playlistType=void 0,i.media=null,i.mediaBuffer=null,i.config=void 0,i.bitrateTest=!1,i.lastCurrentTime=0,i.nextLoadPosition=0,i.startPosition=0,i.startTimeOffset=null,i.loadedmetadata=!1,i.retryDate=0,i.levels=null,i.fragmentLoader=void 0,i.keyLoader=void 0,i.levelLastLoaded=null,i.startFragRequested=!1,i.decrypter=void 0,i.initPTS=[],i.onvseeking=null,i.onvended=null,i.logPrefix="",i.log=void 0,i.warn=void 0,i.playlistType=d,i.logPrefix=n,i.log=Da.log.bind(Da,n+":"),i.warn=Da.warn.bind(Da,n+":"),i.hls=t,i.fragmentLoader=new Cr(t.config),i.keyLoader=r,i.fragmentTracker=a,i.config=t.config,i.decrypter=new Kr(t.config),t.on(Ta.MANIFEST_LOADED,i.onManifestLoaded,k(i)),i}v(t,e);var a=t.prototype;return a.doTick=function e(){this.onTickEnd()},a.onTickEnd=function e(){},a.startLoad=function t(e){},a.stopLoad=function e(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var t=this.fragCurrent;null!=t&&t.loader&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Vr.STOPPED},a._streamEnded=function a(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;var r=t.partList;if(null!=r&&r.length){var n=r[r.length-1],d=wr.isBuffered(this.media,n.start+n.duration/2);return d}var i=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(i)},a.getLevelDetails=function e(){if(this.levels&&null!==this.levelLastLoaded){var t;return null==(t=this.levels[this.levelLastLoaded])?void 0:t.details}},a.onMediaAttached=function a(e,t){var r=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),r.addEventListener("seeking",this.onvseeking),r.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.state===Vr.STOPPED&&this.startLoad(n.startPosition)},a.onMediaDetaching=function e(){var t=this.media;null!=t&&t.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),t&&this.onvseeking&&this.onvended&&(t.removeEventListener("seeking",this.onvseeking),t.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},a.onMediaSeeking=function e(){var t=this.config,a=this.fragCurrent,r=this.media,n=this.mediaBuffer,d=this.state,i=r?r.currentTime:0,o=wr.bufferInfo(n?n:r,i,t.maxBufferHole);if(this.log("media seeking to "+(Ea(i)?i.toFixed(3):i)+", state: "+d),this.state===Vr.ENDED)this.resetLoadingState();else if(a){var s=t.maxFragLookUpTolerance,l=a.start-s,u=a.start+a.duration+s;if(!o.len||u<o.start||l>o.end){var f=i>u;(i<l||f)&&(f&&a.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),a.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}r&&(this.fragmentTracker.removeFragmentsInRange(i,1/0,this.playlistType,!0),this.lastCurrentTime=i),this.loadedmetadata||o.len||(this.nextLoadPosition=this.startPosition=i),this.tickImmediate()},a.onMediaEnded=function e(){this.startPosition=this.lastCurrentTime=0},a.onManifestLoaded=function a(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]},a.onHandlerDestroying=function t(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},a.onHandlerDestroyed=function t(){this.state=Vr.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,e.prototype.onHandlerDestroyed.call(this)},a.loadFragment=function r(e,t,a){this._loadFragForPlayback(e,t,a)},a._loadFragForPlayback=function r(e,t,a){var n=this,d=function a(t){return n.fragContextChanged(e)?(n.warn("Fragment "+e.sn+(t.part?" p: "+t.part.index:"")+" of level "+e.level+" was dropped during download."),void n.fragmentTracker.removeFragment(e)):void(e.stats.chunkCount++,n._handleFragmentLoadProgress(t))};this._doFragLoad(e,t,a,d).then(function(t){if(t){var a=n.state;return n.fragContextChanged(e)?void(a!==Vr.FRAG_LOADING&&(n.fragCurrent||a!==Vr.PARSING)||(n.fragmentTracker.removeFragment(e),n.state=Vr.IDLE)):void("payload"in t&&(n.log("Loaded fragment "+e.sn+" of level "+e.level),n.hls.trigger(Ta.FRAG_LOADED,t)),n._handleFragmentLoadComplete(t))}}).catch(function(t){n.state===Vr.STOPPED||n.state===Vr.ERROR||(n.warn(t),n.resetFragmentLoading(e))})},a.clearTrackerIfNeeded=function t(e){var a=this.fragmentTracker,r=a.getState(e),n;if(r===kr.APPENDING){var d=e.type,i=this.getFwdBufferInfo(this.mediaBuffer,d),o=c(e.duration,i?i.len:this.config.maxBufferLength);this.reduceMaxBufferLength(o)&&a.removeFragment(e)}else 0===(null==(n=this.mediaBuffer)?void 0:n.buffered.length)?a.removeAllFragments():a.hasParts(e.type)&&(a.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),a.getState(e)===kr.PARTIAL&&a.removeFragment(e))},a.checkLiveUpdate=function t(e){if(e.updated&&!e.live){var a=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:a,part:null,stats:a.stats,id:a.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)},a.flushMainBuffer=function r(e,t,a){if(void 0===a&&(a=null),!!(e-t)){var n={startOffset:e,endOffset:t,type:a};this.hls.trigger(Ta.BUFFER_FLUSHING,n)}},a._loadInitSegment=function a(e,t){var r=this;this._doFragLoad(e,t).then(function(t){if(!t||r.fragContextChanged(e)||!r.levels)throw new Error("init load aborted");return t}).then(function(t){var a=r.hls,n=t.payload,d=e.decryptdata;if(n&&0<n.byteLength&&d&&d.key&&d.iv&&"AES-128"===d.method){var i=self.performance.now();return r.decrypter.decrypt(new Uint8Array(n),d.key.buffer,d.iv.buffer).catch(function(t){throw a.trigger(Ta.ERROR,{type:La.MEDIA_ERROR,details:va.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t}).then(function(r){var n=self.performance.now();return a.trigger(Ta.FRAG_DECRYPTED,{frag:e,payload:r,stats:{tstart:i,tdecrypt:n}}),t.payload=r,t})}return t}).then(function(a){var n=r.fragCurrent,d=r.hls,i=r.levels;if(!i)throw new Error("init load aborted, missing levels");var o=e.stats;r.state=Vr.IDLE,t.fragmentError=0,e.data=new Uint8Array(a.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),a.frag===n&&d.trigger(Ta.FRAG_BUFFERED,{stats:o,frag:n,part:null,id:e.type}),r.tick()}).catch(function(t){r.state===Vr.STOPPED||r.state===Vr.ERROR||(r.warn(t),r.resetFragmentLoading(e))})},a.fragContextChanged=function t(e){var a=this.fragCurrent;return!e||!a||e.level!==a.level||e.sn!==a.sn||e.urlId!==a.urlId},a.fragBufferedComplete=function a(e,t){var r=this.mediaBuffer?this.mediaBuffer:this.media,n,d,i,o;this.log("Buffered "+e.type+" sn: "+e.sn+(t?" part: "+t.index:"")+" of "+(this.playlistType===gr.MAIN?"level":"track")+" "+e.level+" (frag:["+(null==(n=e.startPTS)?NaN:n).toFixed(3)+"-"+(null==(d=e.endPTS)?NaN:d).toFixed(3)+"] > buffer:"+(r?Hr.toString(wr.getBuffered(r)):"(detached)")+")"),this.state=Vr.IDLE,r&&(!this.loadedmetadata&&e.type==gr.MAIN&&r.buffered.length&&(null==(i=this.fragCurrent)?void 0:i.sn)===(null==(o=this.fragPrevious)?void 0:o.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},a.seekToStartPos=function e(){},a._handleFragmentLoadComplete=function t(e){var a=this.transmuxer;if(a){var r=e.frag,n=e.part,d=e.partsLoaded,i=!d||0===d.length||d.some(function(e){return!e}),o=new Mr(r.level,r.sn,r.stats.chunkCount+1,0,n?n.index:-1,!i);a.flush(o)}},a._handleFragmentLoadProgress=function t(e){},a._doFragLoad=function n(e,t,a,r){var d=this,i;void 0===a&&(a=null);var o=null==t?void 0:t.details;if(!this.levels||!o)throw new Error("frag load aborted, missing level"+(o?"":" detail")+"s");var s=null;if(e.encrypted&&!(null!=(i=e.decryptdata)&&i.key)?(this.log("Loading key for "+e.sn+" of ["+o.startSN+"-"+o.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+e.level),this.state=Vr.KEY_LOADING,this.fragCurrent=e,s=this.keyLoader.load(e).then(function(e){if(!d.fragContextChanged(e.frag))return d.hls.trigger(Ta.KEY_LOADED,e),d.state===Vr.KEY_LOADING&&(d.state=Vr.IDLE),e}),this.hls.trigger(Ta.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(s=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):!e.encrypted&&o.encryptedFragments.length&&this.keyLoader.loadClear(e,o.encryptedFragments),a=c(e.start,a||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){var l=o.partList;if(l&&r){a>e.end&&o.fragmentHint&&(e=o.fragmentHint);var u=this.getNextPart(l,e,a);if(-1<u){var f=l[u];this.log("Loading part sn: "+e.sn+" p: "+f.index+" cc: "+e.cc+" of playlist ["+o.startSN+"-"+o.endSN+"] parts [0-"+u+"-"+(l.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(a.toFixed(3))),this.nextLoadPosition=f.start+f.duration,this.state=Vr.FRAG_LOADING;var g;return g=s?s.then(function(a){return!a||d.fragContextChanged(a.frag)?null:d.doFragPartsLoad(e,f,t,r)}).catch(function(e){return d.handleFragLoadError(e)}):this.doFragPartsLoad(e,f,t,r).catch(function(e){return d.handleFragLoadError(e)}),this.hls.trigger(Ta.FRAG_LOADING,{frag:e,part:f,targetBufferTime:a}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):g}if(!e.url||this.loadedEndOfParts(l,a))return Promise.resolve(null)}}this.log("Loading fragment "+e.sn+" cc: "+e.cc+" "+(o?"of ["+o.startSN+"-"+o.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(a.toFixed(3))),Ea(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Vr.FRAG_LOADING;var m=this.config.progressive,p;return p=m&&s?s.then(function(t){return!t||d.fragContextChanged(null==t?void 0:t.frag)?null:d.fragmentLoader.load(e,r)}).catch(function(e){return d.handleFragLoadError(e)}):Promise.all([this.fragmentLoader.load(e,m?r:void 0),s]).then(function(e){var t=e[0];return!m&&t&&r&&r(t),t}).catch(function(e){return d.handleFragLoadError(e)}),this.hls.trigger(Ta.FRAG_LOADING,{frag:e,targetBufferTime:a}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):p},a.doFragPartsLoad=function n(e,t,a,r){var d=this;return new Promise(function(n,i){var o=[],s=null==(u=a.details)?void 0:u.partList,l=function l(t){d.fragmentLoader.loadPart(e,t,r).then(function(r){o[t.index]=r;var i=r.part;d.hls.trigger(Ta.FRAG_LOADED,r);var u=Ge(a,e.sn,t.index+1)||Ke(s,e.sn,t.index+1);return u?void l(u):n({frag:e,part:i,partsLoaded:o})}).catch(i)},u;l(t)})},a.handleFragLoadError=function t(e){if("data"in e){var a=e.data;e.data&&a.details===va.INTERNAL_ABORTED?this.handleFragLoadAborted(a.frag,a.part):this.hls.trigger(Ta.ERROR,a)}else this.hls.trigger(Ta.ERROR,{type:La.OTHER_ERROR,details:va.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null},a._handleTransmuxerFlush=function t(e){var a=this.getCurrentContext(e);if(!a||this.state!==Vr.PARSING)return void(this.fragCurrent||this.state===Vr.STOPPED||this.state===Vr.ERROR||(this.state=Vr.IDLE));var r=a.frag,n=a.part,d=a.level,i=self.performance.now();r.stats.parsing.end=i,n&&(n.stats.parsing.end=i),this.updateLevelTiming(r,n,d,e.partial)},a.getCurrentContext=function t(e){var a=this.levels,r=this.fragCurrent,n=e.level,d=e.sn,i=e.part;if(!(null!=a&&a[n]))return this.warn("Levels object was unset while buffering fragment "+d+" of level "+n+". The current chunk will not be buffered."),null;var o=a[n],s=-1<i?Ge(o,d,i):null,l=s?s.fragment:Ue(o,d,r);return l?(r&&r!==l&&(l.stats=r.stats),{frag:l,part:s,level:o}):null},a.bufferFragmentData=function d(e,t,a,r,n){var i;if(e&&this.state===Vr.PARSING){var o=e.data1,s=e.data2,l=o;if(o&&s&&(l=ee(o,s)),!!(null!=(i=l)&&i.length)){var u={type:e.type,frag:t,part:a,chunkMeta:r,parent:t.type,data:l};if(this.hls.trigger(Ta.BUFFER_APPENDING,u),e.dropped&&e.independent&&!a){if(n)return;this.flushBufferGap(t)}}}},a.flushBufferGap=function t(e){var a=this.media;if(a){if(!wr.isBuffered(a,a.currentTime))return void this.flushMainBuffer(0,e.start);var r=a.currentTime,n=wr.bufferInfo(a,r,0),d=e.duration,i=s(2*this.config.maxFragLookUpTolerance,.25*d),o=c(s(e.start-i,n.end-i),r+i);e.start-o>i&&this.flushMainBuffer(o,e.start)}},a.getFwdBufferInfo=function a(e,t){var r=this.getLoadPosition();return Ea(r)?this.getFwdBufferInfoAtPos(e,r,t):null},a.getFwdBufferInfoAtPos=function r(e,t,a){var n=this.config.maxBufferHole,d=wr.bufferInfo(e,t,n);if(0===d.len&&void 0!==d.nextStart){var i=this.fragmentTracker.getBufferedFrag(t,a);if(i&&d.nextStart<i.end)return wr.bufferInfo(e,t,c(d.nextStart,n))}return d},a.getMaxBufferLength=function t(e){var a=this.config,r;return r=e?c(8*a.maxBufferSize/e,a.maxBufferLength):a.maxBufferLength,s(r,a.maxMaxBufferLength)},a.reduceMaxBufferLength=function t(e){var a=this.config,r=e||a.maxBufferLength;return!!(a.maxMaxBufferLength>=r)&&(a.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+a.maxMaxBufferLength+"s"),!0)},a.getAppendedFrag=function a(e,t){var r=this.fragmentTracker.getAppendedFrag(e,gr.MAIN);return r&&"fragment"in r?r.fragment:r},a.getNextFragment=function a(e,t){var r=t.fragments,n=r.length;if(!n)return null;var d=this.config,i=r[0].start,o;if(t.live){var s=d.initialLiveManifestSize;if(n<s)return this.warn("Not enough fragments to start playback (have: "+n+", need: "+s+")"),null;t.PTSKnown||this.startFragRequested||-1!==this.startPosition||(o=this.getInitialLiveFragment(t,r),this.startPosition=o?this.hls.liveSyncPosition||o.start:e)}else e<=i&&(o=r[0]);if(!o){var l=d.lowLatencyMode?t.partEnd:t.fragmentEnd;o=this.getFragmentAtPosition(e,l,t)}return this.mapToInitFragWhenRequired(o)},a.isLoopLoading=function a(e,t){var r=this.fragmentTracker.getState(e);return(r===kr.OK||r===kr.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t},a.getNextFragmentLoopLoading=function d(e,t,a,r,n){var i=e.gap,o=this.getNextFragment(this.nextLoadPosition,t);if(null===o)return o;if(e=o,i&&e&&!e.gap&&a.nextStart){var s=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,a.nextStart,r);if(null!==s&&a.len+s.len>=n)return this.log("buffer full after gaps in \""+r+"\" playlist starting at sn: "+e.sn),null}return e},a.mapToInitFragWhenRequired=function t(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment},a.getNextPart=function r(e,t,a){for(var n=-1,d=!1,o=!0,s=0,l=e.length,u,f;s<l&&(u=e[s],o=o&&!u.independent,!(-1<n&&a<u.start));s++)f=u.loaded,f?n=-1:(d||u.independent||o)&&u.fragment===t&&(n=s),d=f;return n},a.loadedEndOfParts=function a(e,t){var r=e[e.length-1];return r&&t>r.start&&r.loaded},a.getInitialLiveFragment=function a(e,t){var r=this.fragPrevious,n=null;if(!r){var d=this.hls.liveSyncPosition;null!==d&&(n=this.getFragmentAtPosition(d,this.bitrateTest?e.fragmentEnd:e.edge,e))}else if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+r.programDateTime),n=je(t,r.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){var i=r.sn+1;if(i>=e.startSN&&i<=e.endSN){var o=t[i-e.startSN];r.cc===o.cc&&(n=o,this.log("Live playlist, switching playlist, load frag with next SN: "+n.sn))}n||(n=$e(t,r.cc),n&&this.log("Live playlist, switching playlist, load frag with same CC: "+n.sn))}return n},a.getFragmentAtPosition=function r(e,t,a){var n=this.config,d=this.fragPrevious,i=a.fragments,o=a.endSN,s=a.fragmentHint,l=n.maxFragLookUpTolerance,u=a.partList,f=!!(n.lowLatencyMode&&null!=u&&u.length&&s);f&&s&&!this.bitrateTest&&(i=i.concat(s),o=s.sn);var g;if(e<t){var c=e>t-l?0:l;g=Xe(d,i,e,c)}else g=i[i.length-1];if(g){var m=g.sn-a.startSN,p=this.fragmentTracker.getState(g);if((p===kr.OK||p===kr.PARTIAL&&g.gap)&&(d=g),d&&g.sn===d.sn&&(!f||u[0].fragment.sn>g.sn)){var y=d&&g.level===d.level;if(y){var h=i[m+1];g=g.sn<o&&this.fragmentTracker.getState(h)!==kr.OK?h:null}}}return g},a.synchronizeToLiveEdge=function t(e){var a=this.config,r=this.media;if(r){var n=this.hls.liveSyncPosition,d=r.currentTime,i=e.fragments[0].start,o=e.edge,s=d>=i-a.maxFragLookUpTolerance&&d<=o;if(null!==n&&r.duration>n&&(d<n||!s)){var l=void 0===a.liveMaxLatencyDuration?a.liveMaxLatencyDurationCount*e.targetduration:a.liveMaxLatencyDuration;(!s&&4>r.readyState||d<o-l)&&(!this.loadedmetadata&&(this.nextLoadPosition=n),r.readyState&&(this.warn("Playback: "+d.toFixed(3)+" is located too far from the end of live sliding playlist: "+o+", reset currentTime to : "+n.toFixed(3)),r.currentTime=n))}}},a.alignPlaylists=function a(e,t){var r=this.levels,n=this.levelLastLoaded,d=this.fragPrevious,i=null===n?null:r[n],o=e.fragments.length;if(!o)return this.warn("No fragments in live playlist"),0;var s=e.fragments[0].start,l=!t,u=e.alignedSliding&&Ea(s);if(l||!u&&!s){gt(d,i,e);var f=e.fragments[0].start;return this.log("Live playlist sliding: "+f.toFixed(2)+" start-sn: "+(t?t.startSN:"na")+"->"+e.startSN+" prev-sn: "+(d?d.sn:"na")+" fragments: "+o),f}return s},a.waitForCdnTuneIn=function t(e){var a=3;return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>c(e.partHoldBack,3*e.partTarget)},a.setStartPosition=function a(e,t){var r=this.startPosition;if(r<t&&(r=-1),-1===r||-1===this.lastCurrentTime){var n=null!==this.startTimeOffset,d=n?this.startTimeOffset:e.startTimeOffset;null!==d&&Ea(d)?(r=t+d,0>d&&(r+=e.totalduration),r=s(c(t,r),t+e.totalduration),this.log("Start time offset "+d+" found in "+(n?"multivariant":"media")+" playlist, adjust startPosition to "+r),this.startPosition=r):e.live?r=this.hls.liveSyncPosition||t:this.startPosition=r=0,this.lastCurrentTime=r}this.nextLoadPosition=r},a.getLoadPosition=function e(){var t=this.media,a=0;return this.loadedmetadata&&t?a=t.currentTime:this.nextLoadPosition&&(a=this.nextLoadPosition),a},a.handleFragLoadAborted=function a(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn("Fragment "+e.sn+(t?" part "+t.index:"")+" of level "+e.level+" was aborted"),this.resetFragmentLoading(e))},a.resetFragmentLoading=function t(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===Vr.FRAG_LOADING_WAITING_RETRY)||(this.state=Vr.IDLE)},a.onFragmentOrKeyLoadError=function a(e,t){if(t.chunkMeta&&!t.frag){var r=this.getCurrentContext(t.chunkMeta);r&&(t.frag=r.frag)}var n=t.frag;if(n&&n.type===e&&this.levels){if(this.fragContextChanged(n)){var d;return void this.warn("Frag load error must match current frag to retry "+n.url+" > "+(null==(d=this.fragCurrent)?void 0:d.url))}var i=t.details===va.FRAG_GAP;i&&this.fragmentTracker.fragBuffered(n,!0);var o=t.errorAction,s=o||{},l=s.action,u=s.retryCount,f=void 0===u?0:u,g=s.retryConfig;if(o&&l===Rr.RetryRequest&&g){var c;this.resetStartWhenNotLoaded(null==(c=this.levelLastLoaded)?n.level:c);var m=We(g,f);this.warn("Fragment "+n.sn+" of "+e+" "+n.level+" errored with "+t.details+", retrying loading "+(f+1)+"/"+g.maxNumRetry+" in "+m+"ms"),o.resolved=!0,this.retryDate=self.performance.now()+m,this.state=Vr.FRAG_LOADING_WAITING_RETRY}else g&&o?(this.resetFragmentErrors(e),f<g.maxNumRetry?!i&&(o.resolved=!0):Da.warn(t.details+" reached or exceeded max retry ("+f+")")):this.state=(null==o?void 0:o.action)===Rr.SendAlternateToPenaltyBox?Vr.WAITING_LEVEL:Vr.ERROR;this.tickImmediate()}},a.reduceLengthAndFlushBuffer=function t(e){if(this.state===Vr.PARSING||this.state===Vr.PARSED){var a=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,a),n=r&&.5<r.len;n&&this.reduceMaxBufferLength(r.len);var d=!n;return d&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+a+" buffer"),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),d}return!1},a.resetFragmentErrors=function t(e){e===gr.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==Vr.STOPPED&&(this.state=Vr.IDLE)},a.afterBufferFlushed=function r(e,t,a){if(e){var n=wr.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,a),this.state===Vr.ENDED&&this.resetLoadingState()}},a.resetLoadingState=function e(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Vr.IDLE},a.resetStartWhenNotLoaded=function t(e){if(!this.loadedmetadata){this.startFragRequested=!1;var a=this.levels?this.levels[e].details:null;null!=a&&a.live?(this.startPosition=-1,this.setStartPosition(a,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},a.resetWhenMissingContext=function t(e){var a;this.warn("The loading context changed while buffering fragment "+e.sn+" of level "+e.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(null==(a=this.levelLastLoaded)?e.level:a),this.resetLoadingState()},a.removeUnbufferedFrags=function t(e){void 0===e&&(e=0),this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)},a.updateLevelTiming=function n(e,t,a,r){var d=this,i=a.details,o;if(!i)return void this.warn("level.details undefined");var s=Object.keys(e.elementaryStreams).reduce(function(t,n){var o=e.elementaryStreams[n];if(o){var s=o.endPTS-o.startPTS;if(0>=s)return d.warn("Could not parse fragment "+e.sn+" "+n+" duration reliably ("+s+")"),t||!1;var l=r?0:Ce(i,e,o.startPTS,o.endPTS,o.startDTS,o.endDTS);return d.hls.trigger(Ta.LEVEL_PTS_UPDATED,{details:i,level:a,drift:l,type:n,frag:e,start:o.startPTS,end:o.endPTS}),!0}return t},!1);if(s)a.fragmentError=0;else if(null===(null==(o=this.transmuxer)?void 0:o.error)){var l=new Error("Found no media in fragment "+e.sn+" of level "+e.level+" resetting transmuxer to fallback to playlist timing");if(0===a.fragmentError&&(a.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)),this.warn(l.message),this.hls.trigger(Ta.ERROR,{type:La.MEDIA_ERROR,details:va.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:"Found no media in msn "+e.sn+" of level \""+a.url+"\""}),!this.hls)return;this.resetTransmuxer()}this.state=Vr.PARSED,this.hls.trigger(Ta.FRAG_PARSED,{frag:e,part:t})},a.resetTransmuxer=function e(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},a.recoverWorkerError=function t(e){if("demuxerWorker"===e.event){var a,r,n;this.fragmentTracker.removeAllFragments(),this.resetTransmuxer(),this.resetStartWhenNotLoaded(null==(a=null==(r=this.levelLastLoaded)?null==(n=this.fragCurrent)?void 0:n.level:r)?0:a),this.resetLoadingState()}},E(t,[{key:"state",get:function e(){return this._state},set:function t(e){var a=this._state;a!==e&&(this._state=e,this.log(a+"->"+e))}}]),t}(Or),Yr=function(){function e(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var t=e.prototype;return t.resetInitSegment=function n(e,t,a,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},t.resetTimeStamp=function t(e){this.initPTS=e,this.resetContiguity()},t.resetContiguity=function e(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},t.canParse=function a(e,t){return!1},t.appendFrame=function r(e,t,a){},t.demux=function a(e,t){this.cachedData&&(e=ee(this.cachedData,e),this.cachedData=null);var r=Ua(e,0),d=r?r.length:0,i=this._audioTrack,o=this._id3Track,s=r?Ha(r):void 0,l=e.length,u;for((null===this.basePTS||0===this.frameIndex&&Ea(s))&&(this.basePTS=qr(s,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),r&&0<r.length&&o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:mr.audioId3,duration:n});d<l;){if(this.canParse(e,d)){var f=this.appendFrame(i,e,d);f?(this.frameIndex++,this.lastPTS=f.sample.pts,d+=f.length,u=d):d=l}else Ka(e,d)?(r=Ua(e,d),o.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:r,type:mr.audioId3,duration:n}),d+=r.length,u=d):d++;if(d===l&&u!==l){var g=M(e,u);this.cachedData=this.cachedData?ee(this.cachedData,g):g}}return{audioTrack:i,videoTrack:Tt(),id3Track:o,textTrack:Tt()}},t.demuxSampleAes=function r(e,t,a){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},t.flush=function t(e){var a=this.cachedData;return a&&(this.cachedData=null,this.demux(a,0)),{audioTrack:this._audioTrack,videoTrack:Tt(),id3Track:this._id3Track,textTrack:Tt()}},t.destroy=function e(){},e}(),qr=function r(e,t,a){if(Ea(e))return 90*e;var n=a?9e4*a.baseTime/a.timescale:0;return 9e4*t+n},zr=function(e){function t(t,a){var r;return r=e.call(this)||this,r.observer=void 0,r.config=void 0,r.observer=t,r.config=a,r}v(t,e);var a=t.prototype;return a.resetInitSegment=function d(t,a,r,n){e.prototype.resetInitSegment.call(this,t,a,r,n),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:a,duration:n,inputTimeScale:9e4,dropped:0}},t.probe=function t(e){if(!e)return!1;for(var a=Ua(e,0)||[],r=a.length,n=e.length;r<n;r++)if(bt(e,r))return Da.log("ADTS sync word found !"),!0;return!1},a.canParse=function a(e,t){return _t(e,t)},a.appendFrame=function r(e,t,a){kt(e,this.observer,t,a,e.manifestCodec);var n=Ct(e,t,a,this.basePTS,this.frameIndex);if(n&&0===n.missing)return n},t}(Yr),jr=/\/emsg[-/]ID3/i,Xr=function(){function e(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}var t=e.prototype;return t.resetTimeStamp=function e(){},t.resetInitSegment=function n(e,t,a,r){var d=this.videoTrack=Tt("video",1),i=this.audioTrack=Tt("audio",1),o=this.txtTrack=Tt("text",1);if(this.id3Track=Tt("id3",1),this.timeOffset=0,!!(null!=e&&e.byteLength)){var s=q(e);if(s.video){var l=s.video,u=l.id,f=l.timescale,g=l.codec;d.id=u,d.timescale=o.timescale=f,d.codec=g}if(s.audio){var c=s.audio,m=c.id,p=c.timescale,y=c.codec;i.id=m,i.timescale=p,i.codec=y}o.id=tr.text,d.sampleDuration=0,d.duration=i.duration=r}},t.resetContiguity=function e(){this.remainderData=null},e.probe=function t(e){return e=16384<e.length?e.subarray(0,16384):e,0<W(e,["moof"]).length},t.demux=function a(e,t){this.timeOffset=t;var r=e,n=this.videoTrack,d=this.txtTrack;if(this.config.progressive){this.remainderData&&(r=ee(this.remainderData,e));var i=J(r);this.remainderData=i.remainder,n.samples=i.valid||new Uint8Array}else n.samples=r;var o=this.extractID3Track(n,t);return d.samples=te(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:o,textTrack:this.txtTrack}},t.flush=function e(){var t=this.timeOffset,a=this.videoTrack,r=this.txtTrack;a.samples=this.remainderData||new Uint8Array,this.remainderData=null;var n=this.extractID3Track(a,this.timeOffset);return r.samples=te(t,a),{videoTrack:a,audioTrack:Tt(),id3Track:n,textTrack:Tt()}},t.extractID3Track=function a(e,t){var r=this.id3Track;if(e.samples.length){var d=W(e.samples,["emsg"]);d&&d.forEach(function(e){var a=ie(e);if(jr.test(a.schemeIdUri)){var d=Ea(a.presentationTime)?a.presentationTime/a.timeScale:t+a.presentationTimeDelta/a.timeScale,i=4294967295===a.eventDuration?n:a.eventDuration/a.timeScale;.001>=i&&(i=n);var o=a.payload;r.samples.push({data:o,len:o.byteLength,dts:d,pts:d,type:mr.emsg,duration:i})}})}return r},t.demuxSampleAes=function r(e,t,a){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},t.destroy=function e(){},e}(),Qr=null,Zr=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],$r=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],Jr=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],en=[0,1,1,4],tn=function(){function e(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function e(){var t=this.data,a=this.bytesAvailable,r=t.byteLength-a,n=new Uint8Array(4),d=s(4,a);if(0===d)throw new Error("no bytes available");n.set(t.subarray(r,r+d)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*d,this.bytesAvailable-=d},t.skipBits=function t(e){var a;e=s(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,a=e>>3,e-=a<<3,this.bytesAvailable-=a,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},t.readBits=function t(e){var a=s(this.bitsAvailable,e),r=this.word>>>32-a;if(32<e&&Da.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=a,0<this.bitsAvailable)this.word<<=a;else if(0<this.bytesAvailable)this.loadWord();else throw new Error("no bits available");return a=e-a,0<a&&this.bitsAvailable?r<<a|this.readBits(a):r},t.skipLZ=function e(){var t;for(t=0;t<this.bitsAvailable;++t)if(0!=(this.word&2147483648>>>t))return this.word<<=t,this.bitsAvailable-=t,t;return this.loadWord(),t+this.skipLZ()},t.skipUEG=function e(){this.skipBits(1+this.skipLZ())},t.skipEG=function e(){this.skipBits(1+this.skipLZ())},t.readUEG=function e(){var t=this.skipLZ();return this.readBits(t+1)-1},t.readEG=function e(){var t=this.readUEG();return 1&t?1+t>>>1:-1*(t>>>1)},t.readBoolean=function e(){return 1===this.readBits(1)},t.readUByte=function e(){return this.readBits(8)},t.readUShort=function e(){return this.readBits(16)},t.readUInt=function e(){return this.readBits(32)},t.skipScalingList=function t(e){for(var a=8,r=8,n=0,d;n<e;n++)0!==r&&(d=this.readEG(),r=(a+d+256)%256),a=0===r?a:r},t.readSPS=function e(){var t=0,r=0,n=0,d=0,o=this.readUByte.bind(this),s=this.readBits.bind(this),l=this.readUEG.bind(this),u=this.readBoolean.bind(this),f=this.skipBits.bind(this),g=this.skipEG.bind(this),c=this.skipUEG.bind(this),m=this.skipScalingList.bind(this),p,y,h;o();var E=o();if(s(5),f(3),o(),c(),100===E||110===E||122===E||244===E||44===E||83===E||86===E||118===E||128===E){var T=l();if(3===T&&f(1),c(),c(),f(1),u())for(y=3===T?12:8,h=0;h<y;h++)u()&&(6>h?m(16):m(64))}c();var L=l();if(0===L)l();else if(1===L)for(f(1),g(),g(),p=l(),h=0;h<p;h++)g();c(),f(1);var v=l(),S=l(),R=s(1);0===R&&f(1),f(1),u()&&(t=l(),r=l(),n=l(),d=l());var A=[1,1];if(u()&&u()){var D=o();switch(D){case 1:A=[1,1];break;case 2:A=[12,11];break;case 3:A=[10,11];break;case 4:A=[16,11];break;case 5:A=[40,33];break;case 6:A=[24,11];break;case 7:A=[20,11];break;case 8:A=[32,11];break;case 9:A=[80,33];break;case 10:A=[18,11];break;case 11:A=[15,11];break;case 12:A=[64,33];break;case 13:A=[160,99];break;case 14:A=[4,3];break;case 15:A=[3,2];break;case 16:A=[2,1];break;case 255:{A=[o()<<8|o(),o()<<8|o()];break}}}return{width:a(16*(v+1)-2*t-2*r),height:16*((2-R)*(S+1))-(R?2:4)*(n+d),pixelRatio:A}},t.readSliceType=function e(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),an=function(){function e(e,t,a){this.keyData=void 0,this.decrypter=void 0,this.keyData=a,this.decrypter=new Kr(t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function t(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)},t.decryptAacSample=function r(e,t,a){var n=this,d=e[t].unit;if(!(16>=d.length)){var i=d.subarray(16,d.length-d.length%16),o=i.buffer.slice(i.byteOffset,i.byteOffset+i.length);this.decryptBuffer(o).then(function(r){var i=new Uint8Array(r);d.set(i,16),n.decrypter.isSync()||n.decryptAacSamples(e,t+1,a)})}},t.decryptAacSamples=function r(e,t,a){for(;;t++){if(t>=e.length)return void a();if(!(32>e[t].unit.length)&&(this.decryptAacSample(e,t,a),!this.decrypter.isSync()))return}},t.getAvcEncryptedData=function t(e){for(var a=16*f((e.length-48)/160)+16,r=new Int8Array(a),n=0,d=32;d<e.length-16;d+=160,n+=16)r.set(e.subarray(d,d+16),n);return r},t.getAvcDecryptedUnit=function a(e,t){for(var r=new Uint8Array(t),n=0,d=32;d<e.length-16;d+=160,n+=16)e.set(r.subarray(n,n+16),d);return e},t.decryptAvcSample=function d(e,t,a,r,n){var i=this,o=de(n.data),s=this.getAvcEncryptedData(o);this.decryptBuffer(s.buffer).then(function(d){n.data=i.getAvcDecryptedUnit(o,d),i.decrypter.isSync()||i.decryptAvcSamples(e,t,a+1,r)})},t.decryptAvcSamples=function n(e,t,a,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,a=0){if(t>=e.length)return void r();for(var d=e[t].units;;a++){if(a>=d.length)break;var i=d[a];if(!(48>=i.data.length||1!==i.type&&5!==i.type)&&(this.decryptAvcSample(e,t,a,r,i),!this.decrypter.isSync()))return}}},e}(),rn=188,nn=function(){function e(e,t,a){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=a}e.probe=function a(t){var r=e.syncOffset(t);return 0<r&&Da.warn("MPEG2-TS detected but first sync word found @ offset "+r),-1!==r},e.syncOffset=function t(e){for(var a=e.length,r=s(5*rn,e.length-rn)+1,n=0;n<r;){for(var d=!1,o=-1,l=0,u=n;u<a;u+=rn)if(71!==e[u]){if(l)return-1;break}else if(l++,-1===o&&(o=u,0!==o&&(r=s(o+99*rn,e.length-rn)+1)),d||(d=0===Ut(e,u)),d&&1<l&&(0===o&&2<l||u+rn>r))return o;n++}return-1},e.createTrack=function a(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:tr[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}};var t=e.prototype;return t.resetInitSegment=function d(t,a,r,n){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video"),this._audioTrack=e.createTrack("audio",n),this._id3Track=e.createTrack("id3"),this._txtTrack=e.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=a,this.videoCodec=r,this._duration=n},t.resetTimeStamp=function e(){},t.resetContiguity=function e(){var t=this._audioTrack,a=this._avcTrack,r=this._id3Track;t&&(t.pesData=null),a&&(a.pesData=null),r&&(r.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},t.demux=function d(t,a,r,n){void 0===r&&(r=!1),void 0===n&&(n=!1),r||(this.sampleAes=null);var i=this._avcTrack,o=this._audioTrack,s=this._id3Track,l=this._txtTrack,u=i.pid,f=i.pesData,g=o.pid,m=s.pid,p=o.pesData,y=s.pesData,h=null,E=this.pmtParsed,T=this._pmtId,L=t.length,v;if(this.remainderData&&(t=ee(this.remainderData,t),L=t.length,this.remainderData=null),L<rn&&!n)return this.remainderData=t,{audioTrack:o,videoTrack:i,id3Track:s,textTrack:l};var S=c(0,e.syncOffset(t));L-=(L-S)%rn,L<t.byteLength&&!n&&(this.remainderData=new Uint8Array(t.buffer,L,t.buffer.byteLength-L));for(var R=0,A=S;A<L;A+=rn)if(71===t[A]){var D=!!(64&t[A+1]),_=Ut(t,A),b=(48&t[A+3])>>4,k=void 0;if(!(1<b))k=A+4;else if(k=A+5+t[A+4],k===A+rn)continue;switch(_){case u:D&&(f&&(v=Ht(f))&&this.parseAVCPES(i,l,v,!1),f={data:[],size:0}),f&&(f.data.push(t.subarray(k,A+rn)),f.size+=A+rn-k);break;case g:if(D){if(p&&(v=Ht(p)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,v);break;case"mp3":this.parseMPEGPES(o,v)}p={data:[],size:0}}p&&(p.data.push(t.subarray(k,A+rn)),p.size+=A+rn-k);break;case m:D&&(y&&(v=Ht(y))&&this.parseID3PES(s,v),y={data:[],size:0}),y&&(y.data.push(t.subarray(k,A+rn)),y.size+=A+rn-k);break;case 0:D&&(k+=t[k]+1),T=this._pmtId=Gt(t,k);break;case T:{D&&(k+=t[k]+1);var I=Kt(t,k,this.typeSupported,r);u=I.avc,0<u&&(i.pid=u),g=I.audio,0<g&&(o.pid=g,o.segmentCodec=I.segmentCodec),m=I.id3,0<m&&(s.pid=m),null===h||E||(Da.warn("MPEG-TS PMT found at "+A+" after unknown PID '"+h+"'. Backtracking to sync byte @"+S+" to parse all TS packets."),h=null,A=S-188),E=this.pmtParsed=!0;break}case 17:case 8191:break;default:h=_}}else R++;if(0<R){var x=new Error("Found "+R+" TS packet/s that do not start with 0x47");this.observer.emit(Ta.ERROR,Ta.ERROR,{type:La.MEDIA_ERROR,details:va.FRAG_PARSING_ERROR,fatal:!1,error:x,reason:x.message})}i.pesData=f,o.pesData=p,s.pesData=y;var C={audioTrack:o,videoTrack:i,id3Track:s,textTrack:l};return n&&this.extractRemainingSamples(C),C},t.flush=function e(){var t=this.remainderData;this.remainderData=null;var a;return a=t?this.demux(t,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(a),this.sampleAes?this.decrypt(a,this.sampleAes):a},t.extractRemainingSamples=function t(e){var a=e.audioTrack,r=e.videoTrack,n=e.id3Track,d=e.textTrack,i=r.pesData,o=a.pesData,s=n.pesData,l;if(i&&(l=Ht(i))?(this.parseAVCPES(r,d,l,!0),r.pesData=null):r.pesData=i,o&&(l=Ht(o))){switch(a.segmentCodec){case"aac":this.parseAACPES(a,l);break;case"mp3":this.parseMPEGPES(a,l)}a.pesData=null}else null!=o&&o.size&&Da.log("last AAC PES packet truncated,might overlap between fragments"),a.pesData=o;s&&(l=Ht(s))?(this.parseID3PES(n,l),n.pesData=null):n.pesData=s},t.demuxSampleAes=function r(e,t,a){var n=this.demux(e,a,!0,!this.config.progressive),d=this.sampleAes=new an(this.observer,this.config,t);return this.decrypt(n,d)},t.decrypt=function a(e,t){return new Promise(function(a){var r=e.audioTrack,n=e.videoTrack;r.samples&&"aac"===r.segmentCodec?t.decryptAacSamples(r.samples,0,function(){n.samples?t.decryptAvcSamples(n.samples,0,0,function(){a(e)}):a(e)}):n.samples&&t.decryptAvcSamples(n.samples,0,0,function(){a(e)})})},t.destroy=function e(){this._duration=0},t.parseAVCPES=function n(e,t,a,r){var d=this,i=this.parseAVCNALu(e,a.data),o=this.avcSample,s=!1,l;a.data=null,o&&i.length&&!e.audFound&&(Vt(o,e),o=this.avcSample=Bt(!1,a.pts,a.dts,"")),i.forEach(function(r){var n;switch(r.type){case 1:{var u=!1;l=!0;var f=r.data;if(s&&4<f.length){var g=new tn(f).readSliceType();(2===g||4===g||7===g||9===g)&&(u=!0)}if(u){var c;null!=(c=o)&&c.frame&&!o.key&&(Vt(o,e),o=d.avcSample=null)}o||(o=d.avcSample=Bt(!0,a.pts,a.dts,"")),o.frame=!0,o.key=u;break}case 5:l=!0,null!=(n=o)&&n.frame&&!o.key&&(Vt(o,e),o=d.avcSample=null),o||(o=d.avcSample=Bt(!0,a.pts,a.dts,"")),o.key=!0,o.frame=!0;break;case 6:{l=!0,ne(r.data,1,a.pts,t.samples);break}case 7:if(l=!0,s=!0,!e.sps){var m=r.data,p=new tn(m),y=p.readSPS();e.width=y.width,e.height=y.height,e.pixelRatio=y.pixelRatio,e.sps=[m],e.duration=d._duration;for(var E=m.subarray(1,4),T="avc1.",L=0,v;3>L;L++)v=E[L].toString(16),2>v.length&&(v="0"+v),T+=v;e.codec=T}break;case 8:l=!0,e.pps||(e.pps=[r.data]);break;case 9:l=!1,e.audFound=!0,o&&Vt(o,e),o=d.avcSample=Bt(!1,a.pts,a.dts,"");break;case 12:l=!0;break;default:l=!1,o&&(o.debug+="unknown NAL "+r.type+" ")}if(o&&l){var S=o.units;S.push(r)}}),r&&o&&(Vt(o,e),this.avcSample=null)},t.getLastNalUnit=function t(e){var a=this.avcSample,r,n;if(a&&0!==a.units.length||(a=e[e.length-1]),null!=(r=a)&&r.units){var d=a.units;n=d[d.length-1]}return n},t.parseAVCNALu=function a(e,t){var r=t.byteLength,n=e.naluState||0,d=n,o=[],s=0,l=-1,u=0,f,g,c;for(-1===n&&(l=0,u=31&t[0],n=0,s=1);s<r;){if(f=t[s++],!n){n=f?0:1;continue}if(1===n){n=f?0:2;continue}if(!f)n=3;else if(1===f){if(0<=l){var m={data:t.subarray(l,s-n-1),type:u};o.push(m)}else{var p=this.getLastNalUnit(e.samples);if(p&&(d&&s<=4-d&&p.state&&(p.data=p.data.subarray(0,p.data.byteLength-d)),g=s-n-1,0<g)){var y=new Uint8Array(p.data.byteLength+g);y.set(p.data,0),y.set(t.subarray(0,g),p.data.byteLength),p.data=y,p.state=0}}s<r?(c=31&t[s],l=s,u=c,n=0):n=-1}else n=0}if(0<=l&&0<=n){var h={data:t.subarray(l,r),type:u,state:n};o.push(h)}if(0===o.length){var E=this.getLastNalUnit(e.samples);if(E){var T=new Uint8Array(E.data.byteLength+t.byteLength);T.set(E.data,0),T.set(t,E.data.byteLength),E.data=T}}return e.naluState=n,o},t.parseAACPES=function a(e,t){var r=0,n=this.aacOverFlow,d=t.data;if(n){this.aacOverFlow=null;var i=n.missing,o=n.sample.unit.byteLength;if(-1===i){var s=new Uint8Array(o+d.byteLength);s.set(n.sample.unit,0),s.set(d,o),d=s}else{var l=o-i;n.sample.unit.set(d.subarray(0,i),l),e.samples.push(n.sample),r=n.missing}}var u,f;for(u=r,f=d.length;u<f-1&&!Dt(d,u);u++);if(u!==r){var g=u<f-1,c;c=g?"AAC PES did not start with ADTS header,offset:"+u:"No ADTS header found in AAC PES";var m=new Error(c);if(Da.warn("parsing error: "+c),this.observer.emit(Ta.ERROR,Ta.ERROR,{type:La.MEDIA_ERROR,details:va.FRAG_PARSING_ERROR,fatal:!1,levelRetry:g,error:m,reason:c}),!g)return}kt(e,this.observer,d,u,this.audioCodec);var p;if(void 0!==t.pts)p=t.pts;else if(n){var y=It(e.samplerate);p=n.sample.pts+y}else return void Da.warn("[tsdemuxer]: AAC PES unknown PTS");for(var h=0,E;u<f;)if(E=Ct(e,d,u,p,h),u+=E.length,!E.missing)for(h++;u<f-1&&!Dt(d,u);u++);else{this.aacOverFlow=E;break}},t.parseMPEGPES=function a(e,t){var r=t.data,n=r.length,d=0,i=0,o=t.pts;if(void 0===o)return void Da.warn("[tsdemuxer]: MPEG PES unknown PTS");for(;i<n;)if(Nt(r,i)){var s=Pt(e,r,i,o,d);if(s)i+=s.length,d++;else break}else i++},t.parseID3PES=function a(e,t){if(void 0===t.pts)return void Da.warn("[tsdemuxer]: ID3 PES unknown PTS");var r=L({},t,{type:this._avcTrack?mr.emsg:mr.audioId3,duration:n});e.samples.push(r)},e}(),dn=function(e){function t(){return e.apply(this,arguments)||this}v(t,e);var a=t.prototype;return a.resetInitSegment=function d(t,a,r,n){e.prototype.resetInitSegment.call(this,t,a,r,n),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:a,duration:n,inputTimeScale:9e4,dropped:0}},t.probe=function t(e){if(!e)return!1;for(var a=Ua(e,0)||[],r=a.length,n=e.length;r<n;r++)if(Mt(e,r))return Da.log("MPEG Audio sync word found !"),!0;return!1},a.canParse=function a(e,t){return wt(e,t)},a.appendFrame=function r(e,t,a){return null===this.basePTS?void 0:Pt(e,t,a,this.basePTS,this.frameIndex)},t}(Yr),on=function(){function e(){}return e.getSilentFrame=function a(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}},e}(),sn=g(2,32)-1,ln=function(){function e(){}return e.init=function t(){e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};var a;for(a in e.types)e.types.hasOwnProperty(a)&&(e.types[a]=[a.charCodeAt(0),a.charCodeAt(1),a.charCodeAt(2),a.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:r,audio:n};var d=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),o=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=o,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),l=new Uint8Array([97,118,99,49]),u=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,u,s,l),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,d))},e.box=function t(e){for(var a=8,r=arguments.length,n=Array(1<r?r-1:0),d=1;d<r;d++)n[d-1]=arguments[d];for(var o=n.length,s=o;o--;)a+=n[o].byteLength;var l=new Uint8Array(a);for(l[0]=255&a>>24,l[1]=255&a>>16,l[2]=255&a>>8,l[3]=255&a,l.set(e,4),(o=0,a=8);o<s;o++)l.set(n[o],a),a+=n[o].byteLength;return l},e.hdlr=function a(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function a(t){return e.box(e.types.mdat,t)},e.mdhd=function r(t,a){a*=t;var n=f(a/(sn+1)),d=f(a%(sn+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&t>>24,255&t>>16,255&t>>8,255&t,n>>24,255&n>>16,255&n>>8,255&n,d>>24,255&d>>16,255&d>>8,255&d,85,196,0,0]))},e.mdia=function a(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function a(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,255&t>>16,255&t>>8,255&t]))},e.minf=function a(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function n(t,a,r){return e.box(e.types.moof,e.mfhd(t),e.traf(r,a))},e.moov=function a(t){for(var r=t.length,n=[];r--;)n[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(n).concat(e.mvex(t)))},e.mvex=function a(t){for(var r=t.length,n=[];r--;)n[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(n))},e.mvhd=function r(t,a){a*=t;var n=f(a/(sn+1)),d=f(a%(sn+1)),i=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&t>>24,255&t>>16,255&t>>8,255&t,n>>24,255&n>>16,255&n>>8,255&n,d>>24,255&d>>16,255&d>>8,255&d,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,i)},e.sdtp=function a(t){var r=t.samples||[],n=new Uint8Array(4+r.length),d,o;for(d=0;d<r.length;d++)o=r[d].flags,n[d+4]=o.dependsOn<<4|o.isDependedOn<<2|o.hasRedundancy;return e.box(e.types.sdtp,n)},e.stbl=function a(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function a(t){var r=[],n=[],d,o,s;for(d=0;d<t.sps.length;d++)o=t.sps[d],s=o.byteLength,r.push(255&s>>>8),r.push(255&s),r=r.concat(Array.prototype.slice.call(o));for(d=0;d<t.pps.length;d++)o=t.pps[d],s=o.byteLength,n.push(255&s>>>8),n.push(255&s),n=n.concat(Array.prototype.slice.call(o));var l=e.box(e.types.avcC,new Uint8Array([1,r[3],r[4],r[5],255,224|t.sps.length].concat(r).concat([t.pps.length]).concat(n))),u=t.width,f=t.height,g=t.pixelRatio[0],c=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255&u>>8,255&u,255&f>>8,255&f,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),l,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([g>>24,255&g>>16,255&g>>8,255&g,c>>24,255&c>>16,255&c>>8,255&c])))},e.esds=function t(e){var a=e.config.length;return new Uint8Array([0,0,0,0,3,23+a,0,1,0,4,15+a,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([a]).concat(e.config).concat([6,1,2]))},e.mp4a=function a(t){var r=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,255&r>>8,255&r,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function a(t){var r=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,255&r>>8,255&r,0,0]))},e.stsd=function a(t){return"audio"===t.type?"mp3"===t.segmentCodec&&"mp3"===t.codec?e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function a(t){var r=t.id,n=t.duration*t.timescale,d=t.width,i=t.height,o=f(n/(sn+1)),s=f(n%(sn+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,255&r>>24,255&r>>16,255&r>>8,255&r,0,0,0,0,o>>24,255&o>>16,255&o>>8,255&o,s>>24,255&s>>16,255&s>>8,255&s,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,255&d>>8,255&d,0,0,255&i>>8,255&i,0,0]))},e.traf=function r(t,a){var n=e.sdtp(t),d=t.id,i=f(a/(sn+1)),o=f(a%(sn+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,d>>24,255&d>>16,255&d>>8,255&d])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,i>>24,255&i>>16,255&i>>8,255&i,o>>24,255&o>>16,255&o>>8,255&o])),e.trun(t,n.length+16+20+8+16+8+8),n)},e.trak=function a(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function a(t){var r=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,r>>24,255&r>>16,255&r>>8,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function r(t,a){var n=t.samples||[],d=n.length,o=12+16*d,s=new Uint8Array(o),l,u,f,g,c,m;for(a+=8+o,s.set(["video"===t.type?1:0,0,15,1,255&d>>>24,255&d>>>16,255&d>>>8,255&d,255&a>>>24,255&a>>>16,255&a>>>8,255&a],0),l=0;l<d;l++)u=n[l],f=u.duration,g=u.size,c=u.flags,m=u.cts,s.set([255&f>>>24,255&f>>>16,255&f>>>8,255&f,255&g>>>24,255&g>>>16,255&g>>>8,255&g,c.isLeading<<2|c.dependsOn,c.isDependedOn<<6|c.hasRedundancy<<4|c.paddingValue<<1|c.isNonSync,61440&c.degradPrio,15&c.degradPrio,255&m>>>24,255&m>>>16,255&m>>>8,255&m],12+16*l);return e.box(e.types.trun,s)},e.initSegment=function a(t){e.types||e.init();var r=e.moov(t),n=new Uint8Array(e.FTYP.byteLength+r.byteLength);return n.set(e.FTYP),n.set(r,e.FTYP.byteLength),n},e}(),un,fn;ln.types=void 0,ln.HDLR_TYPES=void 0,ln.STTS=void 0,ln.STSC=void 0,ln.STCO=void 0,ln.STSZ=void 0,ln.VMHD=void 0,ln.SMHD=void 0,ln.STSD=void 0,ln.FTYP=void 0,ln.DINF=void 0;var gn=1024,cn=null,mn=null,pn=function(){function e(e,t,a,r){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=a,this.ISGenerated=!1,null===cn){var n=navigator.userAgent||"",d=n.match(/Chrome\/(\d+)/i);cn=d?parseInt(d[1]):0}if(null===mn){var i=navigator.userAgent.match(/Safari\/(\d+)/i);mn=i?parseInt(i[1]):0}}var t=e.prototype;return t.destroy=function e(){},t.resetTimeStamp=function t(e){Da.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e},t.resetNextTimestamp=function e(){Da.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},t.resetInitSegment=function e(){Da.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},t.getVideoStartPts=function t(e){var a=!1,r=e.reduce(function(e,t){var r=t.pts-e;return-4294967296>r?(a=!0,qt(e,t.pts)):0<r?e:t.pts},e[0].pts);return a&&Da.debug("PTS rollover detected"),r},t.remux=function s(e,t,a,r,n,d,i,o){var l=n,u=n,f=-1<e.pid,g=-1<t.pid,m=t.samples.length,p=0<e.samples.length,y=i&&0<m||1<m,h=(!f||p)&&(!g||y)||this.ISGenerated||i,E,T,L,v,S,R;if(h){this.ISGenerated||(L=this.generateIS(e,t,n,d));var A=this.isVideoContiguous,D=-1,_;if(y&&(D=zt(t.samples),!A&&this.config.forceKeyFrameOnDiscontinuity))if(R=!0,0<D){Da.warn("[mp4-remuxer]: Dropped "+D+" out of "+m+" video samples due to a missing keyframe");var b=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(D),t.dropped+=D,u+=(t.samples[0].pts-b)/t.inputTimeScale,_=u}else-1===D&&(Da.warn("[mp4-remuxer]: No keyframe found out of "+m+" video samples"),R=!1);if(this.ISGenerated){if(p&&y){var k=this.getVideoStartPts(t.samples),I=qt(e.samples[0].pts,k)-k,x=I/t.inputTimeScale;l+=c(0,x),u+=c(0,-x)}if(!p)y&&(E=this.remuxVideo(t,u,A,0));else if(e.samplerate||(Da.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),L=this.generateIS(e,t,n,d)),T=this.remuxAudio(e,l,this.isAudioContiguous,d,g||y||o===gr.AUDIO?u:void 0),y){var C=T?T.endPTS-T.startPTS:0;t.inputTimeScale||(Da.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),L=this.generateIS(e,t,n,d)),E=this.remuxVideo(t,u,A,C)}E&&(E.firstKeyFrame=D,E.independent=-1!==D,E.firstKeyFramePTS=_)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(a.samples.length&&(S=jt(a,n,this._initPTS,this._initDTS)),r.samples.length&&(v=Xt(r,n,this._initPTS))),{audio:T,video:E,initSegment:L,independent:R,text:v,id3:S}},t.generateIS=function n(e,t,a,r){var d=e.samples,i=t.samples,l=this.typeSupported,u={},f=this._initPTS,g=!f||r,c="audio/mp4",m,p,y;if(g&&(m=p=1/0),e.config&&d.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":l.mpeg?(c="audio/mpeg",e.codec=""):l.mp3&&(e.codec="mp3")}u.audio={id:"audio",container:c,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&l.mpeg?new Uint8Array(0):ln.initSegment([e]),metadata:{channelCount:e.channelCount}},g&&(y=e.inputTimeScale,f&&y===f.timescale?g=!1:m=p=d[0].pts-o(y*a))}if(t.sps&&t.pps&&i.length&&(t.timescale=t.inputTimeScale,u.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:ln.initSegment([t]),metadata:{width:t.width,height:t.height}},g))if(y=t.inputTimeScale,!f||y!==f.timescale){var h=this.getVideoStartPts(i),E=o(y*a);p=s(p,qt(i[0].dts,h)-E),m=s(m,h-E)}else g=!1;return Object.keys(u).length?(this.ISGenerated=!0,g?(this._initPTS={baseTime:m,timescale:y},this._initDTS={baseTime:p,timescale:y}):m=y=void 0,{tracks:u,initPTS:m,timescale:y}):void 0},t.remuxVideo=function d(e,t,a,r){var l=Number.NEGATIVE_INFINITY,u=e.inputTimeScale,g=e.samples,m=[],p=g.length,y=this._initPTS,h=this.nextAvcDts,E=8,T=this.videoSampleDuration,v=n,S=l,R=!1,A,D;if(!a||null===h){var _=t*u,b=g[0].pts-qt(g[0].dts,g[0].pts);h=_-b}for(var k=y.baseTime*u/y.timescale,I=0,x;I<p;I++)x=g[I],x.pts=qt(x.pts-k,h),x.dts=qt(x.dts-k,h),x.dts<g[0<I?I-1:I].dts&&(R=!0);R&&g.sort(function(e,t){var a=e.dts-t.dts,r=e.pts-t.pts;return a||r}),A=g[0].dts,D=g[g.length-1].dts;var C=D-A,P=C?o(C/(p-1)):T||e.inputTimeScale/30;if(a){var F=A-h,O=F>P,N=-1>F;if((O||N)&&(O?Da.warn("AVC: "+Yt(F,!0)+" ms ("+F+"dts) hole between fragments detected, filling it"):Da.warn("AVC: "+Yt(-F,!0)+" ms ("+F+"dts) overlapping between fragments detected"),!N||h>=g[0].pts)){A=h;var w=g[0].pts-F;g[0].dts=A,g[0].pts=w,Da.log("Video: First PTS/DTS adjusted: "+Yt(w,!0)+"/"+Yt(A,!0)+", delta: "+Yt(F,!0)+" ms")}}A=c(0,A);for(var M=0,B=0,U=0;U<p;U++){for(var G=g[U],K=G.units,H=K.length,V=0,W=0;W<H;W++)V+=K[W].data.length;B+=V,M+=H,G.length=V,G.dts=c(G.dts,A),v=s(G.pts,v),S=c(G.pts,S)}D=g[p-1].dts;var Y=B+4*M+8,q;try{q=new Uint8Array(Y)}catch(e){return void this.observer.emit(Ta.ERROR,Ta.ERROR,{type:La.MUX_ERROR,details:va.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:Y,reason:"fail allocating video mdat "+Y})}var z=new DataView(q.buffer);z.setUint32(0,Y),q.set(ln.types.mdat,4);for(var X=!1,Q=n,Z=n,$=l,J=l,ee=0;ee<p;ee++){for(var te=g[ee],ae=te.units,re=0,ne=0,de=ae.length;ne<de;ne++){var ie=ae[ne],oe=ie.data,se=ie.data.byteLength;z.setUint32(E,se),E+=4,q.set(oe,E),E+=se,re+=4+se}var le=void 0;if(ee<p-1)T=g[ee+1].dts-te.dts,le=g[ee+1].pts-te.pts;else{var ue=this.config,fe=0<ee?te.dts-g[ee-1].dts:P;if(le=0<ee?te.pts-g[ee-1].pts:P,ue.stretchShortVideoTrack&&null!==this.nextAudioPts){var ge=f(ue.maxBufferHole*u),ce=(r?v+r*u:this.nextAudioPts)-te.pts;ce>ge?(T=ce-fe,0>T?T=fe:X=!0,Da.log("[mp4-remuxer]: It is approximately "+ce/90+" ms to the next segment; using duration "+T/90+" ms for the last video frame.")):T=fe}else T=fe}var me=o(te.pts-te.dts);Q=s(Q,T),$=c($,T),Z=s(Z,le),J=c(J,le),m.push(new yn(te.key,T,re,me))}if(m.length)if(cn){if(70>cn){var pe=m[0].flags;pe.dependsOn=2,pe.isNonSync=0}}else if(mn&&J-Z<$-Q&&.025>P/$&&0===m[0].cts){Da.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var ye=A,he=0,Ee=m.length;he<Ee;he++){var Te=ye+m[he].duration,Le=ye+m[he].cts;if(he<Ee-1){var ve=Te+m[he+1].cts;m[he].duration=ve-Le}else m[he].duration=he?m[he-1].duration:P;m[he].cts=0,ye=Te}}T=X||!T?P:T,this.nextAvcDts=h=D+T,this.videoSampleDuration=T,this.isVideoContiguous=!0;var Se=ln.moof(e.sequenceNumber++,A,L({},e,{samples:m})),Re="video",Ae={data1:Se,data2:q,startPTS:v/u,endPTS:(S+T)/u,startDTS:A/u,endDTS:h/u,type:Re,hasAudio:!1,hasVideo:!0,nb:m.length,dropped:e.dropped};return e.samples=[],e.dropped=0,Ae},t.remuxAudio=function d(e,t,a,r,n){var s=e.inputTimeScale,u=e.samplerate?e.samplerate:s,f=s/u,g="aac"===e.segmentCodec?gn:1152,m=g*f,p=this._initPTS,y="mp3"===e.segmentCodec&&this.typeSupported.mpeg,h=[],E=void 0!==n,T=e.samples,v=y?0:8,S=this.nextAudioPts||-1,R=t*s,A=p.baseTime*s/p.timescale;if(this.isAudioContiguous=a=a||T.length&&0<S&&(r&&9e3>l(R-S)||l(qt(T[0].pts-A,R)-S)<20*m),T.forEach(function(e){e.pts=qt(e.pts-A,R)}),!a||0>S){if(T=T.filter(function(e){return 0<=e.pts}),!T.length)return;S=0===n?0:r&&!E?c(0,R):T[0].pts}if("aac"===e.segmentCodec)for(var D=this.config.maxAudioFramesDrift,_=0,b=S;_<T.length;_++){var k=T[_],I=k.pts,x=I-b,C=l(1e3*x/s);if(x<=-D*m&&E)0===_&&(Da.warn("Audio frame @ "+(I/s).toFixed(3)+"s overlaps nextAudioPts by "+o(1e3*x/s)+" ms."),this.nextAudioPts=S=b=I);else if(x>=D*m&&C<10000&&E){var P=o(x/m);b=I-P*m,0>b&&(P--,b+=m),0===_&&(this.nextAudioPts=S=b),Da.warn("[mp4-remuxer]: Injecting "+P+" audio frame @ "+(b/s).toFixed(3)+"s due to "+o(1e3*x/s)+" ms gap.");for(var F=0;F<P;F++){var O=c(b,0),N=on.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);N||(Da.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),N=k.unit.subarray()),T.splice(_,0,{unit:N,pts:O}),b+=m,_++}}k.pts=b,b+=m}for(var w=null,M=null,B=0,U=T.length,G;U--;)B+=T[U].unit.byteLength;for(var K=0,H=T.length;K<H;K++){var V=T[K],W=V.unit,Y=V.pts;if(null!==M){var q=h[K-1];q.duration=o((Y-M)/f)}else if(a&&"aac"===e.segmentCodec&&(Y=S),w=Y,0<B){B+=v;try{G=new Uint8Array(B)}catch(e){return void this.observer.emit(Ta.ERROR,Ta.ERROR,{type:La.MUX_ERROR,details:va.REMUX_ALLOC_ERROR,fatal:!1,error:e,bytes:B,reason:"fail allocating audio mdat "+B})}if(!y){var z=new DataView(G.buffer);z.setUint32(0,B),G.set(ln.types.mdat,4)}}else return;G.set(W,v);var X=W.byteLength;v+=X,h.push(new yn(!0,g,X,0)),M=Y}var Q=h.length;if(Q){var Z=h[h.length-1];this.nextAudioPts=S=M+f*Z.duration;var $=y?new Uint8Array(0):ln.moof(e.sequenceNumber++,w/f,L({},e,{samples:h}));e.samples=[];var J=w/s,ee=S/s,te="audio",ae={data1:$,data2:G,startPTS:J,endPTS:ee,startDTS:J,endDTS:ee,type:te,hasAudio:!0,hasVideo:!1,nb:Q};return this.isAudioContiguous=!0,ae}},t.remuxEmptyAudio=function d(e,t,r,n){var o=e.inputTimeScale,s=e.samplerate?e.samplerate:o,l=o/s,u=this.nextAudioPts,f=this._initDTS,g=9e4*f.baseTime/f.timescale,c=(null===u?n.startDTS*o:u)+g,m=n.endDTS*o+g,p=l*gn,y=a((m-c)/p),h=on.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(Da.warn("[mp4-remuxer]: remux empty Audio"),!h)return void Da.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec");for(var E=[],T=0,L;T<y;T++)L=c+T*p,E.push({unit:h,pts:L,dts:L});return e.samples=E,this.remuxAudio(e,t,r,!1)},e}(),yn=function n(e,t,a,r){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=a,this.cts=r,this.flags=new hn(e)},hn=function t(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1},En=function(){function e(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}var t=e.prototype;return t.destroy=function e(){},t.resetTimeStamp=function t(e){this.initPTS=e,this.lastEndTime=null},t.resetNextTimestamp=function e(){this.lastEndTime=null},t.resetInitSegment=function n(e,t,a,r){this.audioCodec=t,this.videoCodec=a,this.generateInitSegment(z(e,r)),this.emitInitSegment=!0},t.generateInitSegment=function t(e){var a=this.audioCodec,r=this.videoCodec;if(!(null!=e&&e.byteLength))return this.initTracks=void 0,void(this.initData=void 0);var n=this.initData=q(e);a||(a=Zt(n.audio,Ca.AUDIO)),r||(r=Zt(n.video,Ca.VIDEO));var d={};n.audio&&n.video?d.audiovideo={container:"video/mp4",codec:a+","+r,initSegment:e,id:"main"}:n.audio?d.audio={container:"audio/mp4",codec:a,initSegment:e,id:"audio"}:n.video?d.video={container:"video/mp4",codec:r,initSegment:e,id:"main"}:Da.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=d},t.remux=function i(e,t,a,r,n,d){var o=this.initPTS,s=this.lastEndTime,l={audio:void 0,video:void 0,text:r,id3:a,initSegment:void 0},u,f;Ea(s)||(s=this.lastEndTime=n||0);var g=t.samples;if(!(null!=g&&g.length))return l;var c={initPTS:void 0,timescale:1},m=this.initData;if(null!=(u=m)&&u.length||(this.generateInitSegment(g),m=this.initData),!(null!=(f=m)&&f.length))return Da.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),l;this.emitInitSegment&&(c.tracks=this.initTracks,this.emitInitSegment=!1);var p=Q(g,m),y=X(m,g),h=null===y?n:y;(Qt(o,h,n,p)||c.timescale!==o.timescale&&d)&&(c.initPTS=h-n,o&&1===o.timescale&&Da.warn("Adjusting initPTS by "+(c.initPTS-o.baseTime)),this.initPTS=o={baseTime:c.initPTS,timescale:1});var E=e?h-o.baseTime/o.timescale:s,T=E+p;$(m,g,o.baseTime/o.timescale),0<p?this.lastEndTime=T:(Da.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var L=!!m.audio,v=!!m.video,S="";L&&(S+="audio"),v&&(S+="video");var R={data1:g,startPTS:E,startDTS:E,endPTS:T,endDTS:T,type:S,hasAudio:L,hasVideo:v,nb:1,dropped:0};return l.audio="audio"===R.type?R:void 0,l.video="audio"===R.type?void 0:R,l.initSegment=c,l.id3=jt(a,n,o,o),r.samples.length&&(l.text=Xt(r,n,o)),l},e}(),Tn;try{Tn=self.performance.now.bind(self.performance)}catch(e){Da.debug("Unable to use Performance API on this environment"),Tn="undefined"!=typeof self&&self.Date.now}var Ln=[{demux:Xr,remux:En},{demux:nn,remux:pn},{demux:zr,remux:pn},{demux:dn,remux:pn}],vn=function(){function e(e,t,a,r,n){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=a,this.vendor=r,this.id=n}var t=e.prototype;return t.configure=function t(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()},t.push=function n(e,t,a,r){var d=this,i=a.transmuxing;i.executeStart=Tn();var o=new Uint8Array(e),s=this.currentTransmuxState,l=this.transmuxConfig;r&&(this.currentTransmuxState=r);var u=r||s,f=u.contiguous,g=u.discontinuity,c=u.trackSwitch,m=u.accurateTimeOffset,p=u.timeOffset,y=u.initSegmentChange,h=l.audioCodec,E=l.videoCodec,T=l.defaultInitPts,L=l.duration,v=l.initSegmentData,S=$t(o,t);if(S&&"AES-128"===S.method){var R=this.getDecrypter();if(R.isSync()){var A=R.softwareDecrypt(o,S.key.buffer,S.iv.buffer),D=-1<a.part;if(D&&(A=R.flush()),!A)return i.executeEnd=Tn(),Sn(a);o=new Uint8Array(A)}else return this.decryptionPromise=R.webCryptoDecrypt(o,S.key.buffer,S.iv.buffer).then(function(e){var t=d.push(e,null,a);return d.decryptionPromise=null,t}),this.decryptionPromise}var _=this.needsProbing(g,c);if(_){var b=this.configureTransmuxer(o);if(b)return Da.warn("[transmuxer] "+b.message),this.observer.emit(Ta.ERROR,Ta.ERROR,{type:La.MEDIA_ERROR,details:va.FRAG_PARSING_ERROR,fatal:!1,error:b,reason:b.message}),i.executeEnd=Tn(),Sn(a)}(g||c||y||_)&&this.resetInitSegment(v,h,E,L,t),(g||y||_)&&this.resetInitialTimestamp(T),f||this.resetContiguity();var k=this.transmux(o,S,p,m,a),I=this.currentTransmuxState;return I.contiguous=!0,I.discontinuity=!1,I.trackSwitch=!1,i.executeEnd=Tn(),k},t.flush=function t(e){var a=this,r=e.transmuxing;r.executeStart=Tn();var n=this.decrypter,d=this.currentTransmuxState,i=this.decryptionPromise;if(i)return i.then(function(){return a.flush(e)});var o=[],s=d.timeOffset;if(n){var l=n.flush();l&&o.push(this.push(l,null,e))}var u=this.demuxer,f=this.remuxer;if(!u||!f)return r.executeEnd=Tn(),[Sn(e)];var g=u.flush(s);return Jt(g)?g.then(function(t){return a.flushRemux(o,t,e),o}):(this.flushRemux(o,g,e),o)},t.flushRemux=function r(e,t,a){var n=t.audioTrack,d=t.videoTrack,i=t.id3Track,o=t.textTrack,s=this.currentTransmuxState,l=s.accurateTimeOffset,u=s.timeOffset;Da.log("[transmuxer.ts]: Flushed fragment "+a.sn+(-1<a.part?" p: "+a.part:"")+" of level "+a.level);var f=this.remuxer.remux(n,d,i,o,u,l,!0,this.id);e.push({remuxResult:f,chunkMeta:a}),a.transmuxing.executeEnd=Tn()},t.resetInitialTimestamp=function t(e){var a=this.demuxer,r=this.remuxer;a&&r&&(a.resetTimeStamp(e),r.resetTimeStamp(e))},t.resetContiguity=function e(){var t=this.demuxer,a=this.remuxer;t&&a&&(t.resetContiguity(),a.resetNextTimestamp())},t.resetInitSegment=function d(e,t,a,r,n){var i=this.demuxer,o=this.remuxer;i&&o&&(i.resetInitSegment(e,t,a,r),o.resetInitSegment(e,t,a,n))},t.destroy=function e(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},t.transmux=function d(e,t,a,r,n){var i;return i=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,a,r,n):this.transmuxUnencrypted(e,a,r,n),i},t.transmuxUnencrypted=function n(e,t,a,r){var d=this.demuxer.demux(e,t,!1,!this.config.progressive),i=d.audioTrack,o=d.videoTrack,s=d.id3Track,l=d.textTrack,u=this.remuxer.remux(i,o,s,l,t,a,!1,this.id);return{remuxResult:u,chunkMeta:r}},t.transmuxSampleAes=function d(e,t,a,r,n){var i=this;return this.demuxer.demuxSampleAes(e,t,a).then(function(e){var t=i.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,a,r,!1,i.id);return{remuxResult:t,chunkMeta:n}})},t.configureTransmuxer=function t(e){for(var a=this.config,r=this.observer,n=this.typeSupported,d=this.vendor,o=0,s=Ln.length,l;o<s;o++)if(Ln[o].demux.probe(e)){l=Ln[o];break}if(!l)return new Error("Failed to find demuxer by probing fragment data");var u=this.demuxer,f=this.remuxer,g=l.remux,c=l.demux;f&&f instanceof g||(this.remuxer=new g(r,a,n,d)),u&&u instanceof c||(this.demuxer=new c(r,a,n),this.probe=c.probe)},t.needsProbing=function a(e,t){return!this.demuxer||!this.remuxer||e||t},t.getDecrypter=function e(){var t=this.decrypter;return t||(t=this.decrypter=new Kr(this.config)),t},e}(),Sn=function t(e){return{remuxResult:{},chunkMeta:e}},Rn=function d(e,t,a,r,n){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=a,this.duration=r,this.defaultInitPts=n||null},An=function i(e,t,a,r,n,d){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=a,this.trackSwitch=r,this.timeOffset=n,this.initSegmentChange=d},Dn={exports:{}};(function(e){function t(){}function a(e,t,a){this.fn=e,this.context=t,this.once=a||!1}function r(e,t,r,n,d){if("function"!=typeof r)throw new TypeError("The listener must be a function");var i=new a(r,n||e,d),s=o?o+t:t;return e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],i]:e._events[s].push(i):(e._events[s]=i,e._eventsCount++),e}function n(e,a){0==--e._eventsCount?e._events=new t:delete e._events[a]}function d(){this._events=new t,this._eventsCount=0}var i=Object.prototype.hasOwnProperty,o="~";Object.create&&(t.prototype=Object.create(null),!new t().__proto__&&(o=!1)),d.prototype.eventNames=function e(){var t=[],a,r;if(0===this._eventsCount)return t;for(r in a=this._events)i.call(a,r)&&t.push(o?r.slice(1):r);return Object.getOwnPropertySymbols?t.concat(Object.getOwnPropertySymbols(a)):t},d.prototype.listeners=function t(e){var a=o?o+e:e,r=this._events[a];if(!r)return[];if(r.fn)return[r.fn];for(var n=0,d=r.length,s=Array(d);n<d;n++)s[n]=r[n].fn;return s},d.prototype.listenerCount=function t(e){var a=o?o+e:e,r=this._events[a];return r?r.fn?1:r.length:0},d.prototype.emit=function s(e,t,a,r,n,d){var l=o?o+e:e;if(!this._events[l])return!1;var u=this._events[l],f=arguments.length,g,c;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),f){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,a),!0;case 4:return u.fn.call(u.context,t,a,r),!0;case 5:return u.fn.call(u.context,t,a,r,n),!0;case 6:return u.fn.call(u.context,t,a,r,n,d),!0}for(c=1,g=Array(f-1);c<f;c++)g[c-1]=arguments[c];u.fn.apply(u.context,g)}else{var m=u.length,p;for(c=0;c<m;c++)switch(u[c].once&&this.removeListener(e,u[c].fn,void 0,!0),f){case 1:u[c].fn.call(u[c].context);break;case 2:u[c].fn.call(u[c].context,t);break;case 3:u[c].fn.call(u[c].context,t,a);break;case 4:u[c].fn.call(u[c].context,t,a,r);break;default:if(!g)for(p=1,g=Array(f-1);p<f;p++)g[p-1]=arguments[p];u[c].fn.apply(u[c].context,g)}}return!0},d.prototype.on=function n(e,t,a){return r(this,e,t,a,!1)},d.prototype.once=function n(e,t,a){return r(this,e,t,a,!0)},d.prototype.removeListener=function d(e,t,a,r){var s=o?o+e:e;if(!this._events[s])return this;if(!t)return n(this,s),this;var l=this._events[s];if(l.fn)l.fn!==t||r&&!l.once||a&&l.context!==a||n(this,s);else{for(var u=0,f=[],g=l.length;u<g;u++)(l[u].fn!==t||r&&!l[u].once||a&&l[u].context!==a)&&f.push(l[u]);f.length?this._events[s]=1===f.length?f[0]:f:n(this,s)}return this},d.prototype.removeAllListeners=function a(e){var r;return e?(r=o?o+e:e,this._events[r]&&n(this,r)):(this._events=new t,this._eventsCount=0),this},d.prototype.off=d.prototype.removeListener,d.prototype.addListener=d.prototype.on,d.prefixed=o,d.EventEmitter=d,e.exports=d})(Dn);var _n=Dn.exports,bn=C(_n);"undefined"!=typeof e&&e&&function t(e){var a=new bn,r=function r(t,a){e.postMessage({event:t,data:a})};a.on(Ta.FRAG_DECRYPTED,r),a.on(Ta.ERROR,r);var n=function e(){var t=function t(e){var a=function a(t){r("workerLog",{logType:e,message:t})};Da[e]=a};for(var a in Da)t(a)};e.addEventListener("message",function(t){var d=t.data;switch(d.cmd){case"init":{var i=JSON.parse(d.config);e.transmuxer=new vn(a,d.typeSupported,i,d.vendor,d.id),O(i.debug,d.id),n(),r("init",null);break}case"configure":{e.transmuxer.configure(d.config);break}case"demux":{var o=e.transmuxer.push(d.data,d.decryptdata,d.chunkMeta,d.state);Jt(o)?(e.transmuxer.async=!0,o.then(function(t){ea(e,t)}).catch(function(e){r(Ta.ERROR,{type:La.MEDIA_ERROR,details:va.FRAG_PARSING_ERROR,chunkMeta:d.chunkMeta,fatal:!1,error:e,err:e,reason:"transmuxer-worker push error"})})):(e.transmuxer.async=!1,ea(e,o));break}case"flush":{var s=d.chunkMeta,l=e.transmuxer.flush(s),u=Jt(l);u||e.transmuxer.async?(!Jt(l)&&(l=Promise.resolve(l)),l.then(function(t){aa(e,t,s)}).catch(function(e){r(Ta.ERROR,{type:La.MEDIA_ERROR,details:va.FRAG_PARSING_ERROR,chunkMeta:d.chunkMeta,fatal:!1,error:e,err:e,reason:"transmuxer-worker flush error"})})):aa(e,l,s);break}}})}(self);var kn=se()||{isTypeSupported:function e(){return!1}},In=function(){function e(e,t,a,r){var n=this;this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var d=e.config;this.hls=e,this.id=t,this.useWorker=!!d.enableWorker,this.onTransmuxComplete=a,this.onFlush=r;var i=function a(e,t){t=t||{},t.frag=n.frag,t.id=n.id,e===Ta.ERROR&&(n.error=t.error),n.hls.trigger(e,t)};this.observer=new bn,this.observer.on(Ta.FRAG_DECRYPTED,i),this.observer.on(Ta.ERROR,i);var o={mp4:kn.isTypeSupported("video/mp4"),mpeg:kn.isTypeSupported("audio/mpeg"),mp3:kn.isTypeSupported("audio/mp4; codecs=\"mp3\"")},s=navigator.vendor;if(this.useWorker&&"undefined"!=typeof Worker){var l=d.workerPath||na();if(l){try{d.workerPath?(Da.log("loading Web Worker "+d.workerPath+" for \""+t+"\""),this.workerContext=ia(d.workerPath)):(Da.log("injecting Web Worker for \""+t+"\""),this.workerContext=da()),this.onwmsg=function(e){return n.onWorkerMessage(e)};var u=this.workerContext.worker;u.addEventListener("message",this.onwmsg),u.onerror=function(e){var a=new Error(e.message+"  ("+e.filename+":"+e.lineno+")");d.enableWorker=!1,Da.warn("Error in \""+t+"\" Web Worker, fallback to inline"),n.hls.trigger(Ta.ERROR,{type:La.OTHER_ERROR,details:va.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:a})},u.postMessage({cmd:"init",typeSupported:o,vendor:s,id:t,config:JSON.stringify(d)})}catch(e){Da.warn("Error setting up \""+t+"\" Web Worker, fallback to inline",e),this.resetWorker(),this.error=null,this.transmuxer=new vn(this.observer,o,d,s,t)}return}}this.transmuxer=new vn(this.observer,o,d,s,t)}var t=e.prototype;return t.resetWorker=function e(){if(this.workerContext){var t=this.workerContext,a=t.worker,r=t.objectURL;r&&self.URL.revokeObjectURL(r),a.removeEventListener("message",this.onwmsg),a.onerror=null,a.terminate(),this.workerContext=null}},t.destroy=function e(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{var t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}var a=this.observer;a&&a.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},t.push=function u(e,t,a,r,n,d,i,o,s,l){var f=this,g,c;s.transmuxing.start=self.performance.now();var m=this.transmuxer,p=d?d.start:n.start,y=n.decryptdata,h=this.frag,E=!(h&&n.cc===h.cc),T=!(h&&s.level===h.level),L=h?s.sn-h.sn:-1,v=this.part?s.part-this.part.index:-1,S=0===L&&1<s.id&&s.id===(null==h?void 0:h.stats.chunkCount),R=!T&&(1===L||0===L&&(1===v||S&&0>=v)),A=self.performance.now();(T||L||0===n.stats.parsing.start)&&(n.stats.parsing.start=A),d&&(v||!R)&&(d.stats.parsing.start=A);var D=!(h&&(null==(g=n.initSegment)?void 0:g.url)===(null==(c=h.initSegment)?void 0:c.url)),_=new An(E,R,o,T,p,D);if(!R||E||D){Da.log("[transmuxer-interface, "+n.type+"]: Starting new transmux session for sn: "+s.sn+" p: "+s.part+" level: "+s.level+" id: "+s.id+"\n        discontinuity: "+E+"\n        trackSwitch: "+T+"\n        contiguous: "+R+"\n        accurateTimeOffset: "+o+"\n        timeOffset: "+p+"\n        initSegmentChange: "+D);var b=new Rn(a,r,t,i,l);this.configureTransmuxer(b)}if(this.frag=n,this.part=d,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:y,chunkMeta:s,state:_},e instanceof ArrayBuffer?[e]:[]);else if(m){var k=m.push(e,y,s,_);Jt(k)?(m.async=!0,k.then(function(e){f.handleTransmuxComplete(e)}).catch(function(e){f.transmuxerError(e,s,"transmuxer-interface push error")})):(m.async=!1,this.handleTransmuxComplete(k))}},t.flush=function t(e){var a=this;e.transmuxing.start=self.performance.now();var r=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(r){var n=r.flush(e),d=Jt(n);d||r.async?(!Jt(n)&&(n=Promise.resolve(n)),n.then(function(t){a.handleFlushResult(t,e)}).catch(function(t){a.transmuxerError(t,e,"transmuxer-interface flush error")})):this.handleFlushResult(n,e)}},t.transmuxerError=function r(e,t,a){this.hls&&(this.error=e,this.hls.trigger(Ta.ERROR,{type:La.MEDIA_ERROR,details:va.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:a}))},t.handleFlushResult=function a(e,t){var r=this;e.forEach(function(e){r.handleTransmuxComplete(e)}),this.onFlush(t)},t.onWorkerMessage=function t(e){var a=e.data,r=this.hls;switch(a.event){case"init":{var n=null==(d=this.workerContext)?void 0:d.objectURL,d;n&&self.URL.revokeObjectURL(n);break}case"transmuxComplete":{this.handleTransmuxComplete(a.data);break}case"flush":{this.onFlush(a.data);break}case"workerLog":Da[a.data.logType]&&Da[a.data.logType](a.data.message);break;default:{a.data=a.data||{},a.data.frag=this.frag,a.data.id=this.id,r.trigger(a.event,a.data);break}}},t.configureTransmuxer=function t(e){var a=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):a&&a.configure(e)},t.handleTransmuxComplete=function t(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},e}(),xn=2,Cn=function(){function e(e,t,a,r){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=a,this.hls=r}var t=e.prototype;return t.destroy=function e(){this.media=null,this.hls=this.fragmentTracker=null},t.poll=function a(e,t){var r=this.config,n=this.media,d=this.stalled;if(null!==n){var i=n.currentTime,s=n.seeking,l=this.seeking&&!s,u=!this.seeking&&s;if(this.seeking=s,i!==e){if(this.moved=!0,null!==d){if(this.stallReported){var f=self.performance.now()-d;Da.warn("playback not stuck anymore @"+i+", after "+o(f)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}return}if(u||l)return void(this.stalled=null);if((!n.paused||s)&&!n.ended&&0!==n.playbackRate&&wr.getBuffered(n).length){var g=wr.bufferInfo(n,i,0),m=0<g.len,p=g.nextStart||0;if(m||p){if(s){var y=g.len>xn,h=!p||t&&t.start<=i||p-i>xn&&!this.fragmentTracker.getPartialFragment(i);if(y||h)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var E=c(p,g.start||0)-i,T=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,L=null==T||null==(R=T.details)?void 0:R.live,v=L?2*T.details.targetduration:xn,S=this.fragmentTracker.getPartialFragment(i),R;if(0<E&&(E<=v||S))return void this._trySkipBufferHole(S)}var A=self.performance.now();if(null===d)return void(this.stalled=A);var D=A-d;if(!(!s&&D>=250&&(this._reportStall(g),!this.media))){var _=wr.bufferInfo(n,i,r.maxBufferHole);this._tryFixBufferStall(_,D)}}}}},t._tryFixBufferStall=function a(e,t){var r=this.config,n=this.fragmentTracker,d=this.media;if(null!==d){var i=d.currentTime,o=n.getPartialFragment(i);if(o){var s=this._trySkipBufferHole(o);if(s||!this.media)return}(e.len>r.maxBufferHole||e.nextStart&&e.nextStart-i<r.maxBufferHole)&&t>1e3*r.highBufferWatchdogPeriod&&(Da.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},t._reportStall=function t(e){var a=this.hls,r=this.media,n=this.stallReported;if(!n&&r){this.stallReported=!0;var d=new Error("Playback stalling at @"+r.currentTime+" due to low buffer ("+JSON.stringify(e)+")");Da.warn(d.message),a.trigger(Ta.ERROR,{type:La.MEDIA_ERROR,details:va.BUFFER_STALLED_ERROR,fatal:!1,error:d,buffer:e.len})}},t._trySkipBufferHole=function t(e){var a=this.config,r=this.hls,n=this.media;if(null===n)return 0;var d=n.currentTime,i=wr.bufferInfo(n,d,0),o=d<i.start?i.start:i.nextStart;if(o){var s=i.len<=a.maxBufferHole,l=0<i.len&&1>i.len&&3>n.readyState,u=o-d;if(0<u&&(s||l)){if(u>a.maxBufferHole){var f=this.fragmentTracker,g=!1;if(0===d){var m=f.getAppendedFrag(0,gr.MAIN);m&&o<m.end&&(g=!0)}if(!g){var p=e||f.getAppendedFrag(d,gr.MAIN);if(p){for(var y=!1,h=p.end,E;h<o;)if(E=f.getPartialFragment(h),E)h+=E.duration;else{y=!0;break}if(y)return 0}}}var T=c(o+.05,d+.1);if(Da.warn("skipping hole, adjusting currentTime from "+d+" to "+T),this.moved=!0,this.stalled=null,n.currentTime=T,e&&!e.gap){var L=new Error("fragment loaded with buffer holes, seeking from "+d+" to "+T);r.trigger(Ta.ERROR,{type:La.MEDIA_ERROR,details:va.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:L,reason:L.message,frag:e})}return T}}return 0},t._tryNudgeBuffer=function e(){var t=this.config,a=this.hls,r=this.media,n=this.nudgeRetry;if(null!==r){var d=r.currentTime;if(this.nudgeRetry++,n<t.nudgeMaxRetry){var i=d+(n+1)*t.nudgeOffset,o=new Error("Nudging 'currentTime' from "+d+" to "+i);Da.warn(o.message),r.currentTime=i,a.trigger(Ta.ERROR,{type:La.MEDIA_ERROR,details:va.BUFFER_NUDGE_ON_STALL,error:o,fatal:!1})}else{var s=new Error("Playhead still not moving while enough data buffered @"+d+" after "+t.nudgeMaxRetry+" nudges");Da.error(s.message),a.trigger(Ta.ERROR,{type:La.MEDIA_ERROR,details:va.BUFFER_STALLED_ERROR,error:s,fatal:!0})}}},e}(),Pn=function(e){function t(t,a,r){var n;return n=e.call(this,t,a,r,"[stream-controller]",gr.MAIN)||this,n.audioCodecSwap=!1,n.gapController=null,n.level=-1,n._forceStartLoad=!1,n.altAudio=!1,n.audioOnly=!1,n.fragPlaying=null,n.onvplaying=null,n.onvseeked=null,n.fragLastKbps=0,n.couldBacktrack=!1,n.backtrackFragment=null,n.audioCodecSwitch=!1,n.videoBuffer=null,n._registerListeners(),n}v(t,e);var a=t.prototype;return a._registerListeners=function e(){var t=this.hls;t.on(Ta.MEDIA_ATTACHED,this.onMediaAttached,this),t.on(Ta.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(Ta.MANIFEST_LOADING,this.onManifestLoading,this),t.on(Ta.MANIFEST_PARSED,this.onManifestParsed,this),t.on(Ta.LEVEL_LOADING,this.onLevelLoading,this),t.on(Ta.LEVEL_LOADED,this.onLevelLoaded,this),t.on(Ta.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.on(Ta.ERROR,this.onError,this),t.on(Ta.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.on(Ta.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.on(Ta.BUFFER_CREATED,this.onBufferCreated,this),t.on(Ta.BUFFER_FLUSHED,this.onBufferFlushed,this),t.on(Ta.LEVELS_UPDATED,this.onLevelsUpdated,this),t.on(Ta.FRAG_BUFFERED,this.onFragBuffered,this)},a._unregisterListeners=function e(){var t=this.hls;t.off(Ta.MEDIA_ATTACHED,this.onMediaAttached,this),t.off(Ta.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(Ta.MANIFEST_LOADING,this.onManifestLoading,this),t.off(Ta.MANIFEST_PARSED,this.onManifestParsed,this),t.off(Ta.LEVEL_LOADED,this.onLevelLoaded,this),t.off(Ta.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),t.off(Ta.ERROR,this.onError,this),t.off(Ta.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),t.off(Ta.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),t.off(Ta.BUFFER_CREATED,this.onBufferCreated,this),t.off(Ta.BUFFER_FLUSHED,this.onBufferFlushed,this),t.off(Ta.LEVELS_UPDATED,this.onLevelsUpdated,this),t.off(Ta.FRAG_BUFFERED,this.onFragBuffered,this)},a.onHandlerDestroying=function e(){this._unregisterListeners(),this.onMediaDetaching()},a.startLoad=function t(e){if(this.levels){var a=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.setInterval(100),this.level=-1,!this.startFragRequested){var n=r.startLevel;-1===n&&(r.config.testBandwidth&&1<this.levels.length?(n=0,this.bitrateTest=!0):n=r.nextAutoLevel),this.level=r.nextLoadLevel=n,this.loadedmetadata=!1}0<a&&-1===e&&(this.log("Override startPosition with lastCurrentTime @"+a.toFixed(3)),e=a),this.state=Vr.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=Vr.STOPPED},a.stopLoad=function t(){this._forceStartLoad=!1,e.prototype.stopLoad.call(this)},a.doTick=function e(){switch(this.state){case Vr.WAITING_LEVEL:{var t=this.levels,a=this.level,r=null==t||null==(n=t[a])?void 0:n.details,n;if(r&&(!r.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(r))break;this.state=Vr.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=Vr.IDLE;break}break}case Vr.FRAG_LOADING_WAITING_RETRY:{var d=self.performance.now(),i=this.retryDate,o;(!i||d>=i||null!=(o=this.media)&&o.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=Vr.IDLE)}}this.state===Vr.IDLE&&this.doTickIdle(),this.onTickEnd()},a.onTickEnd=function t(){e.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},a.doTickIdle=function e(){var t=this.hls,a=this.levelLastLoaded,r=this.levels,n=this.media,d=t.config,i=t.nextLoadLevel;if(null!==a&&(n||!this.startFragRequested&&d.startFragPrefetch)&&!(this.altAudio&&this.audioOnly)&&null!=r&&r[i]){var o=r[i],s=this.getMainFwdBufferInfo();if(null!==s){var l=this.getLevelDetails();if(l&&this._streamEnded(s,l)){var u={};return this.altAudio&&(u.type="video"),this.hls.trigger(Ta.BUFFER_EOS,u),void(this.state=Vr.ENDED)}t.loadLevel!==i&&-1===t.manualLevel&&this.log("Adapting to level "+i+" from level "+this.level),this.level=t.nextLoadLevel=i;var f=o.details;if(!f||this.state===Vr.WAITING_LEVEL||f.live&&this.levelLastLoaded!==i)return this.level=i,void(this.state=Vr.WAITING_LEVEL);var g=s.len,c=this.getMaxBufferLength(o.maxBitrate);if(!(g>=c)){this.backtrackFragment&&this.backtrackFragment.start>s.end&&(this.backtrackFragment=null);var m=this.backtrackFragment?this.backtrackFragment.start:s.end,p=this.getNextFragment(m,f);if(this.couldBacktrack&&!this.fragPrevious&&p&&"initSegment"!==p.sn&&this.fragmentTracker.getState(p)!==kr.OK){var y=(null==(T=this.backtrackFragment)?p:T).sn,h=y-f.startSN,E=f.fragments[h-1],T;E&&p.cc===E.cc&&(p=E,this.fragmentTracker.removeFragment(E))}else this.backtrackFragment&&s.len&&(this.backtrackFragment=null);if(p&&this.isLoopLoading(p,m)){var L=p.gap;if(!L){var v=this.audioOnly&&!this.altAudio?Ca.AUDIO:Ca.VIDEO,S=(v===Ca.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;S&&this.afterBufferFlushed(S,v,gr.MAIN)}p=this.getNextFragmentLoopLoading(p,f,s,gr.MAIN,c)}p&&(p.initSegment&&!p.initSegment.data&&!this.bitrateTest&&(p=p.initSegment),this.loadFragment(p,o,m))}}}},a.loadFragment=function n(t,a,r){var d=this.fragmentTracker.getState(t);this.fragCurrent=t,d===kr.NOT_LOADED||d===kr.PARTIAL?"initSegment"===t.sn?this._loadInitSegment(t,a):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,a)):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,a,r)):this.clearTrackerIfNeeded(t)},a.getBufferedFrag=function t(e){return this.fragmentTracker.getBufferedFrag(e,gr.MAIN)},a.followingBufferedFrag=function t(e){return e?this.getBufferedFrag(e.end+.5):null},a.immediateLevelSwitch=function e(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},a.nextLevelSwitch=function e(){var t=this.levels,a=this.media;if(null!=a&&a.readyState){var r=this.getAppendedFrag(a.currentTime),n;r&&1<r.start&&this.flushMainBuffer(0,r.start-1);var d=this.getLevelDetails();if(null!=d&&d.live){var i=this.getMainFwdBufferInfo();if(!i||i.len<2*d.targetduration)return}if(!a.paused&&t){var o=this.hls.nextLoadLevel,l=t[o],u=this.fragLastKbps;n=u&&this.fragCurrent?this.fragCurrent.duration*l.maxBitrate/(1e3*u)+1:0}else n=0;var f=this.getBufferedFrag(a.currentTime+n);if(f){var g=this.followingBufferedFrag(f);if(g){this.abortCurrentFrag();var m=g.maxStartPTS?g.maxStartPTS:g.start,p=g.duration,y=c(f.end,m+s(c(p-this.config.maxFragLookUpTolerance,.5*p),.75*p));this.flushMainBuffer(y,Number.POSITIVE_INFINITY)}}}},a.abortCurrentFrag=function e(){var t=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,t&&(t.abortRequests(),this.fragmentTracker.removeFragment(t)),this.state){case Vr.KEY_LOADING:case Vr.FRAG_LOADING:case Vr.FRAG_LOADING_WAITING_RETRY:case Vr.PARSING:case Vr.PARSED:this.state=Vr.IDLE}this.nextLoadPosition=this.getLoadPosition()},a.flushMainBuffer=function r(t,a){e.prototype.flushMainBuffer.call(this,t,a,this.altAudio?"video":null)},a.onMediaAttached=function r(t,a){e.prototype.onMediaAttached.call(this,t,a);var n=a.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),n.addEventListener("playing",this.onvplaying),n.addEventListener("seeked",this.onvseeked),this.gapController=new Cn(this.config,n,this.fragmentTracker,this.hls)},a.onMediaDetaching=function t(){var a=this.media;a&&this.onvplaying&&this.onvseeked&&(a.removeEventListener("playing",this.onvplaying),a.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),e.prototype.onMediaDetaching.call(this)},a.onMediaPlaying=function e(){this.tick()},a.onMediaSeeked=function e(){var t=this.media,a=t?t.currentTime:null;Ea(a)&&this.log("Media seeked to "+a.toFixed(3));var r=this.getMainFwdBufferInfo();return null===r||0===r.len?void this.warn("Main forward buffer length on \"seeked\" event "+(r?r.len:"empty")+")"):void this.tick()},a.onManifestLoading=function e(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(Ta.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1},a.onManifestParsed=function a(e,t){var r=!1,n=!1,d;t.levels.forEach(function(e){d=e.audioCodec,d&&(-1!==d.indexOf("mp4a.40.2")&&(r=!0),-1!==d.indexOf("mp4a.40.5")&&(n=!0))}),this.audioCodecSwitch=r&&n&&!Et(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1},a.onLevelLoading=function a(e,t){var r=this.levels;if(r&&this.state===Vr.IDLE){var n=r[t.level];(!n.details||n.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(n.details))&&(this.state=Vr.WAITING_LEVEL)}},a.onLevelLoaded=function a(e,t){var r=this.levels,n=t.level,d=t.details,i=d.totalduration,o;if(!r)return void this.warn("Levels were reset while loading level "+n);this.log("Level "+n+" loaded ["+d.startSN+","+d.endSN+"]"+(d.lastPartSn?"[part-"+d.lastPartSn+"-"+d.lastPartIndex+"]":"")+", cc ["+d.startCC+", "+d.endCC+"] duration:"+i);var s=r[n],l=this.fragCurrent;l&&(this.state===Vr.FRAG_LOADING||this.state===Vr.FRAG_LOADING_WAITING_RETRY)&&(l.level!==t.level||l.urlId!==s.urlId)&&l.loader&&this.abortCurrentFrag();var u=0;if(d.live||null!=(o=s.details)&&o.live){if(this.checkLiveUpdate(d),d.deltaUpdateFailed)return;u=this.alignPlaylists(d,s.details)}if(s.details=d,this.levelLastLoaded=n,this.hls.trigger(Ta.LEVEL_UPDATED,{details:d,level:n}),this.state===Vr.WAITING_LEVEL){if(this.waitForCdnTuneIn(d))return;this.state=Vr.IDLE}this.startFragRequested?d.live&&this.synchronizeToLiveEdge(d):this.setStartPosition(d,u),this.tick()},a._handleFragmentLoadProgress=function t(e){var a=e.frag,r=e.part,n=e.payload,d=this.levels,i;if(!d)return void this.warn("Levels were reset while fragment load was in progress. Fragment "+a.sn+" of level "+a.level+" will not be buffered");var o=d[a.level],s=o.details;if(!s)return this.warn("Dropping fragment "+a.sn+" of level "+a.level+" after level details were reset"),void this.fragmentTracker.removeFragment(a);var l=o.videoCodec,u=s.PTSKnown||!s.live,f=null==(i=a.initSegment)?void 0:i.data,g=this._getAudioCodec(o),c=this.transmuxer=this.transmuxer||new In(this.hls,gr.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),m=r?r.index:-1,p=-1!==m,y=new Mr(a.level,a.sn,a.stats.chunkCount,n.byteLength,m,p),h=this.initPTS[a.cc];c.push(n,f,g,l,a,r,s.totalduration,u,y,h)},a.onAudioTrackSwitching=function a(e,t){var r=this.altAudio,d=!!t.url;if(!d){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var i=this.fragCurrent;i&&(this.log("Switching to main audio track, cancel main fragment load"),i.abortRequests(),this.fragmentTracker.removeFragment(i)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var o=this.hls;r&&(o.trigger(Ta.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:null}),this.fragmentTracker.removeAllFragments()),o.trigger(Ta.AUDIO_TRACK_SWITCHED,t)}},a.onAudioTrackSwitched=function a(e,t){var r=t.id,n=!!this.hls.audioTracks[r].url;if(n){var d=this.videoBuffer;d&&this.mediaBuffer!==d&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=d)}this.altAudio=n,this.tick()},a.onBufferCreated=function a(e,t){var r=t.tracks,n=!1,d,i;for(var o in r){var s=r[o];if("main"!==s.id)n=!0;else if(i=o,d=s,"video"===o){var l=r[o];l&&(this.videoBuffer=l.buffer)}}n&&d?(this.log("Alternate track found, use "+i+".buffered to schedule main fragment loading"),this.mediaBuffer=d.buffer):this.mediaBuffer=this.media},a.onFragBuffered=function a(e,t){var r=t.frag,n=t.part;if(!(r&&r.type!==gr.MAIN)){if(this.fragContextChanged(r))return this.warn("Fragment "+r.sn+(n?" p: "+n.index:"")+" of level "+r.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===Vr.PARSED&&(this.state=Vr.IDLE));var d=n?n.stats:r.stats;this.fragLastKbps=o(8*d.total/(d.buffering.end-d.loading.first)),"initSegment"!==r.sn&&(this.fragPrevious=r),this.fragBufferedComplete(r,n)}},a.onError=function a(e,t){var r;if(t.fatal)return void(this.state=Vr.ERROR);switch(t.details){case va.FRAG_GAP:case va.FRAG_PARSING_ERROR:case va.FRAG_DECRYPT_ERROR:case va.FRAG_LOAD_ERROR:case va.FRAG_LOAD_TIMEOUT:case va.KEY_LOAD_ERROR:case va.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(gr.MAIN,t);break;case va.LEVEL_LOAD_ERROR:case va.LEVEL_LOAD_TIMEOUT:case va.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Vr.WAITING_LEVEL||(null==(r=t.context)?void 0:r.type)!==fr.LEVEL||(this.state=Vr.IDLE);break;case va.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case va.INTERNAL_EXCEPTION:this.recoverWorkerError(t)}},a.checkBuffer=function e(){var t=this.media,a=this.gapController;if(t&&a&&t.readyState){if(this.loadedmetadata||!wr.getBuffered(t).length){var r=this.state===Vr.IDLE?null:this.fragCurrent;a.poll(this.lastCurrentTime,r)}this.lastCurrentTime=t.currentTime}},a.onFragLoadEmergencyAborted=function e(){this.state=Vr.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},a.onBufferFlushed=function a(e,t){var r=t.type;if(r!==Ca.AUDIO||this.audioOnly&&!this.altAudio){var n=(r===Ca.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(n,r,gr.MAIN)}},a.onLevelsUpdated=function a(e,t){this.levels=t.levels},a.swapAudioCodec=function e(){this.audioCodecSwap=!this.audioCodecSwap},a.seekToStartPos=function e(){var t=this.media;if(t){var a=t.currentTime,r=this.startPosition;if(0<=r&&a<r){if(t.seeking)return void this.log("could not seek to "+r+", already seeking at "+a);var n=wr.getBuffered(t),d=n.length?n.start(0):0,i=d-r;0<i&&(i<this.config.maxBufferHole||i<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+i+" to match buffer start"),r+=i,this.startPosition=r),this.log("seek to target start position "+r+" from current time "+a),t.currentTime=r}}},a._getAudioCodec=function t(e){var a=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&a&&(this.log("Swapping audio codec"),a=-1===a.indexOf("mp4a.40.5")?"mp4a.40.5":"mp4a.40.2"),a},a._loadBitrateTestFrag=function a(e,t){var r=this;e.bitrateTest=!0,this._doFragLoad(e,t).then(function(a){var n=r.hls;if(a&&!r.fragContextChanged(e)){t.fragmentError=0,r.state=Vr.IDLE,r.startFragRequested=!1,r.bitrateTest=!1;var d=e.stats;d.parsing.start=d.parsing.end=d.buffering.start=d.buffering.end=self.performance.now(),n.trigger(Ta.FRAG_LOADED,a),e.bitrateTest=!1}})},a._handleTransmuxComplete=function t(e){var a="main",r=this.hls,n=e.remuxResult,d=e.chunkMeta,i=this.getCurrentContext(d),o;if(!i)return void this.resetWhenMissingContext(d);var s=i.frag,l=i.part,u=i.level,f=n.video,g=n.text,c=n.id3,m=n.initSegment,p=u.details,y=this.altAudio?void 0:n.audio;if(this.fragContextChanged(s))return void this.fragmentTracker.removeFragment(s);if(this.state=Vr.PARSING,m){if(null!=m&&m.tracks){var h=s.initSegment||s;this._bufferInitSegment(u,m.tracks,h,d),r.trigger(Ta.FRAG_PARSING_INIT_SEGMENT,{frag:h,id:a,tracks:m.tracks})}var E=m.initPTS,T=m.timescale;Ea(E)&&(this.initPTS[s.cc]={baseTime:E,timescale:T},r.trigger(Ta.INIT_PTS_FOUND,{frag:s,id:a,initPTS:E,timescale:T}))}if(f&&p&&"initSegment"!==s.sn){var L=p.fragments[s.sn-1-p.startSN],v=s.sn===p.startSN,S=!L||s.cc>L.cc;if(!1!==n.independent){var R=f.startPTS,A=f.endPTS,D=f.startDTS,_=f.endDTS;if(l)l.elementaryStreams[f.type]={startPTS:R,endPTS:A,startDTS:D,endDTS:_};else if(f.firstKeyFrame&&f.independent&&1===d.id&&!S&&(this.couldBacktrack=!0),f.dropped&&f.independent){var b=this.getMainFwdBufferInfo(),k=(b?b.end:this.getLoadPosition())+this.config.maxBufferHole,I=f.firstKeyFramePTS?f.firstKeyFramePTS:R;if(!v&&k<I-this.config.maxBufferHole&&!S)return void this.backtrack(s);S&&(s.gap=!0),s.setElementaryStreamInfo(f.type,s.start,A,s.start,_,!0)}s.setElementaryStreamInfo(f.type,R,A,D,_),this.backtrackFragment&&(this.backtrackFragment=s),this.bufferFragmentData(f,s,l,d,v||S)}else if(v||S)s.gap=!0;else return void this.backtrack(s)}if(y){var x=y.startPTS,C=y.endPTS,P=y.startDTS,F=y.endDTS;l&&(l.elementaryStreams[Ca.AUDIO]={startPTS:x,endPTS:C,startDTS:P,endDTS:F}),s.setElementaryStreamInfo(Ca.AUDIO,x,C,P,F),this.bufferFragmentData(y,s,l,d)}if(p&&null!=c&&null!=(o=c.samples)&&o.length){var O={id:a,frag:s,details:p,samples:c.samples};r.trigger(Ta.FRAG_PARSING_METADATA,O)}if(p&&g){var N={id:a,frag:s,details:p,samples:g.samples};r.trigger(Ta.FRAG_PARSING_USERDATA,N)}},a._bufferInitSegment=function n(e,t,a,r){var d=this;if(this.state===Vr.PARSING){this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;var i=t.audio,o=t.video,s=t.audiovideo;if(i){var l=e.audioCodec,u=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(l&&(-1===l.indexOf("mp4a.40.5")?l="mp4a.40.5":l="mp4a.40.2"),1!==i.metadata.channelCount&&-1===u.indexOf("firefox")&&(l="mp4a.40.5")),-1!==u.indexOf("android")&&"audio/mpeg"!==i.container&&(l="mp4a.40.2",this.log("Android: force audio codec to "+l)),e.audioCodec&&e.audioCodec!==l&&this.log("Swapping manifest audio codec \""+e.audioCodec+"\" for \""+l+"\""),i.levelCodec=l,i.id="main",this.log("Init audio buffer, container:"+i.container+", codecs[selected/level/parsed]=["+(l||"")+"/"+(e.audioCodec||"")+"/"+i.codec+"]")}o&&(o.levelCodec=e.videoCodec,o.id="main",this.log("Init video buffer, container:"+o.container+", codecs[level/parsed]=["+(e.videoCodec||"")+"/"+o.codec+"]")),s&&this.log("Init audiovideo buffer, container:"+s.container+", codecs[level/parsed]=["+(e.attrs.CODECS||"")+"/"+s.codec+"]"),this.hls.trigger(Ta.BUFFER_CODECS,t),Object.keys(t).forEach(function(e){var n=t[e],i=n.initSegment;null!=i&&i.byteLength&&d.hls.trigger(Ta.BUFFER_APPENDING,{type:e,data:i,frag:a,part:null,chunkMeta:r,parent:a.type})}),this.tick()}},a.getMainFwdBufferInfo=function e(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,gr.MAIN)},a.backtrack=function t(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Vr.IDLE},a.checkFragmentChanged=function e(){var t=this.media,a=null;if(t&&1<t.readyState&&!1===t.seeking){var r=t.currentTime;if(wr.isBuffered(t,r)?a=this.getAppendedFrag(r):wr.isBuffered(t,r+.1)&&(a=this.getAppendedFrag(r+.1)),a){this.backtrackFragment=null;var n=this.fragPlaying,d=a.level;n&&a.sn===n.sn&&n.level===d&&a.urlId===n.urlId||(this.fragPlaying=a,this.hls.trigger(Ta.FRAG_CHANGED,{frag:a}),(!n||n.level!==d)&&this.hls.trigger(Ta.LEVEL_SWITCHED,{level:d}))}}},E(t,[{key:"nextLevel",get:function e(){var t=this.nextBufferedFrag;return t?t.level:-1}},{key:"currentFrag",get:function e(){var t=this.media;return t?this.fragPlaying||this.getAppendedFrag(t.currentTime):null}},{key:"currentProgramDateTime",get:function e(){var t=this.media;if(t){var a=t.currentTime,r=this.currentFrag;if(r&&Ea(a)&&Ea(r.programDateTime)){var n=r.programDateTime+1e3*(a-r.start);return new Date(n)}}return null}},{key:"currentLevel",get:function e(){var t=this.currentFrag;return t?t.level:-1}},{key:"nextBufferedFrag",get:function e(){var t=this.currentFrag;return t?this.followingBufferedFrag(t):null}},{key:"forceStartLoad",get:function e(){return this._forceStartLoad}}]),t}(Wr),Fn=function(){function e(e,t,a){var n=Math.log;void 0===t&&(t=0),void 0===a&&(a=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?r(n(.5)/e):0,this.estimate_=t,this.totalWeight_=a}var t=e.prototype;return t.sample=function a(e,t){var r=g(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function e(){return this.totalWeight_},t.getEstimate=function e(){if(this.alpha_){var t=1-g(this.alpha_,this.totalWeight_);if(t)return this.estimate_/t}return this.estimate_},e}(),On=function(){function e(e,t,a,r){void 0===r&&(r=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=a,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new Fn(e),this.fast_=new Fn(t),this.defaultTTFB_=r,this.ttfb_=new Fn(e)}var t=e.prototype;return t.update=function a(e,t){var r=this.slow_,n=this.fast_,d=this.ttfb_;r.halfLife!==e&&(this.slow_=new Fn(e,r.getEstimate(),r.getTotalWeight())),n.halfLife!==t&&(this.fast_=new Fn(t,n.getEstimate(),n.getTotalWeight())),d.halfLife!==e&&(this.ttfb_=new Fn(e,d.getEstimate(),d.getTotalWeight()))},t.sample=function a(e,t){e=c(e,this.minDelayMs_);var r=8*t,n=e/1e3,d=r/n;this.fast_.sample(n,d),this.slow_.sample(n,d)},t.sampleTTFB=function t(e){var a=Math.sqrt,n=e/1e3,d=a(2)*r(-g(n,2)/2);this.ttfb_.sample(d,c(e,5))},t.canEstimate=function e(){return this.fast_.getTotalWeight()>=this.minWeight_},t.getEstimate=function e(){return this.canEstimate()?s(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.getEstimateTTFB=function e(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},t.destroy=function e(){},e}(),Nn=function(){function e(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;var t=e.config;this.bwEstimator=new On(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var t=e.prototype;return t.registerListeners=function e(){var t=this.hls;t.on(Ta.FRAG_LOADING,this.onFragLoading,this),t.on(Ta.FRAG_LOADED,this.onFragLoaded,this),t.on(Ta.FRAG_BUFFERED,this.onFragBuffered,this),t.on(Ta.LEVEL_SWITCHING,this.onLevelSwitching,this),t.on(Ta.LEVEL_LOADED,this.onLevelLoaded,this)},t.unregisterListeners=function e(){var t=this.hls;t.off(Ta.FRAG_LOADING,this.onFragLoading,this),t.off(Ta.FRAG_LOADED,this.onFragLoaded,this),t.off(Ta.FRAG_BUFFERED,this.onFragBuffered,this),t.off(Ta.LEVEL_SWITCHING,this.onLevelSwitching,this),t.off(Ta.LEVEL_LOADED,this.onLevelLoaded,this)},t.destroy=function e(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},t.onFragLoading=function a(e,t){var r=t.frag,n;this.ignoreFragment(r)||(this.fragCurrent=r,this.partCurrent=null==(n=t.part)?null:n,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))},t.onLevelSwitching=function a(e,t){this.clearTimer()},t.getTimeToLoadFrag=function n(e,t,a,r){var d=e+a/t,i=r?this.lastLevelLoadSec:0;return d+i},t.onLevelLoaded=function a(e,t){var r=this.hls.config,n=t.stats,d=n.total,i=n.bwEstimate;Ea(d)&&Ea(i)&&(this.lastLevelLoadSec=8*d/i),t.details.live?this.bwEstimator.update(r.abrEwmaSlowLive,r.abrEwmaFastLive):this.bwEstimator.update(r.abrEwmaSlowVoD,r.abrEwmaFastVoD)},t._abandonRulesCheck=function e(){var t=this.fragCurrent,a=this.partCurrent,r=this.hls,d=r.autoLevelEnabled,i=r.media;if(t&&i){var u=performance.now(),f=a?a.stats:t.stats,g=a?a.duration:t.duration,m=u-f.loading.start;if(f.aborted||f.loaded&&f.loaded===f.total||0===t.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(d&&!i.paused&&i.playbackRate&&i.readyState){var p=r.mainForwardBufferInfo;if(null!==p){var y=this.bwEstimator.getEstimateTTFB(),h=l(i.playbackRate);if(!(m<=c(y,1e3*(g/(2*h))))){var E=p.len/h;if(!(E>=2*g/h)){var T=f.loading.first?f.loading.first-f.loading.start:-1,L=f.loaded&&-1<T,v=this.bwEstimator.getEstimate(),S=r.levels,R=r.minAutoLevel,A=S[t.level],D=f.total||c(f.loaded,o(g*A.maxBitrate/8)),_=m-T;1>_&&L&&(_=s(m,8*f.loaded/v));var b=L?1e3*f.loaded/_:0,k=b?(D-f.loaded)/b:8*D/v+y/1e3;if(!(k<=E)){var I=b?8*b:v,x=n,C;for(C=t.level-1;C>R;C--){var P=S[C].maxBitrate;if(x=this.getTimeToLoadFrag(y/1e3,I,g*P,!S[C].details),x<E)break}x>=k||x>10*g||(r.nextLoadLevel=C,L?this.bwEstimator.sample(m-s(y,T),f.loaded):this.bwEstimator.sampleTTFB(m),this.clearTimer(),Da.warn("[abr] Fragment "+t.sn+(a?" part "+a.index:"")+" of level "+t.level+" is loading too slowly;\n      Time to underbuffer: "+E.toFixed(3)+" s\n      Estimated load time for current fragment: "+k.toFixed(3)+" s\n      Estimated load time for down switch fragment: "+x.toFixed(3)+" s\n      TTFB estimate: "+T+"\n      Current BW estimate: "+(Ea(v)?(v/1024).toFixed(3):"Unknown")+" Kb/s\n      New BW estimate: "+(this.bwEstimator.getEstimate()/1024).toFixed(3)+" Kb/s\n      Aborting and switching to level "+C),t.loader&&(this.fragCurrent=this.partCurrent=null,t.abortRequests()),r.trigger(Ta.FRAG_LOAD_EMERGENCY_ABORTED,{frag:t,part:a,stats:f}))}}}}}}},t.onFragLoaded=function a(e,t){var r=t.frag,n=t.part,d=n?n.stats:r.stats;if(r.type===gr.MAIN&&this.bwEstimator.sampleTTFB(d.loading.first-d.loading.start),!this.ignoreFragment(r)){if(this.clearTimer(),this.lastLoadedFragLevel=r.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var i=n?n.duration:r.duration,s=this.hls.levels[r.level],l=(s.loaded?s.loaded.bytes:0)+d.loaded,u=(s.loaded?s.loaded.duration:0)+i;s.loaded={bytes:l,duration:u},s.realBitrate=o(8*l/u)}if(r.bitrateTest){var f={stats:d,frag:r,part:n,id:r.type};this.onFragBuffered(Ta.FRAG_BUFFERED,f),r.bitrateTest=!1}}},t.onFragBuffered=function a(e,t){var r=t.frag,n=t.part,d=null!=n&&n.stats.loaded?n.stats:r.stats;if(!d.aborted&&!this.ignoreFragment(r)){var i=d.parsing.end-d.loading.start-s(d.loading.first-d.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(i,d.loaded),d.bwEstimate=this.bwEstimator.getEstimate(),this.bitrateTestDelay=r.bitrateTest?i/1e3:0}},t.ignoreFragment=function t(e){return e.type!==gr.MAIN||"initSegment"===e.sn},t.clearTimer=function e(){self.clearInterval(this.timer)},t.getNextABRAutoLevel=function e(){var t=this.fragCurrent,a=this.partCurrent,r=this.hls,n=r.maxAutoLevel,d=r.config,i=r.minAutoLevel,u=r.media,f=a?a.duration:t?t.duration:0,g=u&&0!==u.playbackRate?l(u.playbackRate):1,m=this.bwEstimator?this.bwEstimator.getEstimate():d.abrEwmaDefaultEstimate,p=r.mainForwardBufferInfo,y=(p?p.len:0)/g,h=this.findBestLevel(m,i,n,y,d.abrBandWidthFactor,d.abrBandWidthUpFactor);if(0<=h)return h;Da.trace("[abr] "+(y?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var E=f?s(f,d.maxStarvationDelay):d.maxStarvationDelay,T=d.abrBandWidthFactor,L=d.abrBandWidthUpFactor;if(!y){var v=this.bitrateTestDelay;if(v){var S=f?s(f,d.maxLoadingDelay):d.maxLoadingDelay;E=S-v,Da.trace("[abr] bitrate test took "+o(1e3*v)+"ms, set first fragment max fetchDuration to "+o(1e3*E)+" ms"),T=L=1}}return h=this.findBestLevel(m,i,n,y+E,T,L),c(h,0)},t.findBestLevel=function l(e,t,a,r,n,d){for(var u=this.fragCurrent,f=this.partCurrent,g=this.lastLoadedFragLevel,m=this.hls.levels,p=m[g],y=!!(null!=p&&null!=(R=p.details)&&R.live),h=null==p?void 0:p.codecSet,E=f?f.duration:u?u.duration:0,T=this.bwEstimator.getEstimateTTFB()/1e3,L=t,v=-1,S=a,R,A;S>=t;S--){if(A=m[S],!A||h&&A.codecSet!==h){A&&(L=s(S,L),v=c(S,v));continue}-1!==v&&Da.trace("[abr] Skipped level(s) "+L+"-"+v+" with CODECS:\""+m[v].attrs.CODECS+"\"; not compatible with \""+p.attrs.CODECS+"\"");var D=A.details,_=(f?null==D?void 0:D.partTarget:null==D?void 0:D.averagetargetduration)||E,b=void 0;b=S<=g?n*e:d*e;var k=m[S].maxBitrate,I=this.getTimeToLoadFrag(T,b,k*_,void 0===D);if(Da.trace("[abr] level:"+S+" adjustedbw-bitrate:"+o(b-k)+" avgDuration:"+_.toFixed(1)+" maxFetchDuration:"+r.toFixed(1)+" fetchDuration:"+I.toFixed(1)),b>k&&(0===I||!Ea(I)||y&&!this.bitrateTestDelay||I<r))return S}return-1},E(e,[{key:"nextAutoLevel",get:function e(){var t=this._nextAutoLevel,a=this.bwEstimator;if(-1!==t&&!a.canEstimate())return t;var r=this.getNextABRAutoLevel();if(-1!==t){var n=this.hls.levels;if(n.length>c(t,r)&&n[t].loadError<=n[r].loadError)return t}return-1!==t&&(r=s(t,r)),r},set:function t(e){this._nextAutoLevel=e}}]),e}(),wn=function(){function e(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var t=e.prototype;return t.append=function a(e,t){var r=this.queues[t];r.push(e),1===r.length&&this.buffers[t]&&this.executeNext(t)},t.insertAbort=function a(e,t){var r=this.queues[t];r.unshift(e),this.executeNext(t)},t.appendBlocker=function t(e){var a=new Promise(function(e){n=e}),r={execute:n,onStart:function e(){},onComplete:function e(){},onError:function e(){}},n;return this.append(r,e),a},t.executeNext=function a(t){var r=this.buffers,n=this.queues,d=r[t],i=n[t];if(i.length){var o=i[0];try{o.execute()}catch(a){Da.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),o.onError(a),null!=d&&d.updating||(i.shift(),this.executeNext(t))}}},t.shiftAndExecuteNext=function t(e){this.queues[e].shift(),this.executeNext(e)},t.current=function t(e){return this.queues[e][0]},e}(),Mn=se(),Bn=/([ha]vc.)(?:\.[^.,]+)+/,Un=function(){function e(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var e=t.media,a=t.mediaSource;Da.log("[buffer-controller]: Media source opened"),e&&(e.removeEventListener("emptied",t._onMediaEmptied),t.updateMediaElementDuration(),t.hls.trigger(Ta.MEDIA_ATTACHED,{media:e})),a&&a.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){Da.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){Da.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var e=t.media,a=t._objectUrl;e&&e.src!==a&&Da.error("Media element src was set while attaching MediaSource ("+a+" > "+e.src+")")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var t=e.prototype;return t.hasSourceTypes=function e(){return 0<this.getSourceBufferTypes().length||0<Object.keys(this.pendingTracks).length},t.destroy=function e(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},t.registerListeners=function e(){var t=this.hls;t.on(Ta.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(Ta.MEDIA_DETACHING,this.onMediaDetaching,this),t.on(Ta.MANIFEST_LOADING,this.onManifestLoading,this),t.on(Ta.MANIFEST_PARSED,this.onManifestParsed,this),t.on(Ta.BUFFER_RESET,this.onBufferReset,this),t.on(Ta.BUFFER_APPENDING,this.onBufferAppending,this),t.on(Ta.BUFFER_CODECS,this.onBufferCodecs,this),t.on(Ta.BUFFER_EOS,this.onBufferEos,this),t.on(Ta.BUFFER_FLUSHING,this.onBufferFlushing,this),t.on(Ta.LEVEL_UPDATED,this.onLevelUpdated,this),t.on(Ta.FRAG_PARSED,this.onFragParsed,this),t.on(Ta.FRAG_CHANGED,this.onFragChanged,this)},t.unregisterListeners=function e(){var t=this.hls;t.off(Ta.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(Ta.MEDIA_DETACHING,this.onMediaDetaching,this),t.off(Ta.MANIFEST_LOADING,this.onManifestLoading,this),t.off(Ta.MANIFEST_PARSED,this.onManifestParsed,this),t.off(Ta.BUFFER_RESET,this.onBufferReset,this),t.off(Ta.BUFFER_APPENDING,this.onBufferAppending,this),t.off(Ta.BUFFER_CODECS,this.onBufferCodecs,this),t.off(Ta.BUFFER_EOS,this.onBufferEos,this),t.off(Ta.BUFFER_FLUSHING,this.onBufferFlushing,this),t.off(Ta.LEVEL_UPDATED,this.onLevelUpdated,this),t.off(Ta.FRAG_PARSED,this.onFragParsed,this),t.off(Ta.FRAG_CHANGED,this.onFragChanged,this)},t._initSourceBuffer=function e(){this.sourceBuffer={},this.operationQueue=new wn(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},t.onManifestLoading=function e(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null},t.onManifestParsed=function a(e,t){var r=2;(!t.audio||t.video)&&t.altAudio&&!1||(r=1),this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=r,Da.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},t.onMediaAttaching=function a(e,t){var r=this.media=t.media;if(r&&Mn){var n=this.mediaSource=new Mn;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),r.src=self.URL.createObjectURL(n),this._objectUrl=r.src,r.addEventListener("emptied",this._onMediaEmptied)}},t.onMediaDetaching=function e(){var t=this.media,a=this.mediaSource,r=this._objectUrl;if(a){if(Da.log("[buffer-controller]: media source detaching"),"open"===a.readyState)try{a.endOfStream()}catch(e){Da.warn("[buffer-controller]: onMediaDetaching: "+e.message+" while calling endOfStream")}this.onBufferReset(),a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),t&&(t.removeEventListener("emptied",this._onMediaEmptied),r&&self.URL.revokeObjectURL(r),t.src===r?(t.removeAttribute("src"),t.load()):Da.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(Ta.MEDIA_DETACHED,void 0)},t.onBufferReset=function e(){var t=this;this.getSourceBufferTypes().forEach(function(e){var a=t.sourceBuffer[e];try{a&&(t.removeBufferListeners(e),t.mediaSource&&t.mediaSource.removeSourceBuffer(a),t.sourceBuffer[e]=void 0)}catch(t){Da.warn("[buffer-controller]: Failed to reset the "+e+" buffer",t)}}),this._initSourceBuffer()},t.onBufferCodecs=function a(e,t){var r=this,n=this.getSourceBufferTypes().length;Object.keys(t).forEach(function(e){if(n){var a=r.tracks[e];if(a&&"function"==typeof a.buffer.changeType){var d=t[e],i=d.id,o=d.codec,s=d.levelCodec,l=d.container,u=d.metadata,f=(a.levelCodec||a.codec).replace(Bn,"$1"),g=(s||o).replace(Bn,"$1");if(f!==g){var c=l+";codecs="+(s||o);r.appendChangeType(e,c),Da.log("[buffer-controller]: switching codec "+f+" to "+g),r.tracks[e]={buffer:a.buffer,codec:o,container:l,levelCodec:s,metadata:u,id:i}}}}else r.pendingTracks[e]=t[e]}),n||(this.bufferCodecEventsExpected=c(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},t.appendChangeType=function r(t,a){var n=this,d=this.operationQueue,i={execute:function e(){var r=n.sourceBuffer[t];r&&(Da.log("[buffer-controller]: changing "+t+" sourceBuffer type to "+a),r.changeType(a)),d.shiftAndExecuteNext(t)},onStart:function e(){},onComplete:function e(){},onError:function e(a){Da.warn("[buffer-controller]: Failed to change "+t+" SourceBuffer type",a)}};d.append(i,t)},t.onBufferAppending=function a(e,t){var r=this,n=this.hls,d=this.operationQueue,i=this.tracks,o=t.data,s=t.type,u=t.frag,f=t.part,g=t.chunkMeta,c=g.buffering[s],m=self.performance.now();c.start=m;var p=u.stats.buffering,y=f?f.stats.buffering:null;0===p.start&&(p.start=m),y&&0===y.start&&(y.start=m);var h=i.audio,E=!1;"audio"===s&&"audio/mpeg"===(null==h?void 0:h.container)&&(E=!this.lastMpegAudioChunk||1===g.id||this.lastMpegAudioChunk.sn!==g.sn,this.lastMpegAudioChunk=g);var T=u.start,L={execute:function e(){if(c.executeStart=self.performance.now(),E){var t=r.sourceBuffer[s];if(t){var a=T-t.timestampOffset;.1<=l(a)&&(Da.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+T+" (delta: "+a+") sn: "+u.sn+")"),t.timestampOffset=T)}}r.appendExecutor(o,s)},onStart:function e(){},onComplete:function e(){var t=self.performance.now();c.executeEnd=c.end=t,0===p.first&&(p.first=t),y&&0===y.first&&(y.first=t);var a=r.sourceBuffer,n={};for(var d in a)n[d]=wr.getBuffered(a[d]);r.appendError=0,r.hls.trigger(Ta.BUFFER_APPENDED,{type:s,frag:u,part:f,chunkMeta:g,parent:u.type,timeRanges:n})},onError:function t(e){Da.error("[buffer-controller]: Error encountered while trying to append to the "+s+" SourceBuffer",e);var a={type:La.MEDIA_ERROR,parent:u.type,details:va.BUFFER_APPEND_ERROR,frag:u,part:f,chunkMeta:g,error:e,err:e,fatal:!1};e.code===DOMException.QUOTA_EXCEEDED_ERR?a.details=va.BUFFER_FULL_ERROR:(r.appendError++,a.details=va.BUFFER_APPEND_ERROR,r.appendError>n.config.appendErrorMaxRetry&&(Da.error("[buffer-controller]: Failed "+n.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),a.fatal=!0)),n.trigger(Ta.ERROR,a)}};d.append(L,s)},t.onBufferFlushing=function a(e,t){var r=this,n=this.operationQueue,d=function n(a){return{execute:r.removeExecutor.bind(r,a,t.startOffset,t.endOffset),onStart:function e(){},onComplete:function e(){r.hls.trigger(Ta.BUFFER_FLUSHED,{type:a})},onError:function e(t){Da.warn("[buffer-controller]: Failed to remove from "+a+" SourceBuffer",t)}}};t.type?n.append(d(t.type),t.type):this.getSourceBufferTypes().forEach(function(e){n.append(d(e),e)})},t.onFragParsed=function a(e,t){var r=this,n=t.frag,d=t.part,i=[],o=d?d.elementaryStreams:n.elementaryStreams;o[Ca.AUDIOVIDEO]?i.push("audiovideo"):(o[Ca.AUDIO]&&i.push("audio"),o[Ca.VIDEO]&&i.push("video"));var s=function e(){var t=self.performance.now();n.stats.buffering.end=t,d&&(d.stats.buffering.end=t);var a=d?d.stats:n.stats;r.hls.trigger(Ta.FRAG_BUFFERED,{frag:n,part:d,stats:a,id:n.type})};0===i.length&&Da.warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn),this.blockBuffers(s,i)},t.onFragChanged=function a(e,t){this.flushBackBuffer()},t.onBufferEos=function a(e,t){var r=this,n=this.getSourceBufferTypes().reduce(function(e,a){var n=r.sourceBuffer[a];return n&&(!t.type||t.type===a)&&(n.ending=!0,!n.ended&&(n.ended=!0,Da.log("[buffer-controller]: "+a+" sourceBuffer now EOS"))),e&&(!n||n.ended)},!0);n&&(Da.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers(function(){r.getSourceBufferTypes().forEach(function(e){var t=r.sourceBuffer[e];t&&(t.ending=!1)});var e=r.mediaSource;return e&&"open"===e.readyState?void(Da.log("[buffer-controller]: Calling mediaSource.endOfStream()"),e.endOfStream()):void(e&&Da.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+e.readyState))}))},t.onLevelUpdated=function a(e,t){var r=t.details;r.fragments.length&&(this.details=r,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},t.flushBackBuffer=function e(){var t=this.hls,a=this.details,r=this.media,n=this.sourceBuffer;if(r&&null!==a){var d=this.getSourceBufferTypes();if(d.length){var i=a.live&&null!==t.config.liveBackBufferLength?t.config.liveBackBufferLength:t.config.backBufferLength;if(Ea(i)&&!(0>i)){var o=r.currentTime,s=a.levelTargetDuration,l=c(i,s),u=f(o/s)*s-l;d.forEach(function(e){var r=n[e];if(r){var d=wr.getBuffered(r);if(0<d.length&&u>d.start(0)){if(t.trigger(Ta.BACK_BUFFER_REACHED,{bufferEnd:u}),a.live)t.trigger(Ta.LIVE_BACK_BUFFER_REACHED,{bufferEnd:u});else if(r.ended&&d.end(d.length-1)-o<2*s)return void Da.info("[buffer-controller]: Cannot flush "+e+" back buffer while SourceBuffer is in ended state");t.trigger(Ta.BUFFER_FLUSHING,{startOffset:0,endOffset:u,type:e})}}})}}}},t.updateMediaElementDuration=function e(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var t=this.details,a=this.hls,r=this.media,n=this.mediaSource,d=t.fragments[0].start+t.totalduration,i=r.duration,o=Ea(n.duration)?n.duration:0;t.live&&a.config.liveDurationInfinity?(Da.log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(t)):(d>o&&d>i||!Ea(i))&&(Da.log("[buffer-controller]: Updating Media Source duration to "+d.toFixed(3)),n.duration=d)}},t.updateSeekableRange=function t(e){var a=this.mediaSource,r=e.fragments,n=r.length;if(n&&e.live&&null!=a&&a.setLiveSeekableRange){var d=c(0,r[0].start),i=c(d,d+e.totalduration);a.setLiveSeekableRange(d,i)}},t.checkPendingTracks=function e(){var t=this.bufferCodecEventsExpected,a=this.operationQueue,r=this.pendingTracks,n=Object.keys(r).length;if(n&&!t||2===n){this.createSourceBuffers(r),this.pendingTracks={};var d=this.getSourceBufferTypes();if(d.length)this.hls.trigger(Ta.BUFFER_CREATED,{tracks:this.tracks}),d.forEach(function(e){a.executeNext(e)});else{var i=new Error("could not create source buffer for media codec(s)");this.hls.trigger(Ta.ERROR,{type:La.MEDIA_ERROR,details:va.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:i,reason:i.message})}}},t.createSourceBuffers=function t(e){var a=this.sourceBuffer,r=this.mediaSource;if(!r)throw Error("createSourceBuffers called when mediaSource was null");for(var n in e)if(!a[n]){var d=e[n];if(!d)throw Error("source buffer exists for track "+n+", however track does not");var i=d.levelCodec||d.codec,o=d.container+";codecs="+i;Da.log("[buffer-controller]: creating sourceBuffer("+o+")");try{var s=a[n]=r.addSourceBuffer(o),l=n;this.addBufferListener(l,"updatestart",this._onSBUpdateStart),this.addBufferListener(l,"updateend",this._onSBUpdateEnd),this.addBufferListener(l,"error",this._onSBUpdateError),this.tracks[n]={buffer:s,codec:i,container:d.container,levelCodec:d.levelCodec,metadata:d.metadata,id:d.id}}catch(e){Da.error("[buffer-controller]: error while trying to add sourceBuffer: "+e.message),this.hls.trigger(Ta.ERROR,{type:La.MEDIA_ERROR,details:va.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:e,mimeType:o})}}},t._onSBUpdateStart=function t(e){var a=this.operationQueue,r=a.current(e);r.onStart()},t._onSBUpdateEnd=function t(e){var a=this.operationQueue,r=a.current(e);r.onComplete(),a.shiftAndExecuteNext(e)},t._onSBUpdateError=function a(e,t){var r=new Error(e+" SourceBuffer error");Da.error("[buffer-controller]: "+r,t),this.hls.trigger(Ta.ERROR,{type:La.MEDIA_ERROR,details:va.BUFFER_APPENDING_ERROR,error:r,fatal:!1});var n=this.operationQueue.current(e);n&&n.onError(t)},t.removeExecutor=function r(e,t,a){var n=this.media,d=this.mediaSource,i=this.operationQueue,o=this.sourceBuffer,l=o[e];if(!n||!d||!l)return Da.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void i.shiftAndExecuteNext(e);var u=Ea(n.duration)?n.duration:1/0,f=Ea(d.duration)?d.duration:1/0,g=c(0,t),m=s(a,u,f);m>g&&!l.ending?(l.ended=!1,Da.log("[buffer-controller]: Removing ["+g+","+m+"] from the "+e+" SourceBuffer"),l.remove(g,m)):i.shiftAndExecuteNext(e)},t.appendExecutor=function a(e,t){var r=this.operationQueue,n=this.sourceBuffer,d=n[t];return d?void(d.ended=!1,d.appendBuffer(e)):(Da.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void r.shiftAndExecuteNext(t))},t.blockBuffers=function a(e,t){var r=this;if(void 0===t&&(t=this.getSourceBufferTypes()),!t.length)return Da.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var n=this.operationQueue,d=t.map(function(e){return n.appendBlocker(e)});Promise.all(d).then(function(){e(),t.forEach(function(e){var t=r.sourceBuffer[e];null!=t&&t.updating||n.shiftAndExecuteNext(e)})})},t.getSourceBufferTypes=function e(){return Object.keys(this.sourceBuffer)},t.addBufferListener=function r(e,t,a){var n=this.sourceBuffer[e];if(n){var d=a.bind(this,e);this.listeners[e].push({event:t,listener:d}),n.addEventListener(t,d)}},t.removeBufferListeners=function t(e){var a=this.sourceBuffer[e];a&&this.listeners[e].forEach(function(e){a.removeEventListener(e.event,e.listener)})},e}(),Gn=function(){function e(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=n,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var t=e.prototype;return t.setStreamController=function t(e){this.streamController=e},t.destroy=function e(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},t.registerListeners=function e(){var t=this.hls;t.on(Ta.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.on(Ta.MEDIA_ATTACHING,this.onMediaAttaching,this),t.on(Ta.MANIFEST_PARSED,this.onManifestParsed,this),t.on(Ta.BUFFER_CODECS,this.onBufferCodecs,this),t.on(Ta.MEDIA_DETACHING,this.onMediaDetaching,this)},t.unregisterListener=function e(){var t=this.hls;t.off(Ta.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),t.off(Ta.MEDIA_ATTACHING,this.onMediaAttaching,this),t.off(Ta.MANIFEST_PARSED,this.onManifestParsed,this),t.off(Ta.BUFFER_CODECS,this.onBufferCodecs,this),t.off(Ta.MEDIA_DETACHING,this.onMediaDetaching,this)},t.onFpsDropLevelCapping=function a(e,t){var r=this.hls.levels[t.droppedLevel];this.isLevelAllowed(r)&&this.restrictedLevels.push({bitrate:r.bitrate,height:r.height,width:r.width})},t.onMediaAttaching=function a(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null},t.onManifestParsed=function a(e,t){var r=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,r.config.capLevelToPlayerSize&&t.video&&this.startCapping()},t.onBufferCodecs=function a(e,t){var r=this.hls;r.config.capLevelToPlayerSize&&t.video&&this.startCapping()},t.onMediaDetaching=function e(){this.stopCapping()},t.detectPlayerSize=function e(){if(this.media&&0<this.mediaHeight&&0<this.mediaWidth){var t=this.hls.levels;if(t.length){var a=this.hls;a.autoLevelCapping=this.getMaxLevel(t.length-1),a.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=a.autoLevelCapping}}},t.getMaxLevel=function a(t){var r=this,n=this.hls.levels;if(!n.length)return-1;var d=n.filter(function(e,a){return r.isLevelAllowed(e)&&a<=t});return this.clientRect=null,e.getMaxLevelByMediaSize(d,this.mediaWidth,this.mediaHeight)},t.startCapping=function e(){this.timer||(this.autoLevelCapping=n,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.stopCapping=function e(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=n,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},t.getDimensions=function e(){if(this.clientRect)return this.clientRect;var t=this.media,a={width:0,height:0};if(t){var r=t.getBoundingClientRect();a.width=r.width,a.height=r.height,a.width||a.height||(a.width=r.right-r.left||t.width||0,a.height=r.bottom-r.top||t.height||0)}return this.clientRect=a,a},t.isLevelAllowed=function t(e){var a=this.restrictedLevels;return!a.some(function(t){return e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height})},e.getMaxLevelByMediaSize=function r(e,t,a){if(!(null!=e&&e.length))return-1;for(var n=function a(e,t){return!t||e.width!==t.width||e.height!==t.height},d=e.length-1,o=0,s;o<e.length;o+=1)if(s=e[o],(s.width>=t||s.height>=a)&&n(s,e[o+1])){d=o;break}return d},E(e,[{key:"mediaWidth",get:function e(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function e(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function e(){var t=1;if(!this.hls.config.ignoreDevicePixelRatio)try{t=self.devicePixelRatio}catch(t){}return t}}]),e}(),Kn=function(){function e(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var t=e.prototype;return t.setStreamController=function t(e){this.streamController=e},t.registerListeners=function e(){this.hls.on(Ta.MEDIA_ATTACHING,this.onMediaAttaching,this)},t.unregisterListeners=function e(){this.hls.off(Ta.MEDIA_ATTACHING,this.onMediaAttaching,this)},t.destroy=function e(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},t.onMediaAttaching=function a(e,t){var r=this.hls.config;if(r.capLevelOnFPSDrop){var n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&"function"==typeof n.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),r.fpsDroppedMonitoringPeriod)}},t.checkFPS=function r(e,t,a){var n=performance.now();if(t){if(this.lastTime){var d=n-this.lastTime,i=a-this.lastDroppedFrames,o=t-this.lastDecodedFrames,s=1e3*i/d,l=this.hls;if(l.trigger(Ta.FPS_DROP,{currentDropped:i,currentDecoded:o,totalDroppedFrames:a}),0<s&&i>l.config.fpsDroppedMonitoringThreshold*o){var u=l.currentLevel;Da.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),0<u&&(-1===l.autoLevelCapping||l.autoLevelCapping>=u)&&(--u,l.trigger(Ta.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:l.currentLevel}),l.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=a,this.lastDecodedFrames=t}},t.checkFPSInterval=function e(){var t=this.media;if(t)if(this.isVideoPlaybackQualityAvailable){var a=t.getVideoPlaybackQuality();this.checkFPS(t,a.totalVideoFrames,a.droppedVideoFrames)}else this.checkFPS(t,t.webkitDecodedFrameCount,t.webkitDroppedFrameCount)},e}(),Hn=/^age:\s*[\d.]+\s*$/im,Vn=function(){function e(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e?e.xhrSetup||null:null,this.stats=new xa,this.retryDelay=0}var t=e.prototype;return t.destroy=function e(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},t.abortInternal=function e(){var t=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),t&&(t.onreadystatechange=null,t.onprogress=null,4!==t.readyState&&(this.stats.aborted=!0,t.abort()))},t.abort=function e(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},t.load=function r(e,t,a){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=a,this.loadInternal()},t.loadInternal=function e(){var t=this,a=this.config,r=this.context;if(a){var n=this.loader=new self.XMLHttpRequest,d=this.stats;d.loading.first=0,d.loaded=0,d.aborted=!1;var i=this.xhrSetup;i?Promise.resolve().then(function(){return t.stats.aborted?void 0:i(n,r.url)}).catch(function(e){return n.open("GET",r.url,!0),i(n,r.url)}).then(function(){t.stats.aborted||t.openAndSendXhr(n,r,a)}).catch(function(e){t.callbacks.onError({code:n.status,text:e.message},r,n,d)}):this.openAndSendXhr(n,r,a)}},t.openAndSendXhr=function r(e,t,a){e.readyState||e.open("GET",t.url,!0);var n=this.context.headers,d=a.loadPolicy,i=d.maxTimeToFirstByteMs,o=d.maxLoadTimeMs;if(n)for(var s in n)e.setRequestHeader(s,n[s]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),a.timeout=i&&Ea(i)?i:o,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.timeout),e.send()},t.readystatechange=function e(){var t=this.context,a=this.loader,r=this.stats;if(t&&a){var n=a.readyState,d=this.config;if(!r.aborted&&2<=n&&(0===r.loading.first&&(r.loading.first=c(self.performance.now(),r.loading.start),d.timeout!==d.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),d.timeout=d.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),d.loadPolicy.maxLoadTimeMs-(r.loading.first-r.loading.start)))),4===n)){self.clearTimeout(this.requestTimeout),a.onreadystatechange=null,a.onprogress=null;var i=a.status,o="text"!==a.responseType;if(200<=i&&300>i&&(o&&a.response||null!==a.responseText)){r.loading.end=c(self.performance.now(),r.loading.first);var s=o?a.response:a.responseText,l="arraybuffer"===a.responseType?s.byteLength:s.length;if(r.loaded=r.total=l,r.bwEstimate=8e3*r.total/(r.loading.end-r.loading.first),!this.callbacks)return;var u=this.callbacks.onProgress;if(u&&u(r,t,s,a),!this.callbacks)return;var f={url:a.responseURL,data:s,code:i};this.callbacks.onSuccess(f,r,t,a)}else{var g=d.loadPolicy.errorRetry,m=r.retry;qe(g,m,!1,i)?this.retry(g):(Da.error(i+" while loading "+t.url),this.callbacks.onError({code:i,text:a.statusText},t,a,r))}}}},t.loadtimeout=function e(){var t=null==(r=this.config)?void 0:r.loadPolicy.timeoutRetry,a=this.stats.retry,r;if(qe(t,a,!0))this.retry(t);else{Da.warn("timeout while loading "+this.context.url);var n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}},t.retry=function t(e){var a=this.context,r=this.stats;this.retryDelay=We(e,r.retry),r.retry++,Da.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+a.url+", retrying "+r.retry+"/"+e.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},t.loadprogress=function t(e){var a=this.stats;a.loaded=e.loaded,e.lengthComputable&&(a.total=e.total)},t.getCacheAge=function e(){var t=null;if(this.loader&&Hn.test(this.loader.getAllResponseHeaders())){var a=this.loader.getResponseHeader("age");t=a?parseFloat(a):null}return t},t.getResponseHeader=function t(e){return this.loader&&new RegExp("^"+e+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null},e}(),Wn=function(){function e(){this.chunks=[],this.dataLength=0}var t=e.prototype;return t.push=function t(e){this.chunks.push(e),this.dataLength+=e.length},t.flush=function e(){var t=this.chunks,a=this.dataLength,r;return t.length?(r=1===t.length?t[0]:oa(t,a),this.reset(),r):new Uint8Array(0)},t.reset=function e(){this.chunks.length=0,this.dataLength=0},e}(),Yn=/(\d+)-(\d+)\/(\d+)/,qn=function(){function e(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||ga,this.controller=new self.AbortController,this.stats=new xa}var t=e.prototype;return t.destroy=function e(){this.loader=this.callbacks=null,this.abortInternal()},t.abortInternal=function e(){var t=this.response;null!=t&&t.ok||(this.stats.aborted=!0,this.controller.abort())},t.abort=function e(){var t;this.abortInternal(),null!=(t=this.callbacks)&&t.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},t.load=function r(e,t,a){var n=this,d=this.stats;if(d.loading.start)throw new Error("Loader can only be used once.");d.loading.start=self.performance.now();var i=la(e,this.controller.signal),o=a.onProgress,s="arraybuffer"===e.responseType,l=s?"byteLength":"length",u=t.loadPolicy,f=u.maxTimeToFirstByteMs,g=u.maxLoadTimeMs;this.context=e,this.config=t,this.callbacks=a,this.request=this.fetchSetup(e,i),self.clearTimeout(this.requestTimeout),t.timeout=f&&Ea(f)?f:g,this.requestTimeout=self.setTimeout(function(){n.abortInternal(),a.onTimeout(d,e,n.response)},t.timeout),self.fetch(this.request).then(function(r){n.response=n.loader=r;var i=c(self.performance.now(),d.loading.start);if(self.clearTimeout(n.requestTimeout),t.timeout=g,n.requestTimeout=self.setTimeout(function(){n.abortInternal(),a.onTimeout(d,e,n.response)},g-(i-d.loading.start)),!r.ok){var l=r.status,u=r.statusText;throw new zn(u||"fetch, bad network response",l,r)}return d.loading.first=i,d.total=fa(r.headers)||d.total,o&&Ea(t.highWaterMark)?n.loadProgressively(r,d,e,t.highWaterMark,o):s?r.arrayBuffer():"json"===e.responseType?r.json():r.text()}).then(function(r){var i=n.response;self.clearTimeout(n.requestTimeout),d.loading.end=c(self.performance.now(),d.loading.first);var s=r[l];s&&(d.loaded=d.total=s);var u={url:i.url,data:r,code:i.status};o&&!Ea(t.highWaterMark)&&o(d,e,r,i),a.onSuccess(u,d,e,i)}).catch(function(t){if(self.clearTimeout(n.requestTimeout),!d.aborted){var r=t?t.code||0:0,i=t?t.message:null;a.onError({code:r,text:i},e,t?t.details:null,d)}})},t.getCacheAge=function e(){var t=null;if(this.response){var a=this.response.headers.get("age");t=a?parseFloat(a):null}return t},t.getResponseHeader=function t(e){return this.response?this.response.headers.get(e):null},t.loadProgressively=function d(e,t,a,r,n){void 0===r&&(r=0);var i=new Wn,o=e.body.getReader(),s=function d(){return o.read().then(function(o){if(o.done)return i.dataLength&&n(t,a,i.flush(),e),Promise.resolve(new ArrayBuffer(0));var s=o.value,l=s.length;return t.loaded+=l,l<r||i.dataLength?(i.push(s),i.dataLength>=r&&n(t,a,i.flush(),e)):n(t,a,s,e),d()}).catch(function(){return Promise.reject()})};return s()},e}(),zn=function(e){function t(t,a,r){var n;return n=e.call(this,t)||this,n.code=void 0,n.details=void 0,n.code=a,n.details=r,n}return v(t,e),t}(b(Error)),jn={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},Xn=y(y({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:60000000,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Vn,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Nn,bufferController:Un,capLevelController:Gn,errorController:Dr,fpsController:Kn,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:null,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:jn},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:jn},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},function e(){return{cueHandler:wa,enableWebVTT:!1,enableIMSC1:!1,enableCEA708Captions:!1,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}()),{},{subtitleStreamController:void 0,subtitleTrackController:void 0,timelineController:void 0,audioStreamController:void 0,audioTrackController:void 0,emeController:void 0,cmcdController:void 0,contentSteeringController:void 0}),Qn=function(){function e(t){void 0===t&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new bn,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,O(t.debug||!1,"Hls instance");var a=this.config=ca(e.DefaultConfig,t);this.userConfig=t,this._autoLevelCapping=-1,a.progressive&&pa(a);var r=a.abrController,n=a.bufferController,d=a.capLevelController,i=a.errorController,o=a.fpsController,s=new i(this),l=this.abrController=new r(this),u=this.bufferController=new n(this),f=this.capLevelController=new d(this),g=new o(this),c=new cr(this),m=new yr(this),p=a.contentSteeringController,y=p?new p(this):null,h=this.levelController=new br(this,y),E=new Ir(this),T=new Fr(this.config),L=this.streamController=new Pn(this,E,T);f.setStreamController(L),g.setStreamController(L);var v=[c,h,L];y&&v.splice(1,0,y),this.networkControllers=v;var S=[l,u,f,g,m,E];this.audioTrackController=this.createController(a.audioTrackController,v);var R=a.audioStreamController;R&&v.push(new R(this,E,T)),this.subtitleTrackController=this.createController(a.subtitleTrackController,v);var A=a.subtitleStreamController;A&&v.push(new A(this,E,T)),this.createController(a.timelineController,S),T.emeController=this.emeController=this.createController(a.emeController,S),this.cmcdController=this.createController(a.cmcdController,S),this.latencyController=this.createController(hr,S),this.coreComponents=S,v.push(s);var D=s.onErrorOut;"function"==typeof D&&this.on(Ta.ERROR,D,s)}e.isSupported=function e(){return ht()};var t=e.prototype;return t.createController=function a(e,t){if(e){var r=new e(this);return t&&t.push(r),r}return null},t.on=function r(e,t,a){void 0===a&&(a=this),this._emitter.on(e,t,a)},t.once=function r(e,t,a){void 0===a&&(a=this),this._emitter.once(e,t,a)},t.removeAllListeners=function t(e){this._emitter.removeAllListeners(e)},t.off=function n(e,t,a,r){void 0===a&&(a=this),this._emitter.off(e,t,a,r)},t.listeners=function t(e){return this._emitter.listeners(e)},t.emit=function r(e,t,a){return this._emitter.emit(e,t,a)},t.trigger=function r(t,a){if(this.config.debug)return this.emit(t,t,a);try{return this.emit(t,t,a)}catch(a){Da.error("An internal error happened while handling event "+t+". Error message: \""+a.message+"\". Here is a stacktrace:",a),this.trigger(Ta.ERROR,{type:La.OTHER_ERROR,details:va.INTERNAL_EXCEPTION,fatal:!1,event:t,error:a})}return!1},t.listenerCount=function t(e){return this._emitter.listenerCount(e)},t.destroy=function e(){Da.log("destroy"),this.trigger(Ta.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach(function(e){return e.destroy()}),this.networkControllers.length=0,this.coreComponents.forEach(function(e){return e.destroy()}),this.coreComponents.length=0;var t=this.config;t.xhrSetup=t.fetchSetup=void 0,this.userConfig=null},t.attachMedia=function t(e){Da.log("attachMedia"),this._media=e,this.trigger(Ta.MEDIA_ATTACHING,{media:e})},t.detachMedia=function e(){Da.log("detachMedia"),this.trigger(Ta.MEDIA_DETACHING,void 0),this._media=null},t.loadSource=function t(e){this.stopLoad();var a=this.media,r=this.url,n=this.url=ha.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});Da.log("loadSource:"+n),a&&r&&(r!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(a)),this.trigger(Ta.MANIFEST_LOADING,{url:e})},t.startLoad=function t(e){void 0===e&&(e=-1),Da.log("startLoad("+e+")"),this.networkControllers.forEach(function(t){t.startLoad(e)})},t.stopLoad=function e(){Da.log("stopLoad"),this.networkControllers.forEach(function(e){e.stopLoad()})},t.swapAudioCodec=function e(){Da.log("swapAudioCodec"),this.streamController.swapAudioCodec()},t.recoverMediaError=function e(){Da.log("recoverMediaError");var t=this._media;this.detachMedia(),t&&this.attachMedia(t)},t.removeLevel=function a(e,t){void 0===t&&(t=0),this.levelController.removeLevel(e,t)},E(e,[{key:"levels",get:function e(){var t=this.levelController.levels;return t?t:[]}},{key:"currentLevel",get:function e(){return this.streamController.currentLevel},set:function t(e){Da.log("set currentLevel:"+e),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function e(){return this.streamController.nextLevel},set:function t(e){Da.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function e(){return this.levelController.level},set:function t(e){Da.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function e(){return this.levelController.nextLoadLevel},set:function t(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function e(){return c(this.levelController.firstLevel,this.minAutoLevel)},set:function t(e){Da.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function e(){return this.levelController.startLevel},set:function t(e){Da.log("set startLevel:"+e),-1!==e&&(e=c(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function e(){return this.config.capLevelToPlayerSize},set:function t(e){var a=!!e;a!==this.config.capLevelToPlayerSize&&(a?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=a)}},{key:"autoLevelCapping",get:function e(){return this._autoLevelCapping},set:function t(e){this._autoLevelCapping!==e&&(Da.log("set autoLevelCapping:"+e),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function e(){var t=this.abrController.bwEstimator;return t?t.getEstimate():NaN}},{key:"ttfbEstimate",get:function e(){var t=this.abrController.bwEstimator;return t?t.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function e(){return this._maxHdcpLevel},set:function t(e){-1<Er.indexOf(e)&&(this._maxHdcpLevel=e)}},{key:"autoLevelEnabled",get:function e(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function e(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function e(){var t=this.levels,a=this.config.minAutoBitrate;if(!t)return 0;for(var r=t.length,n=0;n<r;n++)if(t[n].maxBitrate>=a)return n;return 0}},{key:"maxAutoLevel",get:function e(){var t=this.levels,a=this.autoLevelCapping,r=this.maxHdcpLevel,n;if(n=-1===a&&t&&t.length?t.length-1:a,r)for(var d=n,o;d--;)if(o=t[d].attrs["HDCP-LEVEL"],o&&o<=r)return d;return n}},{key:"nextAutoLevel",get:function e(){return s(c(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function t(e){this.abrController.nextAutoLevel=c(this.minAutoLevel,e)}},{key:"playingDate",get:function e(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function e(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function e(){var t=this.audioTrackController;return t?t.audioTracks:[]}},{key:"audioTrack",get:function e(){var t=this.audioTrackController;return t?t.audioTrack:-1},set:function t(e){var a=this.audioTrackController;a&&(a.audioTrack=e)}},{key:"subtitleTracks",get:function e(){var t=this.subtitleTrackController;return t?t.subtitleTracks:[]}},{key:"subtitleTrack",get:function e(){var t=this.subtitleTrackController;return t?t.subtitleTrack:-1},set:function t(e){var a=this.subtitleTrackController;a&&(a.subtitleTrack=e)}},{key:"media",get:function e(){return this._media}},{key:"subtitleDisplay",get:function e(){var t=this.subtitleTrackController;return!!t&&t.subtitleDisplay},set:function t(e){var a=this.subtitleTrackController;a&&(a.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function e(){return this.config.lowLatencyMode},set:function t(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function e(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function e(){return this.latencyController.latency}},{key:"maxLatency",get:function e(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function e(){return this.latencyController.targetLatency}},{key:"drift",get:function e(){return this.latencyController.drift}},{key:"forceStartLoad",get:function e(){return this.streamController.forceStartLoad}}],[{key:"version",get:function e(){return"1.4.12"}},{key:"Events",get:function e(){return Ta}},{key:"ErrorTypes",get:function e(){return La}},{key:"ErrorDetails",get:function e(){return va}},{key:"DefaultConfig",get:function t(){return e.defaultConfig?e.defaultConfig:Xn},set:function a(t){e.defaultConfig=t}}]),e}();return Qn.defaultConfig=void 0,Qn})})(!1);