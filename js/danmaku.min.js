!function(){function a(a){return fetch("https://api.live.bilibili.com/room/v1/Room/room_init?id="+a,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(a=>{if(0===a.code){let c={room_id:a.data.room_id,uid:a.data.uid};return b(c)}throw a})}function b(a){return fetch(`http://api.live.bilibili.com/xlive/web-room/v1/index/getDanmuInfo?id=${a.room_id}`,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(b=>{if(0===b.code){let c=b.data;return c.room_id=a.room_id,c.uid=a.uid,c}return{}}).catch(()=>({}))}function c(a){chrome.cookies.get({url:"https://www.bilibili.com/",name:"DedeUserID"},b=>{chrome.cookies.get({url:"https://www.bilibili.com/",name:"buvid3"},c=>{f?(f=!1,d.connect({uid:b.value-0,room_id:a.room_id,token:a.token,biggest_list:100,buvid:c.value})):d.setNewRoom({uid:b.value-0,room_id:a.room_id,token:a.token,biggest_list:100,buvid:c.value}),d.setOwnerUID(a.uid)})})}let d=new DanmakuWSS(document.getElementById("danmaku-list")),e=-1,f=!0,g=document.getElementById("add-room");g.onclick=async()=>{let b=document.getElementById("room-id-value").value;if(e!==b-0){d.__sent_system_package(`正在获取${b}的房间信息`),e=b;let f=await a(b-0);console.log("Grab room info:"),console.log(f),c(f)}}}();