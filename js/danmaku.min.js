!function(){async function a(){const a=document.getElementById("room-id-value").value;if(j!==a-0){i.__sent_system_package(`正在获取${a}的房间信息`),j=a;let c=await b(a-0);console.log("Grab room info:"),console.log(c),d(c)}}function b(a){return fetch("https://api.live.bilibili.com/room/v1/Room/room_init?id="+a,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(a=>{if(0===a.code){let b={};return b.room_id=a.data.room_id,b.uid=a.data.uid,q=a.data.room_id,h(4,document.getElementById("danmaku-emoji-panel"),document.getElementById("danmaku-value"),q),c(b)}throw a})}function c(a){return fetch(`http://api.live.bilibili.com/xlive/web-room/v1/index/getDanmuInfo?id=${a.room_id}`,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(b=>{if(0===b.code){let c=b.data;return c.room_id=a.room_id,c.uid=a.uid,c}return{}}).catch(()=>({}))}function d(a){chrome.cookies.get({url:"https://www.bilibili.com/",name:"DedeUserID"},b=>{chrome.cookies.get({url:"https://www.bilibili.com/",name:"buvid3"},c=>{k?(k=!1,i.connect({uid:b.value-0,room_id:a.room_id,token:a.token,biggest_list:100,buvid:c.value})):i.setNewRoom({uid:b.value-0,room_id:a.room_id,token:a.token,biggest_list:100,buvid:c.value}),i.setOwnerUID(a.uid)})})}function e(a){return fetch("https://api.live.bilibili.com/xlive/web-room/v1/index/getInfoByUser?from=0&room_id="+a,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(a=>(0===a.code&&(r=0==a.data.privilege.privilege_type-1+1?4:a.data.privilege.privilege_type,s=a.data.info.uid,t=a.data.property.danmu.length,o.innerText=` 0/${t}`),0)).catch(()=>{})}function f(){return Math.round(Date.now()/1e3)}function g(a,b=0){let c=new FormData;c.append("bubble","0"),c.append("msg",a),c.append("color","16777215"),c.append("mode","1"),0!==b&&c.append("dm_type","1"),c.append("fontsize","25"),c.append("rnd",f()+""),c.append("roomid",q),c.append("csrf",p),c.append("csrf_token",p),fetch("https://api.live.bilibili.com/msg/send?requestFrom=rua5",{method:"POST",credentials:"include",body:c}).then(a=>a.json()).then(()=>{}).catch(()=>{})}function h(a,b,c,d){e(d).then(()=>{fetch("https://api.live.bilibili.com/xlive/web-ucenter/v2/emoticon/GetEmoticons?platform=pc&room_id="+q,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(a=>{if(0===a.code){b.innerHTML="";const d=document.createElement("div"),f=document.createElement("div");f.classList.add("rua-emoji-header"),d.appendChild(f),b.appendChild(d),f.addEventListener("wheel",a=>{f.scrollLeft+=a.deltaY,a.preventDefault()});const h=a.data.data;u>h.length&&(u=0);for(let a=0;a<h.length;a++){const d=document.createElement("div");d.classList.add("rua-header-item");const e=document.createElement("div");e.classList.add("rua-emoji-container"),a===u&&(d.classList.add("active"),e.style.display="flex"),d.innerHTML+=`<img src="${h[a].current_cover}"></div>`,d.onclick=()=>{for(let a=0;a<f.childNodes.length;a++)f.childNodes.item(a).classList.remove("active"),b.getElementsByClassName("rua-emoji-container")[a].style.display="none",f.childNodes.item(a)===d&&(b.getElementsByClassName("rua-emoji-container")[a].style.display="flex",u=a);d.classList.add("active")},f.appendChild(d);for(let b=0;b<h[a].emoticons.length;b++){const d=document.createElement("div");d.classList.add("rua-emoji-icon"),d.classList.add("rua-emoji-item"),d.title=h[a].emoticons[b].emoji,0===a&&d.classList.add("rua-emoji-item-xs"),d.innerHTML+=`<div class="rua-emoji-requirement" style="background-color: ${h[a].emoticons[b].unlock_show_color};"><div class="rua-emoji-requirement-text">${h[a].emoticons[b].unlock_show_text}</div></div><img class="${1===h[a].emoticons[b].perm?"rua-emoji-icon-active":"rua-emoji-icon-inactive-new"}" src="${h[a].emoticons[b].url}">`,d.onclick=()=>{if(d.classList.contains("rua-emoji-icon-inactive-new")||0===a||g(h[a].emoticons[b].emoticon_unique,1),0===a){if(c.selectionStart===c.selectionEnd)c.value=c.value.substring(0,c.selectionStart)+d.title+c.value.substring(c.selectionEnd,c.value.length);else{let a=c.value.substring(0,c.selectionStart),b=c.value.substring(c.selectionEnd,c.value.length);c.value=a+d.title+b}c.focus()}},e.append(d)}b.appendChild(e)}}})})}let i=new DanmakuWSS(document.getElementById("danmaku-list")),j=-1,k=!0;const l=document.getElementById("add-room");l.onclick=async()=>{await a()};const m=document.getElementById("room-id-value");m.onkeyup=async b=>{"Enter"===b.key&&(await a())};const n=document.getElementById("danmaku-value"),o=document.getElementById("danmaku-length");let p=-1,q=-1,r=-1,s=-1,t=20,u=0;!function(){try{chrome.runtime.sendMessage({msg:"get_LoginInfo"},function(a){p=a.res.split(",")[0]})}catch(a){}e(337374)}(),n.addEventListener("keyup",a=>{"Enter"===a.key&&0<n.value.length&&(g(n.value),n.value=""),o.innerText=`${9<n.value.length?n.value.length:" "+n.value.length}/${t}`});let v=[];chrome.storage.sync.get(["dm-ban-word"],a=>{v=a["dm-ban-word"]});const w=document.getElementById("ban-word-value"),x=document.getElementById("add-ban-word")}();