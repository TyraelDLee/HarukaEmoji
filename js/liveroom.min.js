!function(){function a(){document.getElementsByClassName('panel-container')[0].style.zIndex='-1',document.getElementsByClassName('panel-container')[0].style.display='none',document.getElementsByClassName('following-block')[0].innerHTML=''}function b(){j.parentNode.style.opacity='0',m.style.opacity='0'}function c(){fetch('https://api.bilibili.com/x/v2/reply/at',{method:'GET',credentials:'include',body:null}).then((a)=>a.json()).then((a)=>{let b=[];if(0===a.code)for(let c=0;c<a.data.groups.length;c++)for(let d=0;d<a.data.groups[''+c].items.length;d++)b.push(a.data.groups[''+c].items[d+''].mid);return b}).then((b)=>{fetch('https://api.live.bilibili.com/room/v1/Room/get_status_info_by_uids?requestFrom=rua5',{method:'POST',credentials:'omit',body:'{"uids": ['+b+']}'}).then((a)=>a.json()).then((c)=>{if(0===c.code){let d=c.data,f=document.getElementsByClassName('following-block')[0];for(let c=0;c<b.length;c++)if(d[b[c]]!==void 0&&1===d[b[c]].live_status){let g=d[b[c]],h=document.createElement('div');h.classList.add('following-liver'),h.innerHTML=`<div class="user-face"><img src="${g.face}"></div><div class="following-room-info"><span class="room-title">${g.title}</span><span class="user-name">${g.uname}</span></div>`,f.append(h),h.addEventListener('click',()=>{e(g),a()})}}})})}function d(a){let b=[a.offsetLeft,a.offsetTop],c=a.offsetParent;for(;null!==c;)b[0]+=c.offsetLeft,b[1]+=c.offsetTop+c.clientTop,c=c.offsetParent;return b[0]+=a.clientWidth-60,b[1]+=a.clientHeight-60,b}function e(a){function b(a,d){function f(d,g,h){flvjs.isSupported()&&(c=flvjs.createPlayer({type:'flv',isLive:!0,url:d[h].url}),c.attachMediaElement(g),g.addEventListener('sourceended',()=>{console.log('source ended')}),c.load(),c.play(),c.on(flvjs.Events.ERROR,(i)=>{console.log('error'),console.log(i),++h,c.unload(),h===d.length?b(a,g):f(d,g,h)}))}fetch(`https://api.live.bilibili.com/room/v1/Room/playUrl?cid=${a}&qn=10000`,{method:'GET',credentials:'include',body:null}).then((a)=>a.json()).then((a)=>{0===a.code&&f(a.data.durl,d,0)}).catch((c)=>{b(a,d),console.log(c)})}let c=null;if(16>p.size&&!p.has(a.uid)){p.set(a.uid,a);let c=document.createElement('video'),e=null;if(3>p.size||5===p.size)e=document.getElementsByClassName('video-container-colum')[0];else if(5>p.size||6===p.size){e=document.getElementsByClassName('video-container-colum')[1];for(let a=0;a<document.getElementsByClassName('video-container-colum').length;a++)document.getElementsByClassName('video-container-colum')[a].style.height='50%'}else if(10>p.size){e=document.getElementsByClassName('video-container-colum')[2];for(let a=0;a<document.getElementsByClassName('video-container-colum').length;a++)document.getElementsByClassName('video-container-colum')[a].style.height='33.33%'}else{e=document.getElementsByClassName('video-container-colum')[3];for(let a=0;a<document.getElementsByClassName('video-container-colum').length;a++)document.getElementsByClassName('video-container-colum')[a].style.height='25%'}e.style.display='flex';let f=document.createElement('div');f.classList.add('video-stream'),f.append(c);let h=document.createElement('div');h.setAttribute('style',`display: block; position: absolute; bottom: 0px; width: 100%; height: 56px; background-image: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.7)); visibility: visible;`),f.append(h);let i=document.createElement('div');i.innerHTML+=`
            <div style="position: relative; user-select: none; z-index: 5">
                <div class="control-area">
                    <div class="left">
                        <div class="volume">
                            <div class="volume-control" style="display: none">
                                <div class="vertical-slider">
                                    <div class="number">100</div>
                                        <div class="slider-rail">
                                            <div class="slider-handle" style="top: 0px;"></div>
                                            <div class="slider-track" style="height: 100%;"></div>
                                        </div>
                                </div>
                            </div>
                            <span class="icon">
                                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 36 36" style="enable-background:new 0 0 36 36; display: none;" xml:space="preserve">
                                    <path class="st0" d="M25.8,25.8c0.4,0.4,0.4,1,0,1.4s-1,0.4-1.4,0l-2.3-2.3c-0.2,0.1-0.4,0.2-0.6,0.3c-0.5,0.2-1.1,0-1.3-0.5\tc-0.2-0.5,0-1.1,0.5-1.3l0,0l-2.6-2.6v3.1c0,0.3-0.2,0.5-0.5,0.5c-0.1,0-0.2,0-0.3-0.1l-4.2-3.4h-1c-1.1,0-2-0.9-2-2v-2\tc0-1.1,0.9-2,2-2h0.2l-3.4-3.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0L25.8,25.8z"></path>
                                    <path class="st0" d="M21.4,10.8c4,1.9,5.7,6.7,3.8,10.7c-0.1,0.2-0.2,0.4-0.3,0.6l-1.5-1.5c1.4-3,0.2-6.6-2.8-8l0,0\tc-0.5-0.2-0.7-0.8-0.5-1.3l0,0C20.4,10.7,21,10.5,21.4,10.8z"></path>  <path class="st0" d="M20,14.5c1.2,0.7,2,2,2,3.5c0,0.3,0,0.7-0.1,1L20,17.1V14.5z"></path>
                                    <path class="st0" d="M17.9,11.7C18,11.8,18,11.9,18,12v3.1l-2.3-2.3l1.5-1.2C17.4,11.5,17.7,11.5,17.9,11.7z"></path>
                                </svg>
                                <svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 36 36" style="enable-background:new 0 0 36 36;" xml:space="preserve">
                                    <path class="st0" d="M20,14.5c1.9,1.1,2.6,3.6,1.5,5.5c-0.3,0.6-0.9,1.1-1.5,1.5V14.5z"></path>
                                    <path class="st0" d="M21.4,10.7c4,1.9,5.7,6.7,3.8,10.7c-0.8,1.7-2,3-3.7,3.8c-0.5,0.2-1.1,0-1.3-0.5l0,0c-0.2-0.5,0-1.1,0.5-1.3\tc2.9-1.5,4.1-4.9,2.7-8c-0.6-1.2-1.6-2.3-2.8-2.8c-0.5-0.2-0.7-0.8-0.5-1.3S20.8,10.5,21.4,10.7C21.3,10.7,21.3,10.7,21.4,10.7\tL21.4,10.7z"></path>
                                    <path class="st0" d="M17.9,11.7c0.1,0.1,0.1,0.1,0.1,0.2l0.1,12c0,0.3-0.2,0.5-0.5,0.5c-0.1,0-0.2,0-0.3-0.1l-4.2-3.4h-1\tc-1.1,0-2-0.9-2-2v-2c0-1.1,0.9-2,2-2h1l4.1-3.3C17.4,11.5,17.7,11.5,17.9,11.7L17.9,11.7z"></path>
                                </svg>
                            </span>
                        </div>
                    </div>
                </div>
            </div>`;let j=100,k=j,l=!1;i.getElementsByClassName('volume')[0].onmouseenter=()=>{i.getElementsByClassName('volume-control')[0].style.display='block'},i.getElementsByClassName('volume')[0].onmouseleave=()=>{q||(i.getElementsByClassName('volume-control')[0].style.display='none')};let m=i.getElementsByClassName('slider-rail')[0];m.onmousedown=(a)=>{a.stopPropagation(),q=!0;let b=d(m)[1]-100;0<=a.y-b&&53>=a.y-b&&(m.getElementsByClassName('slider-handle')[0].style.top=a.y-b+'px',j=g(100*(1-(a.y-b)/53)),i.getElementsByClassName('number')[0].innerText=j,m.getElementsByClassName('slider-track')[0].style.height=j+'%',c.volume=j/100,0===j?(l=!l,k=j,i.getElementsByClassName('icon')[0].getElementsByTagName('svg')[1].style.display='none',i.getElementsByClassName('icon')[0].getElementsByTagName('svg')[0].style.display='block'):(l=!1,i.getElementsByClassName('icon')[0].getElementsByTagName('svg')[0].style.display='none',i.getElementsByClassName('icon')[0].getElementsByTagName('svg')[1].style.display='block')),m.onmousemove=(a)=>{a.stopPropagation(),0<=a.y-b&&53>=a.y-b&&(m.getElementsByClassName('slider-handle')[0].style.transition='none',m.getElementsByClassName('slider-track')[0].style.transition='none',m.getElementsByClassName('slider-handle')[0].style.top=a.y-b+'px',j=g(100*(1-(a.y-b)/53)),i.getElementsByClassName('number')[0].innerText=j,m.getElementsByClassName('slider-track')[0].style.height=j+'%',c.volume=j/100,0===j?(l=!l,k=j,i.getElementsByClassName('icon')[0].getElementsByTagName('svg')[1].style.display='none',i.getElementsByClassName('icon')[0].getElementsByTagName('svg')[0].style.display='block'):(l=!1,i.getElementsByClassName('icon')[0].getElementsByTagName('svg')[0].style.display='none',i.getElementsByClassName('icon')[0].getElementsByTagName('svg')[1].style.display='block'))},m.onmouseup=(a)=>{a.stopPropagation(),m.onmousemove=null,m.onmouseup=null,m.getElementsByClassName('slider-handle')[0].style.transition='',m.getElementsByClassName('slider-track')[0].style.transition='',q=!1},m.onmouseleave=(a)=>{a.stopPropagation(),m.onmousemove=null,m.onmouseup=null,m.getElementsByClassName('slider-handle')[0].style.transition='',m.getElementsByClassName('slider-track')[0].style.transition=''}},i.getElementsByClassName('volume')[0].addEventListener('wheel',(a)=>{j+=a.deltaY,100<j&&(j=100),0>j&&(j=0),c.volume=j/100,i.getElementsByClassName('number')[0].innerText=j,m.getElementsByClassName('slider-handle')[0].style.top=53-53*(j/100)+'px',m.getElementsByClassName('slider-track')[0].style.height=j+'%'}),i.getElementsByClassName('icon')[0].addEventListener('mouseup',(a)=>{a.stopPropagation(),l?(i.getElementsByClassName('icon')[0].getElementsByTagName('svg')[0].style.display='none',i.getElementsByClassName('icon')[0].getElementsByTagName('svg')[1].style.display='block',j=k):(i.getElementsByClassName('icon')[0].getElementsByTagName('svg')[1].style.display='none',i.getElementsByClassName('icon')[0].getElementsByTagName('svg')[0].style.display='block',k=j,j=0),l=!l,c.volume=j/100,i.getElementsByClassName('number')[0].innerText=j,m.getElementsByClassName('slider-handle')[0].style.top=53-53*(j/100)+'px',m.getElementsByClassName('slider-track')[0].style.height=j+'%'}),i.classList.add('video-player-control'),f.append(i),e.append(f),b(a.room_id,c)}}function f(){try{chrome.runtime.sendMessage({msg:'get_LoginInfo'},function(a){i=a.res.split(',')[0],h=a.res.split(',')[1]})}catch(a){}}var g=Math.round;let h,i,j=null,k=null,l=null,m=document.getElementsByClassName('control-bar')[0],n=null,o=!1,p=new Map,q=!1;f(),setInterval(f,3e3),!function(){j=document.getElementsByClassName('add-room')[0].getElementsByTagName('svg')[0],l=document.getElementsByClassName('setting')[0].getElementsByTagName('svg')[0],k=document.getElementsByClassName('fullscreen')[0].getElementsByTagName('svg')[0],document.body.addEventListener('mousemove',()=>{clearTimeout(n),console.log('moved'),j.parentNode.style.opacity='1',m.style.opacity='1',n=setTimeout(b,1e3)}),document.body.addEventListener('mouseup',()=>{for(let a=0;a<document.body.getElementsByClassName('volume-control').length;a++)document.body.getElementsByClassName('volume-control')[0].style.display='none'}),j.addEventListener('click',()=>{console.log('clicked'),document.getElementsByClassName('panel-container')[0].removeEventListener('click',a),document.getElementsByClassName('panel-container')[0].style.zIndex='10',document.getElementsByClassName('panel-container')[0].style.display='block',document.getElementsByClassName('panel-container')[0].addEventListener('click',a),document.getElementsByClassName('add-room-panel')[0].addEventListener('click',(a)=>{a.stopPropagation()}),c()}),l.addEventListener('click',()=>{o?document.exitFullscreen().then(()=>{o=!1}).catch(()=>{document.body.requestFullscreen().then(),o=!0}):document.body.requestFullscreen().then(()=>{o=!0}).catch(()=>{document.exitFullscreen().then(),o=!1})})}()}();