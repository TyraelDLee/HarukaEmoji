!function(){var t=Math.round;function a(){chrome.storage.local.get(["tempRoomNumber"],e=>{if(-1!==e.tempRoomNumber){let t=e.tempRoomNumber;chrome.storage.local.set({tempRoomNumber:-1},()=>{}),u(t).then(e=>{if(1!==e.liveStatus)throw e;else o([e.up],!0)}).catch(t=>{console.log(t)})}})}function n(){document.getElementsByClassName("panel-container")[0].style.zIndex="-1",document.getElementsByClassName("panel-container")[0].style.display="none",document.getElementsByClassName("add-room-panel")[0].style.display="none",document.getElementsByClassName("setting-panel")[0].style.display="none",document.getElementsByClassName("following-block")[0].innerHTML="",document.getElementsByClassName("add-room-panel")[0].getElementsByClassName("room-input")[0].getElementsByTagName("input")[0].onkeyup=null,document.getElementsByClassName("add-room-panel")[0].getElementsByClassName("room-input")[0].getElementsByTagName("input")[0].value="",document.getElementsByClassName("add-room-panel")[0].getElementsByClassName("room-input")[0].getElementsByTagName("input")[0].classList.contains("error-input")&&(document.getElementsByClassName("add-room-panel")[0].getElementsByClassName("room-input")[0].getElementsByTagName("input")[0].classList.remove("error-input"),document.getElementsByClassName("add-room-panel")[0].getElementsByClassName("room-input")[0].getElementsByTagName("span")[0].innerHTML="",document.getElementsByClassName("add-room-panel")[0].getElementsByClassName("room-input")[0].getElementsByTagName("span")[0].removeAttribute("style"))}function s(){T.style.opacity="0",w.style.visibility="hidden",0<I.size&&document.querySelectorAll(".video-owner-info-container")[0].classList.remove("video-owner-info-always-on-first-child")}async function l(){if(-1!=B-0){function e(a){fetch(`https://api.bilibili.com/x/relation/followings?vmid=${B}&pn=${a}&ps=50&order=desc&order_type=attention`,{method:"GET",credentials:"include",body:null}).then(e=>e.json()).then(n=>{if(0===n.code){const s=n.data.list;for(const e of s)t.push(e.mid);50===s.length?e(a+1):o(t)}})}let t=[];fetch(`https://api.bilibili.com/x/polymer/web-dynamic/v1/mention/search`,{method:"GET",credentials:"include",body:null}).then(e=>e.json()).then(e=>{if(0==e.code-0){for(const a of e.data.groups[0].items)t.push(a.uid);if("undefined"!=typeof e.data.groups[1])for(const a of e.data.groups[1].items)t.push(a.uid);o(t)}}).catch(t=>{})}}function i(e){fetch(`https://api.live.bilibili.com/av/v1/VideoConnection/onlineSearch?page=1&pagesize=20&search=${e}&type=1&platform=h5&build=1`,{method:"GET",credentials:"include",body:null}).then(e=>e.json()).then(e=>{if(0===e.code){let t=e.data.list;console.log(t);let a=[];for(let e=0;e<t.length;e++)a.push(t[e].uid);console.log(a),o(a,!1)}}).catch(t=>{})}function o(e,t=!1){let a="{\"uids\": ["+e+"]}";fetch("https://api.live.bilibili.com/room/v1/Room/get_status_info_by_uids?requestFrom=rua5",{method:"POST",credentials:"omit",body:a}).then(e=>e.json()).then(a=>{if(0===a.code){let s=a.data,l=document.getElementsByClassName("following-block")[0];if(1===e.length&&t){let t=s[e[0]];r(t),n()}else if(t){for(let t=0;t<e.length;t++)if(1===s[e[t]].live_status){let a=s[e[t]];r(a),n()}}else{V=[];for(const e of I.keys())V.push(e);for(let t=0;t<e.length;t++)if(void 0!==s[e[t]]&&1===s[e[t]].live_status){let a=s[e[t]];d(a,l)}}}})}function d(e,t){let a=document.createElement("div");a.classList.add("following-liver"),a.innerHTML=`<div class="user-add-num"><span class=""></span></div><div class="user-face"><img src="${e.face}"></div><div class="following-room-info"><span class="room-title">${e.title}</span><div style="display: flex"><span class="user-name">${e.uname}</span><span> | </span><span>${e.area_v2_name}</span></div></div>`,t.append(a),-1!==V.indexOf(e.uid)&&(a.classList.add("selected"),a.classList.add("unchange"),a.getElementsByClassName("user-add-num")[0].getElementsByTagName("span")[0].innerText=V.indexOf(e.uid)+1+""),a.classList.contains("unchange")||a.addEventListener("click",()=>{if(!a.classList.contains("selected")&&16>V.length)a.classList.add("selected"),V.push(e.uid),a.getElementsByClassName("user-add-num")[0].getElementsByTagName("span")[0].innerText=V.length+"";else{a.classList.remove("selected");let t=V.indexOf(e.uid);V.splice(t,1);let n=a.parentElement.getElementsByClassName("following-liver");for(const e of n)e.classList.contains("selected")&&e.getElementsByClassName("user-add-num")[0].getElementsByTagName("span")[0].innerText-0>t&&(e.getElementsByClassName("user-add-num")[0].getElementsByTagName("span")[0].innerText=e.getElementsByClassName("user-add-num")[0].getElementsByTagName("span")[0].innerText-1)}})}function m(t){let e=[t.offsetLeft,t.offsetTop],a=t.offsetParent;for(;null!==a;)e[0]+=a.offsetLeft,e[1]+=a.offsetTop+a.clientTop,a=a.offsetParent;return e[0]+=t.clientWidth-60,e[1]+=t.clientHeight-60,e}async function r(a){function n(e,t){1===t?e.setAttribute("style",`--number-of-row:1; --number-of-column:1;`):2===t?e.setAttribute("style",`--number-of-row:1; --number-of-column:0.5;`):5>t?e.setAttribute("style",`--number-of-row:0.5; --number-of-column:0.5;`):7>t?e.setAttribute("style",`--number-of-row:0.5; --number-of-column:0.3333;`):10>t?e.setAttribute("style",`--number-of-row:0.3333; --number-of-column:0.3333;`):13>t?e.setAttribute("style",`--number-of-row:0.3333; --number-of-column:0.25;`):e.setAttribute("style",`--number-of-row:0.25; --number-of-column:0.25;`)}function s(e){let t=null===C.metadata;e.innerHTML=`
                    <div class="video-status-info-row">
                        <div class="video-status-info-title">Mime 类型:</div>
                        <div class="video-status-info-data">${C.mimeType}</div>
                    </div>
                    <div class="video-status-info-row">
                        <div class="video-status-info-title">视频信息:</div>
                        <div class="video-status-info-data">${C.width}x${C.height}, ${t?"null":C.metadata.framerate}FPS, ${t?"null":C.metadata.videodatarate}Kbps</div>
                    </div>
                    <div class="video-status-info-row">
                        <div class="video-status-info-title">音频信息:</div>
                        <div class="video-status-info-data">${(C.audioSampleRate-0)/1e3}KHz, ${2===C.audioChannelCount?"Stereo":C.audioChannelCount}, ${C.audioDataRate}Kbps</div>
                    </div>
                    <div class="video-status-info-row">
                        <div class="video-status-info-title">编码器:</div>
                        <div class="video-status-info-data">${t?"undefined":C.metadata.encoder}</div>
                    </div>
                    <div class="video-status-info-row">
                        <div class="video-status-info-title">视频编码:</div>
                        <div class="video-status-info-data">${C.videoCodec}</div>
                    </div>
                    <div class="video-status-info-row">
                        <div class="video-status-info-title">视频流源:</div>
                        <div class="video-status-info-data">${C.streamURL}</div>
                    </div>
                    <div class="video-status-info-row">
                        <div class="video-status-info-title">房间号:</div>
                        <div class="video-status-info-data">${C.trueID}</div>
                    </div>
                    <div class="video-status-info-row">
                        <div class="video-status-info-title">短房间号:</div>
                        <div class="video-status-info-data">${C.shortID}</div>
                    </div>`}function l(e,t,n){fetch(`https://api.live.bilibili.com/xlive/web-room/v2/index/getRoomPlayInfo?room_id=${e}&no_playurl=0&mask=1&qn=0&platform=web&protocol=0,1&format=0,1,2&codec=0,1&dolby=5&panorama=1`,{method:"GET",credentials:"include",signal:p.signal,body:null}).then(e=>e.json()).then(i=>{if(0===i.code){console.log(B);let o=null;if(o="undefined"==typeof i.data.playurl_info.playurl.stream[0].format[0].codec[1]?i.data.playurl_info.playurl.stream[0].format[0].codec[0]:i.data.playurl_info.playurl.stream[0].format[0].codec[1],d="http_hls"===i.data.playurl_info.playurl.stream[0].protocol_name,d)Hls.isSupported()?(r=new Hls,r.loadSource(o.url_info[n].host+o.base_url+o.url_info[n].extra),r.attachMedia(t),r.on(Hls.Events.MANIFEST_PARSED,function(){t.play()})):t.canPlayType("application/vnd.apple.mpegurl")&&(t.src=o.url_info[n].host+o.base_url+o.url_info[n].extra);else{r=mpegts.createPlayer({type:"flv",isLive:!0,url:o.url_info[n].host+o.base_url+o.url_info[n].extra}),r.attachMediaElement(t),r.load();try{r.play().catch(t=>{})}catch(t){}r.on(mpegts.Events.ERROR,a=>{B&&(r.unload(),E=setTimeout(()=>{let a=0===n?1:0;l(e,t,a)},1e3))}),r.on(mpegts.Events.MEDIA_INFO,t=>{C=t,C.streamURL=o.url_info[n].host,C.trueID=a.room_id,C.shortID=0===a.short_id?a.room_id:a.short_id,s(document.getElementById(`video-status-info-container-${e}`))})}}})}function i(e,t,n=0){function l(t,n,m){console.log(t);let c=null,u=t.url_info[m].host+t.base_url+t.url_info[m].extra;d?Hls.isSupported()?(o=new Hls,o.loadSource(u),o.attachMedia(n),o.on(Hls.Events.MANIFEST_PARSED,function(){n.play(),n.playbackRate=1}),r.detachMedia(),_.remove(),n.removeAttribute("style")):n.canPlayType("application/vnd.apple.mpegurl")&&(n.src=u):(o=mpegts.createPlayer({type:"flv",isLive:!0,url:u}),o.attachMediaElement(n),o.load(),o.play().catch(t=>{}),c=setTimeout(()=>{try{n.currentTime=n.buffered.end(0)-1}catch(t){}},2e3),o.on(mpegts.Events.ERROR,a=>{console.log(a),++m,o.unload(),clearTimeout(c),m===t.url_info.length?setTimeout(()=>{i(e,n)},1e3):l(t,n,m)}),o.on(mpegts.Events.MEDIA_INFO,l=>{console.log(l),C=l,C.streamURL=t.url_info[m].host,C.trueID=a.room_id,C.shortID=0===a.short_id?a.room_id:a.short_id,s(document.getElementById(`video-status-info-container-${e}`)),p.abort("no needed"),B=!1,null!==E&&(clearTimeout(E),E=null),r.destroy(),_.remove(),n.removeAttribute("style")}))}fetch(`https://api.live.bilibili.com/xlive/web-room/v2/index/getRoomPlayInfo?room_id=${e}&protocol=0&format=0,1,2&codec=0,1&platform=web&ptype=8&dolby=5&panorama=1&qn=${q}`,{method:"GET",credentials:"include",signal:g.signal,body:null}).then(e=>e.json()).then(a=>{if(0!==a.code)throw a.code;else if(null===a.data.playurl_info||null===a.data.playurl_info.playurl)d?o.detachMedia():o.destroy();else{let s=a.data.playurl_info.playurl.stream[0].format[0].codec[0],o=a.data.playurl_info.playurl.stream[0].format[0].codec[1];(null===o||"undefined"==typeof o)&&(o=s),(null===s||"undefined"==typeof s)&&(s=o),(null===o||"undefined"==typeof o)&&(null===s||"undefined"==typeof s)?i(e,t):l(s,t,n)}}).catch(a=>{console.log(a),g.signal.aborted||setTimeout(()=>{i(e,t)},1e3)})}console.log(a),-1===V.indexOf(a.uid)&&V.push(a.uid);let o=null,d=!1,r=null,g=new AbortController,p=new AbortController,E=null,f=null,B=!0,C={mimeType:"",width:"0",height:"0",fps:"NaN",videoDataRate:"0",audioSampleRate:0,audioChannelCount:"NaN",audioDataRate:"0",videoCodec:"NaN",metadata:{encoder:"NaN"},streamURL:"",trueID:a.room_id,shortID:0===a.short_id?a.room_id:a.short_id},b=!1,L=document.createElement("video");L.classList.add("video-player"),F&&(L.volume=G/100),L.setAttribute("style","display: none;");let _=document.createElement("video");if(_.classList.add("video-player"),_.classList.add("video-player-preview"),F&&(_.volume=G/100),16>I.size&&!I.has(a.uid)){function e(){R||M||b||(T.style.visibility="hidden",w.firstElementChild.style.display="none",z?k.classList.add("video-owner-info-always-on"):(k.style.display="none",k.classList.remove("video-owner-info-always-on")))}function r(){L.onpause=null,_.onpause=null,B.onmousemove=null,B.onclick=null,w.onmouseenter=null,w.onmouseleave=null,w.getElementsByClassName("volume")[0].onmouseenter=null,w.getElementsByClassName("volume")[0].onmouseleave=null,D.onmousedown=null,D.onmouseleave=null,D.onmousemove=null,D.onmouseup=null,w.getElementsByClassName("volume")[0].onwheel=null,w.getElementsByClassName("icon")[0].onmouseup=null,w.getElementsByClassName("close")[0].onclick=null,w.getElementsByClassName("asmr-button")[0].onclick=null,J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0].onkeyup,J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0].onkeydown,J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0].onselect=null,J.getElementsByClassName("send-danmaku")[0].onclick=null,w.getElementsByClassName("frame-chasing")[0].onclick=null,w.getElementsByClassName("refresh-stream")[0].onclick=null,C.disconnect(),U.onclick=null}I.set(a.uid,a),X.classList.remove("disabled");let E=document.getElementsByClassName("video-container")[0];n(E,I.size);let B=document.createElement("div"),C=new MutationObserver(async function(t){if(0<t.length){let e=t[0];if("attributes"===e.type&&null===L.getAttribute("src")){let e=await u(a.room_id);if(1===e.liveStatus)i(a.room_id,L,1);else{null!==o&&(d?o.detachMedia():o.destroy()),g.abort("user cancel"),console.log(`Stream ${a.uid} closed.`),r(),B.remove(),I.delete(a.uid);let e=V.indexOf(a.uid);V.splice(e,1),0===I.size&&X.classList.add("disabled"),n(E,I.size),null!==f&&f.stop()}}}});B.classList.add("video-stream"),B.append(L),B.append(_),L.onpause=()=>{L.play().catch(t=>{})},_.onpause=()=>{_.play().catch(t=>{})};let k=document.createElement("div");k.style.display=z?"flex":"none",k.classList.add("video-owner-info-container"),k.innerHTML=`
            
                <a class="owner-avatar" href="https://space.bilibili.com/${a.uid}" target="_blank"><img src="${a.face}"></a>
                <div class="owner-text-info">
                    <div class="owner-room-title"><a href="https://live.bilibili.com/${a.room_id}" target="_blank">${a.title}</a></div>
                    <div class="owner-misc">
                        <div class="owner-name"><a href="https://space.bilibili.com/${a.uid}" target="_blank">${a.uname}</a></div>
                        <div style="margin: 0 5px">|</div>
                        <div class="live-zone">${a.area_v2_name}</div>
                        <div style="margin: 0 5px">|</div>
                        <div class="live-status-btn" style="cursor: pointer" id="live-status-btn-${a.room_id}">显示统计信息</div>
                    </div>
                </div>
            
            `;let T=document.createElement("div");T.setAttribute("style",`display: block; position: absolute; bottom: 0px; width: 100%; height: 56px; background-image: linear-gradient(rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.7)); visibility: hidden;z-index:2`),B.append(T);let w=document.createElement("div");w.innerHTML+=`<div style="position: relative; user-select: none; z-index: 5; display: none"><div class="control-area"><div class="left"><div class="volume"><div class="volume-control ${F?"asmr":""}" style="display: none"><div class="vertical-slider"><div class="number">${F?G:100}</div><div class="slider-rail"><div class="rail-background"></div><div class="slider-handle" style="top: ${F?100-G:0}px;" vol="${F?G:100}" ovol="100"></div><div class="slider-track" style="height: ${F?G:100}%;"></div></div></div></div><span class="icon"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 36 36" style="enable-background:new 0 0 36 36; display: none;" xml:space="preserve"><path class="st0" d="M25.8,25.8c0.4,0.4,0.4,1,0,1.4s-1,0.4-1.4,0l-2.3-2.3c-0.2,0.1-0.4,0.2-0.6,0.3c-0.5,0.2-1.1,0-1.3-0.5\tc-0.2-0.5,0-1.1,0.5-1.3l0,0l-2.6-2.6v3.1c0,0.3-0.2,0.5-0.5,0.5c-0.1,0-0.2,0-0.3-0.1l-4.2-3.4h-1c-1.1,0-2-0.9-2-2v-2\tc0-1.1,0.9-2,2-2h0.2l-3.4-3.4c-0.4-0.4-0.4-1,0-1.4s1-0.4,1.4,0L25.8,25.8z"></path><path class="st0" d="M21.4,10.8c4,1.9,5.7,6.7,3.8,10.7c-0.1,0.2-0.2,0.4-0.3,0.6l-1.5-1.5c1.4-3,0.2-6.6-2.8-8l0,0\tc-0.5-0.2-0.7-0.8-0.5-1.3l0,0C20.4,10.7,21,10.5,21.4,10.8z"></path><path class="st0" d="M20,14.5c1.2,0.7,2,2,2,3.5c0,0.3,0,0.7-0.1,1L20,17.1V14.5z"></path><path class="st0" d="M17.9,11.7C18,11.8,18,11.9,18,12v3.1l-2.3-2.3l1.5-1.2C17.4,11.5,17.7,11.5,17.9,11.7z"></path></svg><svg version="1.1" xmlns="http://www.w3.org/2000/svg" x="0px" y="0px" viewBox="0 0 36 36" style="enable-background:new 0 0 36 36;" xml:space="preserve"><path class="st0" d="M20,14.5c1.9,1.1,2.6,3.6,1.5,5.5c-0.3,0.6-0.9,1.1-1.5,1.5V14.5z"></path><path class="st0" d="M21.4,10.7c4,1.9,5.7,6.7,3.8,10.7c-0.8,1.7-2,3-3.7,3.8c-0.5,0.2-1.1,0-1.3-0.5l0,0c-0.2-0.5,0-1.1,0.5-1.3\tc2.9-1.5,4.1-4.9,2.7-8c-0.6-1.2-1.6-2.3-2.8-2.8c-0.5-0.2-0.7-0.8-0.5-1.3S20.8,10.5,21.4,10.7C21.3,10.7,21.3,10.7,21.4,10.7\tL21.4,10.7z"></path><path class="st0" d="M17.9,11.7c0.1,0.1,0.1,0.1,0.1,0.2l0.1,12c0,0.3-0.2,0.5-0.5,0.5c-0.1,0-0.2,0-0.3-0.1l-4.2-3.4h-1\tc-1.1,0-2-0.9-2-2v-2c0-1.1,0.9-2,2-2h1l4.1-3.3C17.4,11.5,17.7,11.5,17.9,11.7L17.9,11.7z"></path></svg></span></div><div class="refresh-stream"><span class="icon"><svg viewBox="0 0 36 36" version="1.1" xmlns="http://www.w3.org/2000/svg"><g id="终稿" stroke="none" stroke-width="1" fill-rule="evenodd" opacity="0.9"><g id="图标切图" transform="translate(-475.000000, -74.000000)" fill-rule="nonzero"><g id="编组-3" transform="translate(421.000000, 56.000000)"><g id="编组-12" transform="translate(54.000000, 18.000000)"><g id="icon_刷新" transform="translate(11.000000, 9.000000)"><path d="M1.1040804,5.51795009 L2.56593636,6.98003284 C2.20442812,7.67167421 2,8.45841034 2,9.29289322 C2,12.054317 4.23857625,14.2928932 7,14.2928932 L7,12.5 C7,12.3673918 7.05267842,12.2402148 7.14644661,12.1464466 C7.34170876,11.9511845 7.65829124,11.9511845 7.85355339,12.1464466 L7.85355339,12.1464466 L10.6464466,14.9393398 C10.8417088,15.134602 10.8417088,15.4511845 10.6464466,15.6464466 L10.6464466,15.6464466 L7.85355339,18.4393398 C7.7597852,18.533108 7.63260824,18.5857864 7.5,18.5857864 C7.22385763,18.5857864 7,18.3619288 7,18.0857864 L7,18.0857864 L7,16.2928932 C3.13400675,16.2928932 0,13.1588865 0,9.29289322 C0,7.90269507 0.405257589,6.6071499 1.1040804,5.51795009 Z M6.85355339,0.146446609 C6.94732158,0.240214799 7,0.367391755 7,0.5 L7,2.29289322 C10.8659932,2.29289322 14,5.42689997 14,9.29289322 C14,10.682663 13.5949921,11.977838 12.8965656,13.0668293 L11.4343158,11.6052711 C11.7956669,10.9137463 12,10.127182 12,9.29289322 C12,6.53146947 9.76142375,4.29289322 7,4.29289322 L7,6.08578644 C7,6.36192881 6.77614237,6.58578644 6.5,6.58578644 C6.36739176,6.58578644 6.2402148,6.53310802 6.14644661,6.43933983 L3.35355339,3.64644661 C3.15829124,3.45118446 3.15829124,3.13460197 3.35355339,2.93933983 L6.14644661,0.146446609 C6.34170876,-0.0488155365 6.65829124,-0.0488155365 6.85355339,0.146446609 Z" id="Combined-Shape"></path></g></g></g></g></g></svg></span></div><div class="frame-chasing"><div><span class="icon"><svg class="squirtle-svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22"><path d="M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z" style="transform: scale(0.75);transform-origin: center;"></path></svg></span></div></div></div><div class="danmaku"><div class="input-container"><input placeholder="发个弹幕呗～"><span>0/20</span></div><div class="send-danmaku">发送</div><div class="emoji-bg"></div><div class="emoji-sec"></div></div><div class="right"><div class="close"><div><span class="icon"><svg class="rua-cross" viewBox="0 0 100 100"><rect x="25" y="45" rx="5" ry="5" width="50" height="10" style="transform: rotate(45deg);"/><rect x="25" y="45" rx="5" ry="5" width="50" height="10" style="transform: rotate(135deg);"/></svg></span></div></div><div class="asmr-button" style="display: ${F?"block":"none"}">奥数</div></div></div></div>`;let x=100,j=x,A=!1,P=null,R=!1,M=!1;z?k.classList.add("video-owner-info-always-on"):k.classList.remove("video-owner-info-always-on"),B.onmousemove=()=>{clearTimeout(P),T.style.visibility="visible",w.firstElementChild.style.display="block",k.style.display="flex",z&&k.classList.remove("video-owner-info-always-on"),P=setTimeout(e,1e3)},B.onclick=()=>{e()},w.onmouseenter=()=>{R=!0},w.onmouseleave=()=>{R=!1},w.getElementsByClassName("volume")[0].onmouseenter=()=>{w.getElementsByClassName("volume-control")[0].style.display="block"},w.getElementsByClassName("volume")[0].onmouseleave=()=>{S||(w.getElementsByClassName("volume-control")[0].style.display="none")};let D=w.getElementsByClassName("slider-rail")[0];D.onmousedown=a=>{a.stopPropagation(),S=!0;let e=F?194:100,n=m(D)[1]-e,s=F?100:53,l=0;F&&!L.classList.contains("asmr")&&(l=100-G),a.y-n>=l&&a.y-n<=s&&(D.getElementsByClassName("slider-handle")[0].style.top=a.y-n+"px",x=F?100-(a.y-n):t(100*(1-(a.y-n)/53)),D.getElementsByClassName("slider-handle")[0].setAttribute("vol",x),!F&&D.getElementsByClassName("slider-handle")[0].setAttribute("ovol",x),w.getElementsByClassName("number")[0].innerText=x,D.getElementsByClassName("slider-track")[0].style.height=x+"%",L.volume=x/100*K,_.volume=x/100*K,0===x?(A=!A,j=x,w.getElementsByClassName("icon")[0].getElementsByTagName("svg")[1].style.display="none",w.getElementsByClassName("icon")[0].getElementsByTagName("svg")[0].style.display="block"):(A=!1,w.getElementsByClassName("icon")[0].getElementsByTagName("svg")[0].style.display="none",w.getElementsByClassName("icon")[0].getElementsByTagName("svg")[1].style.display="block")),D.onmousemove=a=>{a.stopPropagation();let e=F?100:53,s=0;F&&!L.classList.contains("asmr")&&(s=100-G),a.y-n>=s&&a.y-n<=e&&(D.getElementsByClassName("slider-handle")[0].style.transition="none",D.getElementsByClassName("slider-track")[0].style.transition="none",D.getElementsByClassName("slider-handle")[0].style.top=a.y-n+"px",x=F?100-(a.y-n):t(100*(1-(a.y-n)/53)),D.getElementsByClassName("slider-handle")[0].setAttribute("vol",x),!F&&D.getElementsByClassName("slider-handle")[0].setAttribute("ovol",x),w.getElementsByClassName("number")[0].innerText=x,D.getElementsByClassName("slider-track")[0].style.height=x+"%",L.volume=x/100,_.volume=x/100,0===x?(A=!A,j=x,w.getElementsByClassName("icon")[0].getElementsByTagName("svg")[1].style.display="none",w.getElementsByClassName("icon")[0].getElementsByTagName("svg")[0].style.display="block"):(A=!1,w.getElementsByClassName("icon")[0].getElementsByTagName("svg")[0].style.display="none",w.getElementsByClassName("icon")[0].getElementsByTagName("svg")[1].style.display="block"))},D.onmouseup=t=>{t.stopPropagation(),D.onmousemove=null,D.onmouseup=null,D.getElementsByClassName("slider-handle")[0].style.transition="",D.getElementsByClassName("slider-track")[0].style.transition="",S=!1},D.onmouseleave=t=>{t.stopPropagation(),D.onmousemove=null,D.onmouseup=null,D.getElementsByClassName("slider-handle")[0].style.transition="",D.getElementsByClassName("slider-track")[0].style.transition=""}},w.getElementsByClassName("volume")[0].onwheel=a=>{let e=F?0<a.deltaY?1:-1:a.deltaY;x-=e/10,100<x&&(x=100),F&&!L.classList.contains("asmr")&&(x=G),0>x&&(x=0),0===x?(A=!0,w.getElementsByClassName("icon")[0].getElementsByTagName("svg")[1].style.display="none",w.getElementsByClassName("icon")[0].getElementsByTagName("svg")[0].style.display="block"):A&&(w.getElementsByClassName("icon")[0].getElementsByTagName("svg")[0].style.display="none",w.getElementsByClassName("icon")[0].getElementsByTagName("svg")[1].style.display="block",A=!1),x=t(x),L.volume=x/100,_.volume=x/100,w.getElementsByClassName("number")[0].innerText=x,D.getElementsByClassName("slider-handle")[0].style.top=F?100-x:53-53*(x/100)+"px",D.getElementsByClassName("slider-track")[0].style.height=x+"%"},w.getElementsByClassName("icon")[0].onmouseup=t=>{t.stopPropagation(),A?(w.getElementsByClassName("icon")[0].getElementsByTagName("svg")[0].style.display="none",w.getElementsByClassName("icon")[0].getElementsByTagName("svg")[1].style.display="block",x=F&&j>G?G:j,D.getElementsByClassName("slider-handle")[0].setAttribute("vol",x+"")):(w.getElementsByClassName("icon")[0].getElementsByTagName("svg")[1].style.display="none",w.getElementsByClassName("icon")[0].getElementsByTagName("svg")[0].style.display="block",j=x,x=0,D.getElementsByClassName("slider-handle")[0].setAttribute("vol","0")),A=!A,L.volume=x/100,_.volume=x/100,w.getElementsByClassName("number")[0].innerText=x,D.getElementsByClassName("slider-handle")[0].style.top=F?100-x+"px":53-53*(x/100)+"px",D.getElementsByClassName("slider-track")[0].style.height=x+"%"},w.getElementsByClassName("close")[0].onclick=()=>{null!==o&&(d?o.detachMedia():o.destroy()),g.abort("user cancel"),p.abort("user cancel"),console.log("close "+a.uid),r(),B.remove();let e=V.indexOf(a.uid);V.splice(e,1),I.delete(a.uid),0===I.size&&X.classList.add("disabled"),n(E,I.size),null!==f&&f.stop()},w.getElementsByClassName("refresh-stream")[0].onclick=()=>{null!==o&&(d?o.detachMedia():o.destroy())},w.getElementsByClassName("frame-chasing")[0].onclick=()=>{try{L.currentTime=L.buffered.end(0)-1}catch(t){}},w.getElementsByClassName("asmr-button")[0].onclick=()=>{w.getElementsByClassName("asmr-button")[0].classList.contains("checked")?(w.getElementsByClassName("asmr-button")[0].classList.remove("checked"),L.classList.remove("asmr"),L.volume=G/100,D.getElementsByClassName("slider-handle")[0].setAttribute("vol",G),w.getElementsByClassName("number")[0].innerText=G,D.getElementsByClassName("slider-handle")[0].style.top=100-G+"px",D.getElementsByClassName("slider-track")[0].style.height=G+"%",w.getElementsByClassName("volume-control")[0].classList.remove("asmr-picked")):(w.getElementsByClassName("asmr-button")[0].classList.add("checked"),w.getElementsByClassName("volume-control")[0].classList.add("asmr-picked"),L.classList.add("asmr"))},w.classList.add("video-player-control");const O=document.createElement("div");O.style.display="none",O.classList.add("video-status-info-container"),O.id=`video-status-info-container-${a.room_id}`,B.append(O),B.append(k),B.append(w),E.append(B),c(a.uid,!0),console.log(q),0!=q&&setTimeout(()=>{i(a.room_id,L)},2e3),l(0===a.short_id?a.room_id:a.short_id,_,0),H&&(f=new N(a.area_v2_parent_id,a.area_v2_id,a.room_id,a.uid),f.E());let U=document.getElementById(`live-status-btn-${a.room_id}`);U.onclick=t=>{b=!b,b?(U.innerText="\u9690\u85CF\u7EDF\u8BA1\u4FE1\u606F",O.removeAttribute("style"),s(O)):(O.style.display="none",U.innerText="\u663E\u793A\u7EDF\u8BA1\u4FE1\u606F")};let Y=await y(a.room_id),W=await h(Y.uid,a.uid),J=w.getElementsByClassName("danmaku")[0],Q=[0,0],Z=!0,$=!0;J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0].onfocus=()=>{M=!0},J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0].onblur=()=>{M=!1},J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0].addEventListener("compositionstart",t=>{Z=!1,$=!1}),J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0].addEventListener("compositionend",t=>{Z=!0}),J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0].onkeyup=t=>{13===t.keyCode&&$&&(t.preventDefault(),v(J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0].value,0,a.room_id,a.uid),J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0].value=""),Z&&($=!0),Q=[J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0].selectionStart,J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0].selectionEnd],J.getElementsByClassName("input-container")[0].getElementsByTagName("span")[0].innerText=`${10>J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0].value.length?" ":""}${J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0].value.length}/${Y.totalLength}`},J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0].onkeydown=t=>{"Enter"===t.code&&t.preventDefault()},J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0].onselect=t=>{Q=[t.target.selectionStart,t.target.selectionEnd]},J.getElementsByClassName("send-danmaku")[0].onclick=()=>{v(J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0].value,0,a.room_id,a.uid),J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0].value="",J.getElementsByClassName("input-container")[0].getElementsByTagName("span")[0].innerText=`0/${Y.totalLength}`},J.getElementsByClassName("input-container")[0].getElementsByTagName("span")[0].innerText=`0/${Y.totalLength}`;let ee=0;fetch("https://api.live.bilibili.com/xlive/web-ucenter/v2/emoticon/GetEmoticons?platform=pc&room_id="+a.room_id,{method:"GET",credentials:"include",body:null}).then(e=>e.json()).then(e=>{if(0===e.code){let t=J.getElementsByClassName("emoji-sec")[0];if(t.classList.add("emoji-tray"),0===e.code){const n=document.createElement("div"),s=document.createElement("div");s.classList.add("rua-emoji-header"),n.appendChild(s),t.appendChild(n),s.addEventListener("wheel",t=>{s.scrollLeft+=t.deltaY,s.scrollLeft+=t.deltaX,t.preventDefault()});const l=e.data.data;ee>l.length&&(ee=0);for(let e=0;e<l.length;e++){const n=document.createElement("div");n.classList.add("rua-header-item");const i=document.createElement("div");i.classList.add("rua-emoji-container"),e===ee&&(n.classList.add("active"),i.classList.add("rua-emoji-container-show"),0===e&&i.classList.add("rua-emoji-container-show-xs")),n.innerHTML+=`<img src="${l[e].current_cover}"></div>`,n.onclick=()=>{for(let e=0;e<s.childNodes.length;e++)s.childNodes.item(e).classList.remove("active"),t.getElementsByClassName("rua-emoji-container")[e].classList.remove("rua-emoji-container-show"),0==e&&t.getElementsByClassName("rua-emoji-container")[e].classList.remove("rua-emoji-container-show-xs"),s.childNodes.item(e)===n&&(t.getElementsByClassName("rua-emoji-container")[e].classList.add("rua-emoji-container-show"),0===e&&t.getElementsByClassName("rua-emoji-container")[e].classList.add("rua-emoji-container-show-xs"),ee=e);n.classList.add("active")},s.appendChild(n);for(let t=0;t<l[e].emoticons.length;t++){const n=document.createElement("div");n.classList.add("rua-emoji-icon"),n.classList.add("rua-emoji-item"),n.title=l[e].emoticons[t].emoji,0===e&&n.classList.add("rua-emoji-item-xs"),n.innerHTML+=`<div class="rua-emoji-requirement" style="background-color: ${l[e].emoticons[t].unlock_show_color};"><div class="rua-emoji-requirement-text">${l[e].emoticons[t].unlock_show_text}</div></div><img class="${1===l[e].emoticons[t].perm?"rua-emoji-icon-active":"rua-emoji-icon-inactive-new"}" src="${l[e].emoticons[t].url}">`,n.onclick=()=>{let s=J.getElementsByClassName("input-container")[0].getElementsByTagName("input")[0];if(n.classList.contains("rua-emoji-icon-inactive-new")||0===e||v(l[e].emoticons[t].emoticon_unique,"systemEmoji",a.room_id,a.uid),0===e){if(s.selectionStart===s.selectionEnd)s.value=s.value.substring(0,s.selectionStart)+n.title+s.value.substring(s.selectionEnd,s.value.length);else{let e=s.value.substring(0,s.selectionStart),t=s.value.substring(s.selectionEnd,s.value.length);s.value=e+n.title+t}s.focus()}},i.append(n)}t.appendChild(i)}}}}).catch(e=>{console.log(e)}),C.observe(L,{attributes:!0})}}async function c(e,t=!1){if(t&&(await h(B).then(e=>{A=e})),1===R||-1===R&&1===A[0].medal_info.wearing_status)if(-1===R)f(A[0].medal_info.medal_id);else{P=e;for(const e of A)if(e.medal_info.target_id===P){f(e.medal_info.medal_id);break}}}function u(e){return fetch("https://api.live.bilibili.com/room/v1/Room/room_init?id="+e,{method:"GET",credentials:"include",body:null}).then(e=>e.json()).then(e=>{if(0===e.code)return{up:e.data.uid,roomid:e.data.room_id,liveStatus:e.data.live_status};throw e})}function y(e){return fetch("https://api.live.bilibili.com/xlive/web-room/v1/index/getInfoByUser?from=0&room_id="+e,{method:"GET",credentials:"include",body:null}).then(e=>e.json()).then(e=>{if(0===e.code){let t=0==e.data.privilege.privilege_type-1+1?4:e.data.privilege.privilege_type,a=e.data.info.uid,n=e.data.property.danmu.length;return{totalLength:n,uid:a,emojiRequiredPrivilege:t}}return{totalLength:0,uid:-1,emojiRequiredPrivilege:-1}}).catch(t=>({totalLength:0,uid:-1,emojiRequiredPrivilege:-1}))}function g(){try{chrome.runtime.sendMessage({msg:"get_LoginInfo"},function(e){C=e.res.split(",")[0],B=e.res.split(",")[1]}),chrome.runtime.sendMessage({msg:"get_LIVE_BUVID"},function(e){b=e.res.value})}catch(t){console.log(t)}}function p(){return t(Date.now()/1e3)}async function v(e,t,a,n){if(P!==n&&1===R){P=n;for(const e of A)if(e.medal_info.target_id===P){await f(e.medal_info.medal_id);break}}let s=new FormData;s.append("bubble","0"),s.append("msg",e),s.append("color","16777215"),s.append("mode","1"),t!==void 0&&"systemEmoji"===t&&s.append("dm_type","1"),s.append("fontsize","25"),s.append("rnd",p()+""),s.append("roomid",a),s.append("csrf",C),s.append("csrf_token",C),0!==e.length&&E(s)}function E(e){fetch("https://api.live.bilibili.com/msg/send?requestFrom=rua5",{method:"POST",credentials:"include",body:e}).then(e=>e.json()).then(e=>{console.log("sent"),0===e.message.length?"\u4F60\u6240\u5728\u7684\u5730\u533A\u6682\u65E0\u6CD5\u53D1\u8A00"===e.message&&console.log("Error:","\u4F60\u6240\u5728\u7684\u5730\u533A\u6682\u65E0\u6CD5\u53D1\u8A00"):console.log("Error:","\u4F60\u7684\u5F39\u5E55\u88AB\u7CFB\u7EDF\u541E\u4E86\uFF0C\u91CD\u8BD5\u4E00\u4E0B\u5427\u3002")}).catch(e=>{console.log("Error:",e)})}function h(e,t){return fetch("https://api.live.bilibili.com/xlive/web-ucenter/user/MedalWall?target_id="+e,{method:"GET",credentials:"include",body:null}).then(e=>e.json()).then(e=>{if(0===e.code){if("undefined"!=typeof t){for(let a of e.data.list)if(a.medal_info.target_id===t)return{emojiRequiredMedalLevel:a.medal_info.level,medal_id:a.medal_info.medal_id,medal_name:a.medal_info.medal_name};return{emojiRequiredMedalLevel:0,medal_id:-1,medal_name:""}}return e.data.list}return{emojiRequiredMedalLevel:0,medal_id:-1,medal_name:""}}).catch(t=>({emojiRequiredMedalLevel:0,medal_id:-1,medal_name:""}))}function f(e){if("-1"!==C&&-1!==e&&0!==R){var t=new FormData;t.append("medal_id",e),t.append("csrf",C),t.append("csrf_token",C),t.append("visit_id",""),fetch(-1===R?"https://api.live.bilibili.com/xlive/app-ucenter/v1/fansMedal/take_off":`https://api.live.bilibili.com/xlive/web-room/v1/fansMedal/wear`,{method:"POST",credentials:"include",body:t}).then(t=>{console.log("ware medal successful, MID="+e)})}}function N(e,t,a,n){function s(){let e="";for(let t=0;36>t;t++){const a=Math.floor(16*Math.random());e+=8==t||13===t||18===t||23===t?"-":14===t?"4":19===t?(8|3&a).toString(16):a.toString(16)}return e}function l(e){let t="";for(const a in e)t+=`${a}=${encodeURIComponent("id"==a||"device"===a?JSON.stringify(e[a]):e[a])}&`;return t.slice(0,-1)}function i(e,t){let a=JSON.stringify({platform:"web",parent_id:e.id[0],area_id:e.id[1],seq_id:e.id[2],room_id:e.id[3],buvid:e.device[0],uuid:e.device[1],ets:e.ets,time:e.time,ts:e.ts});for(let n of t)0===n?a=CryptoJS.HmacMD5(a,e.benchmark).toString(CryptoJS.enc.Hex):1===n?a=CryptoJS.HmacSHA1(a,e.benchmark).toString(CryptoJS.enc.Hex):2===n?a=CryptoJS.HmacSHA256(a,e.benchmark).toString(CryptoJS.enc.Hex):3===n?a=CryptoJS.HmacSHA224(a,e.benchmark).toString(CryptoJS.enc.Hex):4===n?a=CryptoJS.HmacSHA512(a,e.benchmark).toString(CryptoJS.enc.Hex):5===n?a=CryptoJS.HmacSHA384(a,e.benchmark).toString(CryptoJS.enc.Hex):void 0;return a}const o=window.navigator.userAgent;this.packageNumber=0,this.packagePayload={id:[e,t,this.packageNumber,a],device:[b,s()],ruid:n,ts:Date.now(),is_patch:0,heart_beat:[],ua:o},this.replayPayload={},this.timer=null,N.prototype.E=async function(){H&&(await fetch("https://live-trace.bilibili.com/xlive/data-interface/v1/x25Kn/E",{method:"POST",credentials:"include",headers:{"content-type":"application/x-www-form-urlencoded"},body:`${l(this.packagePayload)}&csrf_token=${C}&csrf=${C}&visit_id:`}).then(e=>e.json()).then(n=>{0===n.code&&(this.packageNumber++,this.timer=setInterval(()=>{this.X()},1e3*(n.data.heartbeat_interval-0)),this.replayPayload={id:[e,t,this.packageNumber,a],device:this.packagePayload.device,ruid:this.packagePayload.ruid,ets:n.data.timestamp,benchmark:n.data.secret_key,time:n.data.heartbeat_interval,ts:Date.now(),ua:o},this.replayPayload=Object.assign({s:i(this.replayPayload,n.data.secret_rule)},this.replayPayload))}).catch(t=>{this.stop(),this.E()}))},N.prototype.X=async function(){H&&(await fetch("https://live-trace.bilibili.com/xlive/data-interface/v1/x25Kn/X",{method:"POST",credentials:"include",headers:{"content-type":"application/x-www-form-urlencoded"},body:`${l(this.replayPayload)}&csrf_token=${C}&csrf=${C}&visit_id:`}).then(e=>e.json()).then(e=>{0===e.code?(this.packageNumber++,this.replayPayload.id=[this.replayPayload.id[0],this.replayPayload.id[1],this.packageNumber,this.replayPayload.id[3]],this.replayPayload.benchmark=e.data.secret_key,this.replayPayload.time=e.data.heartbeat_interval,this.replayPayload.ets=e.data.timestamp,this.replayPayload.s=i(this.replayPayload,e.data.secret_rule)):(this.stop(),this.E())}))},N.prototype.stop=function(){null!==this.timer&&(clearInterval(this.timer),this.timer=null)}}mpegts.LoggingControl.applyConfig({enableError:!1}),chrome.tabs.getCurrent().then(e=>{chrome.windows.getCurrent().then(t=>{chrome.storage.local.set({liveroomOn:[t.id,e.id]},()=>{})})}),chrome.windows.onFocusChanged.addListener(()=>{chrome.tabs.getCurrent().then(e=>{chrome.windows.getCurrent().then(t=>{chrome.storage.local.set({liveroomOn:[t.id,e.id]},()=>{})})})});let B,C,b,L=null,_=null,k=null,T=document.getElementsByClassName("control-bar")[0],w=document.getElementsByClassName("control-bar-bg")[0],x=null,j=!1,A=null,I=new Map,S=!1,P=-1,R=1,M=10,q=1e4,H=!0,D=0,O=null,z=!1,F=!1,G=10,U=!1;g(),setInterval(g,3e3),setTimeout(()=>{h(B).then(e=>{A=e})},100);const X=document.getElementById("save-current-room-list"),Y=document.getElementById("load-saved-room-list");chrome.storage.sync.get(["liveRoomList","liveroom-asmr-volume"],e=>{0<e.liveRoomList.length?Y.classList.remove("disabled"):X.classList.add("disabled")}),X.onclick=()=>{if(!X.classList.contains("disabled")){let e=[];for(const t of I.keys())e.push(I.get(t).uid);chrome.storage.sync.set({liveRoomList:e},()=>{Y.classList.remove("disabled")})}},Y.onclick=()=>{Y.classList.contains("disabled")||chrome.storage.sync.get(["liveRoomList"],e=>{o(e.liveRoomList,!0)})},window.addEventListener("focus",function(){(-1<P||0!==R)&&null!==A&&"undefined"!=typeof A&&c(P,1===R),a()}),a(),window.addEventListener("beforeunload",()=>{chrome.storage.local.set({liveroomOn:[-1,-1]},()=>{})});let K=1;!function e(){function t(){const e=document.querySelectorAll("video");for(const t of e)try{t.currentTime=t.buffered.end(0)-1,console.log(`video frame chased.`)}catch(t){}}L=document.getElementsByClassName("add-room")[0].getElementsByTagName("svg")[0],k=document.getElementsByClassName("setting")[0].getElementsByTagName("svg")[0],_=document.getElementsByClassName("fullscreen")[0].getElementsByTagName("svg")[0];let a=document.getElementById("setting-heart-beat"),o=document.getElementById("setting-quality"),d=document.getElementById("setting-medal-switch-on"),m=document.getElementById("setting-medal-switch-off"),r=document.getElementById("setting-medal-switch-none"),u=document.getElementById("setting-auto-frame-chasing"),y=document.getElementById("setting-name-always-on"),g=document.getElementById("setting-asmr"),p=document.getElementById("setting-asmr-volume"),v=document.getElementById("setting-asmr-restore");document.body.addEventListener("mousemove",e=>{clearTimeout(x),T.style.opacity="1",w.style.visibility="unset",0<I.size&&document.querySelectorAll(".video-owner-info-container")[0].classList.add("video-owner-info-always-on-first-child"),x=setTimeout(s,1e3)}),document.body.addEventListener("mouseup",()=>{for(let e=0;e<document.body.getElementsByClassName("volume-control").length;e++)document.body.getElementsByClassName("volume-control")[e].style.display="none"}),chrome.storage.sync.get(["liveroom-medal-switch","liveroom-reconnection-time","liveroom-quality","liveroom-heart-beat","liveroom-auto-frame-chasing","liveroom-name-always-on","liveroom-asmr-volume","liveroom-asmr-volume-restore"],function(e){R=e["liveroom-medal-switch"];-1===R?r.setAttribute("checked","true"):0===R?m.setAttribute("checked","true"):1===R?d.setAttribute("checked","true"):void 0;H=e["liveroom-heart-beat"],a.checked=H,M=e["liveroom-reconnection-time"],q=e["liveroom-quality"],o.value=q,D=e["liveroom-auto-frame-chasing"],u.value=D,z=e["liveroom-name-always-on"],y.checked=z,0!=D-0&&(O=setInterval(t,60*(1e3*(D-0)))),null!==e["liveroom-asmr-volume"]&&"undefined"!=typeof e["liveroom-asmr-volume"]&&(G=e["liveroom-asmr-volume"]-0),p.value=G,document.getElementById("setting-name-asmr-volume-label").innerText=G,U=e["liveroom-asmr-volume-restore"],v.checked=U}),d.addEventListener("change",t=>{R=1,chrome.storage.sync.set({"liveroom-medal-switch":R},()=>{})}),m.addEventListener("change",t=>{R=0,chrome.storage.sync.set({"liveroom-medal-switch":R},()=>{})}),r.addEventListener("change",t=>{R=-1,c(0,-1===R),chrome.storage.sync.set({"liveroom-medal-switch":R},()=>{})}),a.addEventListener("change",()=>{H=a.checked,chrome.storage.sync.set({"liveroom-heart-beat":H},function(){})}),o.addEventListener("change",()=>{console.log(o.value),q=o.value,chrome.storage.sync.set({"liveroom-quality":q},function(){})}),u.addEventListener("change",()=>{D=u.value,chrome.storage.sync.set({"liveroom-auto-frame-chasing":D},function(){}),clearInterval(O),O=null,0!=D-0&&(O=setInterval(t,60*(1e3*(D-0))))}),y.addEventListener("change",()=>{z=y.checked;const e=document.querySelectorAll(".video-owner-info-container");for(const t of e)t.style.display=z?"flex":"none",z?t.classList.add("video-owner-info-always-on"):t.classList.remove("video-owner-info-always-on");chrome.storage.sync.set({"liveroom-name-always-on":z},function(){})}),g.addEventListener("change",()=>{F=g.checked;const e=document.querySelectorAll(".volume-control");for(const t of e)F?t.classList.add("asmr"):t.classList.remove("asmr");const t=document.querySelectorAll(".asmr-button");for(const e of t)e.style.display=F?"block":"none";const a=document.querySelectorAll(".slider-handle");for(const e of a){let t=e.getAttribute("vol")-0;F||(e.style.top=(53*t-5300)/-100+"px")}const n=document.querySelectorAll("video");for(const e of n)F&&!e.classList.contains("asmr")&&0<e.volume&&(e.volume=G/100);const s=document.querySelectorAll(".volume-control");for(const e of s)e.classList.contains("asmr")&&(0<e.getElementsByClassName("slider-handle")[0].getAttribute("vol")&&(e.getElementsByClassName("number")[0].innerText=G+"",e.getElementsByClassName("slider-handle")[0].setAttribute("vol",G),e.getElementsByClassName("slider-handle")[0].style.top=100-G+"px",e.getElementsByClassName("slider-track")[0].style.height=G+"%"),0==e.getElementsByClassName("slider-handle")[0].getAttribute("vol")-0&&(e.getElementsByClassName("slider-handle")[0].style.top="100px"))}),p.addEventListener("mousedown",()=>{p.addEventListener("mousemove",()=>{document.getElementById("setting-name-asmr-volume-label").innerText=p.value,G=p.value;const e=document.querySelectorAll("video");for(const t of e)F&&!t.classList.contains("asmr")&&0<=t.volume&&(t.volume=G/100);const t=document.querySelectorAll(".volume-control");for(const e of t)e.classList.contains("asmr")&&!e.classList.contains("asmr-picked")&&(e.getElementsByClassName("number")[0].innerText=G+"",e.getElementsByClassName("slider-handle")[0].setAttribute("vol",G),e.getElementsByClassName("slider-handle")[0].style.top=100-G+"px",e.getElementsByClassName("slider-track")[0].style.height=G+"%")})}),v.addEventListener("change",()=>{U=v.value,chrome.storage.sync.set({"liveroom-asmr-volume-restore":U},function(){})}),p.addEventListener("change",t=>{chrome.storage.sync.set({"liveroom-asmr-volume":p.value},function(){}),G=p.value,document.getElementById("setting-name-asmr-volume-label").innerText=p.value}),L.addEventListener("click",()=>{document.getElementsByClassName("panel-container")[0].removeEventListener("click",n),document.getElementsByClassName("panel-container")[0].style.zIndex="100",document.getElementsByClassName("panel-container")[0].style.display="block",document.getElementsByClassName("panel-container")[0].addEventListener("click",n),document.getElementsByClassName("add-room-panel")[0].style.display="flex",document.getElementsByClassName("setting-panel")[0].style.display="none",document.getElementsByClassName("add-room-panel")[0].addEventListener("click",t=>{t.stopPropagation()});let t=null,a="";document.getElementsByClassName("add-room-panel")[0].getElementsByClassName("room-input")[0].getElementsByTagName("input")[0].onkeyup=n=>{t=setTimeout(()=>{if(a!==n.target.value){console.log(n.target.value),a=n.target.value;let e=document.getElementsByClassName("following-block")[0];e.innerHTML="",""===n.target.value?(document.getElementsByClassName("following-room")[0].getElementsByClassName("following-block-title")[0].innerText="\u4E0A\u5DE5\u4E2D\u7684\u4E3B\u5305\uFF1A",l()):(document.getElementsByClassName("following-room")[0].getElementsByClassName("following-block-title")[0].innerText="\u641C\u7D22\u7ED3\u679C\uFF1A",i(n.target.value))}},1e3),t=null},l()}),k.addEventListener("click",()=>{document.getElementsByClassName("panel-container")[0].removeEventListener("click",n),document.getElementsByClassName("panel-container")[0].style.zIndex="100",document.getElementsByClassName("panel-container")[0].style.display="block",document.getElementsByClassName("panel-container")[0].addEventListener("click",n),document.getElementsByClassName("setting-panel")[0].style.display="flex",document.getElementsByClassName("add-room-panel")[0].style.display="none",document.getElementsByClassName("setting-panel")[0].addEventListener("click",t=>{t.stopPropagation()})}),_.addEventListener("click",()=>{j?document.exitFullscreen().then(e=>{j=!1}).catch(t=>{document.body.requestFullscreen().then(),j=!0}):document.body.requestFullscreen().then(e=>{j=!0}).catch(t=>{document.exitFullscreen().then(),j=!1})})}();let V=[];document.getElementById("start-all").onclick=()=>{o(V,!0),n()}}();