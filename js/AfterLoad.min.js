!function(){function a(){document.getElementById("chat-items")===void 0?setTimeout(a,100):0===document.getElementById("chat-items").getElementsByClassName("important-prompt-item").length?setTimeout(a,10):document.getElementById("chat-items").getElementsByClassName("important-prompt-item")[0].style.display="none"}function b(){$.ajax({url:"https://api.live.bilibili.com/fans_medal/v5/live_fans_medal/iApiMedal?page="+n,type:"GET",dataType:"json",json:"callback",xhrFields:{withCredentials:!0},success:function(a){let c=a.data;if(0!==c.length){let a=c.fansMedalList;for(let b=0;b<a.length;b++)m.push(new Medal(a[b].medal_id+"",a[b].roomid+"",a[b].target_id+"",a[b].medalName,a[b].medal_level,a[b].medal_color_start,a[b].medal_color_end,a[b].medal_color_border));c.pageinfo.totalpages===n?(console.log("load list complete"),"-1"!==m.get(o).MID&&d(m.get(o),!0)):(n++,b())}}})}function d(a,b){if("-1"!==l&&i&&"-1"!==a.MID){var c=new FormData;c.append("medal_id",a.MID),c.append("csrf",l),c.append("csrf_token",l),$.ajax({url:"https://api.live.bilibili.com/xlive/web-room/v1/fansMedal/wear",type:"POST",data:c,dataType:"JSON",processData:!1,contentType:!1,cache:!1,xhrFields:{withCredentials:!0},success:function(){console.log("ware medal successful, MID="+a.MID),b&&e(a)}})}}function e(a){let b=document.createEvent("MouseEvents");if(b.initEvent("click",!1,!0),0===document.getElementsByClassName("medal-section").length||0===document.getElementsByClassName("medal-section")[0].getElementsByTagName("span").length||0===document.getElementsByClassName("medal-section")[0].getElementsByTagName("span")[0].getElementsByTagName("span").length)setTimeout(()=>{e(a)},200);else{let c=document.getElementsByClassName("medal-section")[0].getElementsByTagName("span")[0];c.dispatchEvent(b),setTimeout(function(){let b=document.getElementById("control-panel-ctnr-box").getElementsByClassName("medal")[0];void 0!==b&&(b.style.display="none");let c=document.getElementById("control-panel-ctnr-box").getElementsByClassName("fans-medal-content")[0].innerText;console.log(a),(void 0===c||c!==a.mName)&&setTimeout(()=>{e(a)},1e3)},20)}}function c(a){let b=document.createEvent("MouseEvents");if(b.initEvent("mousemove",!1,!1),void 0===document.getElementById("live-player")||void 0===document.getElementById("live-player").getElementsByClassName("web-player-controller-wrap").length||0===document.getElementById("live-player").getElementsByClassName("web-player-controller-wrap").length)setTimeout(c,200);else{let c=document.getElementById("live-player"),d=c.getElementsByClassName("web-player-controller-wrap");void 0!==d&&(d[0].style.visibility="hidden",d[1].style.visibility="hidden"),c.dispatchEvent(b),setTimeout(function(){b.initEvent("mouseenter",!1,!0);let e=c.getElementsByClassName("quality-wrap")[0];void 0!==e&&(e.dispatchEvent(b),b.initEvent("click",!1,!0),setTimeout(function(){let d=e.getElementsByClassName("panel")[0].getElementsByClassName("quality-it");if(1<d.length){let e=[];for(let a=0;a<d.length;a++)e.push(d[a].innerHTML.replaceAll(" ",""));d[f(a,e)].dispatchEvent(b),b.initEvent("mouseleave",!1,!1),c.dispatchEvent(b)}},100)),setTimeout(()=>{void 0!==d&&(d[0].style.visibility="visible",d[1].style.visibility="visible")},250)},100)}}function f(a,b){let c=0;for(let d=0;d<b.length;d++)g[b[d]]>=g[a]&&(c=d);return c}const g={原画:1e4,蓝光:400,超清:250,高清:150,流畅:80};var h,i,j="\u539F\u753B",k=!1,l="-1",m=new MedalList,n=1,o=window.location.pathname.replaceAll("/","").replace("blanc",""),p=/^[0-9]*$/;chrome.storage.sync.get(["qn"],function(a){h=a.qn}),chrome.storage.sync.get(["qnvalue"],function(a){j=a.qnvalue}),chrome.storage.sync.get(["medal"],a=>{i=a.medal}),chrome.storage.sync.get(["hiddenEntry"],a=>{k=a.hiddenEntry}),chrome.storage.onChanged.addListener(function(a){for(let[b,{oldValue:c,newValue:d}]of Object.entries(a))"medal"===b&&(i=d)}),function(){"undefined"!=typeof chrome.app.isInstalled&&chrome.runtime.sendMessage({msg:"get_LoginInfo"},function(a){l=a.res.split(",")[0]})}(),setTimeout(function(){p.test(o)&&0<o.length&&b(),h&&p.test(o)&&0<o.length&&0===document.getElementsByTagName("article").length&&c(j),k&&"-1"!==l&&p.test(o)&&0<o.length&&0===document.getElementsByTagName("article").length&&a()},10),function(){function a(){if(document.getElementsByClassName("live-haruna-ctnr")[0]===void 0)setTimeout(a,200);else{let a=document.getElementsByClassName("live-haruna-ctnr")[0].getAttribute("style").replace(";","");document.getElementsByClassName("live-haruna-ctnr")[0].setAttribute("style",a+" scale("+b+");");var c=new MutationObserver(function(a){a.forEach(function(a){if("attributes"===a.type&&"style"===a.attributeName){let a=document.getElementsByClassName("live-haruna-ctnr")[0].getAttribute("style").replace(";","");a.includes("scale")||document.getElementsByClassName("live-haruna-ctnr")[0].setAttribute("style",a+" scale("+b+");")}})});c.observe(document.getElementsByClassName("live-haruna-ctnr")[0],{attributes:!0})}}let b=1/window.devicePixelRatio;a()}(),window.addEventListener("focus",function(){d(m.get(o),!1)})}();