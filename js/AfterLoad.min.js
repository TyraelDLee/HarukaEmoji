!function(){function a(){document.getElementById("chat-items")===void 0?setTimeout(a,100):0===document.getElementById("chat-items").getElementsByClassName("important-prompt-item").length?setTimeout(a,10):document.getElementById("chat-items").getElementsByClassName("important-prompt-item")[0].style.display="none"}function b(){fetch("https://api.live.bilibili.com/room/v1/Room/room_init?id="+v,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(a=>{0===a.code&&(u=a.data.uid,d(a.data.uid))})}function d(a){fetch("https://api.live.bilibili.com/xlive/web-ucenter/user/MedalWall?target_id="+t,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(b=>{if(0===b.code){let c=b.data.list;for(let a=0;a<c.length;a++)s.push(new Medal(c[a].medal_info.medal_id,c[a].medal_info.target_id,c[a].medal_info.target_id,c[a].medal_info.medal_name,c[a].medal_info.level,c[a].medal_info.medal_color_start,c[a].medal_info.medal_color_end,c[a].medal_info.medal_color_border));e(s.getByUid(a),!0)}})}function e(a,b){if(console.log(a),"-1"!==r&&o&&"-1"!==a.MID){var c=new FormData;c.append("medal_id",a.MID),c.append("csrf",r),c.append("csrf_token",r),fetch("https://api.live.bilibili.com/xlive/web-room/v1/fansMedal/wear",{method:"POST",credentials:"include",body:c}).then(()=>{console.log("ware medal successful, MID="+a.MID),b&&f(a)})}}function f(a){let b=document.createEvent("MouseEvents");if(b.initEvent("click",!1,!0),0===document.getElementsByClassName("medal-section").length||0===document.getElementsByClassName("medal-section")[0].getElementsByTagName("span").length||0===document.getElementsByClassName("medal-section")[0].getElementsByTagName("span")[0].getElementsByTagName("span").length)setTimeout(()=>{f(a)},200);else{let c=document.getElementsByClassName("medal-section")[0].getElementsByTagName("span")[0];c.dispatchEvent(b),setTimeout(function(){let b=document.getElementById("control-panel-ctnr-box").getElementsByClassName("medal")[0];void 0!==b&&(b.style.display="none");let c=document.getElementById("control-panel-ctnr-box").getElementsByClassName("fans-medal-content")[0].innerText;console.log(a),(void 0===c||c!==a.mName)&&setTimeout(()=>{f(a)},1e3)},20)}}function c(a){let b=document.createEvent("MouseEvents");if(b.initEvent("mousemove",!1,!1),void 0===document.getElementById("live-player")||void 0===document.getElementById("live-player").getElementsByClassName("web-player-controller-wrap").length||0===document.getElementById("live-player").getElementsByClassName("web-player-controller-wrap").length)setTimeout(c,200);else{let c=document.getElementById("live-player"),d=c.getElementsByClassName("web-player-controller-wrap");void 0!==d&&(d[0].style.visibility="hidden",d[1].style.visibility="hidden"),c.dispatchEvent(b),setTimeout(function(){b.initEvent("mouseenter",!1,!0);let e=c.getElementsByClassName("quality-wrap")[0];void 0!==e&&(e.dispatchEvent(b),b.initEvent("click",!1,!0),setTimeout(function(){let d=e.getElementsByClassName("panel")[0].getElementsByClassName("quality-it");if(1<d.length){let e=[];for(let a=0;a<d.length;a++)e.push(d[a].innerHTML.replaceAll(" ",""));d[g(a,e)].dispatchEvent(b),b.initEvent("mouseleave",!1,!1),c.dispatchEvent(b)}},100)),setTimeout(()=>{void 0!==d&&(d[0].style.visibility="visible",d[1].style.visibility="visible")},250)},100)}}function g(a,b){let c=0;for(let d=0;d<b.length;d++)m[b[d]]>=m[a]&&(c=d);return c}function h(){i(),E.getElementsByClassName("right-area")[0].appendChild(D)}function i(){D.innerHTML="<span class='text'>"+(z?"\u7ED3\u675F\u5F55\u5236":"\u5F00\u59CB\u5F55\u5236")+"</span>",z?(F.innerHTML="<span class='text'>\u5F55\u5236\u65F6\u957F "+l(B)+"</span>",E.getElementsByClassName("left-area")[0].appendChild(F)):F.innerHTML="<span class='text'></span>"}function j(){z=!z,i(),console.log("Start recording"),z||(A=!0,y.stop())}function k(){try{const a=document.getElementById("live-player").getElementsByTagName("video")[0].captureStream();let b=[],c=0,d="";B=0,console.log(a),y=new MediaRecorder(a),y.ondataavailable=a=>{console.log(a.data.arrayBuffer()),0<a.data.size&&(b.length>=C&&!z&&b.splice(1,1),0===b.length&&(d=a.data.type),b.push(a.data),z&&(B=b.length,F.innerHTML="<span class='text'>\u5F55\u5236\u65F6\u957F "+l(B)+"</span>"),c++),console.log(b.length)},y.onstart=()=>{console.log("start recording")},y.onstop=()=>{A&&(A=!1,chrome.runtime.sendMessage({msg:"requestEncode",blob:window.URL.createObjectURL(new Blob(b,{type:d})),filename:x,startTime:c-B,duration:B})),k()},y.start(1e3)}catch(a){}}function l(a){return Math.floor(a/60)+" : "+(10>a%60?"0":"")+a%60}const m={原画:1e4,蓝光HEVC:401,蓝光:400,超清HEVC:251,超清:250,高清:150,流畅:80};var n,o,p="\u539F\u753B",q=!1,r="-1",s=new MedalList,t="",u="",v=window.location.pathname.replaceAll("/","").replace("blanc",""),w=/^[0-9]*$/;const x=document.title.replace(" - \u54D4\u54E9\u54D4\u54E9\u76F4\u64AD\uFF0C\u4E8C\u6B21\u5143\u5F39\u5E55\u76F4\u64AD\u5E73\u53F0","").replaceAll(" ","");chrome.storage.sync.get(["qn"],function(a){n=a.qn}),chrome.storage.sync.get(["qnvalue"],function(a){p=a.qnvalue}),chrome.storage.sync.get(["medal"],a=>{o=a.medal}),chrome.storage.sync.get(["hiddenEntry"],a=>{q=a.hiddenEntry}),chrome.storage.onChanged.addListener(function(a){for(let[b,{oldValue:c,newValue:d}]of Object.entries(a))"medal"===b&&(o=d)}),function(){chrome.runtime.sendMessage({msg:"get_LoginInfo"},function(a){r=a.res.split(",")[0],t=a.res.split(",")[2]})}(),setTimeout(function(){w.test(v)&&0<v.length&&b(),n&&w.test(v)&&0<v.length&&0===document.getElementsByTagName("article").length&&c(p),q&&"-1"!==r&&w.test(v)&&0<v.length&&0===document.getElementsByTagName("article").length&&a()},10),function(){function a(){if(document.getElementsByClassName("live-haruna-ctnr")[0]===void 0)setTimeout(a,200);else{let a=document.getElementsByClassName("live-haruna-ctnr")[0].getAttribute("style").replace(";","");document.getElementsByClassName("live-haruna-ctnr")[0].setAttribute("style",a+" scale("+b+");");var c=new MutationObserver(function(a){a.forEach(function(a){if("attributes"===a.type&&"style"===a.attributeName){let a=document.getElementsByClassName("live-haruna-ctnr")[0].getAttribute("style").replace(";","");a.includes("scale")||document.getElementsByClassName("live-haruna-ctnr")[0].setAttribute("style",a+" scale("+b+");")}})});c.observe(document.getElementsByClassName("live-haruna-ctnr")[0],{attributes:!0})}}let b=1/window.devicePixelRatio;a()}(),window.addEventListener("focus",function(){e(s.getByUid(u),!1)});let y,z=!1,A=!1,B=0,C=300;const D=document.createElement("div"),E=document.getElementById("web-player-controller-wrap-el");D.classList.add("rua-record");const F=document.createElement("div");F.classList.add("rua-recording-time");const G=new MutationObserver(function(a){a.forEach(function(a){"childList"===a.type&&(console.log(0===a.addedNodes.length),0===a.addedNodes.length&&D.removeEventListener("click",j),a.addedNodes[0]!==void 0&&"DIV"===a.addedNodes[0].nodeName&&(h(),D.addEventListener("click",j)))})});try{G.observe(E,{childList:!0})}catch(a){}const H=new MutationObserver(function(a){a.forEach(function(a){"childList"===a.type&&a.addedNodes[0]!==void 0&&"VIDEO"===a.addedNodes[0].nodeName&&k()})});try{H.observe(document.getElementById("live-player"),{childList:!0})}catch(a){}}();