!function(){function a(){document.getElementById("chat-items")===void 0?setTimeout(a,100):0===document.getElementById("chat-items").getElementsByClassName("important-prompt-item").length?setTimeout(a,10):document.getElementById("chat-items").getElementsByClassName("important-prompt-item")[0].style.display="none"}function b(){fetch("https://api.live.bilibili.com/room/v1/Room/room_init?id="+w,{method:"GET",credentials:"include",body:null}).then((a)=>a.json()).then((a)=>{0===a.code&&(v=a.data.uid,d(a.data.uid))})}function d(a){fetch("https://api.live.bilibili.com/xlive/web-ucenter/user/MedalWall?target_id="+u,{method:"GET",credentials:"include",body:null}).then((a)=>a.json()).then((b)=>{if(0===b.code){let c=b.data.list;for(let a=0;a<c.length;a++)t.push(new Medal(c[a].medal_info.medal_id,c[a].medal_info.target_id,c[a].medal_info.target_id,c[a].medal_info.medal_name,c[a].medal_info.level,c[a].medal_info.medal_color_start,c[a].medal_info.medal_color_end,c[a].medal_info.medal_color_border));e(t.getByUid(a),!0)}})}function e(a,b){if("-1"!==s&&o&&"-1"!==a.MID){var c=new FormData;c.append("medal_id",a.MID),c.append("csrf",s),c.append("csrf_token",s),fetch("https://api.live.bilibili.com/xlive/web-room/v1/fansMedal/wear",{method:"POST",credentials:"include",body:c}).then(()=>{console.log("ware medal successful, MID="+a.MID),b&&f(a)})}}function f(a){let b=document.createEvent("MouseEvents");if(b.initEvent("click",!1,!0),0===document.getElementsByClassName("medal-section").length||0===document.getElementsByClassName("medal-section")[0].getElementsByTagName("span").length||0===document.getElementsByClassName("medal-section")[0].getElementsByTagName("span")[0].getElementsByTagName("span").length)setTimeout(()=>{f(a)},200);else{let c=document.getElementsByClassName("medal-section")[0].getElementsByTagName("span")[0];c.dispatchEvent(b),setTimeout(function(){let b=document.getElementById("control-panel-ctnr-box").getElementsByClassName("medal")[0];void 0!==b&&(b.style.display="none");let c=document.getElementById("control-panel-ctnr-box").getElementsByClassName("fans-medal-content")[0].innerText;(void 0===c||c!==a.mName)&&setTimeout(()=>{f(a)},1e3)},20)}}function c(a){let b=document.createEvent("MouseEvents");if(b.initEvent("mousemove",!1,!1),void 0===document.getElementById("live-player")||void 0===document.getElementById("live-player").getElementsByClassName("web-player-controller-wrap").length||0===document.getElementById("live-player").getElementsByClassName("web-player-controller-wrap").length)setTimeout(c,200);else{let c=document.getElementById("live-player"),d=c.getElementsByClassName("web-player-controller-wrap");void 0!==d&&(d[0].style.visibility="hidden",d[1].style.visibility="hidden"),c.dispatchEvent(b),setTimeout(function(){b.initEvent("mouseenter",!1,!0);let e=c.getElementsByClassName("quality-wrap")[0];void 0!==e&&(e.dispatchEvent(b),b.initEvent("click",!1,!0),setTimeout(function(){let d=e.getElementsByClassName("panel")[0].getElementsByClassName("quality-it");if(1<d.length){let e=[];for(let a=0;a<d.length;a++)e.push(d[a].innerHTML.replaceAll(" ",""));d[g(a,e)].dispatchEvent(b),b.initEvent("mouseleave",!1,!1),c.dispatchEvent(b)}},100)),setTimeout(()=>{void 0!==d&&(d[0].style.visibility="visible",d[1].style.visibility="visible")},250)},100)}}function g(a,b){let c=0;for(let d=0;d<b.length;d++)m[b[d]]>=m[a]&&(c=d);return c}function h(){i(),G.getElementsByClassName("right-area")[0].appendChild(B)}function i(){B.innerHTML="<span class='text'>"+(D?"\u7ED3\u675F\u5F55\u5236":"\u5F00\u59CB\u5F55\u5236")+"</span>",D?(C.innerHTML="<span class='text'>\u5F55\u5236\u65F6\u957F "+l(F)+"</span>",G.getElementsByClassName("left-area")[0].appendChild(C)):C.innerHTML="<span class='text'></span>"}function j(){D=!D,i(),console.log("Start recording"),0==A&&D&&k(),D||(E=!0,p.stop())}function k(){try{const a=document.getElementById("live-player").getElementsByTagName("video")[0].captureStream(60);let b=[],c=0,d="";F=0,z?(console.log(a),p=new MediaRecorder(a),p.ondataavailable=(a)=>{0<a.data.size&&(b.length>=A&&!D&&b.splice(1,1),0===b.length&&(d=a.data.type),b.push(a.data),D&&(F=b.length,C.innerHTML="<span class='text'>\u5F55\u5236\u65F6\u957F "+l(F)+"</span>"),c++)},p.onstart=()=>{console.log("start recording")},p.onstop=()=>{E&&(E=!1,chrome.runtime.sendMessage({msg:"requestEncode",blob:window.URL.createObjectURL(new Blob(b,{type:d})),filename:y,startTime:c-F,duration:F})),b=[],0<A&&k()},p.start(1e3)):(p.ondataavailable=null,p.onstart=null,p.onstop=null,p=null)}catch(a){}}function l(a){return Math.floor(a/60)+" : "+(10>a%60?"0":"")+a%60}const m={原画:10000,蓝光HEVC:401,蓝光:400,超清HEVC:251,超清:250,高清:150,流畅:80};var n,o,p,q="\u539F\u753B",r=!1,s="-1",t=new MedalList,u="",v="",w=window.location.pathname.replaceAll("/","").replace("blanc",""),x=/^[0-9]*$/,y=document.title.replace(" - \u54D4\u54E9\u54D4\u54E9\u76F4\u64AD\uFF0C\u4E8C\u6B21\u5143\u5F39\u5E55\u76F4\u64AD\u5E73\u53F0","").replaceAll(" ",""),z=!0,A=300;!function(){const a={545:"\u5854\u5B9D",1603600:"\u4F1F\u5927\u7684\u5C71\u732A\u738B\u661F\u6C50Seki\u965B\u4E0B",21652717:"\u5168\u4E16\u754C\u6700\u597D\u7684\u8C79\u8C79",21775601:"\u7D2B\u8272\u53D4\u53D4",22486793:"\u590F\u9E641\uFF1F\u590F\u9E640\uFF01"};a[w]!==void 0&&(y.includes("-")?y=y.split("-")[0]+"-"+a[w]:y+="-"+a[w])}(),chrome.storage.sync.get(["qn"],function(a){n=a.qn}),chrome.storage.sync.get(["qnvalue"],function(a){q=a.qnvalue}),chrome.storage.sync.get(["medal"],(a)=>{o=a.medal}),chrome.storage.sync.get(["hiddenEntry"],(a)=>{r=a.hiddenEntry}),chrome.storage.sync.get(["record"],(a)=>{z=a.record}),chrome.storage.sync.get(["prerecord"],(a)=>{A=a.prerecord-1+1}),chrome.storage.onChanged.addListener(function(a){for(let[b,{oldValue:c,newValue:d}]of Object.entries(a))"medal"===b&&(o=d),"record"===b&&(z=d,0<A&&k())}),function(){chrome.runtime.sendMessage({msg:"get_LoginInfo"},function(a){s=a.res.split(",")[0],u=a.res.split(",")[2]})}(),setTimeout(function(){x.test(w)&&0<w.length&&b(),n&&x.test(w)&&0<w.length&&0===document.getElementsByTagName("article").length&&c(q),r&&"-1"!==s&&x.test(w)&&0<w.length&&0===document.getElementsByTagName("article").length&&a()},10),function(){function a(){if(document.getElementsByClassName("live-haruna-ctnr")[0]===void 0)setTimeout(a,200);else{let a=document.getElementsByClassName("live-haruna-ctnr")[0].getAttribute("style").replace(";","");document.getElementsByClassName("live-haruna-ctnr")[0].setAttribute("style",a+" scale("+b+");");var c=new MutationObserver(function(a){a.forEach(function(a){if("attributes"===a.type&&"style"===a.attributeName){let a=document.getElementsByClassName("live-haruna-ctnr")[0].getAttribute("style").replace(";","");a.includes("scale")||document.getElementsByClassName("live-haruna-ctnr")[0].setAttribute("style",a+" scale("+b+");")}})});c.observe(document.getElementsByClassName("live-haruna-ctnr")[0],{attributes:!0})}}let b=1/window.devicePixelRatio;a()}(),window.addEventListener("focus",function(){e(t.getByUid(v),!1)});const B=document.createElement("div"),C=document.createElement("div");let D=!1,E=!1,F=0,G=document.getElementById("web-player-controller-wrap-el");B.classList.add("rua-record"),C.classList.add("rua-recording-time");const H=new MutationObserver(function(a){a.forEach(function(a){"childList"===a.type&&(0===a.addedNodes.length&&B.removeEventListener("click",j),a.addedNodes[0]!==void 0&&"DIV"===a.addedNodes[0].nodeName&&z&&(h(),B.addEventListener("click",j)))})}),I=new MutationObserver(function(a){a.forEach(function(a){"childList"===a.type&&(a.addedNodes[0]!==void 0&&"VIDEO"===a.addedNodes[0].nodeName&&z&&0<A&&k(),null===G&&a.addedNodes[0]!==void 0&&"DIV"===a.addedNodes[0].nodeName&&"web-player-controller-wrap-el"===a.addedNodes[0].id&&(G=a.addedNodes[0],H.observe(G,{childList:!0})))})});try{null!==G&&H.observe(G,{childList:!0}),I.observe(document.getElementById("live-player"),{childList:!0})}catch(a){}}();