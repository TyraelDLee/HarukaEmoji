!function(){function a(){try{const a=document.getElementById("head-info-vm"),c=a.getElementsByClassName("live-title")[0].getElementsByClassName("text")[0].innerText,d=a.getElementsByClassName("lower-row")[0].getElementsByClassName("left-ctnr")[0].getElementsByTagName("a")[0].innerText;return b(c+"-"+d)}catch(a){}return A}function b(a){const b={545:"\u5854\u5B9D",1603600:"\u4F1F\u5927\u7684\u5C71\u732A\u738B\u661F\u6C50Seki\u965B\u4E0B",21652717:"\u5168\u4E16\u754C\u6700\u597D\u7684\u8C79\u8C79",21775601:"\u7D2B\u8272\u53D4\u53D4",22486793:"\u590F\u9E641\uFF1F\u590F\u9E640\uFF01"};return void 0!==b[y]&&(a.includes("-")?a=a.split("-")[0]+"-"+b[y]:a+="-"+b[y]),a}function d(){document.getElementById("chat-items")===void 0?setTimeout(d,100):0===document.getElementById("chat-items").getElementsByClassName("important-prompt-item").length?setTimeout(d,10):document.getElementById("chat-items").getElementsByClassName("important-prompt-item")[0].style.display="none"}function e(){fetch("https://api.live.bilibili.com/room/v1/Room/room_init?id="+y,{method:"GET",credentials:"include",body:null}).then((a)=>a.json()).then((a)=>{0===a.code&&(x=a.data.uid,f(a.data.uid))})}function f(a){fetch("https://api.live.bilibili.com/xlive/web-ucenter/user/MedalWall?target_id="+w,{method:"GET",credentials:"include",body:null}).then((a)=>a.json()).then((b)=>{if(0===b.code){let c=b.data.list;for(let a=0;a<c.length;a++)v.push(new Medal(c[a].medal_info.medal_id,c[a].medal_info.target_id,c[a].medal_info.target_id,c[a].medal_info.medal_name,c[a].medal_info.level,c[a].medal_info.medal_color_start,c[a].medal_info.medal_color_end,c[a].medal_info.medal_color_border));g(v.getByUid(a),!0)}})}function g(a,b){if("-1"!==u&&q&&"-1"!==a.MID){var c=new FormData;c.append("medal_id",a.MID),c.append("csrf",u),c.append("csrf_token",u),fetch("https://api.live.bilibili.com/xlive/web-room/v1/fansMedal/wear",{method:"POST",credentials:"include",body:c}).then(()=>{console.log("ware medal successful, MID="+a.MID),b&&h(a)})}}function h(a){let b=document.createEvent("MouseEvents");if(b.initEvent("click",!1,!0),0===document.getElementsByClassName("medal-section").length||0===document.getElementsByClassName("medal-section")[0].getElementsByTagName("span").length||0===document.getElementsByClassName("medal-section")[0].getElementsByTagName("span")[0].getElementsByTagName("span").length)setTimeout(()=>{h(a)},200);else{let c=document.getElementsByClassName("medal-section")[0].getElementsByTagName("span")[0];c.dispatchEvent(b),setTimeout(function(){let b=document.getElementById("control-panel-ctnr-box").getElementsByClassName("medal")[0];void 0!==b&&(b.style.display="none");let c=document.getElementById("control-panel-ctnr-box").getElementsByClassName("fans-medal-content")[0].innerText;(void 0===c||c!==a.mName)&&setTimeout(()=>{h(a)},1e3)},20)}}function c(a){let b=document.createEvent("MouseEvents");if(b.initEvent("mousemove",!1,!1),void 0===document.getElementById("live-player")||void 0===document.getElementById("live-player").getElementsByClassName("web-player-controller-wrap").length||0===document.getElementById("live-player").getElementsByClassName("web-player-controller-wrap").length)setTimeout(c,200);else{let c=document.getElementById("live-player"),d=c.getElementsByClassName("web-player-controller-wrap");void 0!==d&&(d[0].style.visibility="hidden",d[1].style.visibility="hidden"),c.dispatchEvent(b),setTimeout(function(){b.initEvent("mouseenter",!1,!0);let e=c.getElementsByClassName("quality-wrap")[0];void 0!==e&&(e.dispatchEvent(b),b.initEvent("click",!1,!0),setTimeout(function(){let d=e.getElementsByClassName("panel")[0].getElementsByClassName("quality-it");if(1<d.length){let e=[];for(let a=0;a<d.length;a++)e.push(d[a].innerHTML.replaceAll(" ",""));d[i(a,e)].dispatchEvent(b),b.initEvent("mouseleave",!1,!1),c.dispatchEvent(b)}},100)),setTimeout(()=>{void 0!==d&&(d[0].style.visibility="visible",d[1].style.visibility="visible")},250)},100)}}function i(a,b){let c=0;for(let d=0;d<b.length;d++)o[b[d]]>=o[a]&&(c=d);return c}function j(){k(),I.getElementsByClassName("right-area")[0].appendChild(D)}function k(){D.innerHTML="<span class='text'>"+(F?"\u7ED3\u675F\u5F55\u5236":"\u5F00\u59CB\u5F55\u5236")+"</span>",F?(E.innerHTML="<span class='text'>\u5F55\u5236\u65F6\u957F "+n(H)+"</span>",I.getElementsByClassName("left-area")[0].appendChild(E)):E.innerHTML="<span class='text'></span>"}function l(){F=!F,k(),console.log("Start recording"),0==C&&F&&m(),F||(G=!0,r.stop())}function m(){try{const b=document.getElementById("live-player").getElementsByTagName("video")[0].captureStream();let c=[],d=0,f="",g=0;H=0,B?(console.log(b),r=new MediaRecorder(b),r.ondataavailable=(a)=>{0<a.data.size&&(c.length>=C&&!F&&c.splice(1,1),0===c.length&&(f=a.data.type),c.push(a.data),g+=a.data.size/1048576,F&&(H=c.length,E.innerHTML="<span class='text'>\u5F55\u5236\u65F6\u957F "+n(H)+"</span>"),d++)},r.onstart=()=>{console.log("start recording")},r.onstop=()=>{if(G){const b=new Blob(c,{type:f}),e=window.URL.createObjectURL(b);G=!1,A=a(),console.log("clip sent to process: \r\nfileName: "+A+"\r\nvideo duration: "+H+"s\r\nfile size: "+b.size/1048576+"MiB\r\nmime type: "+b.type),chrome.runtime.sendMessage({msg:"requestEncode",blob:e,filename:A,startTime:d-H,duration:H})}c=[],0<C&&m()},r.start(1e3)):(r.ondataavailable=null,r.onstart=null,r.onstop=null,r=null)}catch(a){}}function n(a){return Math.floor(a/60)+" : "+(10>a%60?"0":"")+a%60}const o={原画:10000,蓝光HEVC:401,蓝光:400,超清HEVC:251,超清:250,高清:150,流畅:80};var p,q,r,s="\u539F\u753B",t=!1,u="-1",v=new MedalList,w="",x="",y=window.location.pathname.replaceAll("/","").replace("blanc",""),z=/^[0-9]*$/,A=document.title.replace(" - \u54D4\u54E9\u54D4\u54E9\u76F4\u64AD\uFF0C\u4E8C\u6B21\u5143\u5F39\u5E55\u76F4\u64AD\u5E73\u53F0","").replaceAll(" ",""),B=!0,C=300;chrome.storage.sync.get(["qn"],function(a){p=a.qn}),chrome.storage.sync.get(["qnvalue"],function(a){s=a.qnvalue}),chrome.storage.sync.get(["medal"],(a)=>{q=a.medal}),chrome.storage.sync.get(["hiddenEntry"],(a)=>{t=a.hiddenEntry}),chrome.storage.sync.get(["record"],(a)=>{B=a.record}),chrome.storage.sync.get(["prerecord"],(a)=>{C=a.prerecord-1+1}),chrome.storage.onChanged.addListener(function(a){for(let[b,{oldValue:c,newValue:d}]of Object.entries(a))"medal"===b&&(q=d),"record"===b&&(B=d,0<C&&m())}),function(){chrome.runtime.sendMessage({msg:"get_LoginInfo"},function(a){u=a.res.split(",")[0],w=a.res.split(",")[1]})}(),setTimeout(function(){z.test(y)&&0<y.length&&e(),p&&z.test(y)&&0<y.length&&0===document.getElementsByTagName("article").length&&c(s),t&&"-1"!==u&&z.test(y)&&0<y.length&&0===document.getElementsByTagName("article").length&&d()},10),function(){function a(){if(document.getElementsByClassName("live-haruna-ctnr")[0]===void 0)setTimeout(a,200);else{let a=document.getElementsByClassName("live-haruna-ctnr")[0].getAttribute("style").replace(";","");document.getElementsByClassName("live-haruna-ctnr")[0].setAttribute("style",a+" scale("+b+");");var c=new MutationObserver(function(a){a.forEach(function(a){if("attributes"===a.type&&"style"===a.attributeName){let a=document.getElementsByClassName("live-haruna-ctnr")[0].getAttribute("style").replace(";","");a.includes("scale")||document.getElementsByClassName("live-haruna-ctnr")[0].setAttribute("style",a+" scale("+b+");")}})});c.observe(document.getElementsByClassName("live-haruna-ctnr")[0],{attributes:!0})}}let b=1/window.devicePixelRatio;a()}(),window.addEventListener("focus",function(){g(v.getByUid(x),!1)});const D=document.createElement("div"),E=document.createElement("div");let F=!1,G=!1,H=0,I=document.getElementById("web-player-controller-wrap-el");D.classList.add("rua-record"),E.classList.add("rua-recording-time");const J=new MutationObserver(function(a){a.forEach(function(a){"childList"===a.type&&(0===a.addedNodes.length&&D.removeEventListener("click",l),a.addedNodes[0]!==void 0&&"DIV"===a.addedNodes[0].nodeName&&B&&(j(),D.addEventListener("click",l)))})}),K=new MutationObserver(function(a){a.forEach(function(a){"childList"===a.type&&(a.addedNodes[0]!==void 0&&"VIDEO"===a.addedNodes[0].nodeName&&B&&0<C&&m(),null===I&&a.addedNodes[0]!==void 0&&"DIV"===a.addedNodes[0].nodeName&&"web-player-controller-wrap-el"===a.addedNodes[0].id&&(I=a.addedNodes[0],J.observe(I,{childList:!0})))})});try{null!==I&&J.observe(I,{childList:!0}),K.observe(document.getElementById("live-player"),{childList:!0})}catch(a){}}();