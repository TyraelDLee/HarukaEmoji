!function(){let a=window.location.pathname.replaceAll("/","").replace("blanc",""),b=0,c=!1,d=/^\d*$/;if(d.test(a)){function d(){e=window.innerHeight*k,f=window.innerWidth*k}function p(a,b,c,d){var e=Math.abs;return 0===e(a-c)&&0===e(b-d)}function q(){if(console.log("load complete"),"-1"==g||"-1"==h)H.innerHTML="<div id='load'>\u52A0\u8F7D\u5931\u8D25\uFF0C<br>\u8BF7<a href="+window.location+">\u70B9\u51FB\u8FD9\u91CC</a>\u91CD\u8BD5<br><br>\u5982\u672A\u767B\u5F55\uFF0C\u8BF7\u5148\u767B\u5F55</div>",document.getElementById("load").style.marginTop="130px";else{function a(){document.getElementsByClassName("fullscreen-danmaku")[0].classList.add("emoji-fullscreen-danmaku"),j.style.display="none",k.style.display="none",g.style.display="none",f.style.display="none",g.classList.add("emoji_sec"),g.setAttribute("id","fullscreen-table"),h.classList.add("emoji-table"),w(8,l,h,m),v(8,i),g.appendChild(h),g.appendChild(i),f.setAttribute("id","fs-emoji-bg"),l.placeholder="\u53D1\u4E2A\u5F39\u5E55\u5457~",l.setAttribute("id","fullscreen-input"),m.setAttribute("id","fullscreen-text-length"),m.innerHTML=" 0/"+n,j.setAttribute("id","first-child"),j.appendChild(l),j.appendChild(m),k.innerHTML="\u53D1\u9001",k.classList.add("send-danmaku"),k.setAttribute("id","fullscreen-sub-btn"),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(j),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(k),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(f),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(g)}function b(){o.style.display="none",p.style.display="none",j.style.display="block",k.style.display="block",g.style.display="block",f.style.display="block",document.getElementsByClassName("emoji-fullscreen-danmaku")[0].addEventListener("mouseenter",function(){g.classList.remove("fullscreen-hoverout"),g.classList.add("fullscreen-hoverin")}),document.getElementsByClassName("fullscreen-danmaku")[0].addEventListener("mouseleave",function(){g.classList.remove("fullscreen-hoverin"),g.classList.add("fullscreen-hoverout")}),document.getElementById("live-player").addEventListener("mousemove",d),k.addEventListener("click",function(){t(l.value),l.value="",m.innerHTML=" 0/"+n})}function c(){o.style.display="block",p.style.display="block",j.style.display="none",k.style.display="none",g.style.display="none",f.style.display="none",document.getElementById("live-player").removeEventListener("mousemove",d)}function d(){clearTimeout(e),e=setTimeout(function(){g.classList.remove("fullscreen-hoverout")},2e3)}n=0<document.getElementsByClassName("input-limit-hint").length?document.getElementsByClassName("input-limit-hint")[0].innerHTML.split("/")[1]:"20",L.innerHTML=" 0/"+n,J.style.display="block",K.style.display="block",L.style.display="block",N.style.display="block",M.style.display="block",w(4,J,H,L),v(4,I),K.onclick=function(){t(J.value),L.innerHTML=" 0/"+document.getElementsByClassName("input-limit-hint")[0].innerHTML.split("/")[1],J.value=""},P.addEventListener("change",function(){this.checked?b():c()});let e=null;const f=document.createElement("div"),g=document.createElement("div"),h=document.createElement("table"),i=document.createElement("table"),j=document.createElement("div"),k=document.createElement("div"),l=document.createElement("input"),m=document.createElement("span");let o,p;setTimeout(()=>{o=document.getElementsByClassName("fullscreen-danmaku")[0].getElementsByTagName("div")[0],p=document.getElementsByClassName("fullscreen-danmaku")[0].getElementsByTagName("div")[1],a(),b()},2e3)}}function r(){try{chrome.runtime.sendMessage({msg:"get_LoginInfo"},function(a){g=a.res.split(",")[0],h=a.res.split(",")[1]})}catch(a){}}function s(){return Math.round(Date.now()/1e3)}function t(b,c){let d=new FormData;d.append("bubble","0"),d.append("msg",b),d.append("color","16777215"),d.append("mode","1"),c!==void 0&&"systemEmoji"===c&&d.append("dm_type","1"),d.append("fontsize","25"),d.append("rnd",s()+""),d.append("roomid",a),d.append("csrf",g),d.append("csrf_token",g),0!==b.length&&u(d)}function u(a){fetch("https://api.live.bilibili.com/msg/send?requestFrom=rua5",{method:"POST",credentials:"include",body:a}).then(()=>{console.log("sent")}).catch((a)=>{console.error("Error:",a)})}function v(b,c){fetch("https://api.live.bilibili.com/xlive/web-ucenter/v2/emoticon/GetEmoticons?platform=pc&room_id="+a,{method:"GET",credentials:"include",body:null}).then((a)=>a.json()).then((a)=>{if(0===a.code){let e="";for(let c=2;0<=c;c--)if(a.data.data[c]!==void 0&&null!==a.data.data[c]){e+=`</tr></tbody><thead><tr><th colspan='4' class='rua-table-header'>${a.data.data[c].pkg_name}</th></tr></thead><tbody><tr>`;for(let d=0;d<a.data.data[c].emoticons.length;d++)0==d%b&&0!==d&&(e+="</tr><tr>"),e+=`<td colspan="1" title="${a.data.data[c].emoticons[d].emoji}" class="rua-emoji-icon" id="${a.data.data[c].emoticons[d].emoticon_unique}" style="background-image:url('${a.data.data[c].emoticons[d].url.replace("http://","https://")}');"><div class="rua-emoji-requirement" style="background-color: ${a.data.data[c].emoticons[d].unlock_show_color};"><div class="rua-emoji-requirement-text">${a.data.data[c].emoticons[d].unlock_show_text}</div></div></td>`}e+="</tr></tbody>",c.innerHTML=e;for(let a=0;a<c.rows.length;a++){var d=c.rows[a].cells;for(let a=0;a<d.length;a++)d[a].onclick=function(a){0===a.button&&t(this.id,"systemEmoji")}}}0===H.innerHTML.length&&25>=I.innerHTML.length&&(I.innerHTML=`<div id="load">当前直播间没有表情包，<br>如显示不正确，请<a href="${window.location}">点击这里</a>重试<br><br></div>`)}).catch(()=>{})}function w(a,b,c,d){try{let f=[0,0];b.addEventListener("compositionstart",()=>{Q=!1,R=!1}),b.addEventListener("compositionend",()=>{Q=!0,console.log("compositionend")}),b.addEventListener("keyup",(a)=>{13===a.keyCode&&R&&(a.preventDefault(),t(b.value),b.value=""),Q&&(R=!0),f=y(d,b)}),b.addEventListener("keydown",(a)=>{"Enter"===a.code&&a.preventDefault()}),b.addEventListener("select",(a)=>{f=[a.target.selectionStart,a.target.selectionEnd]});let g="<thead><tr><th colspan=\"4\" class=\"rua-table-header\">\u5F39\u5E55\u673A\u8868\u60C5</th></tr></thead>";g+="<tbody><tr>";for(let b=0;b<imgs.length;b++)0==b%a&&0!==b&&(g+="</tr><tr>"),g+=`<td colspan="${imgs[b].getSpan()}" title="${emoji[b]}" class="rua-emoji-icon" style="background-image:url('${imgs[b].getURL()}');"></td>`;g+="</tr></tbody>",c.innerHTML=g;for(let g=1;g<c.rows.length;g++){var e=c.rows[g].cells;for(let c=0;c<e.length;c++)e[c].onclick=function(h){0===h.button&&(b.value=b.value.substr(0,f[0])+"("+emoji[c+(g-1)*a]+")"+b.value.substr(f[1]),f=y(d,b))}}}catch(a){c.innerHTML=""}}function x(a,b){a.innerHTML=10>b?" "+b+"/"+n:b+"/"+n}function y(a,b){return x(a,b.value.length),[b.selectionStart,b.selectionEnd]}function z(a){let b=document.getElementById(a),c=[b.offsetLeft,b.offsetTop],d=b.offsetParent;for(;null!==d;)c[0]+=d.offsetLeft,c[1]+=d.offsetTop+d.clientTop,d=d.offsetParent;return c[0]+=b.clientWidth-60,c[1]+=b.clientHeight-60,c}function A(){let a=z("rank-list-vm");m=[f-a[0],a[1],a[0]],m[2]>f-60?(E.style.left=f-60+"px",F.style.left=f-370+"px"):(E.style.left=m[2]+"px",F.style.left=m[2]-310+"px")}function B(){if(null===localStorage.getItem("rua_pos"))A(),l=!1;else if(localStorage.getItem("rua_pos").includes("undefined"))localStorage.removeItem("rua_pos"),A(),l=!1;else{l=!0;for(let a=0;3>a;a++)m[a]=parseInt(localStorage.getItem("rua_pos").split(",")[a]);let a=0;a=m[0]<m[2]?f-m[0]:m[2],m[1]>e-50&&(m[1]=e-50),E.style.left=a+"px",F.style.left=320>a?a+60+"px":a-310+"px"}}function C(a){a?(F.style.background="#151515",G.style.opacity="0.8",K.style.opacity="0.8",J.style.background="#151515",J.style.borderColor="#2b2b2b"):(F.style.removeProperty("background"),G.style.removeProperty("opacity"),K.style.removeProperty("opacity"),J.style.removeProperty("background"),J.style.removeProperty("border-color"))}var e,f,g="-1",h="-1",i=window.innerWidth,j=[],k=1;d(),r(),setInterval(r,3e3);var l=!1,m=[100,100,100];const D=document.body,E=document.createElement("div"),F=document.createElement("div"),G=document.createElement("div"),H=document.createElement("table"),I=document.createElement("table"),J=document.createElement("textarea"),K=document.createElement("button"),L=document.createElement("span"),M=document.createElement("span"),N=document.createElement("section"),O=document.createElement("div"),P=document.createElement("input");var n;(function b(){fetch("https://api.live.bilibili.com/room/v1/Room/room_init?id="+a,{method:"GET",credentials:"include",body:null}).then((a)=>a.json()).then((c)=>{0===c.code?a=c.data.room_id:setTimeout(b,1e3)}).catch(()=>{setTimeout(b,1e3)})})(),function d(){fetch("https://api.live.bilibili.com/xlive/web-room/v1/index/getInfoByUser?from=0&room_id="+a,{method:"GET",credentials:"include",body:null}).then((a)=>a.json()).then((a)=>{0===a.code?(b=a.data.privilege.privilege_type,c=a.data.relation.is_in_fansclub):setTimeout(d,1e3)}).catch(()=>{setTimeout(d,1e3)})}(),0===document.getElementsByTagName("article").length&&function(){B(),E.setAttribute("id","emoji-popup"),E.style.background="url("+chrome.runtime.getURL("../images/haruka/abaaba.svg")+") no-repeat center";try{E.style.background="url("+link+") no-repeat center"}catch(a){}E.style.backgroundSize="contain",E.style.cursor="pointer",E.innerHTML="<!---->",F.setAttribute("id","emoji-selection"),F.classList.add("emoji_sec"),F.style.display="none",F.innerHTML="",G.setAttribute("id","emoji-tray"),G.classList.add("emoji_sec"),G.appendChild(H),G.appendChild(I),H.setAttribute("class","emoji-table"),H.innerHTML="<div id='load'>\u52A0\u8F7D\u5F39\u5E55\u4E2D...</div>",I.setAttribute("class","emoji-table"),F.appendChild(G),D.appendChild(F),D.appendChild(E),E.style.top=m[1]+"px",F.style.top=m[1]-5+"px",K.setAttribute("id","input-button"),K.innerHTML="<span>\u53D1\u9001</span>",K.style.display="none",J.setAttribute("id","input-form"),J.placeholder="\u8FD9\u91CC\u4E5F\u53EF\u4EE5\u53D1\u5F39\u5E55~",J.style.display="none",L.setAttribute("id","length-indicator"),L.style.display="none",N.classList.add("button"),O.classList.add("checkbox"),P.type="checkbox",P.checked=!0,O.appendChild(P),O.appendChild(document.createElement("label")),N.appendChild(O),N.style.display="none",M.setAttribute("id","fullscreen-label"),M.innerHTML="\u5168\u5C4F\u663E\u793A",M.style.display="none",F.appendChild(J),F.appendChild(K),F.appendChild(N),F.appendChild(M),F.appendChild(L);var a=[0,0],b=[0,0];window.onload=function(){E.onmousedown=function(c){let d,g;document.body.style.userSelect="none",E.className="popup-click-in";const h=c||event,i=h.clientX-E.offsetLeft,j=h.clientY-E.offsetTop;a=[E.offsetLeft,E.offsetTop],b=[E.offsetLeft,E.offsetTop],document.onmousemove=function(a){const c=a||event;0<=c.clientX-i&&c.clientX-i<=f-60&&(d=c.clientX-i),0<=c.clientY-j&&c.clientY-j<=e-60&&(g=c.clientY-j),b=[d,g],E.style.left=d+"px",E.style.top=g+"px",F.style.left=320>d?d+60+"px":d-310+"px",F.style.top=g>e-360?e-360+"px":g-5+"px",g===void 0&&(g=E.offsetTop),-1<d&&(m=[f-d,g,d])},document.onmouseup=function(){document.body.style.userSelect="auto",E.className="popup-click-out",p(a[0],a[1],b[0],b[1])?"none"===F.style.display?(F.classList.remove("selection-fade-out"),F.style.display="block",F.classList.add("selection-fade-in")):(F.classList.remove("selection-fade-in"),F.classList.add("selection-fade-out"),setTimeout(()=>{F.style.display="none"},300)):(l=!0,localStorage.setItem("rua_pos",m[0]+","+m[1]+","+m[2])),document.onmousemove=null,document.onmouseup=null}},E.onmouseenter=function(){E.className="popup-click-hoverin"},E.onmouseleave=function(){E.className="popup-click-hoverout"}},window.addEventListener("resize",function(){let a,b=m[0]<m[2]?m[0]/i:m[2]/i;d(),l?(a=m[0]<m[2]?f-m[0]:m[2],E.style.left=a+"px"):A(),m[1]>e-60&&(E.style.top=e-60+"px",F.style.top=e-360+"px"),F.style.left=320>a?a+60+"px":a-310+"px"}),setTimeout(q,1e3)}();let Q=!0,R=!0;var o=new MutationObserver(function(a){a.forEach(function(a){"attributes"===a.type&&(null===S.getAttribute("lab-style")?C(!1):(j=S.getAttribute("lab-style").split(","),-1===j.indexOf("dark")?C(!1):C(!0)))})});const S=document.documentElement;o.observe(S,{attributes:!0})}}();