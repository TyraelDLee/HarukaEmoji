!function(){function a(){p=window.innerHeight*1,q=window.innerWidth*1}function b(){n(),y.setAttribute("id","emoji-popup"),y.style.background="url("+link+") no-repeat center",y.style.backgroundSize="contain",y.style.cursor="pointer",y.innerHTML="<!---->",z.setAttribute("id","emoji-selection"),z.classList.add("emoji_sec"),z.style.display="none",z.innerHTML="",A.setAttribute("id","emoji-tray"),A.classList.add("emoji_sec"),A.appendChild(B),B.setAttribute("class","emoji-table"),B.innerHTML="<div id='load'>\u52A0\u8F7D\u5F39\u5E55\u4E2D...</div>",z.appendChild(A),x.appendChild(z),x.appendChild(y),y.style.top=w[1]+"px",z.style.top=w[1]-5+"px",D.setAttribute("id","input-button"),D.innerHTML="<span>\u53D1\u9001</span>",D.style.display="none",C.setAttribute("id","input-form"),C.placeholder="\u8FD9\u91CC\u4E5F\u53EF\u4EE5\u53D1\u5F39\u5E55~",C.style.display="none",E.setAttribute("id","length-indicator"),E.style.display="none",G.classList.add("button"),H.classList.add("checkbox"),I.type="checkbox",H.appendChild(I),H.appendChild(document.createElement("label")),G.appendChild(H),G.style.display="none",F.setAttribute("id","fullscreen-label"),F.innerHTML="\u5168\u5C4F\u663E\u793A",F.style.display="none",z.appendChild(C),z.appendChild(D),z.appendChild(G),z.appendChild(F),z.appendChild(E);var b=[0,0],e=[0,0];window.onload=function(){y.onmousedown=function(a){let d,f;document.body.style.userSelect="none",y.className="popup-click-in";const g=a||event,h=g.clientX-y.offsetLeft,i=g.clientY-y.offsetTop;b=[y.offsetLeft,y.offsetTop],e=[y.offsetLeft,y.offsetTop],document.onmousemove=function(a){const b=a||event;0<=b.clientX-h&&b.clientX-h<=q-60&&(d=b.clientX-h),0<=b.clientY-i&&b.clientY-i<=p-60&&(f=b.clientY-i),e=[d,f],y.style.left=d+"px",y.style.top=f+"px",z.style.left=320>d?d+60+"px":d-310+"px",z.style.top=f>p-360?p-360+"px":f-5+"px",f===void 0&&(f=y.offsetTop),-1<d&&(w=[q-d,f,d])},document.onmouseup=function(){document.body.style.userSelect="auto",y.className="popup-click-out",c(b[0],b[1],e[0],e[1])?"none"===z.style.display?(z.classList.remove("selection-fade-out"),z.style.display="block",z.classList.add("selection-fade-in")):(z.classList.remove("selection-fade-in"),z.classList.add("selection-fade-out"),setTimeout(()=>{z.style.display="none"},300)):(v=!0,localStorage.setItem("rua_pos",w[0]+","+w[1]+","+w[2])),document.onmousemove=null,document.onmouseup=null}},y.onmouseenter=function(){y.className="popup-click-hoverin"},y.onmouseleave=function(){y.className="popup-click-hoverout"}},window.addEventListener("resize",function(){let b,c=w[0]<w[2]?w[0]/t:w[2]/t;a(),v?(b=w[0]<w[2]?q-w[0]:w[2],y.style.left=b+"px"):m(),w[1]>p-60&&(y.style.top=p-60+"px",z.style.top=p-360+"px"),z.style.left=320>b?b+60+"px":b-310+"px"}),setTimeout(d,5e3)}function c(a,b,c,d){var e=Math.abs;return 0===e(a-c)&&0===e(b-d)}function d(){if(console.log("load complete"),"-1"===r||"-1"===s)B.innerHTML="<div id='load'>\u52A0\u8F7D\u5931\u8D25\uFF0C<br>\u8BF7<a href="+window.location+">\u70B9\u51FB\u8FD9\u91CC</a>\u91CD\u8BD5<br><br>\u5982\u672A\u767B\u5F55\uFF0C\u8BF7\u5148\u767B\u5F55</div>",document.getElementById("load").style.marginTop="130px";else{function a(){n.style.display="none",o.style.display="none",e.style.display="block",f.style.display="block",h.style.display="block",m.style.display="block",document.getElementsByClassName("emoji-fullscreen-danmaku")[0].addEventListener("mouseenter",function(){h.classList.remove("fullscreen-hoverout"),h.classList.add("fullscreen-hoverin")}),document.getElementsByClassName("fullscreen-danmaku")[0].addEventListener("mouseleave",function(){h.classList.remove("fullscreen-hoverin"),h.classList.add("fullscreen-hoverout")}),document.getElementById("live-player").addEventListener("mousemove",c),f.addEventListener("click",function(){g(j.value),j.value="",k.innerHTML=" 0/30"})}function b(){n.style.display="block",o.style.display="block",e.style.display="none",f.style.display="none",h.style.display="none",m.style.display="none",document.getElementById("live-player").removeEventListener("mousemove",c)}function c(){clearTimeout(d),d=setTimeout(function(){h.classList.remove("fullscreen-hoverout")},2e3)}J=0<document.getElementsByClassName("input-limit-hint").length?document.getElementsByClassName("input-limit-hint")[0].innerHTML.split("/")[1]:"20",E.innerHTML=" 0/"+J,C.style.display="block",D.style.display="block",E.style.display="block",G.style.display="block",F.style.display="block",i(4,C,B,z,E),D.onclick=function(){g(C.value),E.innerHTML=" 0/"+document.getElementsByClassName("input-limit-hint")[0].innerHTML.split("/")[1],C.value=""},I.addEventListener("change",function(){this.checked?a():b()});let d=null,e=document.createElement("div"),f=document.createElement("div"),h=document.createElement("div"),j=document.createElement("input"),k=document.createElement("span"),l=document.createElement("table"),m=document.createElement("div"),n=document.getElementsByClassName("fullscreen-danmaku")[0].getElementsByTagName("div")[0],o=document.getElementsByClassName("fullscreen-danmaku")[0].getElementsByTagName("div")[1];(function(){document.getElementsByClassName("fullscreen-danmaku")[0].classList.add("emoji-fullscreen-danmaku"),e.style.display="none",f.style.display="none",h.style.display="none",m.style.display="none",h.classList.add("emoji_sec"),h.setAttribute("id","fullscreen-table"),l.classList.add("emoji-table"),i(8,j,l,h,k),h.appendChild(l),m.setAttribute("id","fs-emoji-bg"),j.placeholder="\u53D1\u4E2A\u5F39\u5E55\u5457~",j.setAttribute("id","fullscreen-input"),k.setAttribute("id","fullscreen-text-length"),k.innerHTML=" 0/30",e.setAttribute("id","first-child"),e.appendChild(j),e.appendChild(k),f.innerHTML="\u53D1\u9001",f.classList.add("send-danmaku"),f.setAttribute("id","fullscreen-sub-btn"),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(e),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(f),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(m),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(h)})()}}function e(){chrome.runtime.sendMessage({msg:"get_LoginInfo"},function(a){r=a.res.split(",")[0],s=a.res.split(",")[1]})}function f(){return Math.round(Date.now()/1e3)}function g(a){let b=new FormData;b.append("bubble","0"),b.append("msg",a),b.append("color","16777215"),b.append("mode","1"),b.append("fontsize","25"),b.append("rnd",f()+""),b.append("roomid",ROOM_ID),b.append("csrf",r),b.append("csrf_token",r),0!==a.length&&h(b)}function h(a){fetch("https://api.live.bilibili.com/msg/send?requestFrom=rua5",{method:"POST",credentials:"include",body:a}).then(()=>{console.log("sent")}).catch(a=>{console.error("Error:",a)})}function i(a,b,c,d,e){b.addEventListener("keyup",function(a){13===a.keyCode&&(a.preventDefault(),g(b.value),b.value="")}),b.addEventListener("keydown",function(a){"Enter"===a.code&&a.preventDefault()});let f=[0,0];b.onkeyup=function(){f=k(e,b)},d.addEventListener("mousemove",function(){f=k(e,b)});let h="<tbody><tr>";for(let f=0;f<imgs.length;f++)0==f%a&&0!==f&&(h+="</tr><tr>"),h+="<td colspan="+imgs[f].getSpan()+" class=\"rua-emoji-icon\" style=\" background:url("+imgs[f].getURL()+") no-repeat bottom center; background-size: contain\"></td>";h+="</tr></tbody>",c.innerHTML=h;for(let g=0;g<c.rows.length;g++){var l=c.rows[g].cells;for(let c=0;c<l.length;c++)l[c].onclick=function(){b.value=b.value.substr(0,f[0])+"("+emoji[c+g*a]+")"+b.value.substr(f[1]),f=k(e,b)}}}function j(a,b){a.innerHTML=10>b?" "+b+"/"+J:b+"/"+J}function k(a,b){let c=b.selectionStart,d=b.selectionEnd;return j(a,b.value.length),[c,d]}function l(a){let b=document.getElementById(a),c=[b.offsetLeft,b.offsetTop],d=b.offsetParent;for(;null!==d;)c[0]+=d.offsetLeft,c[1]+=d.offsetTop+d.clientTop,d=d.offsetParent;return c[0]+=b.clientWidth-60,c[1]+=b.clientHeight-60,c}function m(){let a=l("rank-list-vm");w=[q-a[0],a[1],a[0]],w[2]>q-60?(y.style.left=q-60+"px",z.style.left=q-370+"px"):(y.style.left=w[2]+"px",z.style.left=w[2]-310+"px")}function n(){if(null===localStorage.getItem("rua_pos"))m(),v=!1;else if(localStorage.getItem("rua_pos").includes("undefined"))localStorage.removeItem("rua_pos"),m(),v=!1;else{v=!0;for(let a=0;3>a;a++)w[a]=parseInt(localStorage.getItem("rua_pos").split(",")[a]);let a=0;a=w[0]<w[2]?q-w[0]:w[2],w[1]>p-50&&(w[1]=p-50),y.style.left=a+"px",z.style.left=320>a?a+60+"px":a-310+"px"}}function o(a){a?(z.style.background="#151515",A.style.opacity="0.8",D.style.opacity="0.8",C.style.background="#151515",C.style.borderColor="#2b2b2b"):(z.style.removeProperty("background"),A.style.removeProperty("opacity"),D.style.removeProperty("opacity"),C.style.removeProperty("background"),C.style.removeProperty("border-color"))}var p,q,r="-1",s="-1",t=window.innerWidth,u=[];a(),e(),setInterval(e,3e3);var v=!1,w=[100,100,100];const x=document.body,y=document.createElement("div"),z=document.createElement("div"),A=document.createElement("div"),B=document.createElement("table"),C=document.createElement("textarea"),D=document.createElement("button"),E=document.createElement("span"),F=document.createElement("span"),G=document.createElement("section"),H=document.createElement("div"),I=document.createElement("input");var J;0===document.getElementsByTagName("article").length&&b();var K=new MutationObserver(function(a){a.forEach(function(a){"attributes"===a.type&&(null===L.getAttribute("lab-style")?o(!1):(u=L.getAttribute("lab-style").split(","),-1===u.indexOf("dark")?o(!1):o(!0)))})});const L=document.documentElement;K.observe(L,{attributes:!0})}();