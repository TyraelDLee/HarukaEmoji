!function(){function a(){q=window.innerHeight*1,r=window.innerWidth*1}function b(){o(),z.setAttribute("id","emoji-popup"),z.style.background="url("+link+") no-repeat center",z.style.backgroundSize="contain",z.style.cursor="pointer",z.innerHTML="<!---->",A.setAttribute("id","emoji-selection"),A.classList.add("emoji_sec"),A.style.display="none",A.innerHTML="",B.setAttribute("id","emoji-tray"),B.classList.add("emoji_sec"),B.appendChild(C),C.setAttribute("class","emoji-table"),C.innerHTML="<div id='load'>\u52A0\u8F7D\u5F39\u5E55\u4E2D...</div>",A.appendChild(B),y.appendChild(A),y.appendChild(z),z.style.top=x[1]+"px",A.style.top=x[1]-5+"px",E.setAttribute("id","input-button"),E.innerHTML="<span>\u53D1\u9001</span>",E.style.display="none",D.setAttribute("id","input-form"),D.placeholder="\u8FD9\u91CC\u4E5F\u53EF\u4EE5\u53D1\u5F39\u5E55~",D.style.display="none",F.setAttribute("id","length-indicator"),F.style.display="none",H.classList.add("button"),I.classList.add("checkbox"),J.type="checkbox",I.appendChild(J),I.appendChild(document.createElement("label")),H.appendChild(I),H.style.display="none",G.setAttribute("id","fullscreen-label"),G.innerHTML="\u5168\u5C4F\u663E\u793A",G.style.display="none",A.appendChild(D),A.appendChild(E),A.appendChild(H),A.appendChild(G),A.appendChild(F);var b=[0,0],f=[0,0];window.onload=function(){z.onmousedown=function(a){let e,g;document.body.style.userSelect="none",z.className="popup-click-in";const h=a||event,i=h.clientX-z.offsetLeft,j=h.clientY-z.offsetTop;b=[z.offsetLeft,z.offsetTop],f=[z.offsetLeft,z.offsetTop],document.onmousemove=function(a){const b=a||event;0<=b.clientX-i&&b.clientX-i<=r-60&&(e=b.clientX-i),0<=b.clientY-j&&b.clientY-j<=q-60&&(g=b.clientY-j),f=[e,g],z.style.left=e+"px",z.style.top=g+"px",A.style.left=320>e?e+60+"px":e-310+"px",A.style.top=g>q-360?q-360+"px":g-5+"px",g===void 0&&(g=z.offsetTop),-1<e&&(x=[r-e,g,e])},document.onmouseup=function(){document.body.style.userSelect="auto",z.className="popup-click-out",d(b[0],b[1],f[0],f[1])?"none"===A.style.display?(A.classList.remove("selection-fade-out"),A.style.display="block",A.classList.add("selection-fade-in")):(A.classList.remove("selection-fade-in"),A.classList.add("selection-fade-out"),setTimeout(c,150)):(w=!0,localStorage.setItem("rua_pos",x[0]+","+x[1]+","+x[2])),document.onmousemove=null,document.onmouseup=null}},z.onmouseenter=function(){z.className="popup-click-hoverin"},z.onmouseleave=function(){z.className="popup-click-hoverout"}},window.addEventListener("resize",function(){let b,c=x[0]<x[2]?x[0]/u:x[2]/u;a(),w?(b=x[0]<x[2]?r-x[0]:x[2],z.style.left=b+"px"):n(),x[1]>q-60&&(z.style.top=q-60+"px",A.style.top=q-360+"px"),A.style.left=320>b?b+60+"px":b-310+"px"}),setTimeout(e,5e3)}function c(){A.style.display="none"}function d(a,b,c,d){var e=Math.abs;return 0===e(a-c)&&0===e(b-d)}function e(){if(console.log("load complete"),"-1"===s||"-1"===t)C.innerHTML="<div id='load'>\u52A0\u8F7D\u5931\u8D25\uFF0C<br>\u8BF7<a href="+window.location+">\u70B9\u51FB\u8FD9\u91CC</a>\u91CD\u8BD5<br><br>\u5982\u672A\u767B\u5F55\uFF0C\u8BF7\u5148\u767B\u5F55</div>",document.getElementById("load").style.marginTop="130px";else{function a(){n.style.display="none",o.style.display="none",e.style.display="block",f.style.display="block",g.style.display="block",m.style.display="block",document.getElementsByClassName("emoji-fullscreen-danmaku")[0].addEventListener("mouseenter",function(){g.classList.remove("fullscreen-hoverout"),g.classList.add("fullscreen-hoverin")}),document.getElementsByClassName("fullscreen-danmaku")[0].addEventListener("mouseleave",function(){g.classList.remove("fullscreen-hoverin"),g.classList.add("fullscreen-hoverout")}),document.getElementById("live-player").addEventListener("mousemove",c),f.addEventListener("click",function(){h(i.value),i.value="",k.innerHTML=" 0/30"})}function b(){n.style.display="block",o.style.display="block",e.style.display="none",f.style.display="none",g.style.display="none",m.style.display="none",document.getElementById("live-player").removeEventListener("mousemove",c)}function c(){clearTimeout(d),d=setTimeout(function(){g.classList.remove("fullscreen-hoverout")},2e3)}K=0<document.getElementsByClassName("input-limit-hint").length?document.getElementsByClassName("input-limit-hint")[0].innerHTML.split("/")[1]:"20",F.innerHTML=" 0/"+K,D.style.display="block",E.style.display="block",F.style.display="block",H.style.display="block",G.style.display="block",j(4,D,C,A,F),E.onclick=function(){h(D.value),F.innerHTML=" 0/"+document.getElementsByClassName("input-limit-hint")[0].innerHTML.split("/")[1],D.value=""},J.addEventListener("change",function(){this.checked?a():b()});let d=null,e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("div"),i=document.createElement("input"),k=document.createElement("span"),l=document.createElement("table"),m=document.createElement("div"),n=document.getElementsByClassName("fullscreen-danmaku")[0].getElementsByTagName("div")[0],o=document.getElementsByClassName("fullscreen-danmaku")[0].getElementsByTagName("div")[1];(function(){document.getElementsByClassName("fullscreen-danmaku")[0].classList.add("emoji-fullscreen-danmaku"),e.style.display="none",f.style.display="none",g.style.display="none",m.style.display="none",g.classList.add("emoji_sec"),g.setAttribute("id","fullscreen-table"),l.classList.add("emoji-table"),j(8,i,l,g,k),g.appendChild(l),m.setAttribute("id","fs-emoji-bg"),i.placeholder="\u53D1\u4E2A\u5F39\u5E55\u5457~",i.setAttribute("id","fullscreen-input"),k.setAttribute("id","fullscreen-text-length"),k.innerHTML=" 0/30",e.setAttribute("id","first-child"),e.appendChild(i),e.appendChild(k),f.innerHTML="\u53D1\u9001",f.classList.add("send-danmaku"),f.setAttribute("id","fullscreen-sub-btn"),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(e),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(f),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(m),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(g)})()}}function f(){"undefined"!=typeof chrome.app.isInstalled&&chrome.runtime.sendMessage({msg:"get_LoginInfo"},function(a){s=a.res.split(",")[0],t=a.res.split(",")[1]})}function g(){return Math.round(Date.now()/1e3)}function h(a){let b=new FormData;b.append("bubble","0"),b.append("msg",a),b.append("color","16777215"),b.append("mode","1"),b.append("fontsize","25"),b.append("rnd",g()+""),b.append("roomid",ROOM_ID),b.append("csrf",s),b.append("csrf_token",s),0!==a.length&&i(b)}function i(a){fetch("https://api.live.bilibili.com/msg/send",{method:"POST",credentials:"include",body:a}).then(()=>{console.log("sent")}).catch(a=>{console.error("Error:",a)})}function j(a,b,c,d,e){b.addEventListener("keyup",function(a){13===a.keyCode&&(a.preventDefault(),h(b.value),b.value="")}),b.addEventListener("keydown",function(a){"Enter"===a.code&&a.preventDefault()});let f=[0,0];b.onkeyup=function(){f=l(e,b)},d.addEventListener("mousemove",function(){f=l(e,b)});let g="<tbody><tr>";for(let f=0;f<imgs.length;f++)0==f%a&&0!==f&&(g+="</tr><tr>"),g+="<td colspan="+imgs[f].getSpan()+" style=\" background:url("+imgs[f].getURL()+") no-repeat bottom center; background-size: contain\"></td>";g+="</tr></tbody>",c.innerHTML=g;for(let g=0;g<c.rows.length;g++){var k=c.rows[g].cells;for(let c=0;c<k.length;c++)k[c].onclick=function(){b.value=b.value.substr(0,f[0])+"("+emoji[c+g*a]+")"+b.value.substr(f[1]),f=l(e,b)}}}function k(a,b){a.innerHTML=10>b?" "+b+"/"+K:b+"/"+K}function l(a,b){let c=b.selectionStart,d=b.selectionEnd;return k(a,b.value.length),[c,d]}function m(a){let b=document.getElementById(a),c=[b.offsetLeft,b.offsetTop],d=b.offsetParent;for(;null!==d;)c[0]+=d.offsetLeft,c[1]+=d.offsetTop+d.clientTop,d=d.offsetParent;return c[0]+=b.clientWidth-60,c[1]+=b.clientHeight-60,c}function n(){let a=m("rank-list-vm");x=[r-a[0],a[1],a[0]],x[2]>r-60?(z.style.left=r-60+"px",A.style.left=r-370+"px"):(z.style.left=x[2]+"px",A.style.left=x[2]-310+"px")}function o(){if(null===localStorage.getItem("rua_pos"))n(),w=!1;else if(localStorage.getItem("rua_pos").includes("undefined"))localStorage.removeItem("rua_pos"),n(),w=!1;else{w=!0;for(let a=0;3>a;a++)x[a]=parseInt(localStorage.getItem("rua_pos").split(",")[a]);let a=0;a=x[0]<x[2]?r-x[0]:x[2],x[1]>q-50&&(x[1]=q-50),z.style.left=a+"px",A.style.left=320>a?a+60+"px":a-310+"px"}}function p(a){a?(A.style.background="#151515",D.style.background="#151515",D.style.borderColor="#2b2b2b"):(A.style.removeProperty("background"),D.style.removeProperty("background"),D.style.removeProperty("border-color"))}var q,r,s="-1",t="-1",u=window.innerWidth,v=[];a(),f(),setInterval(f,3e3);var w=!1,x=[100,100,100];const y=document.body,z=document.createElement("div"),A=document.createElement("div"),B=document.createElement("div"),C=document.createElement("table"),D=document.createElement("textarea"),E=document.createElement("button"),F=document.createElement("span"),G=document.createElement("span"),H=document.createElement("section"),I=document.createElement("div"),J=document.createElement("input");var K;0===document.getElementsByTagName("article").length&&b();var L=new MutationObserver(function(a){a.forEach(function(a){"attributes"===a.type&&(v=M.getAttribute("lab-style").split(","),-1===v.indexOf("dark")?p(!1):p(!0))})});const M=document.documentElement;L.observe(M,{attributes:!0})}();