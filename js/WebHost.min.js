!function(){console.log("script injected");const a={原画PRO:10001,原画:1e4,蓝光PRO:401,蓝光:400,超清PRO:251,超清:250,高清:150,流畅:80},b=chrome.runtime.getURL("../ffmpeg/ffmpeg-core.wasm");let c,d,e,f="\u539F\u753B",g=!1,h="-1",i=window.location.pathname.replaceAll("/","").replace("blanc",""),j=document.title.replace(" - \u54D4\u54E9\u54D4\u54E9\u76F4\u64AD\uFF0C\u4E8C\u6B21\u5143\u5F39\u5E55\u76F4\u64AD\u5E73\u53F0","").replaceAll(" ",""),k=!0,l=300,m=-1,n="",o=0,p=0,q=-1,r=20,s=!1;chrome.storage.sync.get(["enhancedHiddenEntry"],function(a){s=a.enhancedHiddenEntry}),chrome.storage.sync.get(["qn"],function(a){c=a.qn}),chrome.storage.sync.get(["qnvalue"],function(a){f=a.qnvalue}),chrome.storage.sync.get(["medal"],a=>{d=a.medal}),chrome.storage.sync.get(["hiddenEntry"],a=>{g=a.hiddenEntry}),chrome.storage.sync.get(["record"],a=>{k=a.record}),chrome.storage.sync.get(["prerecord"],a=>{l=a.prerecord-1+1}),chrome.storage.onChanged.addListener(function(a){for(let[b,{oldValue:c,newValue:e}]of Object.entries(a))"medal"===b&&(d=e),"record"===b&&(k=e,0<l&&recording())});let t=window.location.href.replace("https://live.bilibili.com/","").replaceAll("/","").replace("blanc","");if(/^\d*$/.test(i)&&0<i.length&&"#"!==t.charAt(t.length-1)){function t(){u=window.innerHeight*1,v=window.innerWidth*1}function A(){return fetch("https://api.live.bilibili.com/room/v1/Room/room_init?id="+i,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(a=>{0===a.code?(i=a.data.room_id,q=a.data.uid):setTimeout(A,1e3)}).catch(a=>{setTimeout(A,1e3)})}function B(a){let b=document.createEvent("MouseEvents");if(b.initEvent("mousemove",!1,!1),void 0===document.getElementById("live-player")||void 0===document.getElementById("live-player").getElementsByClassName("web-player-controller-wrap").length||0===document.getElementById("live-player").getElementsByClassName("web-player-controller-wrap").length)setTimeout(()=>{B(a)},200);else{let c=document.getElementById("live-player"),d=c.getElementsByClassName("web-player-controller-wrap");void 0!==d&&(d[0].style.visibility="hidden",d[1].style.visibility="hidden"),c.dispatchEvent(b),setTimeout(function(){b.initEvent("mouseenter",!1,!0);let e=c.getElementsByClassName("quality-wrap")[0];void 0!==e&&(e.dispatchEvent(b),b.initEvent("click",!1,!0),setTimeout(function(){let d=e.getElementsByClassName("panel")[0].getElementsByClassName("list-it");if(1<d.length){let e=[];for(let a=0;a<d.length;a++)e.push(d[a].innerHTML.replaceAll(" ",""));d[C(a,e)].dispatchEvent(b),b.initEvent("mouseleave",!1,!1),c.dispatchEvent(b)}},100)),setTimeout(()=>{void 0!==d&&(d[0].style.visibility="visible",d[1].style.visibility="visible")},250)},100)}}function C(b,c){let d=0;for(let e=0;e<c.length;e++)a[c[e]]>=a[b]&&(d=e);return d}function D(){document.getElementById("chat-items")===void 0?setTimeout(D,100):0===document.getElementById("chat-items").getElementsByClassName("important-prompt-item").length?setTimeout(D,10):document.getElementById("chat-items").getElementsByClassName("important-prompt-item")[0].style.display="none"}async function E(a){let b=document.cookie.replaceAll(" ","").split("DedeUserID")[1].split(";")[0].replaceAll("=","");a&&(await A()),s||(await fetch("https://api.live.bilibili.com/xlive/web-room/v1/index/getInfoByUser?from=0&room_id="+i,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(a=>{0===a.code&&(o=0==a.data.privilege.privilege_type-1+1?4:a.data.privilege.privilege_type,b=a.data.info.uid,r=a.data.property.danmu.length)}).catch(a=>{setTimeout(E,1e3)})),await fetch("https://api.live.bilibili.com/xlive/web-ucenter/user/MedalWall?target_id="+b,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(b=>{if(0===b.code)for(let c of b.data.list)c.medal_info.target_id===q&&(p=c.medal_info.level,m=c.medal_info.medal_id,n=c.medal_info.medal_name,a&&F(m,n,!0))}).catch(a=>{}),a&&I()}function F(a,b,c){if("-1"!==h&&d&&-1!==a){var e=new FormData;e.append("medal_id",a),e.append("csrf",h),e.append("csrf_token",h),fetch("https://api.live.bilibili.com/xlive/web-room/v1/fansMedal/wear",{method:"POST",credentials:"include",body:e}).then(d=>{console.log("ware medal successful, MID="+a),c&&G(b)})}}function G(a){let b=document.createEvent("MouseEvents");if(b.initEvent("click",!1,!0),0===document.getElementsByClassName("medal-section").length||0===document.getElementsByClassName("medal-section")[0].getElementsByTagName("span").length||0===document.getElementsByClassName("medal-section")[0].getElementsByTagName("span")[0].getElementsByTagName("span").length)setTimeout(()=>{G(a)},200);else{let c=document.getElementsByClassName("medal-section")[0].getElementsByTagName("span")[0];c.dispatchEvent(b),setTimeout(function(){let b=document.getElementById("control-panel-ctnr-box").getElementsByClassName("medal")[0];void 0!==b&&(b.style.display="none");let c=document.getElementById("control-panel-ctnr-box").getElementsByClassName("fans-medal-content")[0].innerText;(void 0===c||c!==a)&&setTimeout(()=>{G(a)},1e3)},20)}}function H(a,b,c,d){var e=Math.abs;return 0===e(a-c)&&0===e(b-d)}function I(){if(console.log("load complete"),"-1"===h||"-1"===w)ha.innerHTML="<div id='load'>\u52A0\u8F7D\u5931\u8D25\uFF0C<br>\u8BF7<a href="+window.location+">\u70B9\u51FB\u8FD9\u91CC</a>\u91CD\u8BD5<br><br>\u5982\u672A\u767B\u5F55\uFF0C\u8BF7\u5148\u767B\u5F55</div>",document.getElementById("load").style.marginTop="130px";else{function a(){let a=new MutationObserver(a=>{a.forEach(function(a){if("attributes"===a.type&&null!==document.body.getAttribute("class")){let a=document.body.getAttribute("class").split(" ");if(-1!==a.indexOf("fullscreen-fix")){P(8,m,p);let a=!0,b=!0;p.addEventListener("compositionstart",c=>{a=!1,b=!1}),p.addEventListener("compositionend",b=>{a=!0}),p.addEventListener("keyup",c=>{13===c.keyCode&&b&&(c.preventDefault(),L(p.value),p.value=""),a&&(b=!0),R(q,p)}),p.addEventListener("keydown",a=>{"Enter"===a.code&&a.preventDefault()})}else m.innerHTML=""}})});a.observe(document.body,{attributes:!0}),document.getElementsByClassName("fullscreen-danmaku")[0].classList.add("emoji-fullscreen-danmaku"),n.style.display="none",o.style.display="none",k.style.display="none",j.style.display="none",k.classList.add("emoji_sec"),k.setAttribute("id","fullscreen-table"),l.classList.add("emoji-table"),P(8,m,p),k.appendChild(l),k.appendChild(m),j.setAttribute("id","fs-emoji-bg"),p.placeholder="\u53D1\u4E2A\u5F39\u5E55\u5457~",p.setAttribute("id","fullscreen-input"),q.setAttribute("id","fullscreen-text-length"),q.innerHTML=" 0/"+r,n.setAttribute("id","first-child"),n.appendChild(p),n.appendChild(q),o.innerHTML="\u53D1\u9001",o.classList.add("send-danmaku"),o.setAttribute("id","fullscreen-sub-btn"),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(n),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(o),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(j),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(k);let c;m.addEventListener("mouseenter",()=>{c=setInterval(b,1e3)}),m.addEventListener("mouseleave",()=>{clearInterval(c)})}function b(){m.parentElement.parentElement.parentElement.parentElement.dispatchEvent(new Event("mousemove"))}function c(){s.style.display="none",t.style.display="none",n.style.display="block",o.style.display="block",k.style.display="block",j.style.display="block",o.addEventListener("click",function(){L(p.value),p.value="",q.innerHTML=" 0/"+r})}function d(){s.style.display="block",t.style.display="block",n.style.display="none",o.style.display="none",k.style.display="none",j.style.display="none"}la.innerHTML=" 0/"+r,ja.style.display="block",ka.style.display="block",la.style.display="block",ma.style.display="block",ma.addEventListener("click",a=>{chrome.storage.local.set({tempRoomNumber:i},()=>{}),chrome.runtime.sendMessage({msg:`launchLiveRoom`},a=>{})}),ka.onclick=function(){L(ja.value),la.innerHTML=" 0/"+document.getElementsByClassName("input-limit-hint")[0].innerHTML.split("/")[1],ja.value=""};let f=!0,g=!0;ja.addEventListener("compositionstart",a=>{f=!1,g=!1}),ja.addEventListener("compositionend",a=>{f=!0}),ja.addEventListener("keyup",a=>{13===a.keyCode&&g&&(a.preventDefault(),L(ja.value),ja.value=""),f&&(g=!0),R(la,ja)}),ja.addEventListener("keydown",a=>{"Enter"===a.code&&a.preventDefault()});let h=null;const j=document.createElement("div"),k=document.createElement("div"),l=document.createElement("table"),m=document.createElement("table"),n=document.createElement("div"),o=document.createElement("div"),p=document.createElement("input"),q=document.createElement("span");let s,t;!function b(){try{s=document.getElementsByClassName("fullscreen-danmaku")[0].getElementsByTagName("div")[0],t=document.getElementsByClassName("fullscreen-danmaku")[0].getElementsByTagName("div")[1],a(),c()}catch(a){console.log(a),console.log("retry in 2 seconds"),setTimeout(()=>{b()},2e3)}}()}}function J(){try{chrome.runtime.sendMessage({msg:"get_LoginInfo"},function(a){h=a.res.split(",")[0],w=a.res.split(",")[1]})}catch(a){}}function K(){return Math.round(Date.now()/1e3)}function L(a,b=0){let c=new FormData;c.append("bubble","0"),c.append("msg",a),c.append("color","16777215"),c.append("mode","1"),0!==b&&c.append("dm_type","1"),c.append("fontsize","25"),c.append("rnd",K()+""),c.append("roomid",i),c.append("csrf",h),c.append("csrf_token",h),0!==a.length&&M(c)}function M(a){fetch("https://api.live.bilibili.com/msg/send?requestFrom=rua5",{method:"POST",credentials:"include",body:a}).then(a=>a.json()).then(a=>{console.log("sent"),0===a.message.length?"\u4F60\u6240\u5728\u7684\u5730\u533A\u6682\u65E0\u6CD5\u53D1\u8A00"===a.message&&N("\u4F60\u6240\u5728\u7684\u5730\u533A\u6682\u65E0\u6CD5\u53D1\u8A00"):N("\u4F60\u7684\u5F39\u5E55\u88AB\u7CFB\u7EDF\u541E\u4E86\uFF0C\u91CD\u8BD5\u4E00\u4E0B\u5427\u3002")}).catch(a=>{console.error("Error:",a),N("\u53D1\u9001\u5931\u8D25")})}function N(a){let b=S("rua-dm-input-form");na.style.left=`${b[0]-140}px`,na.style.top=`${b[1]+15}px`,na.style.display="block",na.innerHTML=`<span>&nbsp;&nbsp;&nbsp;&nbsp;${a}&nbsp;&nbsp;&nbsp;&nbsp;</span>`,setTimeout(()=>{na.style.opacity="1"},400),setTimeout(()=>{na.style.opacity="0"},1400),setTimeout(()=>{na.style.display="none"},1800)}async function O(a,b,c){await E(!1),fetch("https://api.live.bilibili.com/xlive/web-ucenter/v2/emoticon/GetEmoticons?platform=pc&room_id="+i,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(a=>{if(0===a.code){b.innerHTML="";const d=document.createElement("div"),f=document.createElement("div");f.classList.add("rua-emoji-header"),d.appendChild(f),b.appendChild(d),f.addEventListener("wheel",a=>{f.scrollLeft+=a.deltaY,a.preventDefault()});const g=a.data.data;oa>g.length&&(oa=0);for(let a=0;a<g.length;a++){const d=document.createElement("div");d.classList.add("rua-header-item");const e=document.createElement("div");e.classList.add("rua-emoji-container"),a===oa&&(d.classList.add("active"),e.style.display="flex"),d.innerHTML+=`<img src="${g[a].current_cover}"></div>`,d.onclick=()=>{for(let a=0;a<f.childNodes.length;a++)f.childNodes.item(a).classList.remove("active"),b.getElementsByClassName("rua-emoji-container")[a].style.display="none",f.childNodes.item(a)===d&&(b.getElementsByClassName("rua-emoji-container")[a].style.display="flex",oa=a);d.classList.add("active")},f.appendChild(d);for(let b=0;b<g[a].emoticons.length;b++){const d=document.createElement("div");d.classList.add("rua-emoji-icon"),d.classList.add("rua-emoji-item"),d.title=g[a].emoticons[b].emoji,0===a&&d.classList.add("rua-emoji-item-xs"),d.innerHTML+=`<div class="rua-emoji-requirement" style="background-color: ${g[a].emoticons[b].unlock_show_color};"><div class="rua-emoji-requirement-text">${g[a].emoticons[b].unlock_show_text}</div></div><img class="${1===g[a].emoticons[b].perm?"rua-emoji-icon-active":"rua-emoji-icon-inactive-new"}" src="${g[a].emoticons[b].url}">`,d.onclick=()=>{if(d.classList.contains("rua-emoji-icon-inactive-new")||0===a||L(g[a].emoticons[b].emoticon_unique,1),0===a){if(c.selectionStart===c.selectionEnd)c.value=c.value.substring(0,c.selectionStart)+d.title+c.value.substring(c.selectionEnd,c.value.length);else{let a=c.value.substring(0,c.selectionStart),b=c.value.substring(c.selectionEnd,c.value.length);c.value=a+d.title+b}c.focus()}},e.append(d)}b.appendChild(e)}}})}async function P(a,b,c){await E(!1),fetch("https://api.live.bilibili.com/xlive/web-ucenter/v2/emoticon/GetEmoticons?platform=pc&room_id="+i,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(d=>{if(0===d.code){let f="";for(let b=d.data.data.length;0<=b;b--)if(d.data.data[b]!==void 0&&null!==d.data.data[b]&&("\u623F\u95F4\u4E13\u5C5E\u8868\u60C5"===d.data.data[b].pkg_name||"UP\u4E3B\u5927\u8868\u60C5"===d.data.data[b].pkg_name)){f+=`</tr></tbody><thead><tr><th colspan='4' class='rua-table-header'>${d.data.data[b].pkg_name}</th></tr></thead><tbody><tr>`;for(let c,e=0;e<d.data.data[b].emoticons.length;e++)c=o<=d.data.data[b].emoticons[e].identity&&d.data.data[b].emoticons[e].unlock_need_level<=p,0==e%a&&0!==e&&(f+="</tr><tr>"),f+=`<td colspan="1" title="${d.data.data[b].emoticons[e].emoji}" id="${d.data.data[b].emoticons[e].emoticon_unique}"><div  class="rua-emoji-icon ${1===d.data.data[b].emoticons[e].perm?"rua-emoji-icon-active":"rua-emoji-icon-inactive"}" style="width:60px; height:60px; background-image:url('${d.data.data[b].emoticons[e].url.replace("http://","https://")}');"></div><div class="rua-emoji-requirement" style="background-color: ${d.data.data[b].emoticons[e].unlock_show_color};"><div class="rua-emoji-requirement-text">${d.data.data[b].emoticons[e].unlock_show_text}</div></div></td>`}for(let b=d.data.data.length;0<=b;b--)if(d.data.data[b]!==void 0&&null!==d.data.data[b]&&"\u623F\u95F4\u4E13\u5C5E\u8868\u60C5"!==d.data.data[b].pkg_name&&"UP\u4E3B\u5927\u8868\u60C5"!==d.data.data[b].pkg_name){f+=`</tr></tbody><thead><tr><th colspan='4' class='rua-table-header'>${d.data.data[b].pkg_name}</th></tr></thead><tbody><tr>`;for(let c,e=0;e<d.data.data[b].emoticons.length;e++)c=o<=d.data.data[b].emoticons[e].identity&&d.data.data[b].emoticons[e].unlock_need_level<=p,0==e%a&&0!==e&&(f+="</tr><tr>"),f+=`<td colspan="1" title="${d.data.data[b].emoticons[e].emoji}" id="${d.data.data[b].emoticons[e].emoticon_unique}"><div  class="rua-emoji-icon ${1===d.data.data[b].emoticons[e].perm?"rua-emoji-icon-active":"rua-emoji-icon-inactive"}" style="width:60px; height:60px; background-image:url('${d.data.data[b].emoticons[e].url.replace("http://","https://")}');"></div><div class="rua-emoji-requirement" style="background-color: ${d.data.data[b].emoticons[e].unlock_show_color};"><div class="rua-emoji-requirement-text">${d.data.data[b].emoticons[e].unlock_show_text}</div></div></td>`}f+="</tr></tbody>",b.innerHTML=f;for(let a=0;a<b.rows.length;a++){var e=b.rows[a].cells;for(let a=0;a<e.length;a++){const b=e[a].getElementsByTagName("div")[0];e[a].onclick=function(a){if(0===a.button&&b.classList.contains("rua-emoji-icon-active")&&!this.id.includes("emoji")&&(c.focus(),L(this.id,1)),0===a.button&&b.classList.contains("rua-emoji-icon-active")&&this.id.includes("emoji")){if(c.selectionStart===c.selectionEnd)c.value=c.value.substring(0,c.selectionStart)+this.title+c.value.substring(c.selectionEnd,c.value.length);else{let a=c.value.substring(0,c.selectionStart),b=c.value.substring(c.selectionEnd,c.value.length);c.value=a+this.title+b}c.focus()}}}}}0===ha.innerHTML.length&&25>=ia.innerHTML.length&&4===a&&(ia.innerHTML=`<div id="load">当前直播间没有表情包，<br>如显示不正确，请<a href="${window.location}">点击这里</a>重试<br><br></div>`)}).catch(a=>{})}function Q(a,b){a.innerHTML=10>b?" "+b+"/"+r:b+"/"+r}function R(a,b){return Q(a,b.value.length),[b.selectionStart,b.selectionEnd]}function S(a){let b=document.getElementById(a),c=[b.offsetLeft,b.offsetTop],d=b.offsetParent;for(;null!==d;)c[0]+=d.offsetLeft,c[1]+=d.offsetTop+d.clientTop,d=d.offsetParent;return c[0]+=b.clientWidth-60,c[1]+=b.clientHeight-60,c}function T(){let a=S("rank-list-vm");z=[v-a[0],a[1],a[0]],z[2]>v-60?(ea.style.left=v-60+"px",fa.style.left=v-370+"px"):(ea.style.left=z[2]+"px",fa.style.left=z[2]-310+"px")}function U(){if(null===localStorage.getItem("rua_pos"))T(),y=!1;else if(localStorage.getItem("rua_pos").includes("undefined"))localStorage.removeItem("rua_pos"),T(),y=!1;else{y=!0;for(let a=0;3>a;a++)z[a]=parseInt(localStorage.getItem("rua_pos").split(",")[a]);let a=0;a=z[0]<z[2]?v-z[0]:z[2],z[1]>u-50&&(z[1]=u-50),ea.style.left=a+"px",fa.style.left=320>a?a+60+"px":a-310+"px"}}function V(){try{const a=document.getElementById("head-info-vm"),b=a.getElementsByClassName("live-title")[0].getElementsByClassName("text")[0].innerText,c=a.getElementsByClassName("lower-row")[0].getElementsByClassName("left-ctnr")[0].getElementsByTagName("a")[0].innerText;return W(b+"-"+c)}catch(a){}return j}function W(a){const b={21652717:"\u5168\u4E16\u754C\u6700\u597D\u7684\u8C79\u8C79",1603600:"\u4F1F\u5927\u7684\u5C71\u732A\u738B\u661F\u6C50Seki\u965B\u4E0B",545:"\u5854\u5B9D",22486793:"\u590F\u9E641\uFF1F\u590F\u9E640\uFF01",21775601:"\u7D2B\u8272\u53D4\u53D4"};return void 0!==b[i]&&(a.includes("-")?a=a.split("-")[0]+"-"+b[i]:a+="-"+b[i]),a}function X(){Y(),ua.getElementsByClassName("right-area")[0].appendChild(pa)}function Y(){pa.innerHTML="<span class='text'>"+(ra?"\u7ED3\u675F\u5F55\u5236":"\u5F00\u59CB\u5F55\u5236")+"</span>",ra?(qa.innerHTML="<span class='text'>\u5F55\u5236\u65F6\u957F "+_(ta)+"</span>",ua.getElementsByClassName("left-area")[0].appendChild(qa)):qa.innerHTML="<span class='text'></span>"}function Z(){ra=!ra,Y(),console.log("Start recording"),0===l&&ra&&$(),ra||(sa=!0,e.stop())}function $(){try{const a=document.getElementById("live-player").getElementsByTagName("video")[0].captureStream();let b=[],c=0,d="",f=0;ta=0,k?(console.log(a),e=new MediaRecorder(a),e.ondataavailable=a=>{0<a.data.size&&(b.length>=l&&!ra&&b.splice(1,1),0===b.length&&(d=a.data.type),b.push(a.data),f+=a.data.size/1048576,ra&&(ta=b.length,qa.innerHTML="<span class='text'>\u5F55\u5236\u65F6\u957F "+_(ta)+"</span>"),c++)},e.onstart=()=>{console.log("start recording")},e.onstop=()=>{if(sa){const a=new Blob(b,{type:d}),e=window.URL.createObjectURL(a);sa=!1,j=V(),console.log("clip sent to process: \r\nfileName: "+j+"\r\nvideo duration: "+ta+"s\r\nfile size: "+a.size/1048576+"MiB\r\nmime type: "+a.type),aa(e,c-ta,j).then(a=>{window.URL.revokeObjectURL(e)})}b=[],0<l&&$()},e.start(1e3)):(e.ondataavailable=null,e.onstart=null,e.onstop=null,e=null)}catch(a){}}function _(a){return Math.floor(a/60)+" : "+(10>a%60?"0":"")+a%60}async function aa(c,d,e){let f,g,h;const{createFFmpeg:i,fetchFile:j}=FFmpeg,k=i({corePath:b,mainName:"main",log:!1});await k.load(),k.FS("writeFile","video.mp4",await j(c)),1<d?(await k.run("-i","video.mp4","-ss",d+"","-c","copy","footage.mp4"),await k.run("-i","footage.mp4","-vcodec","copy","-acodec","aac","final.mp4")):await k.run("-i","video.mp4","-vcodec","copy","-acodec","aac","final.mp4"),f=k.FS("readFile","final.mp4"),g=e+".mp4",h=URL.createObjectURL(new Blob([f.buffer],{type:"video/mp4"}));const l=document.createElement("a");l.style.display="none",l.href=h,l.download=g,document.body.appendChild(l),l.click(),document.body.removeChild(l),window.URL.revokeObjectURL(h)}function ba(){try{try{document.getElementById("live-player").getElementsByTagName("video")[0].currentTime=document.getElementById("live-player").getElementsByTagName("video")[0].buffered.end(0)-1}catch(a){}}catch(a){}}function ca(){const a=document.getElementById("web-player-controller-wrap-el").getElementsByClassName("control-area")[0].getElementsByClassName("left-area")[0];a.appendChild(xa)}var u,v,w="-1",x=window.innerWidth;t(),J(),setInterval(J,3e3);var y=!1,z=[100,100,100];const da=document.body,ea=document.createElement("div"),fa=document.createElement("div"),ga=document.createElement("div"),ha=document.createElement("table"),ia=document.createElement("table"),ja=document.createElement("textarea"),ka=document.createElement("button"),la=document.createElement("span"),ma=document.createElement("button"),na=document.createElement("div");chrome.storage.sync.get(["popupDisable","popupAlwaysOnTop"],a=>{a.popupDisable?(ea.style.display="none",fa.style.display="none"):(ea.style.display="block",fa.style.display="block"),a.popupAlwaysOnTop?(ea.classList.add("rua-always-on-top"),fa.classList.add("rua-always-on-top")):(ea.classList.remove("rua-always-on-top"),fa.classList.remove("rua-always-on-top"))}),chrome.storage.onChanged.addListener((a,b)=>{for(let[c,{oldValue:d,newValue:e}]of Object.entries(a))"popupDisable"===c&&(e?(ea.style.display="none",fa.style.display="none"):(ea.style.display="block",fa.style.display="block")),"popupAlwaysOnTop"===c&&(e?(ea.classList.add("rua-always-on-top"),fa.classList.add("rua-always-on-top")):(ea.classList.remove("rua-always-on-top"),fa.classList.remove("rua-always-on-top")))}),setTimeout(function(){c&&0===document.getElementsByTagName("article").length&&B(f),g&&"-1"!==h&&0===document.getElementsByTagName("article").length&&D()},10),function a(){function b(){if(document.getElementsByClassName("live-haruna-ctnr")[0]===void 0)setTimeout(b,200);else{let b=document.getElementsByClassName("live-haruna-ctnr")[0].getAttribute("style").replace(";","");document.getElementsByClassName("live-haruna-ctnr")[0].setAttribute("style",b+" scale("+c+");");var a=new MutationObserver(function(a){a.forEach(function(a){if("attributes"===a.type&&"style"===a.attributeName){let a=document.getElementsByClassName("live-haruna-ctnr")[0].getAttribute("style").replace(";","");a.includes("scale")||document.getElementsByClassName("live-haruna-ctnr")[0].setAttribute("style",a+" scale("+c+");")}})});a.observe(document.getElementsByClassName("live-haruna-ctnr")[0],{attributes:!0})}}let c=1/window.devicePixelRatio;b()}(),window.addEventListener("focus",function(){F(m,n,!1)}),E(!0),0===document.getElementsByTagName("article").length&&function a(){U(),ea.setAttribute("id","emoji-popup");try{ea.style.background="url("+link+") no-repeat center"}catch(a){ea.style.background="url("+chrome.runtime.getURL("../images/haruka/abaaba.svg")+") no-repeat center"}ea.style.backgroundSize="contain",ea.style.cursor="pointer",ea.innerHTML="<!---->",fa.setAttribute("id","emoji-selection"),fa.classList.add("emoji_sec"),fa.style.display="none",fa.innerHTML="",ga.setAttribute("id","emoji-tray"),ga.classList.add("emoji_sec"),ga.appendChild(ha),ga.appendChild(ia),ha.setAttribute("class","rua-emoji-table"),ha.innerHTML="<div id='load'>\u52A0\u8F7D\u5F39\u5E55\u4E2D...</div>",ia.setAttribute("class","rua-system-emoji-table"),ea.style.top=z[1]+"px",fa.style.top=z[1]-5+"px",ka.setAttribute("id","input-button"),ka.innerHTML="<span>\u53D1\u9001</span>",ka.style.display="none",ja.setAttribute("id","rua-dm-input-form"),ja.placeholder="\u8FD9\u91CC\u4E5F\u53EF\u4EE5\u53D1\u5F39\u5E55~",ja.style.display="none",la.setAttribute("id","length-indicator"),la.style.display="none",na.setAttribute("id","rua-err-bubble"),na.style.display="none",na.style.opacity="0",ma.setAttribute("id","rua-go-to-live-room"),ma.innerHTML=`<span>去放映室看</span>`,ma.style.display="none",fa.appendChild(ja),fa.appendChild(ka),fa.appendChild(ma),fa.appendChild(la),fa.appendChild(ga),da.appendChild(fa),da.appendChild(ea),da.appendChild(na);var b=[0,0],c=[0,0];window.onload=function(){ea.onmousedown=function(a){let d,e;document.body.style.userSelect="none",ea.classList.remove("popup-click-hoverout"),ea.classList.remove("popup-click-hoverin"),ea.classList.remove("popup-click-out"),ea.classList.add("popup-click-in");const f=a||event,g=f.clientX-ea.offsetLeft,h=f.clientY-ea.offsetTop;b=[ea.offsetLeft,ea.offsetTop],c=[ea.offsetLeft,ea.offsetTop],document.onmousemove=function(a){const b=a||event;0<=b.clientX-g&&b.clientX-g<=v-60&&(d=b.clientX-g),0<=b.clientY-h&&b.clientY-h<=u-60&&(e=b.clientY-h),c=[d,e],ea.style.left=d+"px",ea.style.top=e+"px",fa.style.left=320>d?d+60+"px":d-310+"px",fa.style.top=e>u-360?u-360+"px":e-5+"px",e===void 0&&(e=ea.offsetTop),-1<d&&(z=[v-d,e,d])},document.onmouseup=function(){document.body.style.userSelect="auto",ea.classList.remove("popup-click-hoverout"),ea.classList.remove("popup-click-hoverin"),ea.classList.remove("popup-click-in"),ea.classList.add("popup-click-out"),H(b[0],b[1],c[0],c[1])?"none"===fa.style.display?(O(4,document.getElementById("emoji-tray"),ja),fa.classList.remove("selection-fade-out"),fa.style.display="block",fa.classList.add("selection-fade-in"),ja.focus()):(fa.classList.remove("selection-fade-in"),fa.classList.add("selection-fade-out"),document.getElementById("emoji-tray").innerHTML="",setTimeout(()=>{fa.style.display="none"},300)):(y=!0,localStorage.setItem("rua_pos",z[0]+","+z[1]+","+z[2])),document.onmousemove=null,document.onmouseup=null}},ea.onmouseenter=function(){ea.classList.remove("popup-click-hoverout"),ea.classList.add("popup-click-hoverin")},ea.onmouseleave=function(){ea.classList.remove("popup-click-hoverin"),ea.classList.add("popup-click-hoverout")}},window.addEventListener("resize",function(){let a,b=z[0]<z[2]?z[0]/x:z[2]/x;t(),y?(a=z[0]<z[2]?v-z[0]:z[2],ea.style.left=a+"px"):T(),z[1]>u-60&&(ea.style.top=u-60+"px",fa.style.top=u-360+"px"),fa.style.left=320>a?a+60+"px":a-310+"px"})}();let oa=0;const pa=document.createElement("div"),qa=document.createElement("div");let ra=!1,sa=!1,ta=0,ua=document.getElementById("web-player-controller-wrap-el");pa.classList.add("rua-record"),qa.classList.add("rua-recording-time");const va=new MutationObserver(function(a){a.forEach(function(a){"childList"===a.type&&(0===a.addedNodes.length&&(pa.removeEventListener("click",Z),xa.removeEventListener("click",ba)),a.addedNodes[0]!==void 0&&"DIV"===a.addedNodes[0].nodeName&&(k&&(X(),pa.addEventListener("click",Z)),ca(),xa.addEventListener("click",ba)))})}),wa=new MutationObserver(function(a){a.forEach(function(a){"childList"===a.type&&(a.addedNodes[0]!==void 0&&"VIDEO"===a.addedNodes[0].nodeName&&k&&0<l&&$(),null===ua&&a.addedNodes[0]!==void 0&&"DIV"===a.addedNodes[0].nodeName&&"web-player-controller-wrap-el"===a.addedNodes[0].id&&(ua=a.addedNodes[0],va.observe(ua,{childList:!0})))})});try{null!==ua&&va.observe(ua,{childList:!0}),wa.observe(document.getElementById("live-player"),{childList:!0})}catch(a){}const xa=document.createElement("div");xa.innerHTML+=`<div class="frame-chasing"><div><span class="icon"><svg class="squirtle-svg-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 22 22"><path d="M16 5a1 1 0 00-1 1v4.615a1.431 1.431 0 00-.615-.829L7.21 5.23A1.439 1.439 0 005 6.445v9.11a1.44 1.44 0 002.21 1.215l7.175-4.555a1.436 1.436 0 00.616-.828V16a1 1 0 002 0V6C17 5.448 16.552 5 16 5z" style="fill:#fff;transform-origin: center;"></path></svg></span></div></div></div>`;const ya=document.getElementById("shop-popover-vm");ya.style.display="none"}}();