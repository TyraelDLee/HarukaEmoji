!function(){let a=window.location.pathname.replaceAll("/","").replace("blanc",""),b=0,c=!1;if(/^\d*$/.test(a)){function n(){d=window.innerHeight*1,e=window.innerWidth*1}function o(){B(),E.setAttribute("id","emoji-popup"),E.style.background="url("+chrome.runtime.getURL("../images/haruka/abaaba.svg")+") no-repeat center";try{E.style.background="url("+link+") no-repeat center"}catch(a){}E.style.backgroundSize="contain",E.style.cursor="pointer",E.innerHTML="<!---->",F.setAttribute("id","emoji-selection"),F.classList.add("emoji_sec"),F.style.display="none",F.innerHTML="",G.setAttribute("id","emoji-tray"),G.classList.add("emoji_sec"),G.appendChild(H),G.appendChild(I),H.setAttribute("class","emoji-table"),H.innerHTML="<div id='load'>\u52A0\u8F7D\u5F39\u5E55\u4E2D...</div>",I.setAttribute("class","emoji-table"),F.appendChild(G),D.appendChild(F),D.appendChild(E),E.style.top=k[1]+"px",F.style.top=k[1]-5+"px",K.setAttribute("id","input-button"),K.innerHTML="<span>\u53D1\u9001</span>",K.style.display="none",J.setAttribute("id","input-form"),J.placeholder="\u8FD9\u91CC\u4E5F\u53EF\u4EE5\u53D1\u5F39\u5E55~",J.style.display="none",L.setAttribute("id","length-indicator"),L.style.display="none",N.classList.add("button"),O.classList.add("checkbox"),P.type="checkbox",P.checked=!0,O.appendChild(P),O.appendChild(document.createElement("label")),N.appendChild(O),N.style.display="none",M.setAttribute("id","fullscreen-label"),M.innerHTML="\u5168\u5C4F\u663E\u793A",M.style.display="none",F.appendChild(J),F.appendChild(K),F.appendChild(N),F.appendChild(M),F.appendChild(L);var a=[0,0],b=[0,0];window.onload=function(){E.onmousedown=function(c){let f,g;document.body.style.userSelect="none",E.className="popup-click-in";const h=c||event,i=h.clientX-E.offsetLeft,l=h.clientY-E.offsetTop;a=[E.offsetLeft,E.offsetTop],b=[E.offsetLeft,E.offsetTop],document.onmousemove=function(a){const c=a||event;0<=c.clientX-i&&c.clientX-i<=e-60&&(f=c.clientX-i),0<=c.clientY-l&&c.clientY-l<=d-60&&(g=c.clientY-l),b=[f,g],E.style.left=f+"px",E.style.top=g+"px",F.style.left=320>f?f+60+"px":f-310+"px",F.style.top=g>d-360?d-360+"px":g-5+"px",g===void 0&&(g=E.offsetTop),-1<f&&(k=[e-f,g,f])},document.onmouseup=function(){document.body.style.userSelect="auto",E.className="popup-click-out",p(a[0],a[1],b[0],b[1])?"none"===F.style.display?(F.classList.remove("selection-fade-out"),F.style.display="block",F.classList.add("selection-fade-in")):(F.classList.remove("selection-fade-in"),F.classList.add("selection-fade-out"),setTimeout(()=>{F.style.display="none"},300)):(j=!0,localStorage.setItem("rua_pos",k[0]+","+k[1]+","+k[2])),document.onmousemove=null,document.onmouseup=null}},E.onmouseenter=function(){E.className="popup-click-hoverin"},E.onmouseleave=function(){E.className="popup-click-hoverout"}},window.addEventListener("resize",function(){let a,b=k[0]<k[2]?k[0]/h:k[2]/h;n(),j?(a=k[0]<k[2]?e-k[0]:k[2],E.style.left=a+"px"):A(),k[1]>d-60&&(E.style.top=d-60+"px",F.style.top=d-360+"px"),F.style.left=320>a?a+60+"px":a-310+"px"}),setTimeout(q,5e3)}function p(a,b,c,d){var e=Math.abs;return 0===e(a-c)&&0===e(b-d)}function q(){if(console.log("load complete"),"-1"===f||"-1"===g)H.innerHTML="<div id='load'>\u52A0\u8F7D\u5931\u8D25\uFF0C<br>\u8BF7<a href="+window.location+">\u70B9\u51FB\u8FD9\u91CC</a>\u91CD\u8BD5<br><br>\u5982\u672A\u767B\u5F55\uFF0C\u8BF7\u5148\u767B\u5F55</div>",document.getElementById("load").style.marginTop="130px";else{function a(){n.style.display="none",o.style.display="none",i.style.display="block",j.style.display="block",f.style.display="block",e.style.display="block",document.getElementsByClassName("emoji-fullscreen-danmaku")[0].addEventListener("mouseenter",function(){f.classList.remove("fullscreen-hoverout"),f.classList.add("fullscreen-hoverin")}),document.getElementsByClassName("fullscreen-danmaku")[0].addEventListener("mouseleave",function(){f.classList.remove("fullscreen-hoverin"),f.classList.add("fullscreen-hoverout")}),document.getElementById("live-player").addEventListener("mousemove",c),j.addEventListener("click",function(){t(k.value),k.value="",m.innerHTML=" 0/30"})}function b(){n.style.display="block",o.style.display="block",i.style.display="none",j.style.display="none",f.style.display="none",e.style.display="none",document.getElementById("live-player").removeEventListener("mousemove",c)}function c(){clearTimeout(d),d=setTimeout(function(){f.classList.remove("fullscreen-hoverout")},2e3)}l=0<document.getElementsByClassName("input-limit-hint").length?document.getElementsByClassName("input-limit-hint")[0].innerHTML.split("/")[1]:"20",L.innerHTML=" 0/"+l,J.style.display="block",K.style.display="block",L.style.display="block",N.style.display="block",M.style.display="block",w(4,J,H,F,L),v(4,I),K.onclick=function(){t(J.value),L.innerHTML=" 0/"+document.getElementsByClassName("input-limit-hint")[0].innerHTML.split("/")[1],J.value=""},P.addEventListener("change",function(){this.checked?a():b()});let d=null;const e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("table"),h=document.createElement("table"),i=document.createElement("div"),j=document.createElement("div"),k=document.createElement("input"),m=document.createElement("span"),n=document.getElementsByClassName("fullscreen-danmaku")[0].getElementsByTagName("div")[0],o=document.getElementsByClassName("fullscreen-danmaku")[0].getElementsByTagName("div")[1];(function(){document.getElementsByClassName("fullscreen-danmaku")[0].classList.add("emoji-fullscreen-danmaku"),i.style.display="none",j.style.display="none",f.style.display="none",e.style.display="none",f.classList.add("emoji_sec"),f.setAttribute("id","fullscreen-table"),g.classList.add("emoji-table"),w(8,k,g,f,m),v(8,h),f.appendChild(g),f.appendChild(h),e.setAttribute("id","fs-emoji-bg"),k.placeholder="\u53D1\u4E2A\u5F39\u5E55\u5457~",k.setAttribute("id","fullscreen-input"),m.setAttribute("id","fullscreen-text-length"),m.innerHTML=" 0/30",i.setAttribute("id","first-child"),i.appendChild(k),i.appendChild(m),j.innerHTML="\u53D1\u9001",j.classList.add("send-danmaku"),j.setAttribute("id","fullscreen-sub-btn"),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(i),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(j),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(e),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(f)})(),a()}}function r(){try{chrome.runtime.sendMessage({msg:"get_LoginInfo"},function(a){f=a.res.split(",")[0],g=a.res.split(",")[1]})}catch(a){}}function s(){return Math.round(Date.now()/1e3)}function t(b,c){let d=new FormData;d.append("bubble","0"),d.append("msg",b),d.append("color","16777215"),d.append("mode","1"),c!==void 0&&"systemEmoji"===c&&d.append("dm_type","1"),d.append("fontsize","25"),d.append("rnd",s()+""),d.append("roomid",a),d.append("csrf",f),d.append("csrf_token",f),0!==b.length&&u(d)}function u(a){fetch("https://api.live.bilibili.com/msg/send?requestFrom=rua5",{method:"POST",credentials:"include",body:a}).then(()=>{console.log("sent")}).catch(a=>{console.error("Error:",a)})}function v(b,c){fetch("https://api.live.bilibili.com/xlive/web-ucenter/v2/emoticon/GetEmoticons?platform=pc&room_id="+a,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(a=>{if(0===a.code){let e="<thead><tr><th colspan='4' class='rua-table-header'>up\u5927\u8868\u60C5 / \u7CFB\u7EDF\u8868\u60C5</th></tr></thead>";if(e+="<tbody><tr>",void 0!==a.data.data[1]&&null!==a.data.data[1])for(let c=0;c<a.data.data[1].emoticons.length;c++)0==c%b&&0!==c&&(e+="</tr><tr>"),e+="<td colspan=1 class=\"rua-emoji-icon\" id=\""+a.data.data[1].emoticons[c].emoticon_unique+"\" style=\"background-image:url("+a.data.data[1].emoticons[c].url+");\"><div class='rua-emoji-requirement' style='background-color: "+a.data.data[1].emoticons[c].unlock_show_color+";'><div class='rua-emoji-requirement-text'>"+a.data.data[1].emoticons[c].unlock_show_text+"</div></div></td>";if(e+="</tr>",void 0!==a.data.data[0]&&null!==a.data.data[0])for(let c=0;c<a.data.data[0].emoticons.length;c++)0==c%b&&0!==c&&(e+="</tr><tr>"),e+="<td colspan=1 class=\"rua-emoji-icon\" id=\""+a.data.data[0].emoticons[c].emoticon_unique+"\" style=\"background-image:url("+a.data.data[0].emoticons[c].url+");\"><div class='rua-emoji-requirement' style='background-color: "+a.data.data[0].emoticons[c].unlock_show_color+";'><div class='rua-emoji-requirement-text'>"+a.data.data[0].emoticons[c].unlock_show_text+"</div></div></td>";e+="</tr></tbody>",c.innerHTML=e;for(let a=0;a<c.rows.length;a++){var d=c.rows[a].cells;for(let a=0;a<d.length;a++)d[a].onclick=function(a){0===a.button&&t(this.id,"systemEmoji")}}}0===H.innerHTML.length&&25>=I.innerHTML.length&&(I.innerHTML="<div id='load'>\u5F53\u524D\u76F4\u64AD\u95F4\u6CA1\u6709\u8868\u60C5\u5305\uFF0C<br>\u5982\u663E\u793A\u4E0D\u6B63\u786E\uFF0C\u8BF7<a href="+window.location+">\u70B9\u51FB\u8FD9\u91CC</a>\u91CD\u8BD5<br><br></div>")}).catch(()=>{})}function w(a,b,c,d,f){try{let h=[0,0];b.addEventListener("keyup",function(a){13===a.keyCode&&(a.preventDefault(),t(b.value),b.value="")}),b.addEventListener("keydown",function(a){"Enter"===a.code&&a.preventDefault()}),b.onkeyup=function(){h=y(f,b)},d.addEventListener("mousemove",function(){h=y(f,b)});let j="<thead><tr><th colspan='4' class='rua-table-header'>\u5F39\u5E55\u673A\u8868\u60C5</th></tr></thead>";j+="<tbody><tr>";for(let b=0;b<imgs.length;b++)0==b%a&&0!==b&&(j+="</tr><tr>"),j+="<td colspan="+imgs[b].getSpan()+" class=\"rua-emoji-icon\" style=\"background-image:url("+imgs[b].getURL()+");\"></td>";j+="</tr></tbody>",c.innerHTML=j;for(let d=1;d<c.rows.length;d++){var g=c.rows[d].cells;for(let c=0;c<g.length;c++)g[c].onclick=function(g){0===g.button&&(b.value=b.value.substr(0,h[0])+"("+emoji[c+(d-1)*a]+")"+b.value.substr(h[1]),h=y(f,b))}}}catch(a){c.innerHTML=""}}function x(a,b){a.innerHTML=10>b?" "+b+"/"+l:b+"/"+l}function y(a,b){let c=b.selectionStart,d=b.selectionEnd;return x(a,b.value.length),[c,d]}function z(a){let b=document.getElementById(a),c=[b.offsetLeft,b.offsetTop],d=b.offsetParent;for(;null!==d;)c[0]+=d.offsetLeft,c[1]+=d.offsetTop+d.clientTop,d=d.offsetParent;return c[0]+=b.clientWidth-60,c[1]+=b.clientHeight-60,c}function A(){let a=z("rank-list-vm");k=[e-a[0],a[1],a[0]],k[2]>e-60?(E.style.left=e-60+"px",F.style.left=e-370+"px"):(E.style.left=k[2]+"px",F.style.left=k[2]-310+"px")}function B(){if(null===localStorage.getItem("rua_pos"))A(),j=!1;else if(localStorage.getItem("rua_pos").includes("undefined"))localStorage.removeItem("rua_pos"),A(),j=!1;else{j=!0;for(let a=0;3>a;a++)k[a]=parseInt(localStorage.getItem("rua_pos").split(",")[a]);let a=0;a=k[0]<k[2]?e-k[0]:k[2],k[1]>d-50&&(k[1]=d-50),E.style.left=a+"px",F.style.left=320>a?a+60+"px":a-310+"px"}}function C(a){a?(F.style.background="#151515",G.style.opacity="0.8",K.style.opacity="0.8",J.style.background="#151515",J.style.borderColor="#2b2b2b"):(F.style.removeProperty("background"),G.style.removeProperty("opacity"),K.style.removeProperty("opacity"),J.style.removeProperty("background"),J.style.removeProperty("border-color"))}var d,e,f="-1",g="-1",h=window.innerWidth,i=[];n(),r(),setInterval(r,3e3);var j=!1,k=[100,100,100];const D=document.body,E=document.createElement("div"),F=document.createElement("div"),G=document.createElement("div"),H=document.createElement("table"),I=document.createElement("table"),J=document.createElement("textarea"),K=document.createElement("button"),L=document.createElement("span"),M=document.createElement("span"),N=document.createElement("section"),O=document.createElement("div"),P=document.createElement("input");var l;(function b(){fetch("https://api.live.bilibili.com/room/v1/Room/room_init?id="+a,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(c=>{0===c.code?a=c.data.room_id:setTimeout(b,1e3)}).catch(()=>{setTimeout(b,1e3)})})(),function d(){fetch("https://api.live.bilibili.com/xlive/web-room/v1/index/getInfoByUser?from=0&room_id="+a,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(a=>{0===a.code?(b=a.data.privilege.privilege_type,c=a.data.relation.is_in_fansclub):setTimeout(d,1e3)}).catch(()=>{setTimeout(d,1e3)})}(),0===document.getElementsByTagName("article").length&&o();var m=new MutationObserver(function(a){a.forEach(function(a){"attributes"===a.type&&(null===Q.getAttribute("lab-style")?C(!1):(i=Q.getAttribute("lab-style").split(","),-1===i.indexOf("dark")?C(!1):C(!0)))})});const Q=document.documentElement;m.observe(Q,{attributes:!0})}}();