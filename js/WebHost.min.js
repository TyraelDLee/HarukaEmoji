!function(){let a=window.location.pathname.replaceAll("/","").replace("blanc","");console.log(a);if(/^\d*$/.test(a)){function i(){b=window.innerHeight*1,c=window.innerWidth*1}function m(){z(),C.setAttribute("id","emoji-popup"),C.style.background="url("+chrome.runtime.getURL("../images/haruka/abaaba.svg")+") no-repeat center";try{C.style.background="url("+link+") no-repeat center"}catch(a){}C.style.backgroundSize="contain",C.style.cursor="pointer",C.innerHTML="<!---->",D.setAttribute("id","emoji-selection"),D.classList.add("emoji_sec"),D.style.display="none",D.innerHTML="",E.setAttribute("id","emoji-tray"),E.classList.add("emoji_sec"),E.appendChild(F),E.appendChild(G),F.setAttribute("class","emoji-table"),F.innerHTML="<div id='load'>\u52A0\u8F7D\u5F39\u5E55\u4E2D...</div>",G.setAttribute("class","emoji-table"),D.appendChild(E),B.appendChild(D),B.appendChild(C),C.style.top=j[1]+"px",D.style.top=j[1]-5+"px",I.setAttribute("id","input-button"),I.innerHTML="<span>\u53D1\u9001</span>",I.style.display="none",H.setAttribute("id","input-form"),H.placeholder="\u8FD9\u91CC\u4E5F\u53EF\u4EE5\u53D1\u5F39\u5E55~",H.style.display="none",J.setAttribute("id","length-indicator"),J.style.display="none",L.classList.add("button"),M.classList.add("checkbox"),N.type="checkbox",N.checked=!0,M.appendChild(N),M.appendChild(document.createElement("label")),L.appendChild(M),L.style.display="none",K.setAttribute("id","fullscreen-label"),K.innerHTML="\u5168\u5C4F\u663E\u793A",K.style.display="none",D.appendChild(H),D.appendChild(I),D.appendChild(L),D.appendChild(K),D.appendChild(J);var a=[0,0],d=[0,0];window.onload=function(){C.onmousedown=function(e){let f,g;document.body.style.userSelect="none",C.className="popup-click-in";const i=e||event,k=i.clientX-C.offsetLeft,l=i.clientY-C.offsetTop;a=[C.offsetLeft,C.offsetTop],d=[C.offsetLeft,C.offsetTop],document.onmousemove=function(a){const e=a||event;0<=e.clientX-k&&e.clientX-k<=c-60&&(f=e.clientX-k),0<=e.clientY-l&&e.clientY-l<=b-60&&(g=e.clientY-l),d=[f,g],C.style.left=f+"px",C.style.top=g+"px",D.style.left=320>f?f+60+"px":f-310+"px",D.style.top=g>b-360?b-360+"px":g-5+"px",g===void 0&&(g=C.offsetTop),-1<f&&(j=[c-f,g,f])},document.onmouseup=function(){document.body.style.userSelect="auto",C.className="popup-click-out",n(a[0],a[1],d[0],d[1])?"none"===D.style.display?(D.classList.remove("selection-fade-out"),D.style.display="block",D.classList.add("selection-fade-in")):(D.classList.remove("selection-fade-in"),D.classList.add("selection-fade-out"),setTimeout(()=>{D.style.display="none"},300)):(h=!0,localStorage.setItem("rua_pos",j[0]+","+j[1]+","+j[2])),document.onmousemove=null,document.onmouseup=null}},C.onmouseenter=function(){C.className="popup-click-hoverin"},C.onmouseleave=function(){C.className="popup-click-hoverout"}},window.addEventListener("resize",function(){let a,d=j[0]<j[2]?j[0]/f:j[2]/f;i(),h?(a=j[0]<j[2]?c-j[0]:j[2],C.style.left=a+"px"):y(),j[1]>b-60&&(C.style.top=b-60+"px",D.style.top=b-360+"px"),D.style.left=320>a?a+60+"px":a-310+"px"}),setTimeout(o,5e3)}function n(a,b,c,d){var e=Math.abs;return 0===e(a-c)&&0===e(b-d)}function o(){if(console.log("load complete"),"-1"===d||"-1"===e)F.innerHTML="<div id='load'>\u52A0\u8F7D\u5931\u8D25\uFF0C<br>\u8BF7<a href="+window.location+">\u70B9\u51FB\u8FD9\u91CC</a>\u91CD\u8BD5<br><br>\u5982\u672A\u767B\u5F55\uFF0C\u8BF7\u5148\u767B\u5F55</div>",document.getElementById("load").style.marginTop="130px";else{function a(){n.style.display="none",o.style.display="none",i.style.display="block",j.style.display="block",f.style.display="block",e.style.display="block",document.getElementsByClassName("emoji-fullscreen-danmaku")[0].addEventListener("mouseenter",function(){f.classList.remove("fullscreen-hoverout"),f.classList.add("fullscreen-hoverin")}),document.getElementsByClassName("fullscreen-danmaku")[0].addEventListener("mouseleave",function(){f.classList.remove("fullscreen-hoverin"),f.classList.add("fullscreen-hoverout")}),document.getElementById("live-player").addEventListener("mousemove",c),j.addEventListener("click",function(){r(l.value),l.value="",m.innerHTML=" 0/30"})}function b(){n.style.display="block",o.style.display="block",i.style.display="none",j.style.display="none",f.style.display="none",e.style.display="none",document.getElementById("live-player").removeEventListener("mousemove",c)}function c(){clearTimeout(d),d=setTimeout(function(){f.classList.remove("fullscreen-hoverout")},2e3)}k=0<document.getElementsByClassName("input-limit-hint").length?document.getElementsByClassName("input-limit-hint")[0].innerHTML.split("/")[1]:"20",J.innerHTML=" 0/"+k,H.style.display="block",I.style.display="block",J.style.display="block",L.style.display="block",K.style.display="block",u(4,H,F,D,J),t(4,G),0===F.innerHTML.length&&25>=G.innerHTML.length&&(G.innerHTML="<div id='load'>\u5F53\u524D\u76F4\u64AD\u95F4\u6CA1\u6709\u8868\u60C5\u5305\uFF0C<br>\u5982\u663E\u793A\u4E0D\u6B63\u786E\uFF0C\u8BF7<a href="+window.location+">\u70B9\u51FB\u8FD9\u91CC</a>\u91CD\u8BD5<br><br></div>"),I.onclick=function(){r(H.value),J.innerHTML=" 0/"+document.getElementsByClassName("input-limit-hint")[0].innerHTML.split("/")[1],H.value=""},N.addEventListener("change",function(){this.checked?a():b()});let d=null;const e=document.createElement("div"),f=document.createElement("div"),g=document.createElement("table"),h=document.createElement("table"),i=document.createElement("div"),j=document.createElement("div"),l=document.createElement("input"),m=document.createElement("span"),n=document.getElementsByClassName("fullscreen-danmaku")[0].getElementsByTagName("div")[0],o=document.getElementsByClassName("fullscreen-danmaku")[0].getElementsByTagName("div")[1];(function(){document.getElementsByClassName("fullscreen-danmaku")[0].classList.add("emoji-fullscreen-danmaku"),i.style.display="none",j.style.display="none",f.style.display="none",e.style.display="none",f.classList.add("emoji_sec"),f.setAttribute("id","fullscreen-table"),g.classList.add("emoji-table"),u(8,l,g,f,m),t(8,h),f.appendChild(g),f.appendChild(h),e.setAttribute("id","fs-emoji-bg"),l.placeholder="\u53D1\u4E2A\u5F39\u5E55\u5457~",l.setAttribute("id","fullscreen-input"),m.setAttribute("id","fullscreen-text-length"),m.innerHTML=" 0/30",i.setAttribute("id","first-child"),i.appendChild(l),i.appendChild(m),j.innerHTML="\u53D1\u9001",j.classList.add("send-danmaku"),j.setAttribute("id","fullscreen-sub-btn"),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(i),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(j),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(e),document.getElementsByClassName("emoji-fullscreen-danmaku")[0].appendChild(f)})(),a()}}function p(){try{chrome.runtime.sendMessage({msg:"get_LoginInfo"},function(a){d=a.res.split(",")[0],e=a.res.split(",")[1]})}catch(a){}}function q(){return Math.round(Date.now()/1e3)}function r(b,c){let e=new FormData;e.append("bubble","0"),e.append("msg",b),e.append("color","16777215"),e.append("mode","1"),c!==void 0&&"systemEmoji"===c&&e.append("dm_type","1"),e.append("fontsize","25"),e.append("rnd",q()+""),e.append("roomid",a),e.append("csrf",d),e.append("csrf_token",d),0!==b.length&&s(e)}function s(a){fetch("https://api.live.bilibili.com/msg/send?requestFrom=rua5",{method:"POST",credentials:"include",body:a}).then(()=>{console.log("sent")}).catch(a=>{console.error("Error:",a)})}function t(b,c){fetch("https://api.live.bilibili.com/xlive/web-ucenter/v2/emoticon/GetEmoticons?platform=pc&room_id="+a,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(a=>{if(0===a.code){let e="<tbody><tr>";if(void 0!==a.data.data[1]&&null!==a.data.data[1])for(let c=0;c<a.data.data[1].emoticons.length;c++)0==c%b&&0!==c&&(e+="</tr><tr>"),e+="<td colspan=1 class=\"rua-emoji-icon\" id=\""+a.data.data[1].emoticons[c].emoticon_unique+"\" style=\" background:url("+a.data.data[1].emoticons[c].url+") no-repeat center center; background-size: contain\"></td>";if(e+="</tr>",void 0!==a.data.data[0]&&null!==a.data.data[0])for(let c=0;c<a.data.data[0].emoticons.length;c++)0==c%b&&0!==c&&(e+="</tr><tr>"),e+="<td colspan=1 class=\"rua-emoji-icon\" id=\""+a.data.data[0].emoticons[c].emoticon_unique+"\" style=\" background:url("+a.data.data[0].emoticons[c].url+") no-repeat center center; background-size: contain\"></td>";e+="</tr></tbody>",c.innerHTML=e;for(let a=0;a<c.rows.length;a++){var d=c.rows[a].cells;for(let a=0;a<d.length;a++)d[a].onclick=function(){r(this.id,"systemEmoji")}}}}).catch(()=>{})}function u(a,b,c,d,e){try{let g=[0,0];b.addEventListener("keyup",function(a){13===a.keyCode&&(a.preventDefault(),r(b.value),b.value="")}),b.addEventListener("keydown",function(a){"Enter"===a.code&&a.preventDefault()}),b.onkeyup=function(){g=w(e,b)},d.addEventListener("mousemove",function(){g=w(e,b)});let h="<tbody><tr>";for(let b=0;b<imgs.length;b++)0==b%a&&0!==b&&(h+="</tr><tr>"),h+="<td colspan="+imgs[b].getSpan()+" class=\"rua-emoji-icon\" style=\" background:url("+imgs[b].getURL()+") no-repeat bottom center; background-size: contain\"></td>";h+="</tr></tbody>",c.innerHTML=h;for(let d=0;d<c.rows.length;d++){var f=c.rows[d].cells;for(let c=0;c<f.length;c++)f[c].onclick=function(){b.value=b.value.substr(0,g[0])+"("+emoji[c+d*a]+")"+b.value.substr(g[1]),g=w(e,b)}}}catch(a){c.innerHTML=""}}function v(a,b){a.innerHTML=10>b?" "+b+"/"+k:b+"/"+k}function w(a,b){let c=b.selectionStart,d=b.selectionEnd;return v(a,b.value.length),[c,d]}function x(a){let b=document.getElementById(a),c=[b.offsetLeft,b.offsetTop],d=b.offsetParent;for(;null!==d;)c[0]+=d.offsetLeft,c[1]+=d.offsetTop+d.clientTop,d=d.offsetParent;return c[0]+=b.clientWidth-60,c[1]+=b.clientHeight-60,c}function y(){let a=x("rank-list-vm");j=[c-a[0],a[1],a[0]],j[2]>c-60?(C.style.left=c-60+"px",D.style.left=c-370+"px"):(C.style.left=j[2]+"px",D.style.left=j[2]-310+"px")}function z(){if(null===localStorage.getItem("rua_pos"))y(),h=!1;else if(localStorage.getItem("rua_pos").includes("undefined"))localStorage.removeItem("rua_pos"),y(),h=!1;else{h=!0;for(let a=0;3>a;a++)j[a]=parseInt(localStorage.getItem("rua_pos").split(",")[a]);let a=0;a=j[0]<j[2]?c-j[0]:j[2],j[1]>b-50&&(j[1]=b-50),C.style.left=a+"px",D.style.left=320>a?a+60+"px":a-310+"px"}}function A(a){a?(D.style.background="#151515",E.style.opacity="0.8",I.style.opacity="0.8",H.style.background="#151515",H.style.borderColor="#2b2b2b"):(D.style.removeProperty("background"),E.style.removeProperty("opacity"),I.style.removeProperty("opacity"),H.style.removeProperty("background"),H.style.removeProperty("border-color"))}var b,c,d="-1",e="-1",f=window.innerWidth,g=[];i(),p(),setInterval(p,3e3);var h=!1,j=[100,100,100];const B=document.body,C=document.createElement("div"),D=document.createElement("div"),E=document.createElement("div"),F=document.createElement("table"),G=document.createElement("table"),H=document.createElement("textarea"),I=document.createElement("button"),J=document.createElement("span"),K=document.createElement("span"),L=document.createElement("section"),M=document.createElement("div"),N=document.createElement("input");var k;(function b(){fetch("https://api.live.bilibili.com/room/v1/Room/room_init?id="+a,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(c=>{0===c.code?(a=c.data.room_id,console.log(a)):setTimeout(b,1e3)}).catch(()=>{setTimeout(b,1e3)})})(),0===document.getElementsByTagName("article").length&&m();var l=new MutationObserver(function(a){a.forEach(function(a){"attributes"===a.type&&(null===O.getAttribute("lab-style")?A(!1):(g=O.getAttribute("lab-style").split(","),-1===g.indexOf("dark")?A(!1):A(!0)))})});const O=document.documentElement;l.observe(O,{attributes:!0})}}();