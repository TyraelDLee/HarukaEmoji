(function(){function a(a){const b=document.getElementsByTagName('main')[0];for(let c=0;c<a.length;c++)for(let d=0;d<a[0].length;d++)if(1===a[c][d]){let a=c,e=3+d;const f=document.createElement('img');f.src='../images/svga/13.svg',f.setAttribute('frame','13'),f.setAttribute('moving','1'),f.setAttribute('location',`${a},${e}`),f.setAttribute('style',`height: ${k()}px; width: ${k()}px; top: ${a*k()}px; left: ${e*k()}px`),b.appendChild(f),n[a][e]=1}}function b(a){let b,c=document.getElementsByTagName('main')[0].querySelectorAll('img'),d=!1;return c.forEach((b)=>{if('1'===b.getAttribute('moving')){let c=b.getAttribute('location').split(',')[1]-0,e=b.getAttribute('location').split(',')[0]-0;e<h&&2===n[e+a][c]&&(d=!0)}}),c.forEach((c)=>{if('1'===c.getAttribute('moving')){let e=c.getAttribute('location').split(',')[1]-0,f=c.getAttribute('location').split(',')[0]-0;f<h-1&&!d?(c.setAttribute('location',`${f+a},${e}`),c.style.top=`${(f+a)*k()}px`,n[f][e]=0,n[f+a][e]=1,b=!1):(n[f][e]=2,c.setAttribute('moving','0'),j(0,2),b=!0)}}),b}function c(a){let b,c,e=document.getElementsByTagName('main')[0].querySelectorAll('img'),f=m+1,g=-1;e.forEach((a)=>{'1'===a.getAttribute('moving')&&(a.getAttribute('location').split(',')[1]-0>g&&(g=a.getAttribute('location').split(',')[1]-0,c=a.getAttribute('location').split(',')[0]-0),a.getAttribute('location').split(',')[1]-0<f&&(f=a.getAttribute('location').split(',')[1]-0,b=a.getAttribute('location').split(',')[0]-0))}),d(a)&&(a=0),e.forEach((b)=>{if('1'===b.getAttribute('moving')){let c=b.getAttribute('location').split(',')[1],d=b.getAttribute('location').split(',')[0];b.setAttribute('location',`${d},${c-0+a}`),b.style.left=`${(c-0+a)*k()}px`,n[d-0][c-0]=0,n[d-0][c-0+a]=1}})}function d(a){for(let b=0;b<n.length-1;b++){if(1===n[b][0]&&-1===a)return!0;if(1===n[b][n[b].length-1]&&1===a)return!0;for(let c=0;c<n[b].length;c++)if(1===n[b][c]&&2===n[b][c+a])return!0}return!1}function f(){let a=document.getElementsByTagName('main')[0].querySelectorAll('img'),b=[h+1,-1,m+1,-1],c=[];a.forEach((a)=>{if('1'===a.getAttribute('moving')){let d=a.getAttribute('location').split(',')[0]-0,e=a.getAttribute('location').split(',')[1]-0;c.push([d,e]),b[0]>d&&(b[0]=d),b[1]<d&&(b[1]=d),b[2]>e&&(b[2]=e),b[3]<e&&(b[3]=e)}});let d=[b[0]+l((b[1]-b[0])/2),b[2]+l((b[3]-b[2])/2)],f=[[0,0],[0,0],[0,0],[0,0]],g=0;for(let a=0;a<c.length;a++)f[a][0]=d[0]+d[1]-c[a][1],f[a][1]=d[1]-d[0]+c[a][0];e(f)||(n[c[0][0]][c[0][1]]=0,n[c[1][0]][c[1][1]]=0,n[c[2][0]][c[2][1]]=0,n[c[3][0]][c[3][1]]=0,a.forEach((a)=>{'1'===a.getAttribute('moving')&&(a.setAttribute('location',`${f[g][0]},${f[g][1]}`),a.style.top=`${f[g][0]*k()}px`,a.style.left=`${f[g][1]*k()}px`,g++)}))}function e(a){for(let b=0;b<a.length;b++){if(console.log(a[b][1]),0>a[b][0]||a[b][0]>h-1||0>a[b][1]||a[b][1]>m-1)return!0;if(2===n[a[b][0]][a[b][1]])return!0}return!1}function g(){return-1!==n[0].indexOf(2)}function i(){let a=!1,b=0,c=-1,d=!0;for(let e=0;e<n.length-1;e++)if(-1===n[e].indexOf(1)&&-1===n[e].indexOf(0)){d&&(c=e),d=!1,b=e,a=!0,n[e]=Array(m).fill(0);let f=document.getElementsByTagName('main')[0].querySelectorAll('img');f.forEach((a)=>{a.getAttribute('location').split(',')[0]-0===b&&'0'===a.getAttribute('moving')&&document.getElementsByTagName('main')[0].removeChild(a)})}if(a){let a=[];for(let b=n.length-2;0<=b;b--)if(-1===n[b+1].indexOf(2)&&-1===n[b+1].indexOf(1)){for(let c=0;c<n[b];c++)0!==n[b][c]&&a.push(c);n[b+1]=n[b],n[b]=Array(m).fill(0)}for(let b=0;b<n.length-1;b++)for(let c=0;c<a.length;c++)2===n[b][c]&&0===n[b+1][c]&&(n[b+1][c]=n[b][c],n[b][c]=0)}}function k(){return window.innerWidth/m<window.innerHeight/h?window.innerWidth/m:window.innerHeight/h}function j(a,b){let c=document.getElementsByTagName('main')[0].querySelectorAll('img');c.forEach((c)=>{c.getAttribute('moving')-0===a&&(svga(c,b),setTimeout(()=>{svga(c,0)},600))})}var l=Math.floor;let m,h,n=[];(function(a,b){h=a,m=b;const c=document.getElementsByTagName('main')[0];c.style.height=a*k()+'px',c.style.width=b*k()+'px',n=Array(a).fill(0).map(()=>Array(b).fill(0)),n.push(Array(b).fill(2))})(20,10);const o=[[[1,1,1,1]],[[1,1],[1,1]],[[1,1,1],[0,1,0]],[[0,1,1],[1,1,0]],[[1,1,0],[0,1,1]],[[0,0,1],[1,1,1]],[[1,0,0],[1,1,1]]];a(o[l(Math.random()*(o.length-1))]),setInterval(()=>{b(1)&&!g()&&(i(),setTimeout(()=>{a(o[l(Math.random()*(o.length-1))])},100))},1e3),window.addEventListener('resize',()=>{let a=document.getElementsByTagName('main')[0].querySelectorAll('.game-board-col');a.forEach((a)=>{a.style.height=k()+'px',a.style.width=k()+'px'})}),window.addEventListener('keydown',(d)=>{switch(d.code){case'ArrowUp':f();break;case'ArrowLeft':j(1,1),c(-1);break;case'ArrowRight':j(1,1),c(1);break;case'ArrowDown':j(1,1),b(1)&&!g()&&(i(),setTimeout(()=>{a(o[l(Math.random()*(o.length-1))])},100));}})})();