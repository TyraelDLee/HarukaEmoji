!function(){function e(){I=window.innerHeight*J,F=window.innerWidth*J}function t(e){return 180-8*e.length}function a(e,t,a,i){var d=Math.abs;return 0===d(e-a)&&0===d(t-i)}function i(t){let a=document.getElementById(t),e=[a.offsetLeft,a.offsetTop],i=a.offsetParent;for(;null!==i;)e[0]+=i.offsetLeft,e[1]+=i.offsetTop+i.clientTop,i=i.offsetParent;return e[0]+=a.clientWidth-60,e[1]+=a.clientHeight-60,e}function d(){let e=i("danmukuBox");Z=[F-e[0],e[1],e[0]],Z[2]>F-60?(ee.style.left=F-60+"px",te.style.left=F-370+"px"):(ee.style.left=Z[2]+"px",te.style.left=Z[2]-310+"px")}function n(){if(null===localStorage.getItem("rua_pos"))d(),Q=!1;else if(localStorage.getItem("rua_pos").includes("undefined"))localStorage.removeItem("rua_pos"),d(),Q=!1;else{Q=!0;for(let e=0;3>e;e++)Z[e]=parseInt(localStorage.getItem("rua_pos").split(",")[e]);let e=0;e=Z[0]<Z[2]?F-Z[0]:Z[2],Z[1]>I-50&&(Z[1]=I-50),ee.style.left=e+"px",te.style.left=320>e?e+60+"px":e-310+"px"}}function l(e){e?te.style.background="#151515":te.style.removeProperty("background")}function o(){N=0>N?0:N,U=[],O=[],fetch("https://api.bilibili.com/x/web-interface/view?"+C(_),{method:"GET",credentials:"include",body:null}).then((e)=>e.json()).then((e)=>{if(0===e.code){q=e.data.aid,M=e.data.bvid,O.push(e.data.title);for(let t=0;t<e.data.pages.length;t++)U.push(e.data.pages[t].cid),1<e.data.pages.length&&O.push(e.data.pages[t].part);s(U[N])}})}function s(e){for(ie.innerHTML=`<b style='user-select: none'>视频ID：</b><span>av${q}</span><span style='user-select: none'> / </span><span>${M}</span><span title="复制ID" class="rua-video-info-copy" id="rua-video-info-copy"><svg viewBox="0 0 400 400" width="18" height="18" style="position: absolute" xmlns="http://www.w3.org/2000/svg"><rect width="400" height="400" fill='#aaa' mask='url(#rua-copy-mask)'/><mask id="rua-copy-mask"><rect x='150' y='40' rx="20" ry="20" width="200" height="280" style="fill:#fff" /><rect x="190" y="110" width="120" height="20" fill="black"/><rect x="190" y="160" width="120" height="20" fill="black"/><rect x="190" y="210" width="120" height="20" fill="black"/><rect x='55' y='75' rx="20" ry="20" width="200" height="280" style="fill:#000"/><rect x='50' y='80' rx="20" ry="20" width="200" height="280" style="fill:#fff"/><rect x="90" y="150" width="120" height="20" fill="black"/><rect x="90" y="200" width="120" height="20" fill="black"/><rect x="90" y="250" width="120" height="20" fill="black"/></mask></svg><div id="rua-copy-tips" style="display: none;opacity: 0">视频ID已复制到粘贴板</div></span>`,de.innerText=N-1+2+"p/"+U.length+"p",document.getElementById("rua-video-info-copy").addEventListener("click",()=>{document.getElementById("rua-copy-tips").style.display="block",setTimeout(()=>{document.getElementById("rua-copy-tips").style.opacity="1"},10),setTimeout(()=>{document.getElementById("rua-copy-tips").style.opacity="0"},1e3),setTimeout(()=>{document.getElementById("rua-copy-tips").style.display="none"},1400),navigator.clipboard.writeText(`av号: av${q}\r\nBV号: ${M}\r\ncid: ${e}`).catch(()=>{console.log("Failed to access clipboard, using execCommand.");const t=document.createElement("textarea");t.value=`av号: av${q}\r\nBV号: ${M}\r\ncid: ${e}`,document.body.appendChild(t),t.select(),document.execCommand("Copy"),t.remove()})}),v(),pe.innerHTML="",V=0,z=0,G=new DanmakuArr,W=new DanmakuArr,document.getElementById("rua-danmaku-search-input").value="";oe.hasChildNodes();)oe.firstChild.onmousedown=null,oe.removeChild(oe.firstChild);K=!0,fetch("https://api.bilibili.com/x/player/playurl?bvid="+M+"&cid="+e+"&qn=120&type=flv&fourk=1",{method:"GET",credentials:"include",body:null}).then((e)=>e.json()).then(async(t)=>{if(0===t.code){await u(e,125,"hdr","HDR"),await u(e,127,"8k","8K \u8D85\u9AD8\u6E05");for(let e=0;e<t.data.durl.length;e++)V+=t.data.durl[e].length-1+1;for(let a=0;a<t.data.support_formats.length;a++){j[a]={accept_description:t.data.support_formats[a].new_description,accept_format:t.data.support_formats[a].quality};let i=document.createElement("div");i.setAttribute("id","qn-"+j[a].accept_format),i.classList.add("rua-download-block"),i.innerHTML="<div class='rua-quality-des'>"+j[a].accept_description+"</div>",pe.appendChild(i),H.push(i),i.onclick=()=>{k(M,e,t.data.accept_quality[a],O[0]+(1===O.length?"":O[N+1])+" "+j[a].accept_description)}}pe.style.height=40*P(H.length/3)+"px",r(e,!0,!0),E(e,q,1,x(V))}})}function r(e,t,a){fetch("https://api.bilibili.com/x/player/playurl?bvid="+M+"&cid="+e+"&qn=120&fnval=272",{method:"GET",credentials:"include",body:null}).then((e)=>e.json()).then((i)=>{0===i.code&&null!==i.data&&null!==i.data.dash&&i.data.dash!==void 0&&(null!==i.data.dash.dolby&&t&&p(e,"dolby","\u675C\u6BD4\u5168\u666F\u58F0"),null!==i.data.dash.audio[0].base_url&&a&&p(e,"audio","Sound Only"))})}function p(e,t,a){const i=[`https://api.bilibili.com/x/player/playurl?bvid=${M}&cid=${e}&qn=125&fnval=336`,`https://api.bilibili.com/x/player/playurl?bvid=${M}&cid=${e}&qn=120&fnval=272`,`https://api.bilibili.com/x/player/playurl?cid=${e}&bvid=${M}&qn=127&fourk=1&fnver=0&fnval=4048`];let d=document.createElement("div");d.setAttribute("id",`qn-${t}`),d.classList.add("rua-download-block"),d.innerHTML=`<div class='rua-quality-des'>${a}</div>`,pe.appendChild(d),H.push(d),pe.style.height=40*P(H.length/3)+"px",d.onclick=async()=>{if(!d.classList.contains("rua-downloading")){d.classList.add("rua-downloading");let a=[];await fetch("hdr"===t?i[0]:"8k"===t?i[2]:i[1],{method:"GET",credentials:"include",body:null}).then((e)=>e.json()).then((e)=>{if(0===e.code&&null!==e.data)switch(t){case"hdr":a[0]=e.data.dash.video[0].base_url,a[1]=null===e.data.dash.dolby?e.data.dash.audio[0].base_url:e.data.dash.audio[0].base_url;break;case"audio":a[0]=e.data.dash.audio[0].base_url;break;case"dolby":a[0]=e.data.dash.dolby.audio[0].base_url;break;case"8k":a[0]=e.data.dash.video[0].base_url,a[1]=null===e.data.dash.dolby?e.data.dash.audio[0].base_url:e.data.dash.audio[0].base_url;break;default:}}),await y(a,O[0]+(1===O.length?"":" "+O[N+1]),e,d,t+"Record")}}}async function u(e,t,a,i){await fetch(`https://api.bilibili.com/x/player/playurl?bvid=${M}&cid=${e}&qn=${t}&fourk=1&fnver=0&fnval=4048`,{method:"GET",credentials:"include",body:null}).then((e)=>e.json()).then((d)=>{0===d.code&&null!==d.data&&null!==d.data.dash&&d.data.dash!==void 0&&d.data.dash.video[0].id===t&&p(e,a,i)})}async function y(e,t,a,i,d){let n=i.getElementsByClassName("rua-quality-des")[0].innerText,l=[],o={};i.removeAttribute("title"),l[0]=await g(e[0],i,a,n,"hdrRecord"===d?"\u89C6\u9891":""),("hdrRecord"===d||"8kRecord"===d)&&(l[1]=await g(e[1],i,a,n,"\u97F3\u9891")),"audioRecord"===d&&(o=await f()),m(l,t,d,o).then(()=>{i.removeAttribute("style"),i.removeAttribute("title"),i.classList.remove("rua-downloading"),i.getElementsByClassName("rua-quality-des")[0].innerText=n,window.URL.revokeObjectURL(l[0]),("hdrRecord"===d||"8kRecord"===d)&&window.URL.revokeObjectURL(l[1])})}async function m(e,t,i,d){let n,l,o;const{createFFmpeg:s,fetchFile:r}=FFmpeg,p=s({corePath:T,mainName:"main",log:!1});await p.load(),"audioRecord"===i&&(p.FS("writeFile","audio.m4s",(await r(e[0]))),await p.run("-i","audio.m4s","-c","copy","-metadata",`title=${c(d.title)}`,"-metadata",`artist=${c(d.artist)}`,"-metadata",`year=${d.year}`,"final.m4a"),n=p.FS("readFile","final.m4a"),l=t+".m4a",o=URL.createObjectURL(new Blob([n.buffer],{type:"audio/mp4"}))),"dolbyRecord"===i&&(p.FS("writeFile","audio.m4s",(await r(e[0]))),await p.run("-i","audio.m4s","-c","copy","final.mp4"),n=p.FS("readFile","final.mp4"),l=t+".mp4",o=URL.createObjectURL(new Blob([n.buffer],{type:"audio/mp4"}))),("hdrRecord"===i||"8kRecord"===i)&&(p.FS("writeFile","video.m4s",(await r(e[0]))),p.FS("writeFile","audio.m4s",(await r(e[1]))),await p.run("-i","video.m4s","-i","audio.m4s","-map","0:v","-map","1:a","-c","copy","final.mkv"),n=p.FS("readFile","final.mkv"),l=t+".mkv",o=URL.createObjectURL(new Blob([n.buffer])));const u=document.createElement("a");u.style.display="none",u.href=o,u.download=l,document.body.appendChild(u),u.click(),document.body.removeChild(u),window.URL.revokeObjectURL(o)}function c(e){let t=new TextEncoder("utf8"),a=t.encode(e),d="";for(let t=0;t<a.length;++t)d+=String.fromCharCode(a[t]);return d}async function f(){return fetch(`https://api.bilibili.com/x/web-interface/view?bvid=${M}`,{method:"GET",credentials:"include",body:null}).then((e)=>e.json()).then((e)=>{if(0===e.code&&null!==e.data){let t="";if(null===e.data.staff||e.data.staff===void 0)t=e.data.owner.name;else{for(let a of e.data.staff)t+=a.name+", ";t=t.slice(0,t.length-2)}return{title:e.data.title,artist:t,year:new Date(1e3*(e.data.pubdate-1+1)).getFullYear(),cover:e.data.pic}}return null}).catch(()=>{})}async function g(e,t,a,i,d){let n=0,l=0;return fetch(e,{method:"GET",body:null}).then((e)=>(t.getElementsByClassName("rua-quality-des")[0].innerText=`下载${d}中...`,n=e.headers.get("Content-Length"),e.body)).then((e)=>{const a=e.getReader();return new Response(new ReadableStream({start(e){function i(){return a.read().then((a)=>{const{done:d,value:o}=a;return d&&(e.close(),t.getElementsByClassName("rua-quality-des")[0].innerText="\u8F6C\u7801\u4E2D..."),l+=o.length||0,b(t,100*(l/n)),e.enqueue(o),i()})}return i()}})).blob()}).then((e)=>window.URL.createObjectURL(e)).catch((d)=>{h(t,a,d.toString(),!1,i)})}function b(e,t){e.setAttribute("style","background: linear-gradient(to right, #23ade5 0%, #23ade5 "+t+"%, #fb7299 "+t+"%, #fb7299);")}function h(e,t,a,i,d){function n(){e.removeAttribute("style"),e.removeAttribute("title"),e.getElementsByClassName("rua-quality-des")[0].innerText=d,e.removeEventListener("click",n)}console.log(a),e.classList.remove("rua-downloading"),e.setAttribute("style","background: #ff4650;"),e.setAttribute("title",a),e.getElementsByClassName("rua-quality-des")[0].innerText=i?"\u8F6C\u7801\u5931\u8D25":"\u4E0B\u8F7D\u5931\u8D25",e.addEventListener("click",n)}function k(e,t,a,i){let d=new XMLHttpRequest;d.withCredentials=!0,d.open("GET","https://api.bilibili.com/x/player/playurl?bvid="+M+"&cid="+t+"&qn="+a+"&type=flv&fourk=1"),d.send(null),d.onload=function(){200===d.status&&0===JSON.parse(d.responseText).code&&null!==JSON.parse(d.responseText).data.durl&&D(JSON.parse(d.responseText).data.durl,i,0,JSON.parse(d.responseText).data.durl.length)}}function D(e,t,i,d){const n=e[i].url+"&requestFrom=ruaDL";chrome.runtime.sendMessage({msg:"requestDownload",fileName:t+(1===e.length?"":"_p"+i)});const l=document.createElement("a");document.body.appendChild(l),l.style.display="none",l.href=n,l.target="_Blank",l.referrerPolicy="unsafe-url",l.download,l.click(),document.body.removeChild(l),++i,i<d&&setTimeout(()=>{D(e,t,i,d)},2e3)}function v(){for(let e=0;e<H.length;e++)H[e].onclick=null;H=[]}function C(e){let t="AaBb";if(t.includes(e.charAt(0))&&"Vv".includes(e.charAt(1)))return t.substr(0,2).includes(e.charAt(0))?"aid="+e.replace("av",""):"bvid="+e}function E(e,a,i,d){fetch("https://api.bilibili.com/x/v2/dm/web/seg.so?type=1&oid="+e+"&pid="+a+"&segment_index="+i,{method:"GET",credentials:"include",body:null}).then((e)=>e.arrayBuffer()).then((n)=>{const l=new Uint8Array(n),o=protobuf.Root.fromJSON(dmObj);var s=o.lookupType("bilibili.community.service.dm.v1.DmSegMobileReply");chrome.runtime.sendMessage({msg:"requestDanmaku",danmakuObj:s.decode(l).elems},function(e){if(G.concat(e.danmakuContent),W.concat(e.danmakuContent),z+=e.danmakuPoolSize,document.getElementById("rua-danmaku-size").innerText="\u5171"+z+" \u5F39\u5E55",document.getElementById("rua-input-container").setAttribute("style",`width: ${t(z+"")}px`),oe.style.height=20*W.size+"px",K){for(let e=0;20>e;e++)!L(oe,"rua-danmaku-content","rua-danmaku-"+e)&&e<W.size&&W.get(e).look&&oe.appendChild(S(W.get(e).time,W.get(e).content,W.get(e).mid,e));K=20>W.size}i===d&&(document.getElementById("rua-danmaku-download").setAttribute("style",""),document.getElementById("rua-danmaku-download").innerText="\u5F39\u5E55\u4E0B\u8F7D",R.setTitle(O[0]+(1===O.length?"":O[N+1])))}),i<d&&(i++,E(e,a,i,d))}).catch(()=>{})}function x(e){return P(e/3.6e5)}function B(e){let t=Math.floor(e/20)-5;for(;oe.hasChildNodes();)oe.firstChild.onmousedown=null,oe.removeChild(oe.firstChild);for(let a=0;25>a;a++)void 0!==W.get(t+a)&&oe.appendChild(S(W.get(a+t).time,W.get(a+t).content,W.get(a+t).mid,a+t))}function S(e,t,a,i){const d=document.createElement("div"),n=document.createElement("span"),l=document.createElement("span"),o=e.split(":"),s=[1,60,3600];let r=0;for(let d=o.length-1;0<=d;d--)r+=(o[o.length-1-d]-1+1)*s[d];return d.setAttribute("title",t),d.setAttribute("id","rua-danmaku-"+i),d.style.top=20*i+"px",d.classList.add("rua-danmaku-content"),n.setAttribute("class","seek-video rua-danmaku-time"),n.setAttribute("data-time",r),n.innerText=e,d.appendChild(n),l.classList.add("rua-danmaku"),l.innerText=t,d.appendChild(l),d.onmousedown=function(t){0===t.button&&w(document.body,a,te.style.left.replace("px","")-1+1,t.clientY-140,i)},d}function w(t,e,a,i){const d=document.createElement("div");d.setAttribute("class","rua-danmaku-user-info"),d.setAttribute("style","top:"+i+"px;left:"+a+"px;");const n=document.createElement("div");n.setAttribute("class","rua-danmaku-user-host");const l=document.createElement("div");l.setAttribute("id","rua-user-control-bar"),l.innerHTML="<b style=\"padding-left: 20px;\">\u7528\u6237\u4FE1\u606F</b>";const o=document.createElement("div");if(o.setAttribute("style","position: absolute; top: 2px; left: 280px; width: 14px; height: 14px;"),o.innerHTML="<svg width=\"14\" height=\"14\"><circle cx=\"7\" cy=\"7\" r=\"7\" fill=\"#f16c59\"/><line class=\"rua-cross\" x1=\"4\" y1=\"4\" x2=\"10.5\" y2=\"10.5\" style=\"stroke:#ff5e57;stroke-width:1\"/><line class=\"rua-cross\" x1=\"10.5\" y1=\"4\" x2=\"4\" y2=\"10.5\" style=\"stroke:#ff5e57;stroke-width:1\"/></svg>",l.appendChild(o),0<document.body.getElementsByClassName("rua-danmaku-user-info").length){o.onmouseenter=null,o.onmouseleave=null,o.onmousedown=null,document.getElementById("app").onmousedown=null;for(let e=0;e<document.body.getElementsByClassName("rua-danmaku-user-info").length;e++)document.body.removeChild(document.body.getElementsByClassName("rua-danmaku-user-info")[e])}o.onmouseenter=()=>{for(let e=0;e<o.getElementsByClassName("rua-cross").length;e++)o.getElementsByClassName("rua-cross")[e].style.stroke="#A0000A"},o.onmouseleave=()=>{for(let e=0;e<o.getElementsByClassName("rua-cross").length;e++)o.getElementsByClassName("rua-cross")[e].style.stroke="#ff5e57"},o.onmousedown=(a)=>{0===a.button&&(o.onmouseenter=null,o.onmouseleave=null,o.onmousedown=null,document.getElementById("app").onmousedown=null,t.removeChild(d))};const s=document.createElement("div");s.setAttribute("id","rua-user-host"),s.classList.add("emoji_sec");for(let d=0;d<e.length;d++)chrome.runtime.sendMessage({msg:"requestUserInfo",mid:e[d]},(t)=>{if(0!==t.response.fans||0!==t.response.friend){const a=document.createElement("div");a.setAttribute("class","rua-user");const i=document.createElement("a"),n=document.createElement("img");i.href="https://space.bilibili.com/"+e[d],i.target="_Blank",i.setAttribute("class","rua-user-avatar"),n.classList.add("bili-avatar-img"),n.setAttribute("src",t.response.face.replace("http://","https://")),i.appendChild(n),a.appendChild(i);const l=document.createElement("div");l.setAttribute("style","padding-left: 50px; padding-top: 9px;min-width: 100px;");const o=document.createElement("a");o.href="https://space.bilibili.com/"+e[d],o.target="_Blank";const r=document.createElement("b");r.innerText=t.response.name;const p=document.createElement("a");p.href="https://space.bilibili.com/"+e[d],p.target="_Blank",p.innerText="uid: "+e[d];const u=document.createElement("br");o.appendChild(r),l.appendChild(o),l.appendChild(u),l.appendChild(p),a.appendChild(l),s.appendChild(a)}});n.appendChild(l),n.appendChild(s),d.appendChild(n),t.appendChild(d),document.getElementById("app").onmousedown=()=>{o.onmouseenter=null,o.onmouseleave=null,o.onmousedown=null,document.getElementById("app").onmousedown=null,t.removeChild(d)}}function L(e,t,a){for(let d=0;d<e.getElementsByClassName(t).length;d++)if(e.getElementsByClassName(t)[d].id===a)return!0;return!1}var P=Math.ceil;const A=chrome.runtime.getURL("../images/haruka/abaaba.svg"),T=chrome.runtime.getURL("../ffmpeg/ffmpeg-core.wasm"),R=new AssConvert(1280,720);var I,F,_=window.location.pathname.replaceAll("/","").replace("video",""),q="",M="0",N=null===new URLSearchParams(window.location.search).get("p")?0:new URLSearchParams(window.location.search).get("p")-1,U=[],j={},O=[],H=[],V=0,z=0,G=new DanmakuArr,W=new DanmakuArr,K=!0,Y=window.innerWidth,X=[],J=1;new MutationObserver(()=>{const e=new URLSearchParams(window.location.search).get("p")-1,t=window.location.pathname.replaceAll("/","").replace("video","");null!==new URLSearchParams(window.location.search).get("p")&&N!=e&&(N=e,s(U[e])),null!==t&&t!==_&&(_=t,o())}).observe(document,{subtree:!0,childList:!0}),e();var Q=!1,Z=[100,100,100];const $=document.body,ee=document.createElement("div"),te=document.createElement("div"),ae=document.createElement("div");ae.setAttribute("id","rua-video-info"),ae.style.paddingTop="2px";const ie=document.createElement("div");ie.setAttribute("style","float: left; padding-left:5px"),ae.appendChild(ie);const de=document.createElement("span");de.setAttribute("style","float: right; padding-right:5px; user-select: none;"),ae.appendChild(de);const ne=document.createElement("div");ne.setAttribute("id","rua-danmaku"),ne.classList.add("emoji_sec");const le=document.createElement("div");le.setAttribute("style","width: 300px; position: fixed; background: #fff"),le.innerHTML=`<div style='float: left; padding-left: 5px; user-select: none;'><b>弹幕：</b></div><div style='float: right; padding-right: 5px; user-select: none;' id='rua-danmaku-size'>共${z} 弹幕</div><div style='float: right; padding-right: 5px;user-select: none;cursor: pointer' id='rua-danmaku-search' title='查询弹幕内容'><svg width='18' height='18' viewBox='0 0 18 18' xmlns=\"http://www.w3.org/2000/svg\"><circle cx=\"8\" cy=\"8\" r=\"5\" style=\"stroke:#aaa;stroke-width:2; fill: none\"/><line x1=\"11.5\" y1=\"11.5\" x2=\"15\" y2=\"15\" style=\"stroke:#aaa;stroke-width:2\" /></svg></div><div id='rua-input-container' style='width: ${t(z+"")}px'><textarea id='rua-danmaku-search-input' class='rua-danmaku-search-out' style='display: none' placeholder='输入要查询的弹幕内容'></textarea></div>`;const oe=document.createElement("div");oe.style.position="relative",ne.appendChild(oe);const se=document.createElement("div");se.setAttribute("id","rua-download"),se.classList.add("emoji_sec");const re=document.createElement("div");re.setAttribute("style","width: 290px; position: fixed; background: #fff"),re.innerHTML=`<div style='float: left; user-select: none; padding-left: 5px'><b>视频下载：</b></div><div id="rua-danmaku-download" style="opacity: 0.8; cursor: not-allowed;" title="将弹幕保存为ass文件">加载中</div><div style="float: right; margin: -2px 10px 0 0"><label for="rua-danmaku-intense"></label><select id="rua-danmaku-intense"><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option><option value="7">7</option><option value="8">8</option><option value="9">9</option><option value="10" selected>10</option></select></div><div style="float: right; margin-right: 5px;">弹幕强度</div></div>`;const pe=document.createElement("div");pe.setAttribute("style","margin: 0 0 0 15px;"),se.appendChild(pe),0===document.getElementsByTagName("article").length&&function(){n(),ee.setAttribute("id","emoji-popup"),ee.style.background="url("+A+") no-repeat center",ee.style.backgroundSize="contain",ee.style.cursor="pointer",ee.innerHTML="<!---->",te.setAttribute("id","emoji-selection"),te.classList.add("emoji_sec"),te.style.display="none",te.innerHTML="",te.appendChild(ae),te.appendChild(le),te.appendChild(ne),te.appendChild(re),te.appendChild(se),$.appendChild(te),$.appendChild(ee),ee.style.top=Z[1]+"px",te.style.top=Z[1]-5+"px";var t=[0,0],i=[0,0];window.onload=function(){ee.onmousedown=function(e){let d,n;document.body.style.userSelect="none",ee.className="popup-click-in";const l=e||event,o=l.clientX-ee.offsetLeft,s=l.clientY-ee.offsetTop;t=[ee.offsetLeft,ee.offsetTop],i=[ee.offsetLeft,ee.offsetTop],document.onmousemove=function(e){const t=e||event;0<=t.clientX-o&&t.clientX-o<=F-70&&(d=t.clientX-o),0<=t.clientY-s&&t.clientY-s<=I-60&&(n=t.clientY-s),i=[d,n],ee.style.left=d+"px",ee.style.top=n+"px",te.style.left=320>d?d+60+"px":d-310+"px",te.style.top=n>I-360?I-360+"px":n-5+"px",n===void 0&&(n=ee.offsetTop),-1<d&&(Z=[F-d,n,d])},document.onmouseup=function(){document.body.style.userSelect="auto",ee.className="popup-click-out",a(t[0],t[1],i[0],i[1])?"none"===te.style.display?(te.classList.remove("selection-fade-out"),te.style.display="block",te.classList.add("selection-fade-in")):(te.classList.remove("selection-fade-in"),te.classList.add("selection-fade-out"),setTimeout(()=>{te.style.display="none"},300)):(Q=!0,localStorage.setItem("rua_pos",Z[0]+","+Z[1]+","+Z[2])),document.onmousemove=null,document.onmouseup=null}},ee.onmouseenter=function(){ee.className="popup-click-hoverin"},ee.onmouseleave=function(){ee.className="popup-click-hoverout"}},window.addEventListener("resize",function(){let t,a=Z[0]<Z[2]?Z[0]/Y:Z[2]/Y;e(),Q?(t=Z[0]<Z[2]?F-Z[0]:Z[2],ee.style.left=t+"px"):d(),Z[1]>I-60&&(ee.style.top=I-60+"px",te.style.top=I-360+"px"),te.style.left=320>t?t+60+"px":t-310+"px"}),document.getElementById("rua-danmaku-download").addEventListener("click",()=>{0===document.getElementById("rua-danmaku-download").getAttribute("style").length&&(R.feedDanmaku(G),R.downloadASS())}),document.getElementById("rua-danmaku-intense").addEventListener("change",function(){console.log(this.value);let e=this.value-1+1;R.setWeight(10-e)})}();var ue=new MutationObserver(function(e){e.forEach(function(e){"attributes"===e.type&&(null===ye.getAttribute("lab-style")?l(!1):(X=ye.getAttribute("lab-style").split(","),-1===X.indexOf("dark")?l(!1):l(!0)))})});const ye=document.documentElement;ue.observe(ye,{attributes:!0}),o(),ne.onscroll=function(t){20<=W.size&&B(t.target.scrollTop)},document.getElementById("rua-danmaku-search-input").addEventListener("focus",()=>{document.getElementById("rua-danmaku-search-input").style.borderColor="#23ade5"}),document.getElementById("rua-danmaku-search-input").addEventListener("blur",()=>{document.getElementById("rua-danmaku-search-input").style.borderColor="#aaa"}),document.getElementById("rua-danmaku-search-input").addEventListener("input",(t)=>{W=G.find(t.target.value),oe.style.height=20*W.size+"px",oe.scrollTop=0,B(0)});let me=!1;document.getElementById("rua-danmaku-search").onclick=()=>{me?(me=!1,document.getElementById("rua-danmaku-search-input").classList.remove("rua-danmaku-search-in"),document.getElementById("rua-danmaku-search-input").classList.add("rua-danmaku-search-out"),setTimeout(()=>{document.getElementById("rua-danmaku-search-input").style.display="none"},800)):(me=!0,document.getElementById("rua-danmaku-search-input").style.display="block",document.getElementById("rua-danmaku-search-input").classList.remove("rua-danmaku-search-out"),document.getElementById("rua-danmaku-search-input").classList.add("rua-danmaku-search-in"))}}();const dmObj={nested:{bilibili:{nested:{community:{nested:{service:{nested:{dm:{nested:{v1:{nested:{DM:{methods:{DmSegMobile:{requestType:"DmSegMobileReq",responseType:"DmSegMobileReply"},DmView:{requestType:"DmViewReq",responseType:"DmViewReply"},DmPlayerConfig:{requestType:"DmPlayerConfigReq",responseType:"Response"},DmSegOtt:{requestType:"DmSegOttReq",responseType:"DmSegOttReply"},DmSegSDK:{requestType:"DmSegSDKReq",responseType:"DmSegSDKReply"}}},DmSegSDKReq:{fields:{pid:{type:"int64",id:1},oid:{type:"int64",id:2},type:{type:"int32",id:3},segmentIndex:{type:"int64",id:4}}},DmSegSDKReply:{fields:{closed:{type:"bool",id:1},elems:{rule:"repeated",type:"DanmakuElem",id:2}}},DmSegOttReq:{fields:{pid:{type:"int64",id:1},oid:{type:"int64",id:2},type:{type:"int32",id:3},segmentIndex:{type:"int64",id:4}}},DmSegOttReply:{fields:{closed:{type:"bool",id:1},elems:{rule:"repeated",type:"DanmakuElem",id:2}}},DmSegMobileReq:{fields:{pid:{type:"int64",id:1},oid:{type:"int64",id:2},type:{type:"int32",id:3},segmentIndex:{type:"int64",id:4},teenagersMode:{type:"int32",id:5}}},DmSegMobileReply:{fields:{elems:{rule:"repeated",type:"DanmakuElem",id:1},state:{type:"int32",id:2},aiFlag:{type:"DanmakuAIFlag",id:3}}},DmViewReq:{fields:{pid:{type:"int64",id:1},oid:{type:"int64",id:2},type:{type:"int32",id:3},spmid:{type:"string",id:4},isHardBoot:{type:"int32",id:5}}},DmViewReply:{fields:{closed:{type:"bool",id:1},mask:{type:"VideoMask",id:2},subtitle:{type:"VideoSubtitle",id:3},specialDms:{rule:"repeated",type:"string",id:4},aiFlag:{type:"DanmakuFlagConfig",id:5},playerConfig:{type:"DanmuPlayerViewConfig",id:6},sendBoxStyle:{type:"int32",id:7},allow:{type:"bool",id:8},checkBox:{type:"string",id:9},checkBoxShowMsg:{type:"string",id:10},textPlaceholder:{type:"string",id:11},inputPlaceholder:{type:"string",id:12},reportFilterContent:{rule:"repeated",type:"string",id:13}}},DmWebViewReply:{fields:{state:{type:"int32",id:1},text:{type:"string",id:2},textSide:{type:"string",id:3},dmSge:{type:"DmSegConfig",id:4},flag:{type:"DanmakuFlagConfig",id:5},specialDms:{rule:"repeated",type:"string",id:6},checkBox:{type:"bool",id:7},count:{type:"int64",id:8},commandDms:{rule:"repeated",type:"CommandDm",id:9},playerConfig:{type:"DanmuWebPlayerConfig",id:10},reportFilterContent:{rule:"repeated",type:"string",id:11}}},CommandDm:{fields:{id:{type:"int64",id:1},oid:{type:"int64",id:2},mid:{type:"string",id:3},command:{type:"string",id:4},content:{type:"string",id:5},progress:{type:"int32",id:6},ctime:{type:"string",id:7},mtime:{type:"string",id:8},extra:{type:"string",id:9},idStr:{type:"string",id:10}}},DmSegConfig:{fields:{pageSize:{type:"int64",id:1},total:{type:"int64",id:2}}},VideoMask:{fields:{cid:{type:"int64",id:1},plat:{type:"int32",id:2},fps:{type:"int32",id:3},time:{type:"int64",id:4},maskUrl:{type:"string",id:5}}},VideoSubtitle:{fields:{lan:{type:"string",id:1},lanDoc:{type:"string",id:2},subtitles:{rule:"repeated",type:"SubtitleItem",id:3}}},DanmuWebPlayerConfig:{fields:{dmSwitch:{type:"bool",id:1},aiSwitch:{type:"bool",id:2},aiLevel:{type:"int32",id:3},blocktop:{type:"bool",id:4},blockscroll:{type:"bool",id:5},blockbottom:{type:"bool",id:6},blockcolor:{type:"bool",id:7},blockspecial:{type:"bool",id:8},preventshade:{type:"bool",id:9},dmask:{type:"bool",id:10},opacity:{type:"float",id:11},dmarea:{type:"int32",id:12},speedplus:{type:"float",id:13},fontsize:{type:"float",id:14},screensync:{type:"bool",id:15},speedsync:{type:"bool",id:16},fontfamily:{type:"string",id:17},bold:{type:"bool",id:18},fontborder:{type:"int32",id:19},drawType:{type:"string",id:20}}},SubtitleItem:{fields:{id:{type:"int64",id:1},idStr:{type:"string",id:2},lan:{type:"string",id:3},lanDoc:{type:"string",id:4},subtitleUrl:{type:"string",id:5},author:{type:"UserInfo",id:6}}},UserInfo:{fields:{mid:{type:"int64",id:1},name:{type:"string",id:2},sex:{type:"string",id:3},face:{type:"string",id:4},sign:{type:"string",id:5},rank:{type:"int32",id:6}}},DanmakuElem:{fields:{id:{type:"int64",id:1},progress:{type:"int32",id:2},mode:{type:"int32",id:3},fontsize:{type:"int32",id:4},color:{type:"uint32",id:5},midHash:{type:"string",id:6},content:{type:"string",id:7},ctime:{type:"int64",id:8},weight:{type:"int32",id:9},action:{type:"string",id:10},pool:{type:"int32",id:11},idStr:{type:"string",id:12},attr:{type:"int32",id:13}}},DMAttrBit:{values:{DMAttrBitProtect:0,DMAttrBitFromLive:1,DMAttrHighLike:2}},DmPlayerConfigReq:{fields:{ts:{type:"int64",id:1},switch:{type:"PlayerDanmakuSwitch",id:2},switchSave:{type:"PlayerDanmakuSwitchSave",id:3},useDefaultConfig:{type:"PlayerDanmakuUseDefaultConfig",id:4},aiRecommendedSwitch:{type:"PlayerDanmakuAiRecommendedSwitch",id:5},aiRecommendedLevel:{type:"PlayerDanmakuAiRecommendedLevel",id:6},blocktop:{type:"PlayerDanmakuBlocktop",id:7},blockscroll:{type:"PlayerDanmakuBlockscroll",id:8},blockbottom:{type:"PlayerDanmakuBlockbottom",id:9},blockcolorful:{type:"PlayerDanmakuBlockcolorful",id:10},blockrepeat:{type:"PlayerDanmakuBlockrepeat",id:11},blockspecial:{type:"PlayerDanmakuBlockspecial",id:12},opacity:{type:"PlayerDanmakuOpacity",id:13},scalingfactor:{type:"PlayerDanmakuScalingfactor",id:14},domain:{type:"PlayerDanmakuDomain",id:15},speed:{type:"PlayerDanmakuSpeed",id:16},enableblocklist:{type:"PlayerDanmakuEnableblocklist",id:17},inlinePlayerDanmakuSwitch:{type:"InlinePlayerDanmakuSwitch",id:18}}},Response:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2}}},DanmakuFlag:{fields:{dmid:{type:"int64",id:1},flag:{type:"uint32",id:2}}},DanmakuFlagConfig:{fields:{recFlag:{type:"int32",id:1},recText:{type:"string",id:2},recSwitch:{type:"int32",id:3}}},DanmakuAIFlag:{fields:{dmFlags:{rule:"repeated",type:"DanmakuFlag",id:1}}},DanmuPlayerViewConfig:{fields:{danmukuDefaultPlayerConfig:{type:"DanmuDefaultPlayerConfig",id:1},danmukuPlayerConfig:{type:"DanmuPlayerConfig",id:2},danmukuPlayerDynamicConfig:{rule:"repeated",type:"DanmuPlayerDynamicConfig",id:3}}},DanmuDefaultPlayerConfig:{fields:{playerDanmakuUseDefaultConfig:{type:"bool",id:1},playerDanmakuAiRecommendedSwitch:{type:"bool",id:4},playerDanmakuAiRecommendedLevel:{type:"int32",id:5},playerDanmakuBlocktop:{type:"bool",id:6},playerDanmakuBlockscroll:{type:"bool",id:7},playerDanmakuBlockbottom:{type:"bool",id:8},playerDanmakuBlockcolorful:{type:"bool",id:9},playerDanmakuBlockrepeat:{type:"bool",id:10},playerDanmakuBlockspecial:{type:"bool",id:11},playerDanmakuOpacity:{type:"float",id:12},playerDanmakuScalingfactor:{type:"float",id:13},playerDanmakuDomain:{type:"float",id:14},playerDanmakuSpeed:{type:"int32",id:15},inlinePlayerDanmakuSwitch:{type:"bool",id:16}}},DanmuPlayerConfig:{fields:{playerDanmakuSwitch:{type:"bool",id:1},playerDanmakuSwitchSave:{type:"bool",id:2},playerDanmakuUseDefaultConfig:{type:"bool",id:3},playerDanmakuAiRecommendedSwitch:{type:"bool",id:4},playerDanmakuAiRecommendedLevel:{type:"int32",id:5},playerDanmakuBlocktop:{type:"bool",id:6},playerDanmakuBlockscroll:{type:"bool",id:7},playerDanmakuBlockbottom:{type:"bool",id:8},playerDanmakuBlockcolorful:{type:"bool",id:9},playerDanmakuBlockrepeat:{type:"bool",id:10},playerDanmakuBlockspecial:{type:"bool",id:11},playerDanmakuOpacity:{type:"float",id:12},playerDanmakuScalingfactor:{type:"float",id:13},playerDanmakuDomain:{type:"float",id:14},playerDanmakuSpeed:{type:"int32",id:15},playerDanmakuEnableblocklist:{type:"bool",id:16},inlinePlayerDanmakuSwitch:{type:"bool",id:17},inlinePlayerDanmakuConfig:{type:"int32",id:18}}},DanmuPlayerDynamicConfig:{fields:{progress:{type:"int32",id:1},playerDanmakuDomain:{type:"float",id:2}}},PlayerDanmakuSwitch:{fields:{value:{type:"bool",id:1},canIgnore:{type:"bool",id:2}}},PlayerDanmakuSwitchSave:{fields:{value:{type:"bool",id:1}}},PlayerDanmakuUseDefaultConfig:{fields:{value:{type:"bool",id:1}}},PlayerDanmakuAiRecommendedSwitch:{fields:{value:{type:"bool",id:1}}},PlayerDanmakuAiRecommendedLevel:{fields:{value:{type:"bool",id:1}}},PlayerDanmakuBlocktop:{fields:{value:{type:"bool",id:1}}},PlayerDanmakuBlockscroll:{fields:{value:{type:"bool",id:1}}},PlayerDanmakuBlockbottom:{fields:{value:{type:"bool",id:1}}},PlayerDanmakuBlockcolorful:{fields:{value:{type:"bool",id:1}}},PlayerDanmakuBlockrepeat:{fields:{value:{type:"bool",id:1}}},PlayerDanmakuBlockspecial:{fields:{value:{type:"bool",id:1}}},PlayerDanmakuOpacity:{fields:{value:{type:"float",id:1}}},PlayerDanmakuScalingfactor:{fields:{value:{type:"float",id:1}}},PlayerDanmakuDomain:{fields:{value:{type:"float",id:1}}},PlayerDanmakuSpeed:{fields:{value:{type:"int32",id:1}}},PlayerDanmakuEnableblocklist:{fields:{value:{type:"bool",id:1}}},InlinePlayerDanmakuSwitch:{fields:{value:{type:"bool",id:1}}}}}}}}}}}}}}};