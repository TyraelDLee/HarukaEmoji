!function(){function a(b,c){document.getElementById('app').addEventListener('click',()=>{'TEXTAREA'===document.activeElement.tagName&&(t=document.activeElement)});try{t=document.getElementsByClassName('comment-send')[0].getElementsByTagName('textarea')[0],document.getElementsByClassName('emoji-box')[0].innerHTML='',document.getElementsByClassName('emoji-box')[0].appendChild(g(b,c,[0,0]))}catch(d){setTimeout(()=>{a(b,c)},1e3)}}function b(a){try{document.getElementsByClassName(a)[0].addEventListener('click',()=>{t=document.getElementsByClassName(a)[0].parentElement.getElementsByClassName('textarea-container')[0].getElementsByTagName('textarea')[0]})}catch(a){}}function c(a){let b='AaBb';if(b.includes(a.charAt(0))&&'Vv'.includes(a.charAt(1)))return b.substr(0,2).includes(a.charAt(0))?'aid='+a.replace('av',''):'bvid='+a}function d(){return't.bilibili.com'===i?fetch(`https://api.bilibili.com/x/polymer/web-dynamic/v1/detail?id=${r}`,{method:'GET',credentials:'include',body:null}).then((a)=>a.json()).then((a)=>0===a.code?a.data.item.modules.module_author.mid:-1).catch(()=>-1):s.test(window.location.href)?window.location.pathname.replaceAll('dynamic','').replaceAll('/','')-0:fetch(`https://api.bilibili.com/x/web-interface/view?${c(r)}`,{method:'GET',credentials:'include',body:null}).then((a)=>a.json()).then((a)=>0===a.code?a.data.owner.mid:-1).catch(()=>-1)}function e(a){return fetch(`https://api.bilibili.com/x/emote/live/user/list/v2?appkey=1d8b6e7d45233436&build=6720300&business=reply&mobi_app=android&platform=android&up_mid=${a}`,{method:'GET',credentials:'include',body:null}).then((a)=>a.json()).then((a)=>0===a.code?a.data.list[0]:null).catch(()=>null)}function f(a){return fetch(`https://api.bilibili.com/x/emote/user/panel?aid=0&appkey=1d8b6e7d45233436&build=6720300&business=reply&mobi_app=android&up_mid=${a}`,{method:'GET',credentials:'include',bodu:null}).then((a)=>a.json()).then((a)=>0===a.code?a.data:null).catch(()=>null)}function g(a,b,c,d=!1){function e(c){try{for(const a of document.querySelectorAll('.rua-emoji-type'))n.removeChild(a);for(;f<c;f++)9===a.packages[f].type?n.appendChild(j(a.packages[f].url,f,b.panel_desc,b.emote)):n.appendChild(j(a.packages[f].url,f,a.packages[f].text,a.packages[f].emote))}catch(a){}}let f=1;for(k.innerHTML='',n.innerHTML='',l.innerHTML='',o.innerHTML='',m.innerHTML='',k.setAttribute('style',`--rua-panel-top: ${c[0]}px; --rua-panel-left: ${c[1]}px`),k.classList.add('rua-emoji-panel'),d&&k.classList.add('rua-emoji-panel-bottom'),k.setAttribute('id',d?'rua-emoji-panel-bottom':'rua-emoji-panel'),k.setAttribute('tabindex','1'),l.classList.add('rua-emoji-title'),m.classList.add('rua-emoji-content'),n.classList.add('rua-emoji-tab'),o.classList.add('rua-emoji-slider'),p.setAttribute('style','--2c6ec6e4:#c9ccd0; --72eca176:16px;'),p.classList.add('svg-icon','left-arrow','use-color','slider-pre'),p.innerHTML=`<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.67413 1.57564C7.90844 1.80995 7.90844 2.18985 7.67413 2.42417L4.09839 5.9999L7.67413 9.57564C7.90844 9.80995 7.90844 10.1899 7.67413 10.4242C7.43981 10.6585 7.05992 10.6585 6.8256 10.4242L3.00238 6.60094C2.67043 6.269 2.67043 5.73081 3.00238 5.39886L6.8256 1.57564C7.05992 1.34132 7.43981 1.34132 7.67413 1.57564Z" fill="#A2A7AE"></path></svg>`,5<a.packages.length?q.setAttribute('style','--2c6ec6e4:#61666d; --72eca176:16px;'):q.setAttribute('style','--2c6ec6e4:#c9ccd0; --72eca176:16px;'),q.classList.add('svg-icon','right-arrow','use-color','slider-pre'),q.innerHTML=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.82576 2.07564C5.59145 2.30995 5.59145 2.68985 5.82576 2.92417L10.9015 7.9999L5.82576 13.0756C5.59145 13.31 5.59145 13.6899 5.82576 13.9242C6.06008 14.1585 6.43997 14.1585 6.67429 13.9242L11.9386 8.65987C12.3031 8.29538 12.3031 7.70443 11.9386 7.33994L6.67429 2.07564C6.43997 1.84132 6.06008 1.84132 5.82576 2.07564Z" fill="#E19C2C"></path></svg>`,o.appendChild(p),o.appendChild(q);6>f;f++)9===a.packages[f].type?n.appendChild(j(a.packages[f].url,f,b.panel_desc,b.emote)):n.appendChild(j(a.packages[f].url,f,a.packages[f].text,a.packages[f].emote));for(let e=0;e<a.packages[1].emote.length;e++)m.appendChild(h(a.packages[1].emote[e].url,a.packages[1].emote[e].text,'img','rua-normal-small-emoji'));return p.addEventListener('click',()=>{if(5<a.packages.length&&1<f){f-=10,f=Math.max(f,1),f<a.packages.length&&q.setAttribute('style','--2c6ec6e4:#61666d; --72eca176:16px;'),1===f?p.setAttribute('style','--2c6ec6e4:#c9ccd0; --72eca176:16px;'):p.setAttribute('style','--2c6ec6e4:#61666d; --72eca176:16px;');let b=f+5;e(b)}}),q.addEventListener('click',()=>{if(5<a.packages.length&&f<a.packages.length){f=Math.min(f,a.packages.length-1),1<f&&p.setAttribute('style','--2c6ec6e4:#61666d; --72eca176:16px;'),f+5>a.packages.length-1?q.setAttribute('style','--2c6ec6e4:#c9ccd0; --72eca176:16px;'):q.setAttribute('style','--2c6ec6e4:#61666d; --72eca176:16px;');let b=f+5;e(b)}}),n.appendChild(o),k.appendChild(l),k.appendChild(m),k.appendChild(n),k}function h(a,b,c,d){a=a.replace('http','https');let e=document.createElement('div');return e.classList.add('rua-emoji-info'),e.setAttribute('content',b),e.innerHTML='div'===c?`<div class="${d}" data-v-187455db="">${a}</div>`:`<img class="${d}" src="${a}" data-v-187455db="">`,e.addEventListener('click',()=>{t.focus(),t.value+=e.getAttribute('content')}),e}function j(a,b,c,d){let e=document.createElement('div');return e.setAttribute('content',`${b}`),e.classList.add('rua-emoji-type'),1===b&&(e.classList.add('rua-current-type'),l.innerText=c),e.innerHTML=`<img class="emoji-type-face" src="${a}" data-v-187455db="">`,e.addEventListener('click',()=>{t.focus();for(const a of document.querySelectorAll('.rua-emoji-type'))a.classList.remove('rua-current-type');e.classList.add('rua-current-type'),l.innerText=c,m.innerHTML='';for(let a=0;a<d.length;a++)'tv_\u5C0F\u7535\u89C6'===c?m.appendChild(h(d[a].url,d[a].text,'img','rua-normal-small-emoji')):'\u5C0F\u9EC4\u8138'===c?m.appendChild(h(d[a].url,d[a].text,'img','rua-normal-small-emoji')):'\u989C\u6587\u5B57'===c?m.appendChild(h(d[a].url,d[a].text,'div','rua-text-emoji')):m.appendChild(h(d[a].url,d[a].text,'img','rua-normal-large-emoji'))}),e}const k=document.createElement('div'),l=document.createElement('div'),m=document.createElement('div'),n=document.createElement('div'),o=document.createElement('div'),p=document.createElement('i'),q=document.createElement('i'),i=window.location.host,r=window.location.pathname.replaceAll('/','').replace('video','').replace('bangumi','').replace('play','');let s=/https:\/\/space.bilibili.com\/\d*\/dynamic/,t=null;!async function(){if('t.bilibili.com'===i||r.toUpperCase().includes('BV')||r.toUpperCase().includes('AV')||s.test(window.location.href)){let c=await d(),h=await e(c),j=await f(c);'t.bilibili.com'===i?(a(j,h),b('comment-emoji-lite'),b('comment-emoji')):new MutationObserver((a)=>{a.forEach(function(a){if('childList'===a.type&&a.target.classList.contains('box-active')&&0<a.addedNodes.length){t=a.target.childNodes[0].childNodes[1].childNodes[0];let b=a.addedNodes[0].childNodes[0].childNodes[0];b.addEventListener('click',()=>{a.target.classList.contains('fixed-box')?a.addedNodes[0].childNodes[0].appendChild(g(j,h,[-393,0])):a.addedNodes[0].childNodes[0].appendChild(g(j,h,[30,0]))})}})}).observe(document,{subtree:!0,childList:!0,attributes:!0})}}()}();