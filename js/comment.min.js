!function(){function a(){"TEXTAREA"===document.activeElement.tagName&&(x=document.activeElement)}function b(b,c,d){try{document.getElementById("app").removeEventListener("click",a),document.getElementById("app").addEventListener("click",a),d.appendChild(h(b,c,[0,0]))}catch(b){document.getElementById("app").removeEventListener("click",a)}}function c(a){try{for(let b=0;b<document.getElementsByClassName(a).length;b++)document.getElementsByClassName(a)[b].addEventListener("click",()=>{x=document.getElementsByClassName(a)[b].parentElement.getElementsByClassName("textarea-container")[0].getElementsByTagName("textarea")[0]})}catch(a){console.log(a)}}function d(a){if("AaBb".includes(a.charAt(0))&&"Vv".includes(a.charAt(1)))return"AaBb".substr(0,2).includes(a.charAt(0))?"aid="+a.replace("av",""):"bvid="+a}function e(){return"t.bilibili.com"===t||w.test(window.location.href)?(w.test(window.location.href)&&(u=u.replace("opus","")),fetch(`https://api.bilibili.com/x/polymer/web-dynamic/v1/detail?id=${u}`,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(a=>0===a.code?a.data.item.modules.module_author.mid:-1).catch(()=>-1)):v.test(window.location.href)?window.location.pathname.replaceAll("dynamic","").replaceAll("/","")-0:"cv"===u.substring(0,2)?fetch(`https://api.bilibili.com/x/article/viewinfo?id=${u.substring(2)}`,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(a=>0===a.code?a.data.mid:-1).catch(()=>-1):fetch(`https://api.bilibili.com/x/web-interface/view?${d(u)}`,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(a=>0===a.code?a.data.owner.mid:-1).catch(()=>-1)}function f(a){return fetch(`https://api.bilibili.com/x/emote/live/user/list/v2?appkey=1d8b6e7d45233436&build=6720300&business=reply&mobi_app=android&platform=android&up_mid=${a}`,{method:"GET",credentials:"include",body:null}).then(a=>a.json()).then(a=>0===a.code?a.data.list[0]:null).catch(()=>null)}function g(a){return fetch(`https://api.bilibili.com/x/emote/user/panel?aid=0&appkey=1d8b6e7d45233436&build=6720300&business=reply&mobi_app=android&up_mid=${a}`,{method:"GET",credentials:"include",bodu:null}).then(a=>a.json()).then(a=>0===a.code?a.data:null).catch(()=>null)}function h(a,b,c,d=!1,e=!1){function f(c){try{for(const a of document.querySelectorAll(".rua-emoji-type"))p.removeChild(a);for(;g<c;g++)9===a.packages[g].type?p.appendChild(l(a.packages[g].url,g,b.panel_desc,b.emote)):p.appendChild(l(a.packages[g].url,g,a.packages[g].text,a.packages[g].emote))}catch(a){}}let g=1;if(m.innerHTML="",p.innerHTML="",n.innerHTML="",q.innerHTML="",o.innerHTML="",e||m.setAttribute("style",`--rua-panel-top: ${c[0]}px; --rua-panel-left: ${c[1]}px`),m.classList.add("rua-emoji-panel"),d&&m.classList.add("rua-emoji-panel-bottom"),m.setAttribute("id",d?"rua-emoji-panel-bottom":"rua-emoji-panel"),m.setAttribute("tabindex","1"),n.classList.add("rua-emoji-title"),o.classList.add("rua-emoji-content"),p.classList.add("rua-emoji-tab"),q.classList.add("rua-emoji-slider"),r.setAttribute("style","color: rgb(201, 204, 208); --c1c9b008:#c9ccd0;"),r.classList.add("svg-icon","left-arrow","use-color","slider-pre","rua-arrow"),r.innerHTML=`<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.67413 1.57564C7.90844 1.80995 7.90844 2.18985 7.67413 2.42417L4.09839 5.9999L7.67413 9.57564C7.90844 9.80995 7.90844 10.1899 7.67413 10.4242C7.43981 10.6585 7.05992 10.6585 6.8256 10.4242L3.00238 6.60094C2.67043 6.269 2.67043 5.73081 3.00238 5.39886L6.8256 1.57564C7.05992 1.34132 7.43981 1.34132 7.67413 1.57564Z" fill="#A2A7AE"></path></svg>`,5<a.packages.length?s.setAttribute("style","color: rgb(97, 102, 109); --c1c9b008:#61666d;"):s.setAttribute("style","--e6027e24:#c9ccd0; --78307116:16px;"),s.classList.add("svg-icon","right-arrow","use-color","slider-pre","rua-arrow"),s.innerHTML=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.82576 2.07564C5.59145 2.30995 5.59145 2.68985 5.82576 2.92417L10.9015 7.9999L5.82576 13.0756C5.59145 13.31 5.59145 13.6899 5.82576 13.9242C6.06008 14.1585 6.43997 14.1585 6.67429 13.9242L11.9386 8.65987C12.3031 8.29538 12.3031 7.70443 11.9386 7.33994L6.67429 2.07564C6.43997 1.84132 6.06008 1.84132 5.82576 2.07564Z" fill="#E19C2C"></path></svg>`,q.appendChild(r),q.appendChild(s),5<a.packages.length)for(;6>g;g++)9===a.packages[g].type?p.appendChild(l(a.packages[g].url,g,b.panel_desc,b.emote)):p.appendChild(l(a.packages[g].url,g,a.packages[g].text,a.packages[g].emote));for(let f=0;f<a.packages[1].emote.length;f++)o.appendChild(k(a.packages[1].emote[f].url,a.packages[1].emote[f].text,"img","rua-normal-small-emoji",!1,null));return r.addEventListener("click",()=>{var b=Math.max;if(5<a.packages.length&&1<g){g-=10,g=b(g,1),g<a.packages.length&&s.setAttribute("style","color: rgb(97, 102, 109); --c1c9b008:#c9ccd0;"),1===g?r.setAttribute("style","color: rgb(201, 204, 208); --c1c9b008:#61666d;"):r.setAttribute("style","color: rgb(97, 102, 109); --c1c9b008:#c9ccd0;");let c=g+5;f(c)}}),s.addEventListener("click",()=>{var b=Math.min;if(5<a.packages.length&&g<a.packages.length){g=b(g,a.packages.length-1),1<g&&r.setAttribute("style","color: rgb(97, 102, 109); --c1c9b008:#c9ccd0;"),g+5<a.packages.length-1?s.setAttribute("style","color: rgb(97, 102, 109); --c1c9b008:#c9ccd0;"):s.setAttribute("style","color: rgb(201, 204, 208); --c1c9b008:#61666d;");let c=g+5;f(c)}}),6<a.packages.length&&p.appendChild(q),m.appendChild(n),m.appendChild(o),m.appendChild(p),e?[n,o,p]:m}function k(a,b,c,d,e,f){let g=document.createElement("div");return g.classList.add("rua-emoji-info"),g.setAttribute("content",b),g.innerHTML="div"===c?`<div class="${d}" data-v-187455db="">${a}</div>`:`<img class="${d}" src="${a}" data-v-187455db="">`,null===f||e?g.addEventListener("click",()=>{if(x.focus(),"number"!=typeof x.selectionStart||"number"!=typeof x.selectionEnd)x.value+=g.getAttribute("content");else if(x.selectionStart===x.selectionEnd)x.value=x.value.substring(0,x.selectionStart)+g.getAttribute("content")+x.value.substring(x.selectionEnd,x.value.length);else{let a=x.value.substring(0,x.selectionStart),b=x.value.substring(x.selectionEnd,x.value.length);x.value=a+g.getAttribute("content")+b}x.dispatchEvent(new Event("input"))}):(g.style.position=`relative`,g.getElementsByTagName("img")[0].style.opacity="0.3",g.innerHTML+=`<div class="rua-disabled-text">${f.title}</div>`),g}function l(a,b,c,d){let e=document.createElement("div");return e.setAttribute("content",`${b}`),e.classList.add("rua-emoji-type"),1===b&&(e.classList.add("rua-current-type"),n.innerText=c),e.innerHTML=`<img class="emoji-type-face" src="${a}" data-v-187455db="">`,e.addEventListener("click",()=>{for(const a of document.querySelectorAll(".rua-emoji-type"))a.classList.remove("rua-current-type");e.classList.add("rua-current-type"),n.innerText=c,o.innerHTML="";for(let a=0;a<d.length;a++)"tv_\u5C0F\u7535\u89C6"===c?o.appendChild(k(d[a].url,d[a].text,"img","rua-normal-small-emoji",!1,null)):"\u5C0F\u9EC4\u8138"===c?o.appendChild(k(d[a].url,d[a].text,"img","rua-normal-small-emoji",!1,null)):"\u989C\u6587\u5B57"===c?o.appendChild(k(d[a].url,d[a].text,"div","rua-text-emoji",!1,null)):o.appendChild(k(d[a].url,d[a].text,"img","rua-normal-large-emoji",d[a].flags.unlocked,d[a].activity))}),e}const m=document.createElement("div"),n=document.createElement("div"),o=document.createElement("div"),p=document.createElement("div"),q=document.createElement("div"),r=document.createElement("i"),s=document.createElement("i"),t=window.location.host;let u=window.location.pathname.replaceAll("/","").replace("video","").replace("bangumi","").replace("play","").replace("read",""),v=/https:\/\/space.bilibili.com\/\d*\/dynamic/,w=/https:\/\/www.bilibili.com\/opus\/*/,x=null;!async function(){chrome.storage.sync.get(["commentEmoji"],async a=>{if(a.commentEmoji&&(document.documentElement.setAttribute("emoji","up"),("t.bilibili.com"===t||u.toUpperCase().includes("AV")||u.toUpperCase().includes("BV")||u.toUpperCase().includes("CV")||v.test(window.location.href)||w.test(window.location.href))&&0<u.length)){let a=await e(),d=await f(a),i=await g(a);if(v.test(window.location.href)||u.toUpperCase().includes("CV")){try{c("comment-emoji")}catch(a){console.error(a)}new MutationObserver(a=>{a.forEach(a=>{"childList"===a.type&&a.target.classList.contains("bb-comment")&&0<a.addedNodes.length&&c("comment-emoji"),"childList"===a.type&&a.target.classList.contains("emoji-wrap")&&b(i,d,a.target.parentElement)})}).observe(document,{subtree:!0,childList:!0,attributes:!0})}else{new MutationObserver(async()=>{const b=window.location.pathname.replaceAll("/","").replace("video","").replace("bangumi","").replace("play","").replace("read","").replace("opus","");null!==b&&b!==u&&(u=b,a=await e(),d=await f(a),i=await g(a))}).observe(document,{subtree:!0,childList:!0});let b=null,c=function(){const a=h(i,d,[],!1,!0);if("undefined"!=typeof document.getElementsByClassName("comment-container")[0]){const c=document.getElementsByClassName("comment-container")[0];new MutationObserver(b=>{b.forEach(function(b){if("attributes"===b.type&&b.target.classList.contains("box-active")){const c=b.target.childNodes[0].childNodes[1].childNodes[0].childNodes;let d=0;for(;d<c.length&&"TEXTAREA"!==c.item(d).nodeName.toUpperCase();d++);x=b.target.childNodes[0].childNodes[1].childNodes[0].childNodes[d];const e=b.target.childNodes[1].childNodes[0].childNodes[0].childNodes[1];e.innerHTML="",e.appendChild(a[0]),e.appendChild(a[1]),e.appendChild(a[2]);const f=e.childNodes[0].parentElement;let g=f.getAttribute("style");-1===g.indexOf("110px")?f.getElementsByClassName("rua-emoji-content")[0].setAttribute("style","--rua-emoji-panel-height:196px"):f.getElementsByClassName("rua-emoji-content")[0].setAttribute("style","--rua-emoji-panel-height:110px")}})}).observe(c,{subtree:!0,childList:!0,attributes:!0}),clearInterval(b)}};b=setInterval(c,100)}}})}()}();