!function(){function a(){'TEXTAREA'===document.activeElement.tagName&&(u=document.activeElement)}function b(c,d){document.getElementById('app').addEventListener('click',a);try{document.getElementsByClassName('emoji-box')[0].innerHTML='',document.getElementsByClassName('emoji-box')[0].appendChild(h(c,d,[0,0]))}catch(f){document.getElementById('app').removeEventListener('click',a),setTimeout(()=>{b(c,d)},1e3)}}function c(a){try{document.getElementsByClassName(a)[0].addEventListener('click',()=>{u=document.getElementsByClassName(a)[0].parentElement.getElementsByClassName('textarea-container')[0].getElementsByTagName('textarea')[0]})}catch(b){console.log(b),setTimeout(()=>{c(a)},1e3)}}function d(a){let b='AaBb';if(b.includes(a.charAt(0))&&'Vv'.includes(a.charAt(1)))return b.substr(0,2).includes(a.charAt(0))?'aid='+a.replace('av',''):'bvid='+a}function e(){return't.bilibili.com'===i?fetch(`https://api.bilibili.com/x/polymer/web-dynamic/v1/detail?id=${s}`,{method:'GET',credentials:'include',body:null}).then((a)=>a.json()).then((a)=>0===a.code?a.data.item.modules.module_author.mid:-1).catch(()=>-1):t.test(window.location.href)?window.location.pathname.replaceAll('dynamic','').replaceAll('/','')-0:'cv'===s.substring(0,2)?fetch(`https://api.bilibili.com/x/article/viewinfo?id=${s.substring(2)}`,{method:'GET',credentials:'include',body:null}).then((a)=>a.json()).then((a)=>0===a.code?a.data.mid:-1).catch(()=>-1):fetch(`https://api.bilibili.com/x/web-interface/view?${d(s)}`,{method:'GET',credentials:'include',body:null}).then((a)=>a.json()).then((a)=>0===a.code?a.data.owner.mid:-1).catch(()=>-1)}function f(a){return fetch(`https://api.bilibili.com/x/emote/live/user/list/v2?appkey=1d8b6e7d45233436&build=6720300&business=reply&mobi_app=android&platform=android&up_mid=${a}`,{method:'GET',credentials:'include',body:null}).then((a)=>a.json()).then((a)=>0===a.code?a.data.list[0]:null).catch(()=>null)}function g(a){return fetch(`https://api.bilibili.com/x/emote/user/panel?aid=0&appkey=1d8b6e7d45233436&build=6720300&business=reply&mobi_app=android&up_mid=${a}`,{method:'GET',credentials:'include',bodu:null}).then((a)=>a.json()).then((a)=>0===a.code?a.data:null).catch(()=>null)}function h(a,b,c,d=!1){function e(c){try{for(const a of document.querySelectorAll('.rua-emoji-type'))o.removeChild(a);for(;f<c;f++)9===a.packages[f].type?o.appendChild(j(a.packages[f].url,f,b.panel_desc,b.emote)):o.appendChild(j(a.packages[f].url,f,a.packages[f].text,a.packages[f].emote))}catch(a){}}let f=1;for(l.innerHTML='',o.innerHTML='',m.innerHTML='',p.innerHTML='',n.innerHTML='',l.setAttribute('style',`--rua-panel-top: ${c[0]}px; --rua-panel-left: ${c[1]}px`),l.classList.add('rua-emoji-panel'),d&&l.classList.add('rua-emoji-panel-bottom'),l.setAttribute('id',d?'rua-emoji-panel-bottom':'rua-emoji-panel'),l.setAttribute('tabindex','1'),m.classList.add('rua-emoji-title'),n.classList.add('rua-emoji-content'),o.classList.add('rua-emoji-tab'),p.classList.add('rua-emoji-slider'),q.setAttribute('style','--2c6ec6e4:#c9ccd0; --72eca176:16px;'),q.classList.add('svg-icon','left-arrow','use-color','slider-pre','rua-arrow'),q.innerHTML=`<svg width="12" height="12" viewBox="0 0 12 12" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M7.67413 1.57564C7.90844 1.80995 7.90844 2.18985 7.67413 2.42417L4.09839 5.9999L7.67413 9.57564C7.90844 9.80995 7.90844 10.1899 7.67413 10.4242C7.43981 10.6585 7.05992 10.6585 6.8256 10.4242L3.00238 6.60094C2.67043 6.269 2.67043 5.73081 3.00238 5.39886L6.8256 1.57564C7.05992 1.34132 7.43981 1.34132 7.67413 1.57564Z" fill="#A2A7AE"></path></svg>`,5<a.packages.length?r.setAttribute('style','--2c6ec6e4:#61666d; --72eca176:16px;'):r.setAttribute('style','--2c6ec6e4:#c9ccd0; --72eca176:16px;'),r.classList.add('svg-icon','right-arrow','use-color','slider-pre','rua-arrow'),r.innerHTML=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M5.82576 2.07564C5.59145 2.30995 5.59145 2.68985 5.82576 2.92417L10.9015 7.9999L5.82576 13.0756C5.59145 13.31 5.59145 13.6899 5.82576 13.9242C6.06008 14.1585 6.43997 14.1585 6.67429 13.9242L11.9386 8.65987C12.3031 8.29538 12.3031 7.70443 11.9386 7.33994L6.67429 2.07564C6.43997 1.84132 6.06008 1.84132 5.82576 2.07564Z" fill="#E19C2C"></path></svg>`,p.appendChild(q),p.appendChild(r);6>f;f++)9===a.packages[f].type?o.appendChild(j(a.packages[f].url,f,b.panel_desc,b.emote)):o.appendChild(j(a.packages[f].url,f,a.packages[f].text,a.packages[f].emote));for(let e=0;e<a.packages[1].emote.length;e++)n.appendChild(k(a.packages[1].emote[e].url,a.packages[1].emote[e].text,'img','rua-normal-small-emoji',!1,null));return q.addEventListener('click',()=>{if(5<a.packages.length&&1<f){f-=10,f=Math.max(f,1),f<a.packages.length&&r.setAttribute('style','--2c6ec6e4:#61666d; --72eca176:16px;'),1===f?q.setAttribute('style','--2c6ec6e4:#c9ccd0; --72eca176:16px;'):q.setAttribute('style','--2c6ec6e4:#61666d; --72eca176:16px;');let b=f+5;e(b)}}),r.addEventListener('click',()=>{if(5<a.packages.length&&f<a.packages.length){f=Math.min(f,a.packages.length-1),1<f&&q.setAttribute('style','--2c6ec6e4:#61666d; --72eca176:16px;'),f+5>a.packages.length-1?r.setAttribute('style','--2c6ec6e4:#c9ccd0; --72eca176:16px;'):r.setAttribute('style','--2c6ec6e4:#61666d; --72eca176:16px;');let b=f+5;e(b)}}),o.appendChild(p),l.appendChild(m),l.appendChild(n),l.appendChild(o),l}function k(a,b,c,d,e,f){a=a.replace('http','https');let g=document.createElement('div');return g.classList.add('rua-emoji-info'),g.setAttribute('content',b),g.innerHTML='div'===c?`<div class="${d}" data-v-187455db="">${a}</div>`:`<img class="${d}" src="${a}" data-v-187455db="">`,null===f||e?g.addEventListener('click',()=>{u.focus(),u.value+=g.getAttribute('content'),u.dispatchEvent(new Event('input'))}):(g.style.position=`relative`,g.getElementsByTagName('img')[0].style.opacity='0.3',g.innerHTML+=`<div class="rua-disabled-text">${f.title}</div>`),g}function j(a,b,c,d){let e=document.createElement('div');return e.setAttribute('content',`${b}`),e.classList.add('rua-emoji-type'),1===b&&(e.classList.add('rua-current-type'),m.innerText=c),e.innerHTML=`<img class="emoji-type-face" src="${a}" data-v-187455db="">`,e.addEventListener('click',()=>{for(const a of document.querySelectorAll('.rua-emoji-type'))a.classList.remove('rua-current-type');e.classList.add('rua-current-type'),m.innerText=c,n.innerHTML='';for(let a=0;a<d.length;a++)'tv_\u5C0F\u7535\u89C6'===c?n.appendChild(k(d[a].url,d[a].text,'img','rua-normal-small-emoji',!1,null)):'\u5C0F\u9EC4\u8138'===c?n.appendChild(k(d[a].url,d[a].text,'img','rua-normal-small-emoji',!1,null)):'\u989C\u6587\u5B57'===c?n.appendChild(k(d[a].url,d[a].text,'div','rua-text-emoji',!1,null)):n.appendChild(k(d[a].url,d[a].text,'img','rua-normal-large-emoji',d[a].flags.unlocked,d[a].activity))}),e}const l=document.createElement('div'),m=document.createElement('div'),n=document.createElement('div'),o=document.createElement('div'),p=document.createElement('div'),q=document.createElement('i'),r=document.createElement('i'),i=window.location.host;let s=window.location.pathname.replaceAll('/','').replace('video','').replace('bangumi','').replace('play','').replace('read',''),t=/https:\/\/space.bilibili.com\/\d*\/dynamic/,u=null;!async function(){if(('t.bilibili.com'===i||s.toUpperCase().includes('AV')||s.toUpperCase().includes('BV')||s.toUpperCase().includes('CV')||t.test(window.location.href))&&0<s.length){let a=await e(),d=await f(a),j=await g(a);'t.bilibili.com'===i||t.test(window.location.href)||s.toUpperCase().includes('CV')?(b(j,d),c('comment-emoji-lite'),c('comment-emoji')):(new MutationObserver(async()=>{const b=window.location.pathname.replaceAll('/','').replace('video','').replace('bangumi','').replace('play','').replace('read','');null!==b&&b!==s&&(s=b,a=await e(),d=await f(a),j=await g(a))}).observe(document,{subtree:!0,childList:!0}),new MutationObserver((a)=>{a.forEach(function(a){if('childList'===a.type&&a.target.classList.contains('box-active')&&0<a.addedNodes.length){u=a.target.childNodes[0].childNodes[1].childNodes[0];let b=a.addedNodes[0].childNodes[0].childNodes[0];b.addEventListener('click',()=>{a.target.classList.contains('fixed-box')?a.addedNodes[0].childNodes[0].appendChild(h(j,d,[-393,0])):a.addedNodes[0].childNodes[0].appendChild(h(j,d,[30,0]))})}})}).observe(document,{subtree:!0,childList:!0,attributes:!0}))}}()}();